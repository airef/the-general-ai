(load "The General 1.3/Functions/Reset")

(defrule
(true)
=>
(set-goal g-enemy-swordsmen-count 0)
(set-goal g-enemy-spearmen-count 0)
(set-goal g-enemy-eagle-warriors-count 0)
(set-goal g-enemy-foot-archers-count 0)
(set-goal g-enemy-skirmishers-count 0)
(set-goal g-enemy-cavalry-archers-count 0)
(set-goal g-enemy-hand-cannoneers-count 0)
(set-goal g-enemy-light-cavalry-count 0)
(set-goal g-enemy-heavy-cavalry-count 0)
(set-goal g-enemy-camels-count 0)
(set-goal g-enemy-elephants-count 0)
(set-goal g-enemy-field-siege-count 0)
(set-goal g-enemy-monks-count 0)
(disable-self)
)
(defrule
(true)
=>
(set-goal g-enemy-jaguar-warriors-count 0)
(set-goal g-enemy-huskarls-count 0)
(set-goal g-enemy-chakram-throwers-count 0)
(set-goal g-enemy-samurai-count 0)
(set-goal g-enemy-teutonic-knights-count 0)
(set-goal g-enemy-genoese-crossbowmen-count 0)
(set-goal g-enemy-composite-bowmen-count 0)
(set-goal g-enemy-cataphracts-count 0)
(set-goal g-enemy-mamelukes-count 0)
(disable-self)
)

;Fully count target player's units
;Only count other players' units 1/3 as much
;Also, only count if we have >= 60 villagers or are defending

;----------------------------------------
;	Check if player armies are visible
;----------------------------------------

	;Reset
	(defrule
	(true)
	=>
	(set-goal g-target-army-visible NO)
	(set-goal g-other-enemy-armies-visible NO)
	(set-goal g-total-enemy-soldier-counts 0)
	(set-goal g-temp 0)
	(set-goal g-temp2 0)
	(set-goal g-loop-counter 0)
	)
	
	;Target Player
	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	=>
	(up-get-target-fact military-population 0 g-temp2)
	(up-modify-goal g-temp2 c:%* 67)
	(up-modify-sn sn-focus-player-number s:= sn-target-player-number)
	(up-full-reset-search)
	(up-filter-include cmdid-military -1 -1 monastery-class)
	(up-find-remote c: any-objects c: 40)
	(up-get-search-state g-local-total)
	(up-modify-goal g-temp g:+ g-remote-total)
	(up-modify-goal g-loop-counter c:+ 1)
	)
	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(goal g-remote-total 40)
	(up-compare-goal g-loop-counter < 10)
	=>
	(up-reset-search 0 0 0 1)
	(up-find-remote c: any-objects c: 40)
	(up-get-search-state g-local-total)
	(up-modify-goal g-temp g:+ g-remote-total)
	(up-modify-goal g-loop-counter c:+ 1)
	(up-jump-rule -1)
	)

	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(up-compare-goal g-temp g:>= g-temp2)	;at least 67% of the target player's units are visible
	=>
	(set-goal g-target-army-visible YES)
	(up-modify-goal g-total-enemy-soldier-counts g:+ g-temp)
	)

	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(goal g-target-army-visible NO)
	=>
	(up-get-player-fact target-player unit-type-count militiaman-line g-temp2)
	(up-modify-goal g-total-enemy-soldier-counts g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count throwing-axeman-line g-temp2)
	(up-modify-goal g-total-enemy-soldier-counts g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count berserk-line g-temp2)
	(up-modify-goal g-total-enemy-soldier-counts g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count condottiero g-temp2)
	(up-modify-goal g-total-enemy-soldier-counts g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count kamayuk g-temp2)
	(up-modify-goal g-total-enemy-soldier-counts g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count elite-kamayuk g-temp2)
	(up-modify-goal g-total-enemy-soldier-counts g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count shotel-warrior g-temp2)
	)
	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(goal g-target-army-visible NO)
	=>
	(up-modify-goal g-total-enemy-soldier-counts g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count elite-shotel-warrior g-temp2)
	(up-modify-goal g-total-enemy-soldier-counts g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count gbeto g-temp2)
	(up-modify-goal g-total-enemy-soldier-counts g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count elite-gbeto g-temp2)
	(up-modify-goal g-total-enemy-soldier-counts g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count karambit-warrior g-temp2)
	(up-modify-goal g-total-enemy-soldier-counts g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count elite-karambit-warrior g-temp2)
	(up-modify-goal g-total-enemy-soldier-counts g:+ g-temp2)
	; (up-get-player-fact target-player unit-type-count foot-konnik g-temp2)
	; (up-modify-goal g-total-enemy-soldier-counts g:+ g-temp2)
	; (up-get-player-fact target-player unit-type-count elite-foot-konnik g-temp2)
	; (up-modify-goal g-total-enemy-soldier-counts g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count serjeant-line g-temp2)
	(up-modify-goal g-total-enemy-soldier-counts g:+ g-temp2)
	)
	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(goal g-target-army-visible NO)
	=>
	(up-get-player-fact target-player unit-type-count donjon-serjeant-line g-temp2)
	(up-modify-goal g-total-enemy-soldier-counts g:+ g-temp2)
	; (up-get-player-fact target-player unit-type-count flemish-militia-male g-temp2)
	; (up-modify-goal g-total-enemy-soldier-counts g:+ g-temp2)
	; (up-get-player-fact target-player unit-type-count flemish-militia-female g-temp2)
	; (up-modify-goal g-total-enemy-soldier-counts g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count flemish-militia-trained g-temp2)
	(up-modify-goal g-total-enemy-soldier-counts g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count spearman-line g-temp2)
	(up-modify-goal g-total-enemy-soldier-counts g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count eagle-warrior-line g-temp2)
	(up-modify-goal g-total-enemy-soldier-counts g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count fire-lancer-line g-temp2)
	(up-modify-goal g-total-enemy-soldier-counts g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count ghulam-line g-temp2)
	(up-modify-goal g-total-enemy-soldier-counts g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count archer-line g-temp2)
	(up-modify-goal g-total-enemy-soldier-counts g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count longbowman-line g-temp2)
	)
	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(goal g-target-army-visible NO)
	=>
	(up-modify-goal g-total-enemy-soldier-counts g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count chu-ko-nu-line g-temp2)
	(up-modify-goal g-total-enemy-soldier-counts g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count plumed-archer-line g-temp2)
	(up-modify-goal g-total-enemy-soldier-counts g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count janissary-line g-temp2)
	(up-modify-goal g-total-enemy-soldier-counts g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count rattan-archer g-temp2)
	(up-modify-goal g-total-enemy-soldier-counts g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count elite-rattan-archer g-temp2)
	(up-modify-goal g-total-enemy-soldier-counts g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count skirmisher-line g-temp2)
	(up-modify-goal g-total-enemy-soldier-counts g:+ g-temp2)
	)
	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(goal g-target-army-visible NO)
	=>
	(up-get-player-fact target-player unit-type-count genitour g-temp2)
	(up-modify-goal g-total-enemy-soldier-counts g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count elite-genitour g-temp2)
	(up-modify-goal g-total-enemy-soldier-counts g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count cavalry-archer-line g-temp2)
	(up-modify-goal g-total-enemy-soldier-counts g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count war-wagon-line g-temp2)
	(up-modify-goal g-total-enemy-soldier-counts g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count mangudai-line g-temp2)
	(up-modify-goal g-total-enemy-soldier-counts g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count conquistador-line g-temp2)
	(up-modify-goal g-total-enemy-soldier-counts g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count camel-archer g-temp2)
	)
	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(goal g-target-army-visible NO)
	=>
	(up-modify-goal g-total-enemy-soldier-counts g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count elite-camel-archer g-temp2)
	(up-modify-goal g-total-enemy-soldier-counts g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count arambai g-temp2)
	(up-modify-goal g-total-enemy-soldier-counts g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count elite-arambai g-temp2)
	(up-modify-goal g-total-enemy-soldier-counts g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count kipchak-line g-temp2)
	(up-modify-goal g-total-enemy-soldier-counts g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count elephant-archer-line g-temp2)
	(up-modify-goal g-total-enemy-soldier-counts g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count ratha-melee-line g-temp2)
	(up-modify-goal g-total-enemy-soldier-counts g:+ g-temp2)
	)
	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(goal g-target-army-visible NO)
	=>
	(up-get-player-fact target-player unit-type-count ratha-ranged-line g-temp2)
	(up-modify-goal g-total-enemy-soldier-counts g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count hand-cannoneer g-temp2)
	(up-modify-goal g-total-enemy-soldier-counts g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count slinger g-temp2)
	(up-modify-goal g-total-enemy-soldier-counts g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count scout-cavalry-line g-temp)
	(up-modify-goal g-total-enemy-soldier-counts g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count magyar-huszar g-temp2)
	(up-modify-goal g-total-enemy-soldier-counts g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count elite-magyar-huszar g-temp2)
	(up-modify-goal g-total-enemy-soldier-counts g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count steppe-lancer-line g-temp2)
	)
	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(goal g-target-army-visible NO)
	=>
	(up-modify-goal g-total-enemy-soldier-counts g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count shrivamsha-rider-line g-temp2)
	(up-modify-goal g-total-enemy-soldier-counts g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count knight-line g-temp2)
	(up-modify-goal g-total-enemy-soldier-counts g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count hei-guang-cavalry-line g-temp2)
	(up-modify-goal g-total-enemy-soldier-counts g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count tarkan-line g-temp2)
	(up-modify-goal g-total-enemy-soldier-counts g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count stable-tarkan g-temp2)
	(up-modify-goal g-total-enemy-soldier-counts g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count stable-elite-tarkan g-temp2)
	(up-modify-goal g-total-enemy-soldier-counts g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count boyar g-temp2)
	(up-modify-goal g-total-enemy-soldier-counts g:+ g-temp2)
	)
	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(goal g-target-army-visible NO)
	=>
	(up-get-player-fact target-player unit-type-count elite-boyar g-temp2)
	(up-modify-goal g-total-enemy-soldier-counts g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count konnik-line g-temp2)
	(up-modify-goal g-total-enemy-soldier-counts g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count keshik-line g-temp2)
	(up-modify-goal g-total-enemy-soldier-counts g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count leitis-line g-temp2)
	(up-modify-goal g-total-enemy-soldier-counts g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count coustillier-line g-temp2)
	(up-modify-goal g-total-enemy-soldier-counts g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count camel-line g-temp2)
	(up-modify-goal g-total-enemy-soldier-counts g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count war-elephant-line g-temp2)
	)
	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(goal g-target-army-visible NO)
	=>
	(up-modify-goal g-total-enemy-soldier-counts g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count battle-elephant g-temp2)
	(up-modify-goal g-total-enemy-soldier-counts g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count elite-battle-elephant g-temp2)
	(up-modify-goal g-total-enemy-soldier-counts g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count mangonel-line g-temp2)
	(up-modify-goal g-total-enemy-soldier-counts g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count rocket-cart-line g-temp2)
	(up-modify-goal g-total-enemy-soldier-counts g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count scorpion-line g-temp2)
	(up-modify-goal g-total-enemy-soldier-counts g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count war-chariot-focus-fire g-temp2)
	(up-modify-goal g-total-enemy-soldier-counts g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count war-chariot-barrage g-temp2)
	(up-modify-goal g-total-enemy-soldier-counts g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count organ-gun g-temp2)
	(up-modify-goal g-total-enemy-soldier-counts g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count elite-organ-gun g-temp2)
	(up-modify-goal g-total-enemy-soldier-counts g:+ g-temp2)
	)
	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(goal g-target-army-visible NO)
	=>
	(up-get-player-fact target-player unit-type-count ballista-elephant g-temp2)
	(up-modify-goal g-total-enemy-soldier-counts g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count elite-ballista-elephant g-temp2)
	(up-modify-goal g-total-enemy-soldier-counts g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count hussite-wagon-line g-temp2)
	(up-modify-goal g-total-enemy-soldier-counts g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count monk g-temp2)
	(up-modify-goal g-total-enemy-soldier-counts g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count missionary g-temp2)
	(up-modify-goal g-total-enemy-soldier-counts g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count jaguar-warrior-line g-temp2)
	(up-modify-goal g-total-enemy-soldier-counts g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count urumi-swordsman-line g-temp2)
	)
	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(goal g-target-army-visible NO)
	=>
	(up-modify-goal g-total-enemy-soldier-counts g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count huskarl-line g-temp2)
	(up-modify-goal g-total-enemy-soldier-counts g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count barracks-huskarl g-temp2)
	(up-modify-goal g-total-enemy-soldier-counts g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count barracks-elite-huskarl g-temp2)
	(up-modify-goal g-total-enemy-soldier-counts g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count chakram-thrower-line g-temp2)
	(up-modify-goal g-total-enemy-soldier-counts g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count samurai-line g-temp2)
	(up-modify-goal g-total-enemy-soldier-counts g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count teutonic-knight-line g-temp2)
	(up-modify-goal g-total-enemy-soldier-counts g:+ g-temp2)
	)
	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(goal g-target-army-visible NO)
	=>
	(up-get-player-fact target-player unit-type-count genoese-crossbowman g-temp2)
	(up-modify-goal g-total-enemy-soldier-counts g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count elite-genoese-crossbowman g-temp2)
	(up-modify-goal g-total-enemy-soldier-counts g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count cataphract-line g-temp2)
	(up-modify-goal g-total-enemy-soldier-counts g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count mameluke-line g-temp2)
	(up-modify-goal g-total-enemy-soldier-counts g:+ g-temp2)
	)

	#load-if-defined UP-MULTIPLE-ENEMIES
	
		;Other Players
		(defrule
		(players-military-population any-enemy > 1)
		(player-in-game target-player)
		=>
		(set-strategic-number sn-focus-player-number 1)
		(set-goal g-temp3 0)
		(set-goal g-temp4 0)
		(set-goal g-loop-counter 0)
		(up-get-fact-sum any-enemy military-population 0 g-temp4)
		(up-get-target-fact military-population 0 g-temp2)
		(up-modify-goal g-temp4 g:- g-temp2)	;remove target player's military pop
		(up-modify-goal g-temp4 c:%* 67)
		)

			(defrule
			(players-military-population any-enemy > 1)
			(player-in-game target-player)
			(player-in-game focus-player)
			(stance-toward focus-player enemy)
			(strategic-number sn-focus-player-number s:!= sn-target-player-number)
			=>
			(up-full-reset-search)
			(up-filter-include cmdid-military -1 -1 monastery-class)
			(up-find-remote c: any-objects c: 40)
			(up-get-search-state g-local-total)
			(up-modify-goal g-temp3 g:+ g-remote-total)
			(up-modify-goal g-loop-counter c:+ 1)
			)
			(defrule
			(players-military-population any-enemy > 1)
			(player-in-game target-player)
			(player-in-game focus-player)
			(stance-toward focus-player enemy)
			(strategic-number sn-focus-player-number s:!= sn-target-player-number)
			(goal g-remote-total 40)
			(up-compare-goal g-loop-counter < 10)
			=>
			(up-reset-search 0 0 0 1)
			(up-find-remote c: any-objects c: 40)
			(up-get-search-state g-local-total)
			(up-modify-goal g-temp3 g:+ g-remote-total)
			(up-modify-goal g-loop-counter c:+ 1)
			(up-jump-rule -1)
			)
			(defrule
			(players-military-population any-enemy > 1)
			(player-in-game target-player)
			(up-compare-sn sn-focus-player-number < MAX-PLAYERS)
			=>
			(up-modify-sn sn-focus-player-number c:+ 1)
			(set-goal g-loop-counter 0)
			(up-jump-rule -3)
			)

		(defrule
		(players-military-population any-enemy > 1)
		(player-in-game target-player)
		(up-compare-goal g-temp3 g:>= g-temp4)	;at least 67% of other enemy player's units are visible
		=>
		(set-goal g-other-enemy-armies-visible YES)
		(up-modify-goal g-temp3 c:/ 3)
		(up-modify-goal g-total-enemy-soldier-counts g:+ g-temp3)
		)

		(defrule
		(players-military-population any-enemy > 1)
		(player-in-game target-player)
		(goal g-other-enemy-armies-visible NO)
		=>
		(set-strategic-number sn-focus-player-number 1)
		(set-goal g-temp 0)
		)
		
			(defrule
			(players-military-population any-enemy > 1)
			(player-in-game target-player)
			(goal g-other-enemy-armies-visible NO)
			(up-compare-sn sn-focus-player-number <= MAX-PLAYERS)
			(or
				(up-compare-sn sn-focus-player-number s:== sn-target-player-number)
				(nor
					(player-in-game focus-player)
					(stance-toward focus-player enemy)))
			=>
			(up-modify-sn sn-focus-player-number c:+ 1)
			(up-jump-rule -1)
			)

			(defrule
			(players-military-population any-enemy > 1)
			(player-in-game target-player)
			(goal g-other-enemy-armies-visible NO)
			=>
			(up-get-player-fact focus-player unit-type-count militiaman-line g-temp2)
			(up-modify-goal g-temp g:+ g-temp2)
			(up-get-player-fact focus-player unit-type-count coustillier-line g-temp2)
			(up-modify-goal g-temp g:+ g-temp2)
			(up-get-player-fact focus-player unit-type-count throwing-axeman-line g-temp2)
			(up-modify-goal g-temp g:+ g-temp2)
			(up-get-player-fact focus-player unit-type-count berserk-line g-temp2)
			(up-modify-goal g-temp g:+ g-temp2)
			(up-get-player-fact focus-player unit-type-count condottiero g-temp2)
			(up-modify-goal g-temp g:+ g-temp2)
			(up-get-player-fact focus-player unit-type-count kamayuk g-temp2)
			(up-modify-goal g-temp g:+ g-temp2)
			(up-get-player-fact focus-player unit-type-count elite-kamayuk g-temp2)
			(up-modify-goal g-temp g:+ g-temp2)
			(up-get-player-fact focus-player unit-type-count shotel-warrior g-temp2)
			)
			(defrule
			(players-military-population any-enemy > 1)
			(player-in-game target-player)
			(goal g-other-enemy-armies-visible NO)
			=>
			(up-modify-goal g-temp g:+ g-temp2)
			(up-get-player-fact focus-player unit-type-count elite-shotel-warrior g-temp2)
			(up-modify-goal g-temp g:+ g-temp2)
			(up-get-player-fact focus-player unit-type-count gbeto g-temp2)
			(up-modify-goal g-temp g:+ g-temp2)
			(up-get-player-fact focus-player unit-type-count elite-gbeto g-temp2)
			(up-modify-goal g-temp g:+ g-temp2)
			(up-get-player-fact focus-player unit-type-count karambit-warrior g-temp2)
			(up-modify-goal g-temp g:+ g-temp2)
			(up-get-player-fact focus-player unit-type-count elite-karambit-warrior g-temp2)
			(up-modify-goal g-temp g:+ g-temp2)
			; (up-get-player-fact focus-player unit-type-count foot-konnik g-temp2)
			; (up-modify-goal g-temp g:+ g-temp2)
			; (up-get-player-fact focus-player unit-type-count elite-foot-konnik g-temp2)
			; (up-modify-goal g-temp g:+ g-temp2)
			(up-get-player-fact focus-player unit-type-count serjeant-line g-temp2)
			(up-modify-goal g-temp g:+ g-temp2)
			(up-get-player-fact focus-player unit-type-count liao-dao-line g-temp2)
			(up-modify-goal g-temp g:+ g-temp2)
			(up-get-player-fact focus-player unit-type-count white-feather-guard-line g-temp2)
			(up-modify-goal g-temp g:+ g-temp2)
			)
			(defrule
			(players-military-population any-enemy > 1)
			(player-in-game target-player)
			(goal g-other-enemy-armies-visible NO)
			=>
			(up-get-player-fact focus-player unit-type-count donjon-serjeant-line g-temp2)
			(up-modify-goal g-temp g:+ g-temp2)
			; (up-get-player-fact focus-player unit-type-count flemish-militia-male g-temp2)
			; (up-modify-goal g-temp g:+ g-temp2)
			; (up-get-player-fact focus-player unit-type-count flemish-militia-female g-temp2)
			; (up-modify-goal g-temp g:+ g-temp2)
			(up-get-player-fact focus-player unit-type-count flemish-militia-trained g-temp2)
			(up-modify-goal g-temp g:+ g-temp2)
			(up-get-player-fact focus-player unit-type-count spearman-line g-temp2)
			(up-modify-goal g-temp g:+ g-temp2)
			(up-get-player-fact focus-player unit-type-count eagle-warrior-line g-temp2)
			(up-modify-goal g-temp g:+ g-temp2)
			(up-get-player-fact focus-player unit-type-count fire-lancer-line g-temp2)
			(up-modify-goal g-temp g:+ g-temp2)
			(up-get-player-fact focus-player unit-type-count jian-swordsman g-temp2)
			(up-modify-goal g-temp g:+ g-temp2)
			(up-get-player-fact focus-player unit-type-count ghulam-line g-temp2)
			(up-modify-goal g-temp g:+ g-temp2)
			(up-get-player-fact focus-player unit-type-count archer-line g-temp2)
			(up-modify-goal g-temp g:+ g-temp2)
			(up-get-player-fact focus-player unit-type-count longbowman-line g-temp2)
			)
			(defrule
			(players-military-population any-enemy > 1)
			(player-in-game target-player)
			(goal g-other-enemy-armies-visible NO)
			=>
			(up-modify-goal g-temp g:+ g-temp2)
			(up-get-player-fact focus-player unit-type-count chu-ko-nu-line g-temp2)
			(up-modify-goal g-temp g:+ g-temp2)
			(up-get-player-fact focus-player unit-type-count plumed-archer-line g-temp2)
			(up-modify-goal g-temp g:+ g-temp2)
			(up-get-player-fact focus-player unit-type-count composite-bowman-line g-temp2)
			(up-modify-goal g-temp g:+ g-temp2)
			(up-get-player-fact focus-player unit-type-count fire-archer-line g-temp2)
			(up-modify-goal g-temp g:+ g-temp2)
			(up-get-player-fact focus-player unit-type-count janissary-line g-temp2)
			(up-modify-goal g-temp g:+ g-temp2)
			(up-get-player-fact focus-player unit-type-count rattan-archer g-temp2)
			(up-modify-goal g-temp g:+ g-temp2)
			(up-get-player-fact focus-player unit-type-count elite-rattan-archer g-temp2)
			(up-modify-goal g-temp g:+ g-temp2)
			(up-get-player-fact focus-player unit-type-count skirmisher-line g-temp2)
			(up-modify-goal g-temp g:+ g-temp2)
			)
			(defrule
			(players-military-population any-enemy > 1)
			(player-in-game target-player)
			(goal g-other-enemy-armies-visible NO)
			=>
			(up-get-player-fact focus-player unit-type-count genitour g-temp2)
			(up-modify-goal g-temp g:+ g-temp2)
			(up-get-player-fact focus-player unit-type-count elite-genitour g-temp2)
			(up-modify-goal g-temp g:+ g-temp2)
			(up-get-player-fact focus-player unit-type-count cavalry-archer-line g-temp2)
			(up-modify-goal g-temp g:+ g-temp2)
			(up-get-player-fact focus-player unit-type-count war-wagon-line g-temp2)
			(up-modify-goal g-temp g:+ g-temp2)
			(up-get-player-fact focus-player unit-type-count mangudai-line g-temp2)
			(up-modify-goal g-temp g:+ g-temp2)
			(up-get-player-fact focus-player unit-type-count xianbei-raider g-temp2)
			(up-modify-goal g-temp g:+ g-temp2)
			(up-get-player-fact focus-player unit-type-count conquistador-line g-temp2)
			(up-modify-goal g-temp g:+ g-temp2)
			(up-get-player-fact focus-player unit-type-count camel-archer g-temp2)
			)
			(defrule
			(players-military-population any-enemy > 1)
			(player-in-game target-player)
			(goal g-other-enemy-armies-visible NO)
			=>
			(up-modify-goal g-temp g:+ g-temp2)
			(up-get-player-fact focus-player unit-type-count elite-camel-archer g-temp2)
			(up-modify-goal g-temp g:+ g-temp2)
			(up-get-player-fact focus-player unit-type-count arambai g-temp2)
			(up-modify-goal g-temp g:+ g-temp2)
			(up-get-player-fact focus-player unit-type-count elite-arambai g-temp2)
			(up-modify-goal g-temp g:+ g-temp2)
			(up-get-player-fact focus-player unit-type-count kipchak-line g-temp2)
			(up-modify-goal g-temp g:+ g-temp2)
			(up-get-player-fact focus-player unit-type-count elephant-archer-line g-temp2)
			(up-modify-goal g-temp g:+ g-temp2)
			(up-get-player-fact focus-player unit-type-count ratha-melee-line g-temp2)
			(up-modify-goal g-temp g:+ g-temp2)
			)
			(defrule
			(players-military-population any-enemy > 1)
			(player-in-game target-player)
			(goal g-other-enemy-armies-visible NO)
			=>
			(up-get-player-fact focus-player unit-type-count ratha-ranged-line g-temp2)
			(up-modify-goal g-temp g:+ g-temp2)
			(up-get-player-fact focus-player unit-type-count hand-cannoneer g-temp2)
			(up-modify-goal g-temp g:+ g-temp2)
			(up-get-player-fact focus-player unit-type-count slinger g-temp2)
			(up-modify-goal g-temp g:+ g-temp2)
			(up-get-player-fact focus-player unit-type-count grenadier g-temp2)
			(up-modify-goal g-temp g:+ g-temp2)
			(up-get-player-fact focus-player unit-type-count scout-cavalry-line g-temp)
			(up-modify-goal g-temp g:+ g-temp2)
			(up-get-player-fact focus-player unit-type-count magyar-huszar g-temp2)
			(up-modify-goal g-temp g:+ g-temp2)
			(up-get-player-fact focus-player unit-type-count elite-magyar-huszar g-temp2)
			(up-modify-goal g-temp g:+ g-temp2)
			(up-get-player-fact focus-player unit-type-count steppe-lancer-line g-temp2)
			)
			(defrule
			(players-military-population any-enemy > 1)
			(player-in-game target-player)
			(goal g-other-enemy-armies-visible NO)
			=>
			(up-modify-goal g-temp g:+ g-temp2)
			(up-get-player-fact focus-player unit-type-count shrivamsha-rider-line g-temp2)
			(up-modify-goal g-temp g:+ g-temp2)
			(up-get-player-fact focus-player unit-type-count knight-line g-temp2)
			(up-modify-goal g-temp g:+ g-temp2)
			(up-get-player-fact focus-player unit-type-count hei-guang-cavalry-line g-temp2)
			(up-modify-goal g-temp g:+ g-temp2)
			(up-get-player-fact focus-player unit-type-count tarkan-line g-temp2)
			(up-modify-goal g-temp g:+ g-temp2)
			(up-get-player-fact focus-player unit-type-count stable-tarkan g-temp2)
			(up-modify-goal g-temp g:+ g-temp2)
			(up-get-player-fact focus-player unit-type-count stable-elite-tarkan g-temp2)
			(up-modify-goal g-temp g:+ g-temp2)
			(up-get-player-fact focus-player unit-type-count boyar g-temp2)
			(up-modify-goal g-temp g:+ g-temp2)
			)
			(defrule
			(players-military-population any-enemy > 1)
			(player-in-game target-player)
			(goal g-other-enemy-armies-visible NO)
			=>
			(up-get-player-fact focus-player unit-type-count elite-boyar g-temp2)
			(up-modify-goal g-temp g:+ g-temp2)
			(up-get-player-fact focus-player unit-type-count konnik-line g-temp2)
			(up-modify-goal g-temp g:+ g-temp2)
			(up-get-player-fact focus-player unit-type-count keshik-line g-temp2)
			(up-modify-goal g-temp g:+ g-temp2)
			(up-get-player-fact focus-player unit-type-count leitis-line g-temp2)
			(up-modify-goal g-temp g:+ g-temp2)
			(up-get-player-fact focus-player unit-type-count coustillier-line g-temp2)
			(up-modify-goal g-temp g:+ g-temp2)
			(up-get-player-fact focus-player unit-type-count monaspa-line g-temp2)
			(up-modify-goal g-temp g:+ g-temp2)
			(up-get-player-fact focus-player unit-type-count iron-pagoda-line g-temp2)
			(up-modify-goal g-temp g:+ g-temp2)
			(up-get-player-fact focus-player unit-type-count tiger-cavalry-line g-temp2)
			(up-modify-goal g-temp g:+ g-temp2)
			(up-get-player-fact focus-player unit-type-count camel-line g-temp2)
			(up-modify-goal g-temp g:+ g-temp2)
			(up-get-player-fact focus-player unit-type-count war-elephant-line g-temp2)
			)
			(defrule
			(players-military-population any-enemy > 1)
			(player-in-game target-player)
			(goal g-other-enemy-armies-visible NO)
			=>
			(up-modify-goal g-temp g:+ g-temp2)
			(up-get-player-fact focus-player unit-type-count battle-elephant g-temp2)
			(up-modify-goal g-temp g:+ g-temp2)
			(up-get-player-fact focus-player unit-type-count elite-battle-elephant g-temp2)
			(up-modify-goal g-temp g:+ g-temp2)
			(up-get-player-fact focus-player unit-type-count mangonel-line g-temp2)
			(up-modify-goal g-temp g:+ g-temp2)
			(up-get-player-fact focus-player unit-type-count rocket-cart-line g-temp2)
			(up-modify-goal g-temp g:+ g-temp2)
			(up-get-player-fact focus-player unit-type-count scorpion-line g-temp2)
			(up-modify-goal g-temp g:+ g-temp2)
			(up-get-player-fact focus-player unit-type-count war-chariot-focus-fire g-temp2)
			(up-modify-goal g-temp g:+ g-temp2)
			(up-get-player-fact focus-player unit-type-count war-chariot-barrage g-temp2)
			(up-modify-goal g-temp g:+ g-temp2)
			(up-get-player-fact focus-player unit-type-count organ-gun g-temp2)
			(up-modify-goal g-temp g:+ g-temp2)
			(up-get-player-fact focus-player unit-type-count elite-organ-gun g-temp2)
			(up-modify-goal g-temp g:+ g-temp2)
			)
			(defrule
			(players-military-population any-enemy > 1)
			(player-in-game target-player)
			(goal g-other-enemy-armies-visible NO)
			=>
			(up-get-player-fact focus-player unit-type-count ballista-elephant g-temp2)
			(up-modify-goal g-temp g:+ g-temp2)
			(up-get-player-fact focus-player unit-type-count elite-ballista-elephant g-temp2)
			(up-modify-goal g-temp g:+ g-temp2)
			(up-get-player-fact focus-player unit-type-count hussite-wagon-line g-temp2)
			(up-modify-goal g-temp g:+ g-temp2)
			(up-get-player-fact focus-player unit-type-count monk g-temp2)
			(up-modify-goal g-temp g:+ g-temp2)
			(up-get-player-fact focus-player unit-type-count missionary g-temp2)
			(up-modify-goal g-temp g:+ g-temp2)
			(up-get-player-fact focus-player unit-type-count jaguar-warrior-line g-temp2)
			(up-modify-goal g-temp g:+ g-temp2)
			(up-get-player-fact focus-player unit-type-count urumi-swordsman-line g-temp2)
			)
			(defrule
			(players-military-population any-enemy > 1)
			(player-in-game target-player)
			(goal g-other-enemy-armies-visible NO)
			=>
			(up-modify-goal g-temp g:+ g-temp2)
			(up-get-player-fact focus-player unit-type-count huskarl-line g-temp2)
			(up-modify-goal g-temp g:+ g-temp2)
			(up-get-player-fact focus-player unit-type-count barracks-huskarl g-temp2)
			(up-modify-goal g-temp g:+ g-temp2)
			(up-get-player-fact focus-player unit-type-count barracks-elite-huskarl g-temp2)
			(up-modify-goal g-temp g:+ g-temp2)
			(up-get-player-fact focus-player unit-type-count chakram-thrower-line g-temp2)
			(up-modify-goal g-temp g:+ g-temp2)
			(up-get-player-fact focus-player unit-type-count samurai-line g-temp2)
			(up-modify-goal g-temp g:+ g-temp2)
			(up-get-player-fact focus-player unit-type-count teutonic-knight-line g-temp2)
			(up-modify-goal g-temp g:+ g-temp2)
			)
			(defrule
			(players-military-population any-enemy > 1)
			(player-in-game target-player)
			(goal g-other-enemy-armies-visible NO)
			=>
			(up-get-player-fact focus-player unit-type-count genoese-crossbowman g-temp2)
			(up-modify-goal g-temp g:+ g-temp2)
			(up-get-player-fact focus-player unit-type-count elite-genoese-crossbowman g-temp2)
			(up-modify-goal g-temp g:+ g-temp2)
			(up-get-player-fact focus-player unit-type-count cataphract-line g-temp2)
			(up-modify-goal g-temp g:+ g-temp2)
			(up-get-player-fact focus-player unit-type-count mameluke-line g-temp2)
			(up-modify-goal g-temp g:+ g-temp2)
			)

			(defrule
			(players-military-population any-enemy > 1)
			(player-in-game target-player)
			(goal g-other-enemy-armies-visible NO)
			(up-compare-sn sn-focus-player-number < MAX-PLAYERS)
			=>
			(up-modify-sn sn-focus-player-number c:+ 1)
			(up-jump-rule -15)
			)

		(defrule
		(players-military-population any-enemy > 1)
		(player-in-game target-player)
		(goal g-other-enemy-armies-visible NO)
		=>
		(up-modify-goal g-temp c:/ 3)
		(up-modify-goal g-total-enemy-soldier-counts g:+ g-temp)
		)

	#end-if

;---------------
;	Swordsmen
;---------------

	(load "The General 1.3/Functions/Reset Mini")

	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(goal g-target-army-visible YES)
	=>
	(set-goal g-temp 0)
	)

	;Target DUC Counting
	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(goal g-target-army-visible YES)
	(not
		(players-civ target-player malian))
	=>
	(up-modify-sn sn-focus-player-number s:= sn-target-player-number)
	(up-full-reset-search)
	(up-find-remote c: militiaman-line c: 40)
	(up-get-search-state g-local-total)
	(up-modify-goal g-temp g:+ g-remote-total)
	)
	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(goal g-target-army-visible YES)
	=>
	(up-modify-sn sn-focus-player-number s:= sn-target-player-number)
	(up-full-reset-search)
	(up-find-remote c: condottiero c: 40)
	(up-get-search-state g-local-total)
	(up-modify-goal g-temp g:+ g-remote-total)
	)
	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(goal g-target-army-visible YES)
	=>
	(up-find-remote c: woad-raider-line c: 40)
	(up-find-remote c: throwing-axeman-line c: 40)
	(up-find-remote c: berserk-line c: 40)
	(up-find-remote c: kamayuk c: 40)
	(up-find-remote c: elite-kamayuk c: 40)
	(up-find-remote c: shotel-warrior c: 40)
	(up-find-remote c: elite-shotel-warrior c: 40)
	(up-find-remote c: gbeto c: 40)
	(up-find-remote c: elite-gbeto c: 40)
	(up-find-remote c: karambit-warrior c: 40)
	(up-find-remote c: elite-karambit-warrior c: 40)
	(up-find-remote c: foot-konnik-line c: 40)
	(up-find-remote c: serjeant-line c: 40)
	(up-find-remote c: donjon-serjeant-line c: 40)
	(up-find-remote c: flemish-militia-trained c: 40)
	(up-find-remote c: flemish-militia-male c: 40)
	(up-find-remote c: flemish-militia-female c: 40)
	(up-find-remote c: liao-dao-line c: 40)
	(up-find-remote c: white-feather-guard-line c: 40)
	(up-get-search-state g-local-total)
	(up-modify-goal g-temp g:+ g-remote-total)
	)

	;Target Normal Counting
	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(goal g-target-army-visible NO)
	(not
		(players-civ target-player malian))
	=>
	(up-get-player-fact target-player unit-type-count militiaman-line g-temp)
	)
	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(goal g-target-army-visible NO)
	(players-civ target-player malian)
	=>
	(set-goal g-temp 0)
	)
	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(goal g-target-army-visible NO)
	=>
	(up-get-player-fact target-player unit-type-count woad-raider-line g-temp2)
	(up-modify-goal g-temp g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count throwing-axeman-line g-temp2)
	(up-modify-goal g-temp g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count berserk-line g-temp2)
	(up-modify-goal g-temp g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count condottiero g-temp2)
	(up-modify-goal g-temp g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count kamayuk g-temp2)
	(up-modify-goal g-temp g:+ g-temp2)
	)
	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(goal g-target-army-visible NO)
	=>
	(up-get-player-fact target-player unit-type-count elite-kamayuk g-temp2)
	(up-modify-goal g-temp g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count shotel-warrior g-temp2)
	(up-modify-goal g-temp g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count elite-shotel-warrior g-temp2)
	(up-modify-goal g-temp g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count gbeto g-temp2)
	(up-modify-goal g-temp g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count elite-gbeto g-temp2)
	(up-modify-goal g-temp g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count karambit-warrior g-temp2)
	(up-modify-goal g-temp g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count elite-karambit-warrior g-temp2)
	(up-modify-goal g-temp g:+ g-temp2)
	)
	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(goal g-target-army-visible NO)
	=>
	; (up-get-player-fact target-player unit-type-count foot-konnik g-temp2)
	; (up-modify-goal g-temp g:+ g-temp2)
	; (up-get-player-fact target-player unit-type-count elite-foot-konnik g-temp2)
	; (up-modify-goal g-temp g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count serjeant-line g-temp2)
	(up-modify-goal g-temp g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count donjon-serjeant-line g-temp2)
	(up-modify-goal g-temp g:+ g-temp2)
	; (up-get-player-fact target-player unit-type-count flemish-militia-male g-temp2)
	; (up-modify-goal g-temp g:+ g-temp2)
	; (up-get-player-fact target-player unit-type-count flemish-militia-female g-temp2)
	; (up-modify-goal g-temp g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count flemish-militia-trained g-temp2)
	(up-modify-goal g-temp g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count liao-dao-line g-temp2)
	(up-modify-goal g-temp g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count white-feather-guard-line g-temp2)
	(up-modify-goal g-temp g:+ g-temp2)
	)

	#load-if-defined UP-MULTIPLE-ENEMIES

		;Other Players DUC Counting
		(defrule
		(players-military-population any-enemy > 1)
		(player-in-game target-player)
		(goal g-other-enemy-armies-visible YES)
		(or
			(goal g-game-focus DEFENSIVE)
			(civilian-population >= 60))
		=>
		(set-goal g-temp2 0)
		(set-strategic-number sn-focus-player-number 1)
		(set-goal g-temp5 YES)
		)

			(defrule
			(goal g-temp5 YES)
			(player-in-game focus-player)
			(stance-toward focus-player enemy)
			(up-compare-sn sn-focus-player-number s:!= sn-target-player-number)
			(not
				(players-civ target-player malian))
			=>
			(up-full-reset-search)
			(up-find-remote c: militiaman-line c: 40)
			(up-get-search-state g-local-total)
			(up-modify-goal g-temp2 g:+ g-remote-total)
			)
			(defrule
			(goal g-temp5 YES)
			(player-in-game focus-player)
			(stance-toward focus-player enemy)
			(up-compare-sn sn-focus-player-number s:!= sn-target-player-number)
			=>
			(up-full-reset-search)
			(up-find-remote c: condottiero c: 40)
			(up-find-remote c: woad-raider-line c: 40)
			(up-find-remote c: throwing-axeman-line c: 40)
			(up-find-remote c: berserk-line c: 40)
			(up-find-remote c: kamayuk c: 40)
			(up-find-remote c: elite-kamayuk c: 40)
			(up-find-remote c: shotel-warrior c: 40)
			(up-find-remote c: elite-shotel-warrior c: 40)
			(up-get-search-state g-local-total)
			(up-modify-goal g-temp2 g:+ g-remote-total)
			)
			(defrule
			(goal g-temp5 YES)
			(player-in-game focus-player)
			(stance-toward focus-player enemy)
			(up-compare-sn sn-focus-player-number s:!= sn-target-player-number)
			=>
			(up-find-remote c: gbeto c: 40)
			(up-find-remote c: elite-gbeto c: 40)
			(up-find-remote c: karambit-warrior c: 40)
			(up-find-remote c: elite-karambit-warrior c: 40)
			(up-find-remote c: foot-konnik-line c: 40)
			(up-find-remote c: serjeant-line c: 40)
			(up-find-remote c: donjon-serjeant-line c: 40)
			(up-find-remote c: flemish-militia-trained c: 40)
			(up-find-remote c: liao-dao-line c: 40)
			(up-find-remote c: white-feather-guard-line c: 40)
			(up-get-search-state g-local-total)
			(up-modify-goal g-temp2 g:+ g-remote-total)
			)
			(defrule
			(goal g-temp5 YES)
			(player-in-game focus-player)
			(stance-toward focus-player enemy)
			(up-compare-sn sn-focus-player-number s:!= sn-target-player-number)
			=>
			(up-find-remote c: flemish-militia-male c: 40)
			(up-get-search-state g-local-total)
			(up-modify-goal g-temp2 g:+ g-remote-total)
			)
			(defrule
			(goal g-temp5 YES)
			(player-in-game focus-player)
			(stance-toward focus-player enemy)
			(up-compare-sn sn-focus-player-number s:!= sn-target-player-number)
			=>
			(up-find-remote c: flemish-militia-female c: 40)
			(up-get-search-state g-local-total)
			(up-modify-goal g-temp2 g:+ g-remote-total)
			)
			(defrule
			(goal g-temp5 YES)
			(up-compare-sn sn-focus-player-number < MAX-PLAYERS)
			=>
			(up-modify-sn sn-focus-player-number c:+ 1)
			(up-jump-rule -6)
			)

		;Other Players Normal Counting
		(defrule
		(players-military-population any-enemy > 1)
		(player-in-game target-player)
		(goal g-other-enemy-armies-visible NO)
		(up-players-in-game enemy > 1)
		(or
			(goal g-game-focus DEFENSIVE)
			(civilian-population >= 60))
		=>
		(up-get-fact-sum any-enemy unit-type-count militiaman-line g-temp2)
		(up-get-fact-sum any-enemy unit-type-count woad-raider-line g-temp3)
		(up-modify-goal g-temp2 g:+ g-temp3)
		(up-get-fact-sum any-enemy unit-type-count throwing-axeman-line g-temp3)
		(up-modify-goal g-temp2 g:+ g-temp3)
		(up-get-fact-sum any-enemy unit-type-count berserk-line g-temp3)
		(up-modify-goal g-temp2 g:+ g-temp3)
		(up-get-fact-sum any-enemy unit-type-count condottiero g-temp3)
		(up-modify-goal g-temp2 g:+ g-temp3)
		(up-get-fact-sum any-enemy unit-type-count kamayuk g-temp3)
		(up-modify-goal g-temp2 g:+ g-temp3)
		)
		(defrule
		(players-military-population any-enemy > 1)
		(player-in-game target-player)
		(goal g-other-enemy-armies-visible NO)
		(up-players-in-game enemy > 1)
		(or
			(goal g-game-focus DEFENSIVE)
			(civilian-population >= 60))
		=>
		(up-get-fact-sum any-enemy unit-type-count elite-kamayuk g-temp3)
		(up-modify-goal g-temp2 g:+ g-temp3)
		(up-get-fact-sum any-enemy unit-type-count shotel-warrior g-temp3)
		(up-modify-goal g-temp2 g:+ g-temp3)
		(up-get-fact-sum any-enemy unit-type-count elite-shotel-warrior g-temp3)
		(up-modify-goal g-temp2 g:+ g-temp3)
		(up-get-fact-sum any-enemy unit-type-count gbeto g-temp3)
		(up-modify-goal g-temp2 g:+ g-temp3)
		(up-get-fact-sum any-enemy unit-type-count elite-gbeto g-temp3)
		(up-modify-goal g-temp2 g:+ g-temp3)
		(up-get-fact-sum any-enemy unit-type-count karambit-warrior g-temp3)
		(up-modify-goal g-temp2 g:+ g-temp3)
		)
		(defrule
		(players-military-population any-enemy > 1)
		(player-in-game target-player)
		(goal g-other-enemy-armies-visible NO)
		(up-players-in-game enemy > 1)
		(or
			(goal g-game-focus DEFENSIVE)
			(civilian-population >= 60))
		=>
		(up-get-fact-sum any-enemy unit-type-count elite-karambit-warrior g-temp3)
		(up-modify-goal g-temp2 g:+ g-temp3)
		; (up-get-fact-sum any-enemy unit-type-count foot-konnik-line g-temp3)
		; (up-modify-goal g-temp2 g:+ g-temp3)
		(up-get-fact-sum any-enemy unit-type-count serjeant-line g-temp3)
		(up-modify-goal g-temp2 g:+ g-temp3)
		(up-get-fact-sum any-enemy unit-type-count donjon-serjeant-line g-temp3)
		(up-modify-goal g-temp2 g:+ g-temp3)
		(up-get-fact-sum any-enemy unit-type-count liao-dao-line g-temp3)
		(up-modify-goal g-temp2 g:+ g-temp3)
		(up-get-fact-sum any-enemy unit-type-count white-feather-guard-line g-temp3)
		(up-modify-goal g-temp2 g:+ g-temp3)
		)
		(defrule
		(players-military-population any-enemy > 1)
		(player-in-game target-player)
		(goal g-other-enemy-armies-visible NO)
		(up-players-in-game enemy > 1)
		(or
			(goal g-game-focus DEFENSIVE)
			(civilian-population >= 60))
		=>
		; (up-get-player-fact target-player unit-type-count flemish-militia-male g-temp3)
		; (up-modify-goal g-temp2 g:+ g-temp3)
		; (up-get-player-fact target-player unit-type-count flemish-militia-female g-temp3)
		; (up-modify-goal g-temp2 g:+ g-temp3)
		(up-get-player-fact target-player unit-type-count flemish-militia-trained g-temp3)
		(up-modify-goal g-temp2 g:+ g-temp3)
		)

		;Remove enemy Malian swordsmen (included in huskarls count instead)
		(defrule
		(players-military-population any-enemy > 1)
		(player-in-game target-player)
		(goal g-other-enemy-armies-visible NO)
		(up-players-in-game enemy > 1)
		(or
			(goal g-game-focus DEFENSIVE)
			(civilian-population >= 60))
		(players-civ any-enemy malian)
		=>
		(set-strategic-number sn-focus-player-number 1)
		)

			(defrule
			(players-military-population any-enemy > 1)
			(player-in-game target-player)
			(goal g-other-enemy-armies-visible NO)
			(up-players-in-game enemy > 1)
			(or
				(goal g-game-focus DEFENSIVE)
				(civilian-population >= 60))
			(players-civ any-enemy malian)
			(strategic-number sn-focus-player-number <= MAX-PLAYERS)
			(player-in-game focus-player)
			(stance-toward focus-player enemy)
			(players-civ focus-player malian)
			=>
			(up-get-player-fact focus-player unit-type-count militiaman-line g-temp3)
			(up-modify-goal g-temp2 g:- g-temp3)
			)

			(defrule
			(players-military-population any-enemy > 1)
			(player-in-game target-player)
			(goal g-other-enemy-armies-visible NO)
			(up-players-in-game enemy > 1)
			(or
				(goal g-game-focus DEFENSIVE)
				(civilian-population >= 60))
			(players-civ any-enemy malian)
			(strategic-number sn-focus-player-number < MAX-PLAYERS)
			=>
			(up-modify-sn sn-focus-player-number c:+ 1)
			(up-jump-rule -2)
			)

		(defrule
		(players-military-population any-enemy > 1)
		(player-in-game target-player)
		(up-players-in-game enemy > 1)
		(or
			(goal g-game-focus DEFENSIVE)
			(civilian-population >= 60))
		=>
		(up-modify-goal g-temp2 g:- g-temp)	;remove target player's units
		(up-modify-goal g-temp2 c:/ 3)
		(up-modify-goal g-temp g:+ g-temp2)
		)

	#end-if

	;If enemy swordsmen count has increased, update count
	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(up-compare-goal g-total-enemy-soldier-counts > 0)
	(up-get-fact-max any-enemy military-population 0 g-temp2)
	(up-compare-goal g-total-enemy-soldier-counts g:> g-temp2)
	=>
	(up-modify-goal g-temp2 g:%/ g-total-enemy-soldier-counts)
	(up-modify-goal g-temp g:%* g-temp2)
	)

	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(up-compare-goal g-enemy-swordsmen-count g:< g-temp)
	=>
	(up-modify-goal g-enemy-swordsmen-count g:= g-temp)
	; (up-chat-data-to-all "More swordsmen: %d" g: g-enemy-swordsmen-count)
	)
	;If enemy swordsmen count has decreased,
	;only decrease count by 1 every 5 seconds to reduce rapid changes
	(defrule
	(timer-triggered t-5-sec)
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(up-compare-goal g-enemy-swordsmen-count g:> g-temp)
	=>
	(up-modify-goal g-enemy-swordsmen-count c:- 1)
	; (up-chat-data-to-all "Less swordsmen: %d" g: g-enemy-swordsmen-count)
	)

;--------------
;	Spearmen
;--------------

	(load "The General 1.3/Functions/Reset Mini")

	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(goal g-target-army-visible YES)
	=>
	(set-goal g-temp 0)
	)

	;Target DUC Counting
	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(goal g-target-army-visible YES)
	=>
	(up-modify-sn sn-focus-player-number s:= sn-target-player-number)
	(up-full-reset-search)
	(up-find-remote c: spearman-line c: 40)
	(up-get-search-state g-local-total)
	(up-modify-goal g-temp g:+ g-remote-total)
	)

	;Target Normal Counting
	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(goal g-target-army-visible NO)
	=>
	(up-get-player-fact target-player unit-type-count spearman-line g-temp)
	)

	#load-if-defined UP-MULTIPLE-ENEMIES

		;Other Players DUC counting
		(defrule
		(players-military-population any-enemy > 1)
		(player-in-game target-player)
		(goal g-other-enemy-armies-visible YES)
		(or
			(goal g-game-focus DEFENSIVE)
			(civilian-population >= 60))
		=>
		(set-goal g-temp2 0)
		(set-strategic-number sn-focus-player-number 1)
		(set-goal g-temp5 YES)
		)

			(defrule
			(goal g-temp5 YES)
			(player-in-game focus-player)
			(stance-toward focus-player enemy)
			(up-compare-sn sn-focus-player-number s:!= sn-target-player-number)
			=>
			(up-full-reset-search)
			(up-find-remote c: spearman-line c: 40)
			(up-get-search-state g-local-total)
			(up-modify-goal g-temp2 g:+ g-remote-total)
			)
			(defrule
			(goal g-temp5 YES)
			(up-compare-sn sn-focus-player-number < MAX-PLAYERS)
			=>
			(up-modify-sn sn-focus-player-number c:+ 1)
			(up-jump-rule -2)
			)

		;Other Players Normal counting
		(defrule
		(players-military-population any-enemy > 1)
		(player-in-game target-player)
		(goal g-other-enemy-armies-visible NO)
		(up-players-in-game enemy > 1)
		(or
			(goal g-game-focus DEFENSIVE)
			(civilian-population >= 60))
		=>
		(up-get-fact-sum any-enemy unit-type-count spearman-line g-temp2)
		)

		(defrule
		(players-military-population any-enemy > 1)
		(player-in-game target-player)
		(up-players-in-game enemy > 1)
		(or
			(goal g-game-focus DEFENSIVE)
			(civilian-population >= 60))
		=>
		(up-modify-goal g-temp2 g:- g-temp)	;remove target player's units
		(up-modify-goal g-temp2 c:/ 3)
		(up-modify-goal g-temp g:+ g-temp2)
		)

	#end-if

	;If enemy count has increased, update count
	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(up-get-fact-max any-enemy military-population 0 g-temp2)
	(up-compare-goal g-total-enemy-soldier-counts g:> g-temp2)
	=>
	(up-modify-goal g-temp2 g:%/ g-total-enemy-soldier-counts)
	(up-modify-goal g-temp g:%* g-temp2)
	)

	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(up-compare-goal g-enemy-spearmen-count g:< g-temp)
	=>
	(up-modify-goal g-enemy-spearmen-count g:= g-temp)
	; (up-chat-data-to-all "More spearmen: %d" g: g-enemy-spearmen-count)
	)
	;If enemy count has decreased,
	;only decrease count by 1 every 5 seconds to reduce rapid changes
	(defrule
	(timer-triggered t-5-sec)
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(up-compare-goal g-enemy-spearmen-count g:> g-temp)
	=>
	(up-modify-goal g-enemy-spearmen-count c:- 1)
	; (up-chat-data-to-all "Less spearmen: %d" g: g-enemy-spearmen-count)
	)

;--------------------
;	Eagle Warriors	
;--------------------

	(load "The General 1.3/Functions/Reset Mini")

	;Target DUC Counting
	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(or
		(goal g-target-army-visible YES)
		(current-age < castle-age))
	=>
	(set-goal g-temp 0)
	)

	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(or
		(goal g-target-army-visible YES)
		(current-age < castle-age))
	=>
	(up-modify-sn sn-focus-player-number s:= sn-target-player-number)
	(up-full-reset-search)
	(up-find-remote c: eagle-warrior-line c: 40)
	(up-find-remote c: heavy-eagle-warrior c: 40)
	(up-find-remote c: ghulam-line c: 40)
	(up-find-remote c: fire-lancer-line c: 40)
	(up-get-search-state g-local-total)
	(up-modify-goal g-temp g:+ g-remote-total)
	)

	;Target Normal Counting
	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(goal g-target-army-visible NO)
	(current-age >= castle-age)
	=>
	(up-get-player-fact target-player unit-type-count eagle-warrior-line g-temp)
	(up-get-player-fact target-player unit-type-count ghulam-line g-temp2)
	(up-modify-goal g-temp g:+ g-temp2)
	)

	#load-if-defined UP-MULTIPLE-ENEMIES

		;Other Players DUC counting
		(defrule
		(players-military-population any-enemy > 1)
		(player-in-game target-player)
		(goal g-other-enemy-armies-visible YES)
		(or
			(goal g-game-focus DEFENSIVE)
			(civilian-population >= 60))
		=>
		(set-goal g-temp2 0)
		(set-strategic-number sn-focus-player-number 1)
		(set-goal g-temp5 YES)
		)

			(defrule
			(goal g-temp5 YES)
			(player-in-game focus-player)
			(stance-toward focus-player enemy)
			(up-compare-sn sn-focus-player-number s:!= sn-target-player-number)
			=>
			(up-full-reset-search)
			(up-find-remote c: eagle-warrior-line c: 40)
			(up-find-remote c: heavy-eagle-warrior c: 40)
			(up-find-remote c: ghulam-line c: 40)
			(up-find-remote c: fire-lancer-line c: 40)
			(up-get-search-state g-local-total)
			(up-modify-goal g-temp2 g:+ g-remote-total)
			)
			(defrule
			(goal g-temp5 YES)
			(up-compare-sn sn-focus-player-number < MAX-PLAYERS)
			=>
			(up-modify-sn sn-focus-player-number c:+ 1)
			(up-jump-rule -2)
			)

		;Other Players Normal Counting
		(defrule
		(players-military-population any-enemy > 1)
		(player-in-game target-player)
		(goal g-other-enemy-armies-visible NO)
		(up-players-in-game enemy > 1)
		(or
			(goal g-game-focus DEFENSIVE)
			(civilian-population >= 60))
		=>
		(up-get-fact-sum any-enemy unit-type-count eagle-warrior-line g-temp2)
		(up-get-fact-sum any-enemy unit-type-count ghulam-line g-temp3)
		(up-modify-goal g-temp2 g:+ g-temp3)
		)


		(defrule
		(players-military-population any-enemy > 1)
		(player-in-game target-player)
		(up-players-in-game enemy > 1)
		(or
			(goal g-game-focus DEFENSIVE)
			(civilian-population >= 60))
		=>
		(up-modify-goal g-temp2 g:- g-temp)	;remove target player's units
		(up-modify-goal g-temp2 c:/ 3)
		(up-modify-goal g-temp g:+ g-temp2)
		)

	#end-if

	;If enemy count has increased, update count
	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(up-get-fact-max any-enemy military-population 0 g-temp2)
	(up-compare-goal g-total-enemy-soldier-counts g:> g-temp2)
	=>
	(up-modify-goal g-temp2 g:%/ g-total-enemy-soldier-counts)
	(up-modify-goal g-temp g:%* g-temp2)
	)

	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(up-compare-goal g-enemy-eagle-warriors-count g:< g-temp)
	=>
	(up-modify-goal g-enemy-eagle-warriors-count g:= g-temp)
	; (up-chat-data-to-all "More eagle-warriors: %d" g: g-enemy-eagle-warriors-count)
	)
	;If enemy count has decreased,
	;only decrease count by 1 every 5 seconds to reduce rapid changes
	(defrule
	(timer-triggered t-5-sec)
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(up-compare-goal g-enemy-eagle-warriors-count g:> g-temp)
	=>
	(up-modify-goal g-enemy-eagle-warriors-count c:- 1)
	; (up-chat-data-to-all "Less eagle-warriors: %d" g: g-enemy-eagle-warriors-count)
	)

;------------------
;	Foot Archers
;------------------

	(load "The General 1.3/Functions/Reset Mini")

	;Target DUC Counting
	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(goal g-target-army-visible YES)
	=>
	(set-goal g-temp 0)
	)

	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(goal g-target-army-visible YES)
	=>
	(up-modify-sn sn-focus-player-number s:= sn-target-player-number)
	(up-full-reset-search)
	(up-find-remote c: archer-line c: 40)
	(up-find-remote c: longbowman c: 40)
	(up-find-remote c: chu-ko-nu-line c: 40)
	(up-find-remote c: plumed-archer-line c: 40)
	(up-find-remote c: janissary-line c: 40)
	(up-find-remote c: rattan-archer c: 40)
	(up-find-remote c: elite-rattan-archer c: 40)
	(up-find-remote c: fire-archer-line c: 40)
	(up-get-search-state g-local-total)
	(up-modify-goal g-temp g:+ g-remote-total)
	)

	;Target Normal Counting
	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(goal g-target-army-visible NO)
	=>
	(up-get-player-fact target-player unit-type-count archer-line g-temp)
	(up-get-player-fact target-player unit-type-count longbowman-line g-temp2)
	(up-modify-goal g-temp g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count chu-ko-nu-line g-temp2)
	(up-modify-goal g-temp g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count plumed-archer-line g-temp2)
	(up-modify-goal g-temp g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count janissary-line g-temp2)
	(up-modify-goal g-temp g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count rattan-archer g-temp2)
	(up-modify-goal g-temp g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count elite-rattan-archer g-temp2)
	(up-modify-goal g-temp g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count fire-archer-line g-temp2)
	(up-modify-goal g-temp g:+ g-temp2)
	)

	#load-if-defined UP-MULTIPLE-ENEMIES

		;Other Players DUC counting
		(defrule
		(players-military-population any-enemy > 1)
		(player-in-game target-player)
		(goal g-other-enemy-armies-visible YES)
		(or
			(goal g-game-focus DEFENSIVE)
			(civilian-population >= 60))
		=>
		(set-goal g-temp2 0)
		(set-strategic-number sn-focus-player-number 1)
		(set-goal g-temp5 YES)
		)

			(defrule
			(goal g-temp5 YES)
			(player-in-game focus-player)
			(stance-toward focus-player enemy)
			(up-compare-sn sn-focus-player-number s:!= sn-target-player-number)
			=>
			(up-full-reset-search)
			(up-find-remote c: archer-line c: 40)
			(up-find-remote c: longbowman c: 40)
			(up-find-remote c: chu-ko-nu-line c: 40)
			(up-find-remote c: plumed-archer-line c: 40)
			(up-find-remote c: janissary-line c: 40)
			(up-find-remote c: rattan-archer c: 40)
			(up-find-remote c: elite-rattan-archer c: 40)
			(up-find-remote c: fire-archer-line c: 40)
			(up-get-search-state g-local-total)
			(up-modify-goal g-temp2 g:+ g-remote-total)
			)
			(defrule
			(goal g-temp5 YES)
			(up-compare-sn sn-focus-player-number < MAX-PLAYERS)
			=>
			(up-modify-sn sn-focus-player-number c:+ 1)
			(up-jump-rule -2)
			)

		;Other players
		(defrule
		(players-military-population any-enemy > 1)
		(player-in-game target-player)
		(goal g-other-enemy-armies-visible NO)
		(up-players-in-game enemy > 1)
		(or
			(goal g-game-focus DEFENSIVE)
			(civilian-population >= 60))
		=>
		(up-get-fact-sum any-enemy unit-type-count archer-line g-temp2)
		(up-get-fact-sum any-enemy unit-type-count longbowman-line g-temp3)
		(up-modify-goal g-temp2 g:+ g-temp3)
		(up-get-fact-sum any-enemy unit-type-count chu-ko-nu-line g-temp3)
		(up-modify-goal g-temp2 g:+ g-temp3)
		(up-get-fact-sum any-enemy unit-type-count plumed-archer-line g-temp3)
		(up-modify-goal g-temp2 g:+ g-temp3)
		(up-get-fact-sum any-enemy unit-type-count janissary-line g-temp3)
		(up-modify-goal g-temp2 g:+ g-temp3)
		)
		(defrule
		(players-military-population any-enemy > 1)
		(player-in-game target-player)
		(goal g-other-enemy-armies-visible NO)
		(up-players-in-game enemy > 1)
		(or
			(goal g-game-focus DEFENSIVE)
			(civilian-population >= 60))
		=>
		(up-get-fact-sum any-enemy unit-type-count rattan-archer g-temp3)
		(up-modify-goal g-temp2 g:+ g-temp3)
		(up-get-fact-sum any-enemy unit-type-count elite-rattan-archer g-temp3)
		(up-modify-goal g-temp2 g:+ g-temp3)
		(up-get-fact-sum any-enemy unit-type-count fire-archer-line g-temp3)
		(up-modify-goal g-temp2 g:+ g-temp3)
		)

		(defrule
		(players-military-population any-enemy > 1)
		(player-in-game target-player)
		(up-players-in-game enemy > 1)
		(or
			(goal g-game-focus DEFENSIVE)
			(civilian-population >= 60))
		=>
		(up-modify-goal g-temp2 g:- g-temp)	;remove target player's units
		(up-modify-goal g-temp2 c:/ 3)
		(up-modify-goal g-temp g:+ g-temp2)
		)

	#end-if

	;If enemy count has increased, update count
	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(up-get-fact-max any-enemy military-population 0 g-temp2)
	(up-compare-goal g-total-enemy-soldier-counts g:> g-temp2)
	=>
	(up-modify-goal g-temp2 g:%/ g-total-enemy-soldier-counts)
	(up-modify-goal g-temp g:%* g-temp2)
	)

	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(up-compare-goal g-enemy-foot-archers-count g:< g-temp)
	=>
	(up-modify-goal g-enemy-foot-archers-count g:= g-temp)
	; (up-chat-data-to-all "More foot-archers: %d" g: g-enemy-foot-archers-count)
	)
	;If enemy count has decreased,
	;only decrease count by 1 every 5 seconds to reduce rapid changes
	(defrule
	(timer-triggered t-5-sec)
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(up-compare-goal g-enemy-foot-archers-count g:> g-temp)
	=>
	(up-modify-goal g-enemy-foot-archers-count c:- 1)
	; (up-chat-data-to-all "Less foot-archers: %d" g: g-enemy-foot-archers-count)
	)

;-----------------
;	Skirmishers
;-----------------

	(load "The General 1.3/Functions/Reset Mini")

	;Target DUC Counting
	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(goal g-target-army-visible YES)
	=>
	(set-goal g-temp 0)
	)

	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(goal g-target-army-visible YES)
	=>
	(up-modify-sn sn-focus-player-number s:= sn-target-player-number)
	(up-full-reset-search)
	(up-find-remote c: skirmisher-line c: 40)
	(up-find-remote c: imperial-skirmisher c: 40)
	(up-find-remote c: genitour c: 40)
	(up-find-remote c: elite-genitour c: 40)
	(up-get-search-state g-local-total)
	(up-modify-goal g-temp g:+ g-remote-total)
	)

	;Target Normal Counting
	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(goal g-target-army-visible NO)
	=>
	(up-get-player-fact target-player unit-type-count skirmisher-line g-temp)
	(up-get-player-fact target-player unit-type-count genitour g-temp2)
	(up-modify-goal g-temp g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count elite-genitour g-temp2)
	(up-modify-goal g-temp g:+ g-temp2)
	)

	#load-if-defined UP-MULTIPLE-ENEMIES

		;Other Players DUC counting
		(defrule
		(players-military-population any-enemy > 1)
		(player-in-game target-player)
		(goal g-other-enemy-armies-visible YES)
		(or
			(goal g-game-focus DEFENSIVE)
			(civilian-population >= 60))
		=>
		(set-goal g-temp2 0)
		(set-strategic-number sn-focus-player-number 1)
		(set-goal g-temp5 YES)
		)

			(defrule
			(goal g-temp5 YES)
			(player-in-game focus-player)
			(stance-toward focus-player enemy)
			(up-compare-sn sn-focus-player-number s:!= sn-target-player-number)
			=>
			(up-full-reset-search)
			(up-find-remote c: skirmisher-line c: 40)
			(up-find-remote c: imperial-skirmisher c: 40)
			(up-find-remote c: genitour c: 40)
			(up-find-remote c: elite-genitour c: 40)
			(up-get-search-state g-local-total)
			(up-modify-goal g-temp2 g:+ g-remote-total)
			)

			(defrule
			(goal g-temp5 YES)
			(up-compare-sn sn-focus-player-number < MAX-PLAYERS)
			=>
			(up-modify-sn sn-focus-player-number c:+ 1)
			(up-jump-rule -2)
			)

		;Other Players Normal Counting
		(defrule
		(players-military-population any-enemy > 1)
		(player-in-game target-player)
		(goal g-other-enemy-armies-visible NO)
		(up-players-in-game enemy > 1)
		(or
			(goal g-game-focus DEFENSIVE)
			(civilian-population >= 60))
		=>
		(up-get-fact-sum any-enemy unit-type-count skirmisher-line g-temp2)
		(up-get-fact-sum any-enemy unit-type-count genitour g-temp3)
		(up-modify-goal g-temp2 g:+ g-temp3)
		(up-get-fact-sum any-enemy unit-type-count elite-genitour g-temp3)
		(up-modify-goal g-temp2 g:+ g-temp3)
		)

		(defrule
		(players-military-population any-enemy > 1)
		(player-in-game target-player)
		(up-players-in-game enemy > 1)
		(or
			(goal g-game-focus DEFENSIVE)
			(civilian-population >= 60))
		=>
		(up-modify-goal g-temp2 g:- g-temp)	;remove target player's units
		(up-modify-goal g-temp2 c:/ 3)
		(up-modify-goal g-temp g:+ g-temp2)
		)

	#end-if

	;If enemy count has increased, update count
	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(up-get-fact-max any-enemy military-population 0 g-temp2)
	(up-compare-goal g-total-enemy-soldier-counts g:> g-temp2)
	=>
	(up-modify-goal g-temp2 g:%/ g-total-enemy-soldier-counts)
	(up-modify-goal g-temp g:%* g-temp2)
	)

	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(up-compare-goal g-enemy-skirmishers-count g:< g-temp)
	=>
	(up-modify-goal g-enemy-skirmishers-count g:= g-temp)
	; (up-chat-data-to-all "More skirmishers: %d" g: g-enemy-skirmishers-count)
	)
	;If enemy count has decreased,
	;only decrease count by 1 every 5 seconds to reduce rapid changes
	(defrule
	(timer-triggered t-5-sec)
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(up-compare-goal g-enemy-skirmishers-count g:> g-temp)
	=>
	(up-modify-goal g-enemy-skirmishers-count c:- 1)
	; (up-chat-data-to-all "Less skirmishers: %d" g: g-enemy-skirmishers-count)
	)
	
;---------------------
;	Cavalry Archers
;---------------------

	(load "The General 1.3/Functions/Reset Mini")

	;Target DUC Counting
	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(goal g-target-army-visible YES)
	=>
	(set-goal g-temp 0)
	)

	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(goal g-target-army-visible YES)
	=>
	(up-modify-sn sn-focus-player-number s:= sn-target-player-number)
	(up-full-reset-search)
	(up-find-remote c: cavalry-archer-line c: 40)
	(up-find-remote c: elephant-archer-line c: 40)
	(up-find-remote c: xianbei-raider c: 40)
	(up-find-remote c: conquistador-line c: 40)
	(up-get-search-state g-local-total)
	(up-modify-goal g-temp g:+ g-remote-total)
	)
	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(goal g-target-army-visible YES)
	=>
	(up-modify-sn sn-focus-player-number s:= sn-target-player-number)
	(up-full-reset-search)
	(up-find-remote c: war-wagon-line c: 40)
	(up-find-remote c: mangudai-line c: 40)
	(up-find-remote c: camel-archer c: 40)
	(up-find-remote c: elite-camel-archer c: 40)
	(up-find-remote c: arambai c: 40)
	(up-find-remote c: elite-arambai c: 40)
	(up-find-remote c: kipchak-line c: 40)
	(up-find-remote c: ratha-melee-line c: 40)
	(up-find-remote c: ratha-ranged-line c: 40)
	(up-get-search-state g-local-total)
	(up-modify-goal g-temp g:+ g-remote-total)
	)

	;Target Normal Counting
	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(goal g-target-army-visible NO)
	=>
	(up-get-player-fact target-player unit-type-count cavalry-archer-line g-temp)
	(up-get-player-fact target-player unit-type-count xianbei-raider g-temp2)
	(up-modify-goal g-temp g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count war-wagon-line g-temp2)
	(up-modify-goal g-temp g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count mangudai-line g-temp2)
	(up-modify-goal g-temp g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count conquistador-line g-temp2)
	(up-modify-goal g-temp g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count camel-archer g-temp2)
	(up-modify-goal g-temp g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count elite-camel-archer g-temp2)
	(up-modify-goal g-temp g:+ g-temp2)
	)
	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(goal g-target-army-visible NO)
	=>
	(up-get-player-fact target-player unit-type-count arambai g-temp2)
	(up-modify-goal g-temp g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count elite-arambai g-temp2)
	(up-modify-goal g-temp g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count kipchak-line g-temp2)
	(up-modify-goal g-temp g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count elephant-archer-line g-temp2)
	(up-modify-goal g-temp g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count ratha-melee-line g-temp2)
	(up-modify-goal g-temp g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count ratha-ranged-line g-temp2)
	(up-modify-goal g-temp g:+ g-temp2)
	)

	#load-if-defined UP-MULTIPLE-ENEMIES

		;Other Players DUC counting
		(defrule
		(players-military-population any-enemy > 1)
		(player-in-game target-player)
		(goal g-other-enemy-armies-visible YES)
		(or
			(goal g-game-focus DEFENSIVE)
			(civilian-population >= 60))
		=>
		(set-goal g-temp2 0)
		(set-strategic-number sn-focus-player-number 1)
		(set-goal g-temp5 YES)
		)

			(defrule
			(goal g-temp5 YES)
			(player-in-game focus-player)
			(stance-toward focus-player enemy)
			(up-compare-sn sn-focus-player-number s:!= sn-target-player-number)
			=>
			(up-full-reset-search)
			(up-find-remote c: cavalry-archer-line c: 40)
			(up-find-remote c: elephant-archer-line c: 40)
			(up-find-remote c: xianbei-raider c: 40)
			(up-find-remote c: conquistador-line c: 40)
			(up-find-remote c: arambai c: 40)
			(up-find-remote c: elite-arambai c: 40)
			(up-modify-goal g-temp2 g:+ g-remote-total)
			)
			(defrule
			(goal g-temp5 YES)
			(player-in-game focus-player)
			(stance-toward focus-player enemy)
			(up-compare-sn sn-focus-player-number s:!= sn-target-player-number)
			=>
			(up-full-reset-search)
			(up-find-remote c: war-wagon-line c: 40)
			(up-find-remote c: mangudai-line c: 40)
			(up-find-remote c: camel-archer c: 40)
			(up-find-remote c: elite-camel-archer c: 40)
			(up-find-remote c: kipchak-line c: 40)
			(up-find-remote c: ratha-melee-line c: 40)
			(up-find-remote c: ratha-ranged-line c: 40)
			(up-modify-goal g-temp2 g:+ g-remote-total)
			)

			(defrule
			(goal g-temp5 YES)
			(up-compare-sn sn-focus-player-number < MAX-PLAYERS)
			=>
			(up-modify-sn sn-focus-player-number c:+ 1)
			(up-jump-rule -3)
			)

		;Other Players Normal Counting
		(defrule
		(players-military-population any-enemy > 1)
		(player-in-game target-player)
		(goal g-other-enemy-armies-visible NO)
		(up-players-in-game enemy > 1)
		(or
			(goal g-game-focus DEFENSIVE)
			(civilian-population >= 60))
		=>
		(up-get-fact-sum any-enemy unit-type-count cavalry-archer-line g-temp2)
		(up-get-fact-sum any-enemy unit-type-count xianbei-raider g-temp3)
		(up-modify-goal g-temp2 g:+ g-temp3)
		(up-get-fact-sum any-enemy unit-type-count war-wagon-line g-temp3)
		(up-modify-goal g-temp2 g:+ g-temp3)
		(up-get-fact-sum any-enemy unit-type-count mangudai-line g-temp3)
		(up-modify-goal g-temp2 g:+ g-temp3)
		(up-get-fact-sum any-enemy unit-type-count conquistador-line g-temp3)
		(up-modify-goal g-temp2 g:+ g-temp3)
		(up-get-fact-sum any-enemy unit-type-count camel-archer g-temp3)
		(up-modify-goal g-temp2 g:+ g-temp3)
		)
		(defrule
		(players-military-population any-enemy > 1)
		(player-in-game target-player)
		(goal g-other-enemy-armies-visible NO)
		(up-players-in-game enemy > 1)
		(or
			(goal g-game-focus DEFENSIVE)
			(civilian-population >= 60))
		=>
		(up-get-fact-sum any-enemy unit-type-count elite-camel-archer g-temp3)
		(up-modify-goal g-temp2 g:+ g-temp3)
		(up-get-fact-sum any-enemy unit-type-count arambai g-temp3)
		(up-modify-goal g-temp2 g:+ g-temp3)
		(up-get-fact-sum any-enemy unit-type-count elite-arambai g-temp3)
		(up-modify-goal g-temp2 g:+ g-temp3)
		(up-get-fact-sum any-enemy unit-type-count kipchak-line g-temp3)
		(up-modify-goal g-temp2 g:+ g-temp3)
		(up-get-fact-sum any-enemy unit-type-count elephant-archer-line g-temp3)
		(up-modify-goal g-temp2 g:+ g-temp3)
		)
		(defrule
		(players-military-population any-enemy > 1)
		(player-in-game target-player)
		(goal g-other-enemy-armies-visible NO)
		(up-players-in-game enemy > 1)
		(or
			(goal g-game-focus DEFENSIVE)
			(civilian-population >= 60))
		=>
		(up-get-fact-sum any-enemy unit-type-count ratha-ranged-line g-temp3)
		(up-modify-goal g-temp2 g:+ g-temp3)
		(up-get-fact-sum any-enemy unit-type-count ratha-melee-line g-temp3)
		(up-modify-goal g-temp2 g:+ g-temp3)
		)

		(defrule
		(players-military-population any-enemy > 1)
		(player-in-game target-player)
		(up-players-in-game enemy > 1)
		(or
			(goal g-game-focus DEFENSIVE)
			(civilian-population >= 60))
		=>
		(up-modify-goal g-temp2 g:- g-temp)	;remove target player's units
		(up-modify-goal g-temp2 c:/ 3)
		(up-modify-goal g-temp g:+ g-temp2)
		)

	#end-if

	;If enemy count has increased, update count
	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(up-get-fact-max any-enemy military-population 0 g-temp2)
	(up-compare-goal g-total-enemy-soldier-counts g:> g-temp2)
	=>
	(up-modify-goal g-temp2 g:%/ g-total-enemy-soldier-counts)
	(up-modify-goal g-temp g:%* g-temp2)
	)

	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(up-compare-goal g-enemy-cavalry-archers-count g:< g-temp)
	=>
	(up-modify-goal g-enemy-cavalry-archers-count g:= g-temp)
	; (up-chat-data-to-all "More cavalry-archers: %d" g: g-enemy-cavalry-archers-count)
	)
	;If enemy count has decreased,
	;only decrease count by 1 every 5 seconds to reduce rapid changes
	(defrule
	(timer-triggered t-5-sec)
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(up-compare-goal g-enemy-cavalry-archers-count g:> g-temp)
	=>
	(up-modify-goal g-enemy-cavalry-archers-count c:- 1)
	; (up-chat-data-to-all "Less cavalry-archers: %d" g: g-enemy-cavalry-archers-count)
	)

;---------------------
;	Hand Cannoneers
;---------------------

	(load "The General 1.3/Functions/Reset Mini")

	;Target DUC Counting
	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(goal g-target-army-visible YES)
	=>
	(set-goal g-temp 0)
	)

	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(goal g-target-army-visible YES)
	=>
	(up-modify-sn sn-focus-player-number s:= sn-target-player-number)
	(up-full-reset-search)
	(up-find-remote c: hand-cannoneer c: 40)
	(up-find-remote c: slinger c: 40)
	(up-find-remote c: grenadier c: 40)
	(up-get-search-state g-local-total)
	(up-modify-goal g-temp g:+ g-remote-total)
	)
	
	;Target Normal Counting
	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(goal g-target-army-visible NO)
	=>
	(up-get-player-fact target-player unit-type-count hand-cannoneer g-temp)
	(up-get-player-fact target-player unit-type-count slinger g-temp2)
	(up-modify-goal g-temp g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count grenadier g-temp2)
	(up-modify-goal g-temp g:+ g-temp2)
	)

	#load-if-defined UP-MULTIPLE-ENEMIES

		;Other Players DUC counting
		(defrule
		(players-military-population any-enemy > 1)
		(player-in-game target-player)
		(goal g-other-enemy-armies-visible YES)
		(or
			(goal g-game-focus DEFENSIVE)
			(civilian-population >= 60))
		=>
		(set-goal g-temp2 0)
		(set-strategic-number sn-focus-player-number 1)
		(set-goal g-temp5 YES)
		)

			(defrule
			(goal g-temp5 YES)
			(player-in-game focus-player)
			(stance-toward focus-player enemy)
			(up-compare-sn sn-focus-player-number s:!= sn-target-player-number)
			=>
			(up-full-reset-search)
			(up-find-remote c: hand-cannoneer c: 40)
			(up-find-remote c: slinger c: 40)
			(up-find-remote c: grenadier c: 40)
			(up-modify-goal g-temp2 g:+ g-remote-total)
			)

			(defrule
			(goal g-temp5 YES)
			(up-compare-sn sn-focus-player-number < MAX-PLAYERS)
			=>
			(up-modify-sn sn-focus-player-number c:+ 1)
			(up-jump-rule -2)
			)
	
		;Other Players Normal Counting
		(defrule
		(players-military-population any-enemy > 1)
		(player-in-game target-player)
		(goal g-other-enemy-armies-visible NO)
		(up-players-in-game enemy > 1)
		(or
			(goal g-game-focus DEFENSIVE)
			(civilian-population >= 60))
		=>
		(up-get-fact-sum any-enemy unit-type-count hand-cannoneer g-temp2)
		(up-get-fact-sum any-enemy unit-type-count slinger g-temp3)
		(up-modify-goal g-temp2 g:+ g-temp3)
		(up-get-fact-sum any-enemy unit-type-count grenadier g-temp3)
		(up-modify-goal g-temp2 g:+ g-temp3)
		)

		(defrule
		(players-military-population any-enemy > 1)
		(player-in-game target-player)
		(up-players-in-game enemy > 1)
		(or
			(goal g-game-focus DEFENSIVE)
			(civilian-population >= 60))
		=>
		(up-modify-goal g-temp2 g:- g-temp)	;remove target player's units
		(up-modify-goal g-temp2 c:/ 3)
		(up-modify-goal g-temp g:+ g-temp2)
		)

	#end-if

	;If enemy count has increased, update count
	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(up-get-fact-max any-enemy military-population 0 g-temp2)
	(up-compare-goal g-total-enemy-soldier-counts g:> g-temp2)
	=>
	(up-modify-goal g-temp2 g:%/ g-total-enemy-soldier-counts)
	(up-modify-goal g-temp g:%* g-temp2)
	)

	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(up-compare-goal g-enemy-hand-cannoneers-count g:< g-temp)
	=>
	(up-modify-goal g-enemy-hand-cannoneers-count g:= g-temp)
	; (up-chat-data-to-all "More hand-cannoneers: %d" g: g-enemy-hand-cannoneers-count)
	)
	;If enemy count has decreased,
	;only decrease count by 1 every 5 seconds to reduce rapid changes
	(defrule
	(timer-triggered t-5-sec)
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(up-compare-goal g-enemy-hand-cannoneers-count g:> g-temp)
	=>
	(up-modify-goal g-enemy-hand-cannoneers-count c:- 1)
	; (up-chat-data-to-all "Less hand-cannoneers: %d" g: g-enemy-hand-cannoneers-count)
	)

;-------------------
;	Light Cavalry
;-------------------

	(load "The General 1.3/Functions/Reset Mini")

	;Target DUC Counting
	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(or
		(goal g-target-army-visible YES)
		(current-age < castle-age))
	=>
	(set-goal g-temp 0)
	)

	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(or
		(goal g-target-army-visible YES)
		(current-age < castle-age))
	=>
	(up-modify-sn sn-focus-player-number s:= sn-target-player-number)
	(up-full-reset-search)
	(up-find-remote c: scout-cavalry-line c: 40)
	(up-find-remote c: magyar-huszar c: 40)
	(up-find-remote c: elite-magyar-huszar c: 40)
	(up-find-remote c: steppe-lancer-line c: 40)
	(up-find-remote c: shrivamsha-rider-line c: 40)
	(up-get-search-state g-local-total)
	(up-modify-goal g-temp g:+ g-remote-total)
	)

	;Target Normal Counting
	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(goal g-target-army-visible NO)
	(current-age >= castle-age)
	=>
	(up-get-player-fact target-player unit-type-count scout-cavalry-line g-temp)
	(up-get-player-fact target-player unit-type-count magyar-huszar g-temp2)
	(up-modify-goal g-temp g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count elite-magyar-huszar g-temp2)
	(up-modify-goal g-temp g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count steppe-lancer-line g-temp2)
	(up-modify-goal g-temp g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count shrivamsha-rider-line g-temp2)
	(up-modify-goal g-temp g:+ g-temp2)
	)

	#load-if-defined UP-MULTIPLE-ENEMIES

		;Other Players DUC Counting
		(defrule
		(players-military-population any-enemy > 1)
		(player-in-game target-player)
		(goal g-other-enemy-armies-visible YES)
		(or
			(goal g-game-focus DEFENSIVE)
			(civilian-population >= 60))
		=>
		(set-goal g-temp2 0)
		(set-strategic-number sn-focus-player-number 1)
		(set-goal g-temp5 YES)
		)

			(defrule
			(goal g-temp5 YES)
			(player-in-game focus-player)
			(stance-toward focus-player enemy)
			(up-compare-sn sn-focus-player-number s:!= sn-target-player-number)
			=>
			(up-full-reset-search)
			(up-find-remote c: scout-cavalry-line c: 40)
			(up-find-remote c: magyar-huszar c: 40)
			(up-find-remote c: elite-magyar-huszar c: 40)
			(up-find-remote c: steppe-lancer-line c: 40)
			(up-find-remote c: shrivamsha-rider-line c: 40)
			(up-modify-goal g-temp2 g:+ g-remote-total)
			)

			(defrule
			(goal g-temp5 YES)
			(up-compare-sn sn-focus-player-number < MAX-PLAYERS)
			=>
			(up-modify-sn sn-focus-player-number c:+ 1)
			(up-jump-rule -2)
			)

		;Other Players Normal Counting
		(defrule
		(players-military-population any-enemy > 1)
		(player-in-game target-player)
		(goal g-other-enemy-armies-visible NO)
		(up-players-in-game enemy > 1)
		(or
			(goal g-game-focus DEFENSIVE)
			(civilian-population >= 60))
		=>
		(up-get-fact-sum any-enemy unit-type-count scout-cavalry-line g-temp2)
		(up-get-fact-sum any-enemy unit-type-count magyar-huszar g-temp3)
		(up-modify-goal g-temp2 g:+ g-temp3)
		(up-get-fact-sum any-enemy unit-type-count elite-magyar-huszar g-temp3)
		(up-modify-goal g-temp2 g:+ g-temp3)
		(up-get-fact-sum any-enemy unit-type-count steppe-lancer-line g-temp3)
		(up-modify-goal g-temp2 g:+ g-temp3)
		(up-get-fact-sum any-enemy unit-type-count shrivamsha-rider-line g-temp3)
		(up-modify-goal g-temp2 g:+ g-temp3)
		)

		(defrule
		(players-military-population any-enemy > 1)
		(player-in-game target-player)
		(up-players-in-game enemy > 1)
		(or
			(goal g-game-focus DEFENSIVE)
			(civilian-population >= 60))
		=>
		(up-modify-goal g-temp2 g:- g-temp)	;remove target player's units
		(up-modify-goal g-temp2 c:/ 3)
		(up-modify-goal g-temp g:+ g-temp2)
		)

	#end-if

	;If enemy count has increased, update count
	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(up-get-fact-max any-enemy military-population 0 g-temp2)
	(up-compare-goal g-total-enemy-soldier-counts g:> g-temp2)
	=>
	(up-modify-goal g-temp2 g:%/ g-total-enemy-soldier-counts)
	(up-modify-goal g-temp g:%* g-temp2)
	)

	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(up-compare-goal g-enemy-light-cavalry-count g:< g-temp)
	=>
	(up-modify-goal g-enemy-light-cavalry-count g:= g-temp)
	; (up-chat-data-to-all "More light-cavalry: %d" g: g-enemy-light-cavalry-count)
	)
	;If enemy count has decreased,
	;only decrease count by 1 every 5 seconds to reduce rapid changes
	(defrule
	(timer-triggered t-5-sec)
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(up-compare-goal g-enemy-light-cavalry-count g:> g-temp)
	=>
	(up-modify-goal g-enemy-light-cavalry-count c:- 1)
	; (up-chat-data-to-all "Less light-cavalry: %d" g: g-enemy-light-cavalry-count)
	)
	
;-------------------
;	Heavy Cavalry
;-------------------

	(load "The General 1.3/Functions/Reset Mini")

	;Target DUC Counting
	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(goal g-target-army-visible YES)
	=>
	(set-goal g-temp 0)
	)

	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(goal g-target-army-visible YES)
	=>
	(up-modify-sn sn-focus-player-number s:= sn-target-player-number)
	(up-full-reset-search)
	(up-find-remote c: knight-line c: 40)
	(up-find-remote c: hei-guang-cavalry-line c: 40)
	(up-find-remote c: stable-tarkan c: 40)
	(up-find-remote c: stable-elite-tarkan c: 40)
	(up-get-search-state g-local-total)
	(up-modify-goal g-temp g:+ g-remote-total)
	)
	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(goal g-target-army-visible YES)
	=>
	(up-modify-sn sn-focus-player-number s:= sn-target-player-number)
	(up-full-reset-search)
	(up-find-remote c: tarkan-line c: 40)
	(up-find-remote c: boyar c: 40)
	(up-find-remote c: elite-boyar c: 40)
	(up-find-remote c: konnik-line c: 40)
	(up-find-remote c: keshik-line c: 40)
	(up-find-remote c: leitis-line c: 40)
	(up-find-remote c: coustillier-line c: 40)
	(up-find-remote c: iron-pagoda-line c: 40)
	(up-find-remote c: tiger-cavalry-line c: 40)
	(up-find-remote c: monaspa-line c: 40)
	(up-get-search-state g-local-total)
	(up-modify-goal g-temp g:+ g-remote-total)
	)

	;Target Normal Counting
	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(goal g-target-army-visible NO)
	=>
	(up-get-player-fact target-player unit-type-count knight-line g-temp)
	(up-get-player-fact target-player unit-type-count hei-guang-cavalry-line g-temp2)
	(up-modify-goal g-temp g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count tarkan-line g-temp2)
	(up-modify-goal g-temp g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count stable-tarkan g-temp2)
	(up-modify-goal g-temp g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count stable-elite-tarkan g-temp2)
	(up-modify-goal g-temp g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count boyar g-temp2)
	(up-modify-goal g-temp g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count elite-boyar g-temp2)
	(up-modify-goal g-temp g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count konnik-line g-temp2)
	(up-modify-goal g-temp g:+ g-temp2)
	)
	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(goal g-target-army-visible NO)
	=>
	(up-get-player-fact target-player unit-type-count keshik-line g-temp2)
	(up-modify-goal g-temp g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count leitis-line g-temp2)
	(up-modify-goal g-temp g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count coustillier-line g-temp2)
	(up-modify-goal g-temp g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count iron-pagoda-line g-temp2)
	(up-modify-goal g-temp g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count tiger-cavalry-line g-temp2)
	(up-modify-goal g-temp g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count monaspa-line g-temp2)
	(up-modify-goal g-temp g:+ g-temp2)
	)

	#load-if-defined UP-MULTIPLE-ENEMIES

		;Other Players DUC Counting
		(defrule
		(players-military-population any-enemy > 1)
		(player-in-game target-player)
		(goal g-other-enemy-armies-visible YES)
		(or
			(goal g-game-focus DEFENSIVE)
			(civilian-population >= 60))
		=>
		(set-goal g-temp2 0)
		(set-strategic-number sn-focus-player-number 1)
		(set-goal g-temp5 YES)
		)

			(defrule
			(goal g-temp5 YES)
			(player-in-game focus-player)
			(stance-toward focus-player enemy)
			(up-compare-sn sn-focus-player-number s:!= sn-target-player-number)
			=>
			(up-full-reset-search)
			(up-find-remote c: knight-line c: 40)
			(up-find-remote c: hei-guang-cavalry-line c: 40)
			(up-find-remote c: stable-tarkan c: 40)
			(up-find-remote c: stable-elite-tarkan c: 40)
			(up-modify-goal g-temp2 g:+ g-remote-total)
			)
			(defrule
			(goal g-temp5 YES)
			(player-in-game focus-player)
			(stance-toward focus-player enemy)
			(up-compare-sn sn-focus-player-number s:!= sn-target-player-number)
			=>
			(up-full-reset-search)
			(up-find-remote c: tarkan-line c: 40)
			(up-find-remote c: boyar c: 40)
			(up-find-remote c: elite-boyar c: 40)
			(up-find-remote c: konnik-line c: 40)
			(up-find-remote c: keshik-line c: 40)
			(up-find-remote c: leitis-line c: 40)
			(up-find-remote c: coustillier-line c: 40)
			(up-find-remote c: monaspa-line c: 40)
			(up-find-remote c: iron-pagoda-line c: 40)
			(up-find-remote c: tiger-cavalry-line c: 40)
			(up-modify-goal g-temp2 g:+ g-remote-total)
			)

			(defrule
			(goal g-temp5 YES)
			(up-compare-sn sn-focus-player-number < MAX-PLAYERS)
			=>
			(up-modify-sn sn-focus-player-number c:+ 1)
			(up-jump-rule -3)
			)

		;Other Players Normal Counting
		(defrule
		(players-military-population any-enemy > 1)
		(player-in-game target-player)
		(goal g-other-enemy-armies-visible NO)
		(up-players-in-game enemy > 1)
		(or
			(goal g-game-focus DEFENSIVE)
			(civilian-population >= 60))
		=>
		(up-get-fact-sum any-enemy unit-type-count knight-line g-temp2)
		(up-get-fact-sum any-enemy unit-type-count hei-guang-cavalry-line g-temp3)
		(up-modify-goal g-temp2 g:+ g-temp3)
		(up-get-fact-sum any-enemy unit-type-count tarkan-line g-temp3)
		(up-modify-goal g-temp2 g:+ g-temp3)
		(up-get-fact-sum any-enemy unit-type-count stable-tarkan g-temp3)
		(up-modify-goal g-temp2 g:+ g-temp3)
		(up-get-fact-sum any-enemy unit-type-count stable-elite-tarkan g-temp3)
		(up-modify-goal g-temp2 g:+ g-temp3)
		(up-get-fact-sum any-enemy unit-type-count boyar g-temp3)
		(up-modify-goal g-temp2 g:+ g-temp3)
		)
		(defrule
		(players-military-population any-enemy > 1)
		(player-in-game target-player)
		(goal g-other-enemy-armies-visible NO)
		(up-players-in-game enemy > 1)
		(or
			(goal g-game-focus DEFENSIVE)
			(civilian-population >= 60))
		=>
		(up-get-fact-sum any-enemy unit-type-count elite-boyar g-temp3)
		(up-modify-goal g-temp2 g:+ g-temp3)
		(up-get-fact-sum any-enemy unit-type-count konnik-line g-temp3)
		(up-modify-goal g-temp2 g:+ g-temp3)
		(up-get-fact-sum any-enemy unit-type-count keshik-line g-temp3)
		(up-modify-goal g-temp2 g:+ g-temp3)
		(up-get-fact-sum any-enemy unit-type-count leitis-line g-temp3)
		(up-modify-goal g-temp2 g:+ g-temp3)
		(up-get-fact-sum any-enemy unit-type-count coustillier-line g-temp3)
		(up-modify-goal g-temp2 g:+ g-temp3)
		(up-get-fact-sum any-enemy unit-type-count monaspa-line g-temp3)
		(up-modify-goal g-temp2 g:+ g-temp3)
		(up-get-fact-sum any-enemy unit-type-count iron-pagoda-line g-temp3)
		(up-modify-goal g-temp2 g:+ g-temp3)
		(up-get-fact-sum any-enemy unit-type-count tiger-cavalry-line g-temp3)
		(up-modify-goal g-temp2 g:+ g-temp3)
		)

		(defrule
		(players-military-population any-enemy > 1)
		(player-in-game target-player)
		(up-players-in-game enemy > 1)
		(or
			(goal g-game-focus DEFENSIVE)
			(civilian-population >= 60))
		=>
		(up-modify-goal g-temp2 g:- g-temp)	;remove target player's units
		(up-modify-goal g-temp2 c:/ 3)
		(up-modify-goal g-temp g:+ g-temp2)
		)

	#end-if

	;If enemy count has increased, update count
	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(up-get-fact-max any-enemy military-population 0 g-temp2)
	(up-compare-goal g-total-enemy-soldier-counts g:> g-temp2)
	=>
	(up-modify-goal g-temp2 g:%/ g-total-enemy-soldier-counts)
	(up-modify-goal g-temp g:%* g-temp2)
	)

	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(up-compare-goal g-enemy-heavy-cavalry-count g:< g-temp)
	=>
	(up-modify-goal g-enemy-heavy-cavalry-count g:= g-temp)
	; (up-chat-data-to-all "More heavy-cavalry: %d" g: g-enemy-heavy-cavalry-count)
	)
	;If enemy count has decreased,
	;only decrease count by 1 every 5 seconds to reduce rapid changes
	(defrule
	(timer-triggered t-5-sec)
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(up-compare-goal g-enemy-heavy-cavalry-count g:> g-temp)
	=>
	(up-modify-goal g-enemy-heavy-cavalry-count c:- 1)
	; (up-chat-data-to-all "Less heavy-cavalry: %d" g: g-enemy-heavy-cavalry-count)
	)

;------------
;	Camels
;------------

	(load "The General 1.3/Functions/Reset Mini")

	;Target DUC Counting
	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(or
		(goal g-target-army-visible YES)
		(current-age < castle-age))
	=>
	(set-goal g-temp 0)
	)

	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(or
		(goal g-target-army-visible YES)
		(current-age < castle-age))
	=>
	(up-modify-sn sn-focus-player-number s:= sn-target-player-number)
	(up-full-reset-search)
	(up-find-remote c: camel-line c: 40)
	(up-find-remote c: imperial-camel c: 40)
	(up-get-search-state g-local-total)
	(up-modify-goal g-temp g:+ g-remote-total)
	)

	;Target player
	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(goal g-target-army-visible NO)
	(current-age >= castle-age)
	=>
	(up-get-player-fact target-player unit-type-count camel-line g-temp)
	)

	#load-if-defined UP-MULTIPLE-ENEMIES

		;Other Players DUC Counting
		(defrule
		(players-military-population any-enemy > 1)
		(player-in-game target-player)
		(goal g-other-enemy-armies-visible YES)
		(or
			(goal g-game-focus DEFENSIVE)
			(civilian-population >= 60))
		=>
		(set-goal g-temp2 0)
		(set-strategic-number sn-focus-player-number 1)
		(set-goal g-temp5 YES)
		)

			(defrule
			(goal g-temp5 YES)
			(player-in-game focus-player)
			(stance-toward focus-player enemy)
			(up-compare-sn sn-focus-player-number s:!= sn-target-player-number)
			=>
			(up-full-reset-search)
			(up-find-remote c: camel-line c: 40)
			(up-find-remote c: imperial-camel c: 40)
			(up-modify-goal g-temp2 g:+ g-remote-total)
			)

			(defrule
			(goal g-temp5 YES)
			(up-compare-sn sn-focus-player-number < MAX-PLAYERS)
			=>
			(up-modify-sn sn-focus-player-number c:+ 1)
			(up-jump-rule -2)
			)

		;Other Players Normal Counting	
		(defrule
		(players-military-population any-enemy > 1)
		(player-in-game target-player)
		(goal g-other-enemy-armies-visible NO)
		(up-players-in-game enemy > 1)
		(or
			(goal g-game-focus DEFENSIVE)
			(civilian-population >= 60))
		=>
		(up-get-fact-sum any-enemy unit-type-count camel-line g-temp2)
		)

		(defrule
		(players-military-population any-enemy > 1)
		(player-in-game target-player)
		(up-players-in-game enemy > 1)
		(or
			(goal g-game-focus DEFENSIVE)
			(civilian-population >= 60))
		=>
		(up-modify-goal g-temp2 g:- g-temp)	;remove target player's units
		(up-modify-goal g-temp2 c:/ 3)
		(up-modify-goal g-temp g:+ g-temp2)
		)

	#end-if

	;If enemy count has increased, update count
	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(up-get-fact-max any-enemy military-population 0 g-temp2)
	(up-compare-goal g-total-enemy-soldier-counts g:> g-temp2)
	=>
	(up-modify-goal g-temp2 g:%/ g-total-enemy-soldier-counts)
	(up-modify-goal g-temp g:%* g-temp2)
	)

	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(up-compare-goal g-enemy-camels-count g:< g-temp)
	=>
	(up-modify-goal g-enemy-camels-count g:= g-temp)
	; (up-chat-data-to-all "More camels: %d" g: g-enemy-camels-count)
	)
	;If enemy count has decreased,
	;only decrease count by 1 every 5 seconds to reduce rapid changes
	(defrule
	(timer-triggered t-5-sec)
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(up-compare-goal g-enemy-camels-count g:> g-temp)
	=>
	(up-modify-goal g-enemy-camels-count c:- 1)
	; (up-chat-data-to-all "Less camels: %d" g: g-enemy-camels-count)
	)

;---------------
;	Elephants
;---------------

	(load "The General 1.3/Functions/Reset Mini")

	;Target DUC Counting
	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(goal g-target-army-visible YES)
	=>
	(set-goal g-temp 0)
	)

	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(goal g-target-army-visible YES)
	=>
	(up-modify-sn sn-focus-player-number s:= sn-target-player-number)
	(up-full-reset-search)
	(up-find-remote c: war-elephant-line c: 40)
	(up-find-remote c: battle-elephant c: 40)
	(up-find-remote c: elite-battle-elephant c: 40)
	(up-get-search-state g-local-total)
	(up-modify-goal g-temp g:+ g-remote-total)
	)

	;Target Normal Counting
	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(goal g-target-army-visible NO)
	=>
	(up-get-player-fact target-player unit-type-count war-elephant-line g-temp)
	(up-get-player-fact target-player unit-type-count battle-elephant g-temp2)
	(up-modify-goal g-temp g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count elite-battle-elephant g-temp2)
	(up-modify-goal g-temp g:+ g-temp2)
	)

	#load-if-defined UP-MULTIPLE-ENEMIES

		;Other Players DUC Counting
		(defrule
		(players-military-population any-enemy > 1)
		(player-in-game target-player)
		(goal g-other-enemy-armies-visible YES)
		(or
			(goal g-game-focus DEFENSIVE)
			(civilian-population >= 60))
		=>
		(set-goal g-temp2 0)
		(set-strategic-number sn-focus-player-number 1)
		(set-goal g-temp5 YES)
		)

			(defrule
			(goal g-temp5 YES)
			(player-in-game focus-player)
			(stance-toward focus-player enemy)
			(up-compare-sn sn-focus-player-number s:!= sn-target-player-number)
			=>
			(up-full-reset-search)
			(up-find-remote c: war-elephant-line c: 40)
			(up-find-remote c: battle-elephant c: 40)
			(up-find-remote c: elite-battle-elephant c: 40)
			(up-modify-goal g-temp2 g:+ g-remote-total)
			)

			(defrule
			(goal g-temp5 YES)
			(up-compare-sn sn-focus-player-number < MAX-PLAYERS)
			=>
			(up-modify-sn sn-focus-player-number c:+ 1)
			(up-jump-rule -2)
			)

		;Other Players Normal Counting
		(defrule
		(players-military-population any-enemy > 1)
		(player-in-game target-player)
		(goal g-other-enemy-armies-visible NO)
		(up-players-in-game enemy > 1)
		(or
			(goal g-game-focus DEFENSIVE)
			(civilian-population >= 60))
		=>
		(up-get-fact-sum any-enemy unit-type-count war-elephant-line g-temp2)
		(up-get-fact-sum any-enemy unit-type-count battle-elephant g-temp3)
		(up-modify-goal g-temp2 g:+ g-temp3)
		(up-get-fact-sum any-enemy unit-type-count elite-battle-elephant g-temp3)
		(up-modify-goal g-temp2 g:+ g-temp3)
		)

		(defrule
		(players-military-population any-enemy > 1)
		(player-in-game target-player)
		(up-players-in-game enemy > 1)
		(or
			(goal g-game-focus DEFENSIVE)
			(civilian-population >= 60))
		=>
		(up-modify-goal g-temp2 g:- g-temp)	;remove target player's units
		(up-modify-goal g-temp2 c:/ 3)
		(up-modify-goal g-temp g:+ g-temp2)
		)

	#end-if

	;If enemy count has increased, update count
	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(up-get-fact-max any-enemy military-population 0 g-temp2)
	(up-compare-goal g-total-enemy-soldier-counts g:> g-temp2)
	=>
	(up-modify-goal g-temp2 g:%/ g-total-enemy-soldier-counts)
	(up-modify-goal g-temp g:%* g-temp2)
	)

	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(up-compare-goal g-enemy-elephants-count g:< g-temp)
	=>
	(up-modify-goal g-enemy-elephants-count g:= g-temp)
	; (up-chat-data-to-all "More elephants: %d" g: g-enemy-elephants-count)
	)
	;If enemy count has decreased,
	;only decrease count by 1 every 5 seconds to reduce rapid changes
	(defrule
	(timer-triggered t-5-sec)
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(up-compare-goal g-enemy-elephants-count g:> g-temp)
	=>
	(up-modify-goal g-enemy-elephants-count c:- 1)
	; (up-chat-data-to-all "Less elephants: %d" g: g-enemy-elephants-count)
	)

;-----------------
;	Field Siege
;-----------------

	(load "The General 1.3/Functions/Reset Mini")

	;Target DUC Counting
	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(goal g-target-army-visible YES)
	=>
	(set-goal g-temp 0)
	)

	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(goal g-target-army-visible YES)
	=>
	(up-modify-sn sn-focus-player-number s:= sn-target-player-number)
	(up-full-reset-search)
	(up-find-remote c: mangonel-line c: 40)
	(up-find-remote c: rocket-cart-line c: 40)
	(up-find-remote c: scorpion-line c: 40)
	(up-find-remote c: war-chariot-focus-fire c: 40)
	(up-find-remote c: war-chariot-barrage c: 40)
	(up-find-remote c: organ-gun c: 40)
	(up-find-remote c: elite-organ-gun c: 40)
	(up-find-remote c: ballista-elephant c: 40)
	(up-find-remote c: elite-ballista-elephant c: 40)
	(up-find-remote c: hussite-wagon-line c: 40)
	(up-get-search-state g-local-total)
	(up-modify-goal g-temp g:+ g-remote-total)
	)

	;Target Normal Counting
	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(goal g-target-army-visible NO)
	=>
	(up-get-player-fact target-player unit-type-count mangonel-line g-temp)
	(up-get-player-fact target-player unit-type-count rocket-cart-line g-temp2)
	(up-modify-goal g-temp g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count scorpion-line g-temp2)
	(up-modify-goal g-temp g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count war-chariot-focus-fire g-temp2)
	(up-modify-goal g-temp g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count war-chariot-barrage g-temp2)
	(up-modify-goal g-temp g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count organ-gun g-temp2)
	(up-modify-goal g-temp g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count elite-organ-gun g-temp2)
	(up-modify-goal g-temp g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count ballista-elephant g-temp2)
	(up-modify-goal g-temp g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count elite-ballista-elephant g-temp2)
	(up-modify-goal g-temp g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count hussite-wagon-line g-temp2)
	(up-modify-goal g-temp g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count mounted-trebuchet g-temp2)
	(up-modify-goal g-temp g:+ g-temp2)
	)

	#load-if-defined UP-MULTIPLE-ENEMIES

		;Other Players DUC Counting
		(defrule
		(players-military-population any-enemy > 1)
		(player-in-game target-player)
		(goal g-other-enemy-armies-visible YES)
		(or
			(goal g-game-focus DEFENSIVE)
			(civilian-population >= 60))
		=>
		(set-goal g-temp2 0)
		(set-strategic-number sn-focus-player-number 1)
		(set-goal g-temp5 YES)
		)

			(defrule
			(goal g-temp5 YES)
			(player-in-game focus-player)
			(stance-toward focus-player enemy)
			(up-compare-sn sn-focus-player-number s:!= sn-target-player-number)
			=>
			(up-full-reset-search)
			(up-find-remote c: mangonel-line c: 40)
			(up-find-remote c: rocket-cart-line c: 40)
			(up-find-remote c: scorpion-line c: 40)
			(up-find-remote c: war-chariot-focus-fire c: 40)
			(up-find-remote c: war-chariot-barrage c: 40)
			(up-find-remote c: organ-gun c: 40)
			(up-find-remote c: elite-organ-gun c: 40)
			(up-find-remote c: ballista-elephant c: 40)
			(up-find-remote c: elite-ballista-elephant c: 40)
			(up-find-remote c: hussite-wagon-line c: 40)
			(up-modify-goal g-temp2 g:+ g-remote-total)
			)

			(defrule
			(goal g-temp5 YES)
			(up-compare-sn sn-focus-player-number < MAX-PLAYERS)
			=>
			(up-modify-sn sn-focus-player-number c:+ 1)
			(up-jump-rule -2)
			)

		;Other Players Normal counting
		(defrule
		(players-military-population any-enemy > 1)
		(player-in-game target-player)
		(goal g-other-enemy-armies-visible NO)
		(up-players-in-game enemy > 1)
		(or
			(goal g-game-focus DEFENSIVE)
			(civilian-population >= 60))
		=>
		(up-get-fact-sum any-enemy unit-type-count mangonel-line g-temp2)
		(up-get-fact-sum any-enemy unit-type-count rocket-cart-line g-temp3)
		(up-modify-goal g-temp2 g:+ g-temp3)
		(up-get-fact-sum any-enemy unit-type-count scorpion-line g-temp3)
		(up-modify-goal g-temp2 g:+ g-temp3)
		(up-get-fact-sum any-enemy unit-type-count war-chariot-focus-fire g-temp3)
		(up-modify-goal g-temp2 g:+ g-temp3)
		(up-get-fact-sum any-enemy unit-type-count war-chariot-barrage g-temp3)
		(up-modify-goal g-temp2 g:+ g-temp3)
		(up-get-fact-sum any-enemy unit-type-count organ-gun g-temp3)
		(up-modify-goal g-temp2 g:+ g-temp3)
		(up-get-fact-sum any-enemy unit-type-count elite-organ-gun g-temp3)
		(up-modify-goal g-temp2 g:+ g-temp3)
		(up-get-fact-sum any-enemy unit-type-count ballista-elephant g-temp3)
		(up-modify-goal g-temp2 g:+ g-temp3)
		(up-get-fact-sum any-enemy unit-type-count hussite-wagon-line g-temp3)
		(up-modify-goal g-temp2 g:+ g-temp3)
		(up-get-fact-sum any-enemy unit-type-count mounted-trebuchet g-temp3)
		(up-modify-goal g-temp2 g:+ g-temp3)
		)
		(defrule
		(players-military-population any-enemy > 1)
		(player-in-game target-player)
		(goal g-other-enemy-armies-visible NO)
		(up-players-in-game enemy > 1)
		(or
			(goal g-game-focus DEFENSIVE)
			(civilian-population >= 60))
		=>
		(up-get-fact-sum any-enemy unit-type-count elite-ballista-elephant g-temp3)
		(up-modify-goal g-temp2 g:+ g-temp3)
		(up-get-fact-sum any-enemy unit-type-count hussite-wagon-line g-temp3)
		(up-modify-goal g-temp2 g:+ g-temp3)
		)

		(defrule
		(players-military-population any-enemy > 1)
		(player-in-game target-player)
		(up-players-in-game enemy > 1)
		(or
			(goal g-game-focus DEFENSIVE)
			(civilian-population >= 60))
		=>
		(up-modify-goal g-temp2 g:- g-temp)	;remove target player's units
		(up-modify-goal g-temp2 c:/ 3)
		(up-modify-goal g-temp g:+ g-temp2)
		)

	#end-if

	;If enemy count has increased, update count
	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(up-get-fact-max any-enemy military-population 0 g-temp2)
	(up-compare-goal g-total-enemy-soldier-counts g:> g-temp2)
	=>
	(up-modify-goal g-temp2 g:%/ g-total-enemy-soldier-counts)
	(up-modify-goal g-temp g:%* g-temp2)
	)

	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(up-compare-goal g-enemy-field-siege-count g:< g-temp)
	=>
	(up-modify-goal g-enemy-field-siege-count g:= g-temp)
	; (up-chat-data-to-all "More field-siege: %d" g: g-enemy-field-siege-count)
	)
	;If enemy count has decreased,
	;only decrease count by 1 every 5 seconds to reduce rapid changes
	(defrule
	(timer-triggered t-5-sec)
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(up-compare-goal g-enemy-field-siege-count g:> g-temp)
	=>
	(up-modify-goal g-enemy-field-siege-count c:- 1)
	; (up-chat-data-to-all "Less field-siege: %d" g: g-enemy-field-siege-count)
	)

;-----------
;	Monks
;-----------

	(load "The General 1.3/Functions/Reset Mini")

	;Target DUC Counting
	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(goal g-target-army-visible YES)
	=>
	(set-goal g-temp 0)
	)

	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(goal g-target-army-visible YES)
	=>
	(up-modify-sn sn-focus-player-number s:= sn-target-player-number)
	(up-full-reset-search)
	(up-find-remote c: monk c: 40)
	(up-find-remote c: missionary c: 40)
	(up-get-search-state g-local-total)
	(up-modify-goal g-temp g:+ g-remote-total)
	)

	;Target Normal Counting
	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(goal g-target-army-visible NO)
	=>
	(up-get-player-fact target-player unit-type-count monk g-temp)
	(up-get-player-fact target-player unit-type-count missionary g-temp2)
	(up-modify-goal g-temp g:+ g-temp2)
	)

	#load-if-defined UP-MULTIPLE-ENEMIES

		;Other Players DUC Counting
		(defrule
		(players-military-population any-enemy > 1)
		(player-in-game target-player)
		(goal g-other-enemy-armies-visible YES)
		(or
			(goal g-game-focus DEFENSIVE)
			(civilian-population >= 60))
		=>
		(set-goal g-temp2 0)
		(set-strategic-number sn-focus-player-number 1)
		(set-goal g-temp5 YES)
		)

			(defrule
			(goal g-temp5 YES)
			(player-in-game focus-player)
			(stance-toward focus-player enemy)
			(up-compare-sn sn-focus-player-number s:!= sn-target-player-number)
			=>
			(up-full-reset-search)
			(up-find-remote c: monk c: 40)
			(up-find-remote c: missionary c: 40)
			(up-modify-goal g-temp2 g:+ g-remote-total)
			)

			(defrule
			(goal g-temp5 YES)
			(up-compare-sn sn-focus-player-number < MAX-PLAYERS)
			=>
			(up-modify-sn sn-focus-player-number c:+ 1)
			(up-jump-rule -2)
			)

		;Other Players Normal Counting
		(defrule
		(players-military-population any-enemy > 1)
		(player-in-game target-player)
		(goal g-other-enemy-armies-visible NO)
		(up-players-in-game enemy > 1)
		(or
			(goal g-game-focus DEFENSIVE)
			(civilian-population >= 60))
		=>
		(up-get-fact-sum any-enemy unit-type-count monk g-temp2)
		(up-get-fact-sum any-enemy unit-type-count missionary g-temp3)
		(up-modify-goal g-temp2 g:+ g-temp3)
		)

		(defrule
		(players-military-population any-enemy > 1)
		(player-in-game target-player)
		(up-players-in-game enemy > 1)
		(or
			(goal g-game-focus DEFENSIVE)
			(civilian-population >= 60))
		=>
		(up-modify-goal g-temp2 g:- g-temp)	;remove target player's units
		(up-modify-goal g-temp2 c:/ 3)
		(up-modify-goal g-temp g:+ g-temp2)
		)

	#end-if

	;If enemy count has increased, update count
	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(up-get-fact-max any-enemy military-population 0 g-temp2)
	(up-compare-goal g-total-enemy-soldier-counts g:> g-temp2)
	=>
	(up-modify-goal g-temp2 g:%/ g-total-enemy-soldier-counts)
	(up-modify-goal g-temp g:%* g-temp2)
	)

	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(up-compare-goal g-enemy-monks-count g:< g-temp)
	=>
	(up-modify-goal g-enemy-monks-count g:= g-temp)
	; (up-chat-data-to-all "More monks: %d" g: g-enemy-monks-count)
	)
	;If enemy count has decreased,
	;only decrease count by 1 every 5 seconds to reduce rapid changes
	(defrule
	(timer-triggered t-5-sec)
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(up-compare-goal g-enemy-monks-count g:> g-temp)
	=>
	(up-modify-goal g-enemy-monks-count c:- 1)
	; (up-chat-data-to-all "Less monks: %d" g: g-enemy-monks-count)
	)

;---------------------
;	Jaguar Warriors
;---------------------

	(load "The General 1.3/Functions/Reset Mini")

	;Target DUC Counting
	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(goal g-target-army-visible YES)
	=>
	(set-goal g-temp 0)
	)

	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(goal g-target-army-visible YES)
	=>
	(up-modify-sn sn-focus-player-number s:= sn-target-player-number)
	(up-full-reset-search)
	(up-find-remote c: jaguar-warrior-line c: 40)
	(up-find-remote c: urumi-swordsman-line c: 40)
	(up-get-search-state g-local-total)
	(up-modify-goal g-temp g:+ g-remote-total)
	)

	;Target player
	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(goal g-target-army-visible NO)
	=>
	(up-get-player-fact target-player unit-type-count jaguar-warrior-line g-temp)
	(up-get-player-fact target-player unit-type-count urumi-swordsman-line g-temp2)
	(up-modify-goal g-temp g:+ g-temp2)
	)

	#load-if-defined UP-MULTIPLE-ENEMIES

		;Other Players DUC Counting
		(defrule
		(players-military-population any-enemy > 1)
		(player-in-game target-player)
		(goal g-other-enemy-armies-visible YES)
		(or
			(goal g-game-focus DEFENSIVE)
			(civilian-population >= 60))
		=>
		(set-goal g-temp2 0)
		(set-strategic-number sn-focus-player-number 1)
		(set-goal g-temp5 YES)
		)

			(defrule
			(goal g-temp5 YES)
			(player-in-game focus-player)
			(stance-toward focus-player enemy)
			(up-compare-sn sn-focus-player-number s:!= sn-target-player-number)
			=>
			(up-full-reset-search)
			(up-find-remote c: jaguar-warrior-line c: 40)
			(up-find-remote c: urumi-swordsman-line c: 40)
			(up-modify-goal g-temp2 g:+ g-remote-total)
			)

			(defrule
			(goal g-temp5 YES)
			(up-compare-sn sn-focus-player-number < MAX-PLAYERS)
			=>
			(up-modify-sn sn-focus-player-number c:+ 1)
			(up-jump-rule -2)
			)

		;Other players
		(defrule
		(players-military-population any-enemy > 1)
		(player-in-game target-player)
		(goal g-other-enemy-armies-visible NO)
		(up-players-in-game enemy > 1)
		(or
			(goal g-game-focus DEFENSIVE)
			(civilian-population >= 60))
		=>
		(up-get-fact-sum any-enemy unit-type-count jaguar-warrior-line g-temp2)
		(up-get-fact-sum any-enemy unit-type-count urumi-swordsman-line g-temp3)
		(up-modify-goal g-temp2 g:+ g-temp3)
		)
		
		(defrule
		(players-military-population any-enemy > 1)
		(player-in-game target-player)
		(up-players-in-game enemy > 1)
		(or
			(goal g-game-focus DEFENSIVE)
			(civilian-population >= 60))
		=>
		(up-modify-goal g-temp2 g:- g-temp)	;remove target player's units
		(up-modify-goal g-temp2 c:/ 3)
		(up-modify-goal g-temp g:+ g-temp2)
		)

	#end-if

	;If enemy count has increased, update count
	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(up-get-fact-max any-enemy military-population 0 g-temp2)
	(up-compare-goal g-total-enemy-soldier-counts g:> g-temp2)
	=>
	(up-modify-goal g-temp2 g:%/ g-total-enemy-soldier-counts)
	(up-modify-goal g-temp g:%* g-temp2)
	)

	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(up-compare-goal g-enemy-jaguar-warriors-count g:< g-temp)
	=>
	(up-modify-goal g-enemy-jaguar-warriors-count g:= g-temp)
	; (up-chat-data-to-all "More jaguar-warriors: %d" g: g-enemy-jaguar-warriors-count)
	)
	;If enemy count has decreased,
	;only decrease count by 1 every 5 seconds to reduce rapid changes
	(defrule
	(timer-triggered t-5-sec)
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(up-compare-goal g-enemy-jaguar-warriors-count g:> g-temp)
	=>
	(up-modify-goal g-enemy-jaguar-warriors-count c:- 1)
	; (up-chat-data-to-all "Less jaguar-warriors: %d" g: g-enemy-jaguar-warriors-count)
	)

;--------------
;	Huskarls
;--------------

	(load "The General 1.3/Functions/Reset Mini")

	;Target DUC Counting
	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(goal g-target-army-visible YES)
	=>
	(set-goal g-temp 0)
	)

	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(goal g-target-army-visible YES)
	=>
	(up-modify-sn sn-focus-player-number s:= sn-target-player-number)
	(up-full-reset-search)
	(up-find-remote c: huskarl-line c: 40)
	(up-find-remote c: barracks-huskarl c: 40)
	(up-find-remote c: barracks-elite-huskarl c: 40)
	(up-find-remote c: jian-swordsman c: 40)
	(up-get-search-state g-local-total)
	(up-modify-goal g-temp g:+ g-remote-total)
	)

	;Target Normal Counting
	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(goal g-target-army-visible NO)
	=>
	(up-get-player-fact target-player unit-type-count huskarl-line g-temp)
	(up-get-player-fact target-player unit-type-count barracks-huskarl g-temp2)
	(up-modify-goal g-temp g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count barracks-elite-huskarl g-temp2)
	(up-modify-goal g-temp g:+ g-temp2)
	(up-get-player-fact target-player unit-type-count jian-swordsman g-temp2)
	(up-modify-goal g-temp g:+ g-temp2)
	)
	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(goal g-target-army-visible NO)
	(players-civ target-player malian)
	=>
	(up-get-player-fact target-player unit-type-count militiaman-line g-temp2)
	(up-modify-goal g-temp g:+ g-temp2)
	)

	#load-if-defined UP-MULTIPLE-ENEMIES

		;Other Players DUC Counting
		(defrule
		(players-military-population any-enemy > 1)
		(player-in-game target-player)
		(goal g-other-enemy-armies-visible YES)
		(or
			(goal g-game-focus DEFENSIVE)
			(civilian-population >= 60))
		=>
		(set-goal g-temp2 0)
		(set-strategic-number sn-focus-player-number 1)
		(set-goal g-temp5 YES)
		)

			(defrule
			(goal g-temp5 YES)
			(player-in-game focus-player)
			(stance-toward focus-player enemy)
			(up-compare-sn sn-focus-player-number s:!= sn-target-player-number)
			=>
			(up-full-reset-search)
			(up-find-remote c: huskarl-line c: 40)
			(up-find-remote c: barracks-huskarl c: 40)
			(up-find-remote c: barracks-elite-huskarl c: 40)
			(up-find-remote c: jian-swordsman c: 40)
			(up-modify-goal g-temp2 g:+ g-remote-total)
			)

			(defrule
			(goal g-temp5 YES)
			(up-compare-sn sn-focus-player-number < MAX-PLAYERS)
			=>
			(up-modify-sn sn-focus-player-number c:+ 1)
			(up-jump-rule -2)
			)

		;Other Players Normal Counting
		(defrule
		(players-military-population any-enemy > 1)
		(player-in-game target-player)
		(goal g-other-enemy-armies-visible NO)
		(up-players-in-game enemy > 1)
		(or
			(goal g-game-focus DEFENSIVE)
			(civilian-population >= 60))
		=>
		(up-get-fact-sum any-enemy unit-type-count huskarl-line g-temp2)
		(up-get-fact-sum any-enemy unit-type-count barracks-huskarl g-temp3)
		(up-modify-goal g-temp2 g:+ g-temp3)
		(up-get-fact-sum any-enemy unit-type-count barracks-elite-huskarl g-temp3)
		(up-modify-goal g-temp2 g:+ g-temp3)
		(up-get-fact-sum any-enemy unit-type-count jian-swordsman g-temp3)
		(up-modify-goal g-temp2 g:+ g-temp3)
		)

		;Add enemy Malian swordsmen
		(defrule
		(players-military-population any-enemy > 1)
		(player-in-game target-player)
		(goal g-other-enemy-armies-visible NO)
		(up-players-in-game enemy > 1)
		(or
			(goal g-game-focus DEFENSIVE)
			(civilian-population >= 60))
		(players-civ any-enemy malian)
		=>
		(set-strategic-number sn-focus-player-number 1)
		)

			(defrule
			(players-military-population any-enemy > 1)
			(player-in-game target-player)
			(goal g-other-enemy-armies-visible NO)
			(up-players-in-game enemy > 1)
			(or
				(goal g-game-focus DEFENSIVE)
				(civilian-population >= 60))
			(players-civ any-enemy malian)
			(strategic-number sn-focus-player-number <= MAX-PLAYERS)
			(player-in-game focus-player)
			(stance-toward focus-player enemy)
			(players-civ focus-player malian)
			=>
			(up-get-player-fact focus-player unit-type-count militiaman-line g-temp3)
			(up-modify-goal g-temp2 g:+ g-temp3)
			)

			(defrule
			(players-military-population any-enemy > 1)
			(player-in-game target-player)
			(goal g-other-enemy-armies-visible NO)
			(up-players-in-game enemy > 1)
			(or
				(goal g-game-focus DEFENSIVE)
				(civilian-population >= 60))
			(players-civ any-enemy malian)
			(strategic-number sn-focus-player-number < MAX-PLAYERS)
			=>
			(up-modify-sn sn-focus-player-number c:+ 1)
			(up-jump-rule -2)
			)

		(defrule
		(players-military-population any-enemy > 1)
		(player-in-game target-player)
		(up-players-in-game enemy > 1)
		(or
			(goal g-game-focus DEFENSIVE)
			(civilian-population >= 60))
		=>
		(up-modify-goal g-temp2 g:- g-temp)	;remove target player's units
		(up-modify-goal g-temp2 c:/ 3)
		(up-modify-goal g-temp g:+ g-temp2)
		)

	#end-if

	;If enemy count has increased, update count
	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(up-get-fact-max any-enemy military-population 0 g-temp2)
	(up-compare-goal g-total-enemy-soldier-counts g:> g-temp2)
	=>
	(up-modify-goal g-temp2 g:%/ g-total-enemy-soldier-counts)
	(up-modify-goal g-temp g:%* g-temp2)
	)

	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(up-compare-goal g-enemy-huskarls-count g:< g-temp)
	=>
	(up-modify-goal g-enemy-huskarls-count g:= g-temp)
	; (up-chat-data-to-all "More huskarls: %d" g: g-enemy-huskarls-count)
	)
	;If enemy count has decreased,
	;only decrease count by 1 every 5 seconds to reduce rapid changes
	(defrule
	(timer-triggered t-5-sec)
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(up-compare-goal g-enemy-huskarls-count g:> g-temp)
	=>
	(up-modify-goal g-enemy-huskarls-count c:- 1)
	; (up-chat-data-to-all "Less huskarls: %d" g: g-enemy-huskarls-count)
	)

;----------------------
;	Chakram Throwers
;----------------------

	(load "The General 1.3/Functions/Reset Mini")

	;Target DUC Counting
	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(goal g-target-army-visible YES)
	=>
	(set-goal g-temp 0)
	)

	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(goal g-target-army-visible YES)
	=>
	(up-modify-sn sn-focus-player-number s:= sn-target-player-number)
	(up-full-reset-search)
	(up-find-remote c: chakram-thrower-line c: 40)
	(up-get-search-state g-local-total)
	(up-modify-goal g-temp g:+ g-remote-total)
	)

	;Target Normal Counting
	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(goal g-target-army-visible NO)
	=>
	(up-get-player-fact target-player unit-type-count chakram-thrower-line g-temp)
	)

	#load-if-defined UP-MULTIPLE-ENEMIES

		;Other Players DUC Counting
		(defrule
		(players-military-population any-enemy > 1)
		(player-in-game target-player)
		(goal g-other-enemy-armies-visible YES)
		(or
			(goal g-game-focus DEFENSIVE)
			(civilian-population >= 60))
		=>
		(set-goal g-temp2 0)
		(set-strategic-number sn-focus-player-number 1)
		(set-goal g-temp5 YES)
		)

			(defrule
			(goal g-temp5 YES)
			(player-in-game focus-player)
			(stance-toward focus-player enemy)
			(up-compare-sn sn-focus-player-number s:!= sn-target-player-number)
			=>
			(up-full-reset-search)
			(up-find-remote c: chakram-thrower-line c: 40)
			(up-modify-goal g-temp2 g:+ g-remote-total)
			)

			(defrule
			(goal g-temp5 YES)
			(up-compare-sn sn-focus-player-number < MAX-PLAYERS)
			=>
			(up-modify-sn sn-focus-player-number c:+ 1)
			(up-jump-rule -2)
			)

		;Other Players Normal Counting
		(defrule
		(players-military-population any-enemy > 1)
		(player-in-game target-player)
		(goal g-other-enemy-armies-visible NO)
		(up-players-in-game enemy > 1)
		(or
			(goal g-game-focus DEFENSIVE)
			(civilian-population >= 60))
		=>
		(up-get-fact-sum any-enemy unit-type-count chakram-thrower-line g-temp2)
		)

		(defrule
		(players-military-population any-enemy > 1)
		(player-in-game target-player)
		(up-players-in-game enemy > 1)
		(or
			(goal g-game-focus DEFENSIVE)
			(civilian-population >= 60))
		=>
		(up-modify-goal g-temp2 g:- g-temp)	;remove target player's units
		(up-modify-goal g-temp2 c:/ 3)
		(up-modify-goal g-temp g:+ g-temp2)
		)

	#end-if

	;If enemy count has increased, update count
	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(up-get-fact-max any-enemy military-population 0 g-temp2)
	(up-compare-goal g-total-enemy-soldier-counts g:> g-temp2)
	=>
	(up-modify-goal g-temp2 g:%/ g-total-enemy-soldier-counts)
	(up-modify-goal g-temp g:%* g-temp2)
	)

	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(up-compare-goal g-enemy-chakram-throwers-count g:< g-temp)
	=>
	(up-modify-goal g-enemy-chakram-throwers-count g:= g-temp)
	; (up-chat-data-to-all "More chakram-throwers: %d" g: g-enemy-chakram-throwers-count)
	)
	;If enemy count has decreased,
	;only decrease count by 1 every 5 seconds to reduce rapid changes
	(defrule
	(timer-triggered t-5-sec)
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(up-compare-goal g-enemy-chakram-throwers-count g:> g-temp)
	=>
	(up-modify-goal g-enemy-chakram-throwers-count c:- 1)
	; (up-chat-data-to-all "Less chakram-throwers: %d" g: g-enemy-chakram-throwers-count)
	)

;-------------
;	Samurai
;-------------

	(load "The General 1.3/Functions/Reset Mini")

	;Target DUC Counting
	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(goal g-target-army-visible YES)
	=>
	(set-goal g-temp 0)
	)

	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(goal g-target-army-visible YES)
	=>
	(up-modify-sn sn-focus-player-number s:= sn-target-player-number)
	(up-full-reset-search)
	(up-find-remote c: samurai-line c: 40)
	(up-get-search-state g-local-total)
	(up-modify-goal g-temp g:+ g-remote-total)
	)

	;Target Normal Counting
	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(goal g-target-army-visible NO)
	=>
	(up-get-player-fact target-player unit-type-count samurai-line g-temp)
	)

	#load-if-defined UP-MULTIPLE-ENEMIES

		;Other Players DUC Counting
		(defrule
		(players-military-population any-enemy > 1)
		(player-in-game target-player)
		(goal g-other-enemy-armies-visible YES)
		(or
			(goal g-game-focus DEFENSIVE)
			(civilian-population >= 60))
		=>
		(set-goal g-temp2 0)
		(set-strategic-number sn-focus-player-number 1)
		(set-goal g-temp5 YES)
		)

			(defrule
			(goal g-temp5 YES)
			(player-in-game focus-player)
			(stance-toward focus-player enemy)
			(up-compare-sn sn-focus-player-number s:!= sn-target-player-number)
			=>
			(up-full-reset-search)
			(up-find-remote c: samurai-line c: 40)
			(up-modify-goal g-temp2 g:+ g-remote-total)
			)

			(defrule
			(goal g-temp5 YES)
			(up-compare-sn sn-focus-player-number < MAX-PLAYERS)
			=>
			(up-modify-sn sn-focus-player-number c:+ 1)
			(up-jump-rule -2)
			)

		;Other Players Normal Counting
		(defrule
		(players-military-population any-enemy > 1)
		(player-in-game target-player)
		(goal g-other-enemy-armies-visible NO)
		(up-players-in-game enemy > 1)
		(or
			(goal g-game-focus DEFENSIVE)
			(civilian-population >= 60))
		=>
		(up-get-fact-sum any-enemy unit-type-count samurai-line g-temp2)
		)

		(defrule
		(players-military-population any-enemy > 1)
		(player-in-game target-player)
		(up-players-in-game enemy > 1)
		(or
			(goal g-game-focus DEFENSIVE)
			(civilian-population >= 60))
		=>
		(up-modify-goal g-temp2 g:- g-temp)	;remove target player's units
		(up-modify-goal g-temp2 c:/ 3)
		(up-modify-goal g-temp g:+ g-temp2)
		)

	#end-if

	;If enemy count has increased, update count
	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(up-get-fact-max any-enemy military-population 0 g-temp2)
	(up-compare-goal g-total-enemy-soldier-counts g:> g-temp2)
	=>
	(up-modify-goal g-temp2 g:%/ g-total-enemy-soldier-counts)
	(up-modify-goal g-temp g:%* g-temp2)
	)

	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(up-compare-goal g-enemy-samurai-count g:< g-temp)
	=>
	(up-modify-goal g-enemy-samurai-count g:= g-temp)
	; (up-chat-data-to-all "More samurai: %d" g: g-enemy-samurai-count)
	)
	;If enemy count has decreased,
	;only decrease count by 1 every 5 seconds to reduce rapid changes
	(defrule
	(timer-triggered t-5-sec)
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(up-compare-goal g-enemy-samurai-count g:> g-temp)
	=>
	(up-modify-goal g-enemy-samurai-count c:- 1)
	; (up-chat-data-to-all "Less samurai: %d" g: g-enemy-samurai-count)
	)

;----------------------
;	Teutonic Knights
;----------------------

	(load "The General 1.3/Functions/Reset Mini")

	;Target DUC Counting
	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(goal g-target-army-visible YES)
	=>
	(set-goal g-temp 0)
	)

	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(goal g-target-army-visible YES)
	=>
	(up-modify-sn sn-focus-player-number s:= sn-target-player-number)
	(up-full-reset-search)
	(up-find-remote c: teutonic-knight-line c: 40)
	(up-get-search-state g-local-total)
	(up-modify-goal g-temp g:+ g-remote-total)
	)

	;Target Normal Counting
	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(goal g-target-army-visible NO)
	=>
	(up-get-player-fact target-player unit-type-count teutonic-knight-line g-temp)
	)

	#load-if-defined UP-MULTIPLE-ENEMIES

		;Other Players DUC Counting
		(defrule
		(players-military-population any-enemy > 1)
		(player-in-game target-player)
		(goal g-other-enemy-armies-visible YES)
		(or
			(goal g-game-focus DEFENSIVE)
			(civilian-population >= 60))
		=>
		(set-goal g-temp2 0)
		(set-strategic-number sn-focus-player-number 1)
		(set-goal g-temp5 YES)
		)

			(defrule
			(goal g-temp5 YES)
			(player-in-game focus-player)
			(stance-toward focus-player enemy)
			(up-compare-sn sn-focus-player-number s:!= sn-target-player-number)
			=>
			(up-full-reset-search)
			(up-find-remote c: teutonic-knight-line c: 40)
			(up-modify-goal g-temp2 g:+ g-remote-total)
			)

			(defrule
			(goal g-temp5 YES)
			(up-compare-sn sn-focus-player-number < MAX-PLAYERS)
			=>
			(up-modify-sn sn-focus-player-number c:+ 1)
			(up-jump-rule -2)
			)

		;Other Players Normal Counting
		(defrule
		(players-military-population any-enemy > 1)
		(player-in-game target-player)
		(goal g-other-enemy-armies-visible NO)
		(up-players-in-game enemy > 1)
		(or
			(goal g-game-focus DEFENSIVE)
			(civilian-population >= 60))
		=>
		(up-get-fact-sum any-enemy unit-type-count teutonic-knight-line g-temp2)
		)

		(defrule
		(players-military-population any-enemy > 1)
		(player-in-game target-player)
		(up-players-in-game enemy > 1)
		(or
			(goal g-game-focus DEFENSIVE)
			(civilian-population >= 60))
		=>
		(up-modify-goal g-temp2 g:- g-temp)	;remove target player's units
		(up-modify-goal g-temp2 c:/ 3)
		(up-modify-goal g-temp g:+ g-temp2)
		)

	#end-if

	;If enemy count has increased, update count
	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(up-get-fact-max any-enemy military-population 0 g-temp2)
	(up-compare-goal g-total-enemy-soldier-counts g:> g-temp2)
	=>
	(up-modify-goal g-temp2 g:%/ g-total-enemy-soldier-counts)
	(up-modify-goal g-temp g:%* g-temp2)
	)

	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(up-compare-goal g-enemy-teutonic-knights-count g:< g-temp)
	=>
	(up-modify-goal g-enemy-teutonic-knights-count g:= g-temp)
	; (up-chat-data-to-all "More teutonic-knights: %d" g: g-enemy-teutonic-knights-count)
	)
	;If enemy count has decreased,
	;only decrease count by 1 every 5 seconds to reduce rapid changes
	(defrule
	(timer-triggered t-5-sec)
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(up-compare-goal g-enemy-teutonic-knights-count g:> g-temp)
	=>
	(up-modify-goal g-enemy-teutonic-knights-count c:- 1)
	; (up-chat-data-to-all "Less teutonic-knights: %d" g: g-enemy-teutonic-knights-count)
	)

;-------------------------
;	Genoese Crossbowmen
;-------------------------

	(load "The General 1.3/Functions/Reset Mini")

	;Target DUC Counting
	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(goal g-target-army-visible YES)
	=>
	(set-goal g-temp 0)
	)

	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(goal g-target-army-visible YES)
	=>
	(up-modify-sn sn-focus-player-number s:= sn-target-player-number)
	(up-full-reset-search)
	(up-find-remote c: genoese-crossbowman c: 40)
	(up-find-remote c: elite-genoese-crossbowman c: 40)
	(up-get-search-state g-local-total)
	(up-modify-goal g-temp g:+ g-remote-total)
	)

	;Target Normal Counting
	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(goal g-target-army-visible NO)
	=>
	(up-get-player-fact target-player unit-type-count genoese-crossbowman g-temp)
	(up-get-player-fact target-player unit-type-count elite-genoese-crossbowman g-temp2)
	(up-modify-goal g-temp g:+ g-temp2)
	)

	#load-if-defined UP-MULTIPLE-ENEMIES

		;Other Players DUC Counting
		(defrule
		(players-military-population any-enemy > 1)
		(player-in-game target-player)
		(goal g-other-enemy-armies-visible YES)
		(or
			(goal g-game-focus DEFENSIVE)
			(civilian-population >= 60))
		=>
		(set-goal g-temp2 0)
		(set-strategic-number sn-focus-player-number 1)
		(set-goal g-temp5 YES)
		)

			(defrule
			(goal g-temp5 YES)
			(player-in-game focus-player)
			(stance-toward focus-player enemy)
			(up-compare-sn sn-focus-player-number s:!= sn-target-player-number)
			=>
			(up-full-reset-search)
			(up-find-remote c: genoese-crossbowman c: 40)
			(up-find-remote c: elite-genoese-crossbowman c: 40)
			(up-modify-goal g-temp2 g:+ g-remote-total)
			)

			(defrule
			(goal g-temp5 YES)
			(up-compare-sn sn-focus-player-number < MAX-PLAYERS)
			=>
			(up-modify-sn sn-focus-player-number c:+ 1)
			(up-jump-rule -2)
			)

		;Other Players Normal Counting
		(defrule
		(players-military-population any-enemy > 1)
		(player-in-game target-player)
		(goal g-other-enemy-armies-visible NO)
		(up-players-in-game enemy > 1)
		(or
			(goal g-game-focus DEFENSIVE)
			(civilian-population >= 60))
		=>
		(up-get-fact-sum any-enemy unit-type-count genoese-crossbowman g-temp2)
		(up-get-fact-sum any-enemy unit-type-count elite-genoese-crossbowman g-temp3)
		(up-modify-goal g-temp2 g:+ g-temp3)
		)

		(defrule
		(players-military-population any-enemy > 1)
		(player-in-game target-player)
		(up-players-in-game enemy > 1)
		(or
			(goal g-game-focus DEFENSIVE)
			(civilian-population >= 60))
		=>
		(up-modify-goal g-temp2 g:- g-temp)	;remove target player's units
		(up-modify-goal g-temp2 c:/ 3)
		(up-modify-goal g-temp g:+ g-temp2)
		)

	#end-if

	;If enemy count has increased, update count
	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(up-get-fact-max any-enemy military-population 0 g-temp2)
	(up-compare-goal g-total-enemy-soldier-counts g:> g-temp2)
	=>
	(up-modify-goal g-temp2 g:%/ g-total-enemy-soldier-counts)
	(up-modify-goal g-temp g:%* g-temp2)
	)

	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(up-compare-goal g-enemy-genoese-crossbowmen-count g:< g-temp)
	=>
	(up-modify-goal g-enemy-genoese-crossbowmen-count g:= g-temp)
	; (up-chat-data-to-all "More genoese-crossbowmen: %d" g: g-enemy-genoese-crossbowmen-count)
	)
	;If enemy count has decreased,
	;only decrease count by 1 every 5 seconds to reduce rapid changes
	(defrule
	(timer-triggered t-5-sec)
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(up-compare-goal g-enemy-genoese-crossbowmen-count g:> g-temp)
	=>
	(up-modify-goal g-enemy-genoese-crossbowmen-count c:- 1)
	; (up-chat-data-to-all "Less genoese-crossbowmen: %d" g: g-enemy-genoese-crossbowmen-count)
	)

;-----------------
;	Cataphracts
;-----------------

	(load "The General 1.3/Functions/Reset Mini")

	;Target DUC Counting
	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(goal g-target-army-visible YES)
	=>
	(set-goal g-temp 0)
	)

	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(goal g-target-army-visible YES)
	=>
	(up-modify-sn sn-focus-player-number s:= sn-target-player-number)
	(up-full-reset-search)
	(up-find-remote c: cataphract-line c: 40)
	(up-get-search-state g-local-total)
	(up-modify-goal g-temp g:+ g-remote-total)
	)

	;Target Normal Counting
	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(goal g-target-army-visible NO)
	=>
	(up-get-player-fact target-player unit-type-count cataphract-line g-temp)
	)

	#load-if-defined UP-MULTIPLE-ENEMIES

		;Other Players DUC Counting
		(defrule
		(players-military-population any-enemy > 1)
		(player-in-game target-player)
		(goal g-other-enemy-armies-visible YES)
		(or
			(goal g-game-focus DEFENSIVE)
			(civilian-population >= 60))
		=>
		(set-goal g-temp2 0)
		(set-strategic-number sn-focus-player-number 1)
		(set-goal g-temp5 YES)
		)

			(defrule
			(goal g-temp5 YES)
			(player-in-game focus-player)
			(stance-toward focus-player enemy)
			(up-compare-sn sn-focus-player-number s:!= sn-target-player-number)
			=>
			(up-full-reset-search)
			(up-find-remote c: cataphract-line c: 40)
			(up-modify-goal g-temp2 g:+ g-remote-total)
			)

			(defrule
			(goal g-temp5 YES)
			(up-compare-sn sn-focus-player-number < MAX-PLAYERS)
			=>
			(up-modify-sn sn-focus-player-number c:+ 1)
			(up-jump-rule -2)
			)

		;Other Players Normal Counting
		(defrule
		(players-military-population any-enemy > 1)
		(player-in-game target-player)
		(goal g-other-enemy-armies-visible NO)
		(up-players-in-game enemy > 1)
		(or
			(goal g-game-focus DEFENSIVE)
			(civilian-population >= 60))
		=>
		(up-get-fact-sum any-enemy unit-type-count cataphract-line g-temp2)
		)

		(defrule
		(players-military-population any-enemy > 1)
		(player-in-game target-player)
		(up-players-in-game enemy > 1)
		(or
			(goal g-game-focus DEFENSIVE)
			(civilian-population >= 60))
		=>
		(up-modify-goal g-temp2 g:- g-temp)	;remove target player's units
		(up-modify-goal g-temp2 c:/ 3)
		(up-modify-goal g-temp g:+ g-temp2)
		)

	#end-if

	;If enemy count has increased, update count
	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(up-get-fact-max any-enemy military-population 0 g-temp2)
	(up-compare-goal g-total-enemy-soldier-counts g:> g-temp2)
	=>
	(up-modify-goal g-temp2 g:%/ g-total-enemy-soldier-counts)
	(up-modify-goal g-temp g:%* g-temp2)
	)

	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(up-compare-goal g-enemy-cataphracts-count g:< g-temp)
	=>
	(up-modify-goal g-enemy-cataphracts-count g:= g-temp)
	; (up-chat-data-to-all "More cataphracts: %d" g: g-enemy-cataphracts-count)
	)
	;If enemy count has decreased,
	;only decrease count by 1 every 5 seconds to reduce rapid changes
	(defrule
	(timer-triggered t-5-sec)
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(up-compare-goal g-enemy-cataphracts-count g:> g-temp)
	=>
	(up-modify-goal g-enemy-cataphracts-count c:- 1)
	; (up-chat-data-to-all "Less cataphracts: %d" g: g-enemy-cataphracts-count)
	)

;---------------
;	Mamelukes
;---------------

	(load "The General 1.3/Functions/Reset Mini")

	;Target DUC Counting
	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(goal g-target-army-visible YES)
	=>
	(set-goal g-temp 0)
	)

	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(goal g-target-army-visible YES)
	=>
	(up-modify-sn sn-focus-player-number s:= sn-target-player-number)
	(up-full-reset-search)
	(up-find-remote c: mameluke-line c: 40)
	(up-get-search-state g-local-total)
	(up-modify-goal g-temp g:+ g-remote-total)
	)

	;Target Normal Counting
	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(goal g-target-army-visible NO)
	=>
	(up-get-player-fact target-player unit-type-count mameluke-line g-temp)
	)

	#load-if-defined UP-MULTIPLE-ENEMIES

		;Other Players DUC Counting
		(defrule
		(players-military-population any-enemy > 1)
		(player-in-game target-player)
		(goal g-other-enemy-armies-visible YES)
		(or
			(goal g-game-focus DEFENSIVE)
			(civilian-population >= 60))
		=>
		(set-goal g-temp2 0)
		(set-strategic-number sn-focus-player-number 1)
		(set-goal g-temp5 YES)
		)

			(defrule
			(goal g-temp5 YES)
			(player-in-game focus-player)
			(stance-toward focus-player enemy)
			(up-compare-sn sn-focus-player-number s:!= sn-target-player-number)
			=>
			(up-full-reset-search)
			(up-find-remote c: mameluke-line c: 40)
			(up-modify-goal g-temp2 g:+ g-remote-total)
			)

			(defrule
			(goal g-temp5 YES)
			(up-compare-sn sn-focus-player-number < MAX-PLAYERS)
			=>
			(up-modify-sn sn-focus-player-number c:+ 1)
			(up-jump-rule -2)
			)

		;Other Players Normal Counting
		(defrule
		(players-military-population any-enemy > 1)
		(player-in-game target-player)
		(goal g-other-enemy-armies-visible NO)
		(up-players-in-game enemy > 1)
		(or
			(goal g-game-focus DEFENSIVE)
			(civilian-population >= 60))
		=>
		(up-get-fact-sum any-enemy unit-type-count mameluke-line g-temp2)
		)

		(defrule
		(players-military-population any-enemy > 1)
		(player-in-game target-player)
		(up-players-in-game enemy > 1)
		(or
			(goal g-game-focus DEFENSIVE)
			(civilian-population >= 60))
		=>
		(up-modify-goal g-temp2 g:- g-temp)	;remove target player's units
		(up-modify-goal g-temp2 c:/ 3)
		(up-modify-goal g-temp g:+ g-temp2)
		)

	#end-if

	;If enemy count has increased, update count
	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(up-get-fact-max any-enemy military-population 0 g-temp2)
	(up-compare-goal g-total-enemy-soldier-counts g:> g-temp2)
	=>
	(up-modify-goal g-temp2 g:%/ g-total-enemy-soldier-counts)
	(up-modify-goal g-temp g:%* g-temp2)
	)

	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(up-compare-goal g-enemy-mamelukes-count g:< g-temp)
	=>
	(up-modify-goal g-enemy-mamelukes-count g:= g-temp)
	; (up-chat-data-to-all "More mamelukes: %d" g: g-enemy-mamelukes-count)
	)
	;If enemy count has decreased,
	;only decrease count by 1 every 5 seconds to reduce rapid changes
	(defrule
	(timer-triggered t-5-sec)
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(up-compare-goal g-enemy-mamelukes-count g:> g-temp)
	=>
	(up-modify-goal g-enemy-mamelukes-count c:- 1)
	; (up-chat-data-to-all "Less mamelukes: %d" g: g-enemy-mamelukes-count)
	)

;-------------------------
;	Composite Bowmen
;-------------------------

	(load "The General 1.3/Functions/Reset Mini")

	;Target DUC Counting
	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(goal g-target-army-visible YES)
	=>
	(set-goal g-temp 0)
	)

	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(goal g-target-army-visible YES)
	=>
	(up-modify-sn sn-focus-player-number s:= sn-target-player-number)
	(up-full-reset-search)
	(up-find-remote c: composite-bowman-line c: 40)
	(up-get-search-state g-local-total)
	(up-modify-goal g-temp g:+ g-remote-total)
	)

	;Target Normal Counting
	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(goal g-target-army-visible NO)
	=>
	(up-get-player-fact target-player unit-type-count composite-bowman-line g-temp)
	(up-modify-goal g-temp g:+ g-temp2)
	)

	#load-if-defined UP-MULTIPLE-ENEMIES

		;Other Players DUC Counting
		(defrule
		(players-military-population any-enemy > 1)
		(player-in-game target-player)
		(goal g-other-enemy-armies-visible YES)
		(or
			(goal g-game-focus DEFENSIVE)
			(civilian-population >= 60))
		=>
		(set-goal g-temp2 0)
		(set-strategic-number sn-focus-player-number 1)
		(set-goal g-temp5 YES)
		)

			(defrule
			(goal g-temp5 YES)
			(player-in-game focus-player)
			(stance-toward focus-player enemy)
			(up-compare-sn sn-focus-player-number s:!= sn-target-player-number)
			=>
			(up-full-reset-search)
			(up-find-remote c: composite-bowman-line c: 40)
			(up-modify-goal g-temp2 g:+ g-remote-total)
			)

			(defrule
			(goal g-temp5 YES)
			(up-compare-sn sn-focus-player-number < MAX-PLAYERS)
			=>
			(up-modify-sn sn-focus-player-number c:+ 1)
			(up-jump-rule -2)
			)

		;Other Players Normal Counting
		(defrule
		(players-military-population any-enemy > 1)
		(player-in-game target-player)
		(goal g-other-enemy-armies-visible NO)
		(up-players-in-game enemy > 1)
		(or
			(goal g-game-focus DEFENSIVE)
			(civilian-population >= 60))
		=>
		(up-get-fact-sum any-enemy unit-type-count composite-bowman-line g-temp2)
		(up-modify-goal g-temp2 g:+ g-temp3)
		)

		(defrule
		(players-military-population any-enemy > 1)
		(player-in-game target-player)
		(up-players-in-game enemy > 1)
		(or
			(goal g-game-focus DEFENSIVE)
			(civilian-population >= 60))
		=>
		(up-modify-goal g-temp2 g:- g-temp)	;remove target player's units
		(up-modify-goal g-temp2 c:/ 3)
		(up-modify-goal g-temp g:+ g-temp2)
		)

	#end-if

	;If enemy count has increased, update count
	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(up-get-fact-max any-enemy military-population 0 g-temp2)
	(up-compare-goal g-total-enemy-soldier-counts g:> g-temp2)
	=>
	(up-modify-goal g-temp2 g:%/ g-total-enemy-soldier-counts)
	(up-modify-goal g-temp g:%* g-temp2)
	)

	(defrule
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(up-compare-goal g-enemy-composite-bowmen-count g:< g-temp)
	=>
	(up-modify-goal g-enemy-composite-bowmen-count g:= g-temp)
	; (up-chat-data-to-all "More composite-bowmen: %d" g: g-enemy-composite-bowmen-count)
	)
	;If enemy count has decreased,
	;only decrease count by 1 every 5 seconds to reduce rapid changes
	(defrule
	(timer-triggered t-5-sec)
	(players-military-population any-enemy > 1)
	(player-in-game target-player)
	(up-compare-goal g-enemy-composite-bowmen-count g:> g-temp)
	=>
	(up-modify-goal g-enemy-composite-bowmen-count c:- 1)
	; (up-chat-data-to-all "Less composite-bowmen: %d" g: g-enemy-composite-bowmen-count)
	)

;-----------------------------------
;	Cap at max enemy military pop
;-----------------------------------

	;Cap military numbers at max enemy military population (enemy player unit counts can sometimes go way too high)
	; (defrule
	; (players-military-population any-enemy > 1)
	; =>
	; (up-modify-goal g-total-enemy-soldier-counts g:= g-enemy-swordsmen-count)
	; (up-modify-goal g-total-enemy-soldier-counts g:+ g-enemy-spearmen-count)
	; (up-modify-goal g-total-enemy-soldier-counts g:+ g-enemy-eagle-warriors-count)
	; (up-modify-goal g-total-enemy-soldier-counts g:+ g-enemy-foot-archers-count)
	; (up-modify-goal g-total-enemy-soldier-counts g:+ g-enemy-skirmishers-count)
	; (up-modify-goal g-total-enemy-soldier-counts g:+ g-enemy-cavalry-archers-count)
	; (up-modify-goal g-total-enemy-soldier-counts g:+ g-enemy-hand-cannoneers-count)
	; (up-modify-goal g-total-enemy-soldier-counts g:+ g-enemy-light-cavalry-count)
	; (up-modify-goal g-total-enemy-soldier-counts g:+ g-enemy-heavy-cavalry-count)
	; (up-modify-goal g-total-enemy-soldier-counts g:+ g-enemy-camels-count)
	; (up-modify-goal g-total-enemy-soldier-counts g:+ g-enemy-elephants-count)
	; (up-modify-goal g-total-enemy-soldier-counts g:+ g-enemy-field-siege-count)
	; (up-modify-goal g-total-enemy-soldier-counts g:+ g-enemy-monks-count)
	; )
	; (defrule
	; (players-military-population any-enemy > 1)
	; =>
	; (up-modify-goal g-total-enemy-soldier-counts g:+ g-enemy-jaguar-warriors-count)
	; (up-modify-goal g-total-enemy-soldier-counts g:+ g-enemy-huskarls-count)
	; (up-modify-goal g-total-enemy-soldier-counts g:+ g-enemy-chakram-throwers-count)
	; (up-modify-goal g-total-enemy-soldier-counts g:+ g-enemy-samurai-count)
	; (up-modify-goal g-total-enemy-soldier-counts g:+ g-enemy-teutonic-knights-count)
	; (up-modify-goal g-total-enemy-soldier-counts g:+ g-enemy-genoese-crossbowmen-count)
	; (up-modify-goal g-total-enemy-soldier-counts g:+ g-enemy-composite-bowmen-count)
	; (up-modify-goal g-total-enemy-soldier-counts g:+ g-enemy-cataphracts-count)
	; (up-modify-goal g-total-enemy-soldier-counts g:+ g-enemy-mamelukes-count)
	; )

	; (defrule
	; (players-military-population any-enemy > 1)
	; (up-get-fact-max any-enemy military-population 0 g-temp4)
	; ; (up-compare-goal g-total-enemy-soldier-counts g:> g-temp4)
	; (up-modify-goal g-temp2 g:= g-temp4)
	; (up-modify-goal g-temp2 g:%/ g-total-enemy-soldier-counts)
	; =>
	; (up-modify-goal g-enemy-swordsmen-count g:%* g-temp2)
	; (up-modify-goal g-enemy-spearmen-count g:%* g-temp2)
	; (up-modify-goal g-enemy-foot-archers-count g:%* g-temp2)
	; (up-modify-goal g-enemy-skirmishers-count g:%* g-temp2)
	; (up-modify-goal g-enemy-cavalry-archers-count g:%* g-temp2)
	; (up-modify-goal g-enemy-hand-cannoneers-count g:%* g-temp2)
	; (up-modify-goal g-enemy-heavy-cavalry-count g:%* g-temp2)
	; (up-modify-goal g-enemy-elephants-count g:%* g-temp2)
	; (up-modify-goal g-enemy-field-siege-count g:%* g-temp2)
	; (up-modify-goal g-enemy-monks-count g:%* g-temp2)
	; )

	; (defrule
	; (players-military-population any-enemy > 1)
	; (up-get-fact-max any-enemy military-population 0 g-temp4)
	; ; (up-compare-goal g-total-enemy-soldier-counts g:> g-temp4)
	; (up-modify-goal g-temp2 g:= g-temp4)
	; (up-modify-goal g-temp2 g:%/ g-total-enemy-soldier-counts)
	; =>
	; (up-modify-goal g-enemy-jaguar-warriors-count g:%* g-temp2)
	; (up-modify-goal g-enemy-chakram-throwers-count g:%* g-temp2)
	; (up-modify-goal g-enemy-huskarls-count g:%* g-temp2)
	; (up-modify-goal g-enemy-samurai-count g:%* g-temp2)
	; (up-modify-goal g-enemy-teutonic-knights-count g:%* g-temp2)
	; (up-modify-goal g-enemy-genoese-crossbowmen-count g:%* g-temp2)
	; (up-modify-goal g-enemy-composite-bowmen-count g:%* g-temp2)
	; (up-modify-goal g-enemy-cataphracts-count g:%* g-temp2)
	; (up-modify-goal g-enemy-mamelukes-count g:%* g-temp2)
	; )

	; (defrule
	; (players-military-population any-enemy > 1)
	; (up-get-fact-max any-enemy military-population 0 g-temp4)
	; (or
	; 	(up-compare-goal g-total-enemy-soldier-counts g:> g-temp4)
	; 	(current-age >= castle-age))
	; (up-modify-goal g-temp2 g:= g-temp4)
	; (up-modify-goal g-temp2 g:%/ g-total-enemy-soldier-counts)
	; =>
	; (up-modify-goal g-enemy-eagle-warriors-count g:%* g-temp2)
	; (up-modify-goal g-enemy-light-cavalry-count g:%* g-temp2)
	; (up-modify-goal g-enemy-camels-count g:%* g-temp2)
	; )