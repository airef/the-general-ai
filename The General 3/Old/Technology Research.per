;Technology Research.per

;-----------
;	Reset
;-----------

	(defrule
	(up-compare-goal g-highest-tech-priority >= 8)
	=>
	(up-release-escrow)
	)

	(defrule
	(true)
	=>
	(up-reset-cost-data g-max-food-needed)
	(up-reset-cost-data g-total-food-needed)
	(set-goal g-highest-tech-priority 0)
	(set-escrow-percentage food 0)
	(set-escrow-percentage wood 0)
	(set-escrow-percentage gold 0)
	(set-escrow-percentage stone 0)
	)

;=========================<>=========================
;				 ESCROW FOR BUILDINGS
;=========================<>=========================

	;-------------
	;	Wonders
	;-------------

		(defrule
		(up-object-type-count-total c: wonder g:< g-desired-num-wonder)
		(not
			(can-build-with-escrow wonder))
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-object-cost c: wonder c: 1)
		(up-setup-cost-data 0 g-total-food-needed)
		(up-add-cost-data g-food-cost c: 1)
		(up-modify-goal g-max-wood-needed g:max g-wood-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-max-stone-needed g:max g-stone-cost)
		(up-modify-escrow wood g:= g-total-wood-needed)
		(up-modify-escrow stone g:= g-total-stone-needed)
		(up-modify-escrow gold g:= g-total-gold-needed)
		)

	;------------------
	;	Town Centers
	;------------------

		(defrule
		(up-object-type-count-total c: town-center g:< g-desired-num-town-center)
		(not
			(can-build-with-escrow town-center))
		=>
		(up-get-fact building-type-count-total town-center g-temp)
		(up-modify-goal g-temp g:- g-desired-num-town-center)
		(up-modify-goal g-temp c:* -1)
		(up-setup-cost-data 1 g-food-cost)
		(up-add-object-cost c: town-center-foundation c: 1)
		(up-setup-cost-data 0 g-total-food-needed)
		(up-add-cost-data g-food-cost g: g-temp)
		(up-modify-goal g-max-wood-needed g:max g-wood-cost)
		(up-modify-goal g-max-stone-needed g:max g-stone-cost)
		(up-modify-escrow wood g:= g-total-wood-needed)
		(up-modify-escrow stone g:= g-total-stone-needed)
		)

	;-------------
	;	Castles
	;-------------

		(defrule
		(up-object-type-count-total c: castle g:< g-desired-num-castle)
		(not
			(can-build-with-escrow castle))
		=>
		(up-get-fact building-type-count-total castle g-temp)
		(up-modify-goal g-temp g:- g-desired-num-castle)
		(up-modify-goal g-temp c:* -1)
		(up-setup-cost-data 1 g-food-cost)
		(up-add-object-cost c: castle c: 1)
		(up-setup-cost-data 0 g-total-food-needed)
		(up-add-cost-data g-food-cost g: g-temp)
		(up-modify-goal g-max-stone-needed g:max g-stone-cost)
		(up-modify-escrow stone g:= g-total-stone-needed)
		)

	;---------------------
	;	Siege Workshops
	;---------------------

		(defrule
		(up-object-type-count-total c: siege-workshop g:< g-desired-num-castle)
		(not
			(can-build-with-escrow siege-workshop))
		=>
		(up-get-fact building-type-count-total siege-workshop g-temp)
		(up-modify-goal g-temp g:- g-desired-num-siege-workshop)
		(up-modify-goal g-temp c:* -1)
		(up-setup-cost-data 1 g-food-cost)
		(up-add-object-cost c: siege-workshop c: 1)
		(up-setup-cost-data 0 g-total-food-needed)
		(up-add-cost-data g-food-cost g: g-temp)
		(up-modify-goal g-max-wood-needed g:max g-wood-cost)
		(up-modify-escrow wood g:= g-total-wood-needed)
		)

;=========================<>=========================
;				      PRIORITY 11
;=========================<>=========================

	;----------
	;	Loom
	;----------

		(defrule
		(can-research-with-escrow ri-loom)
		(goal g-far-boar YES)
		(unit-type-count villager >= FAR-BOAR-HUNTING-VILS-NEEDED)
		=>
		(up-release-escrow)
		(research ri-loom)
		(chat-to-player my-player-number "Research Loom for boar hunting")
		)

		(defrule
		(can-research-with-escrow ri-loom)
		(or
			(up-object-type-count c: villager g:>= g-required-num-villager)
			(or
				(goal g-town-under-attack YES)
				(players-military-population any-enemy > 1)))
		(or
			(unit-type-count villager >= 7)
			(or
				(civ-selected chinese)
				(civ-selected mayan)))
		=>
		(up-release-escrow)
		(research ri-loom)
		(chat-to-player my-player-number "Research Loom")
		)

		(defrule
		(can-research-with-escrow ri-loom)
		(food-amount < 45)
		(not
			(can-train villager))
		(or
			(unit-type-count villager >= 7)
			(or
				(civ-selected chinese)
				(civ-selected mayan)))
		=>
		(up-release-escrow)
		(research ri-loom)
		(chat-to-player my-player-number "Research Loom to prevent idle TC")
		)

		(defrule
		(research-available ri-loom)
		=>
		(up-modify-goal g-highest-tech-priority c:max 11)
		)

	;-----------------
	;	Feudal Age
	;-----------------

		(defrule
		(can-research-with-escrow feudal-age)
		(up-object-type-count c: villager g:>= g-required-num-villager)
		=>
		(up-release-escrow)
		(research feudal-age)
		)

		(defrule
		(research-available feudal-age)
		=>
		(up-modify-goal g-highest-tech-priority c:max 11)
		)
		
	;-----------------
	;	Castle Age
	;-----------------

		(defrule
		(up-research-status c: castle-age != research-available)
		=>
		(up-jump-rule 2)
		)

		(defrule
		(can-research-with-escrow castle-age)
		(up-object-type-count c: villager g:>= g-required-num-villager)
		=>
		(up-release-escrow)
		(research castle-age)
		)

		(defrule
		(current-age == feudal-age)
		(up-research-status c: castle-age == research-available)
		(up-object-type-count c: villager g:>= g-required-num-villager)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: castle-age c: 1)
		(up-setup-cost-data 0 g-total-food-needed)
		(up-add-cost-data g-food-cost c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 11)
		(up-modify-escrow food g:= g-total-food-needed)
		(up-modify-escrow wood g:= g-total-wood-needed)
		(up-modify-escrow stone g:= g-total-stone-needed)
		(up-modify-escrow gold g:= g-total-gold-needed)
		)
		
	;-----------------
	;	Imperial Age
	;-----------------

		(defrule
		(up-research-status c: imperial-age != research-available)
		=>
		(up-jump-rule 3)
		)

		(defrule
		(can-research-with-escrow imperial-age)
		(up-object-type-count c: villager g:>= g-required-num-villager)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: imperial-age c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
		(up-research g-escrow c: imperial-age)
		)

		(defrule
		(current-age == castle-age)
		(up-research-status c: imperial-age == research-available)
		(up-object-type-count c: villager g:>= g-required-num-villager)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: imperial-age c: 1)
		(up-setup-cost-data 0 g-total-food-needed)
		(up-add-cost-data g-food-cost c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 11)
		(up-modify-escrow food g:= g-total-food-needed)
		(up-modify-escrow wood g:= g-total-wood-needed)
		(up-modify-escrow stone g:= g-total-stone-needed)
		(up-modify-escrow gold g:= g-total-gold-needed)
		)

(load "The General 3/Strategies/Krush Techs")
(load "The General 3/Strategies/MC Knights Techs")

	;------------
	;	Escrow
	;------------

		(defrule
		(up-resource-amount amount-food g:< g-max-food-needed)    ;Need to escrow food
		(goal g-highest-tech-priority 7)
		=>
		(set-escrow-percentage food 48)
		)

		(defrule
		(up-resource-amount amount-wood g:< g-max-wood-needed)    ;Need to escrow wood
		(goal g-highest-tech-priority 7)
		=>
		(set-escrow-percentage wood 48)
		)

		(defrule
		(up-resource-amount amount-gold g:< g-max-gold-needed)    ;Need to escrow gold
		(goal g-highest-tech-priority 7)
		=>
		(set-escrow-percentage gold 48)
		)

		(defrule
		(up-resource-amount amount-stone g:< g-max-stone-needed)    ;Need to escrow stone
		(goal g-highest-tech-priority 7)
		=>
		(set-escrow-percentage stone 48)
		)

;=========================<>=========================
;				      PRIORITY 6
;=========================<>=========================

	;Emergency unit upgrades (if next age and is a support unit)
	;-----------------
	;	Man-at-Arms
	;-----------------

		(defrule
		(up-research-status c: ri-man-at-arms != research-available)
		=>
		(up-jump-rule 3)
		)

        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-man-at-arms)
        (up-compare-goal g-highest-tech-priority <= 6)
		(current-age >= castle-age)
		(goal g-support-unit militiaman)
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-man-at-arms c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-man-at-arms)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-man-at-arms)
        (up-compare-goal g-highest-tech-priority <= 8)
		(current-age >= castle-age)
		(goal g-support-unit militiaman)
        =>
        (research ri-man-at-arms)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-man-at-arms == research-available)
        (up-compare-goal g-highest-tech-priority <= 6)
		(current-age >= castle-age)
		(goal g-support-unit militiaman)
		(building-type-count barracks > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-man-at-arms c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 6)
		)

	;-----------------
	;	Crossbowman
	;-----------------

		(defrule
		(up-research-status c: ri-crossbow != research-available)
		=>
		(up-jump-rule 3)
		)

        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-crossbow)
        (up-compare-goal g-highest-tech-priority <= 6)
		(current-age >= imperial-age)
		(goal g-support-unit archer)
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-crossbow c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-crossbow)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-crossbow)
        (up-compare-goal g-highest-tech-priority <= 8)
		(current-age >= imperial-age)
		(goal g-support-unit archer)
        =>
        (research ri-crossbow)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-crossbow == research-available)
        (up-compare-goal g-highest-tech-priority <= 6)
		(current-age >= imperial-age)
		(goal g-support-unit archer)
		(building-type-count archery-range > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-crossbow c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 6)
		)

	;-------------
	;	Pikeman
	;-------------

		(defrule
		(up-research-status c: ri-pikeman != research-available)
		=>
		(up-jump-rule 3)
		)

        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-pikeman)
        (up-compare-goal g-highest-tech-priority <= 6)
		(current-age >= imperial-age)
		(goal g-support-unit spearman)
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-pikeman c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-pikeman)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-pikeman)
        (up-compare-goal g-highest-tech-priority <= 8)
		(current-age >= imperial-age)
		(goal g-support-unit spearman)
        =>
        (research ri-pikeman)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-pikeman == research-available)
        (up-compare-goal g-highest-tech-priority <= 6)
		(current-age >= imperial-age)
		(goal g-support-unit spearman)
		(building-type-count barracks > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-pikeman c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 6)
		)

	#load-if-defined UP-GAME-WK

		;-------------------
		;	Eagle Warrior
		;-------------------

			(defrule
			(up-research-status c: ri-eagle-warrior != research-available)
			=>
			(up-jump-rule 3)
			)

			(defrule
			(goal g-first-attack-launched YES)
			(can-research-with-escrow ri-eagle-warrior)
      	  	(up-compare-goal g-highest-tech-priority <= 6)
			(current-age >= imperial-age)
			(goal g-support-unit eagle-warrior)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-eagle-warrior c: 1)
			(up-modify-escrow food g:- g-food-cost)
			(up-modify-escrow gold g:- g-gold-cost)
			(up-research g-escrow c: ri-eagle-warrior)
			)

			(defrule
			(goal g-first-attack-launched YES)
			(can-research ri-eagle-warrior)
			(up-compare-goal g-highest-tech-priority <= 8)
			(current-age >= imperial-age)
			(goal g-support-unit eagle-warrior)
			=>
			(research ri-eagle-warrior)
			)

			(defrule
			(goal g-first-attack-launched YES)
			(up-research-status c: ri-eagle-warrior == research-available)
        	(up-compare-goal g-highest-tech-priority <= 6)
			(current-age >= imperial-age)
			(goal g-support-unit eagle-warrior)
			(building-type-count barracks > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-eagle-warrior c: 1)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			(up-modify-goal g-highest-tech-priority c:max 6)
			)

	#end-if

	;-------------------
	;	Light Cavalry
	;-------------------

		(defrule
		(up-research-status c: ri-light-cavalry != research-available)
		=>
		(up-jump-rule 3)
		)

        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-light-cavalry)
        (up-compare-goal g-highest-tech-priority <= 6)
		(current-age >= imperial-age)
		(goal g-support-unit scout-cavalry)
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-light-cavalry c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-light-cavalry)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-light-cavalry)
        (up-compare-goal g-highest-tech-priority <= 8)
		(current-age >= imperial-age)
		(goal g-support-unit scout-cavalry)
        =>
        (research ri-light-cavalry)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-light-cavalry == research-available)
        (up-compare-goal g-highest-tech-priority <= 6)
		(current-age >= imperial-age)
		(goal g-support-unit scout-cavalry)
		(building-type-count stable > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-light-cavalry c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 6)
		)

	;----------------------
	;	Elite Skirmisher
	;----------------------

		(defrule
		(up-research-status c: ri-elite-skirmisher != research-available)
		=>
		(up-jump-rule 3)
		)

        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-elite-skirmisher)
        (up-compare-goal g-highest-tech-priority <= 6)
		(current-age >= imperial-age)
		(goal g-support-unit skirmisher)
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-elite-skirmisher c: 1)
		(up-modify-escrow wood g:- g-wood-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-elite-skirmisher)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-elite-skirmisher)
        (up-compare-goal g-highest-tech-priority <= 8)
		(current-age >= imperial-age)
		(goal g-support-unit skirmisher)
        =>
        (research ri-elite-skirmisher)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-elite-skirmisher == research-available)
        (up-compare-goal g-highest-tech-priority <= 6)
		(current-age >= imperial-age)
		(goal g-support-unit skirmisher)
		(building-type-count archery-range > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-elite-skirmisher c: 1)
		(up-modify-goal g-max-wood-needed g:max g-wood-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 6)
		)

	;--------------------
	;	Long Swordsman
	;--------------------

		(defrule
		(up-research-status c: ri-long-swordsman != research-available)
		=>
		(up-jump-rule 3)
		)

        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-long-swordsman)
        (up-compare-goal g-highest-tech-priority <= 6)
		(or
			(and
				(current-age >= imperial-age)
				(up-compare-goal g-desired-num-militia >= 6))
			(goal g-support-unit militiaman))
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-long-swordsman c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-long-swordsman)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-long-swordsman)
        (up-compare-goal g-highest-tech-priority <= 8)
		(or
			(and
				(current-age >= imperial-age)
				(up-compare-goal g-desired-num-militia >= 6))
			(goal g-support-unit militiaman))
        =>
        (research ri-long-swordsman)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-long-swordsman == research-available)
        (up-compare-goal g-highest-tech-priority <= 6)
		(or
			(and
				(current-age >= imperial-age)
				(up-compare-goal g-desired-num-militia >= 6))
			(goal g-support-unit militiaman))
		(building-type-count barracks > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-long-swordsman c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 6)
		)

	;----------------
	;	Halberdier
	;----------------

		(defrule
		(up-research-status c: ri-halberdier != research-available)
		=>
		(up-jump-rule 3)
		)

        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-halberdier)
        (up-compare-goal g-highest-tech-priority <= 6)
		(up-compare-goal g-desired-num-spearman >= 6)
		(up-compare-goal g-age-status >= LATE-IMPERIAL)
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-halberdier c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-halberdier)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-halberdier)
        (up-compare-goal g-highest-tech-priority <= 8)
		(up-compare-goal g-desired-num-spearman >= 6)
		(up-compare-goal g-age-status >= LATE-IMPERIAL)
        =>
        (research ri-halberdier)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-halberdier == research-available)
        (up-compare-goal g-highest-tech-priority <= 6)
		(up-compare-goal g-desired-num-spearman >= 6)
		(up-compare-goal g-age-status >= LATE-IMPERIAL)
		(building-type-count barracks > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-halberdier c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 6)
		)

	;-------------
	;	Hussar
	;-------------

		(defrule
		(up-research-status c: ri-hussar != research-available)
		=>
		(up-jump-rule 3)
		)

        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-hussar)
        (up-compare-goal g-highest-tech-priority <= 6)
		(up-compare-goal g-desired-num-scout-cavalry >= 6)
		(up-compare-goal g-age-status >= LATE-IMPERIAL)
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-hussar c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-hussar)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-hussar)
        (up-compare-goal g-highest-tech-priority <= 8)
		(up-compare-goal g-desired-num-scout-cavalry >= 6)
		(up-compare-goal g-age-status >= LATE-IMPERIAL)
        =>
        (research ri-hussar)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-hussar == research-available)
        (up-compare-goal g-highest-tech-priority <= 6)
		(up-compare-goal g-desired-num-scout-cavalry >= 6)
		(up-compare-goal g-age-status >= LATE-IMPERIAL)
		(building-type-count stable > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-hussar c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 6)
		)

	;-------------------------
	;	Imperial Skirmisher
	;-------------------------

		(defrule
		(up-research-status c: ri-imperial-skirmisher != research-available)
		=>
		(up-jump-rule 3)
		)

        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-imperial-skirmisher)
        (up-compare-goal g-highest-tech-priority <= 6)
		(up-compare-goal g-desired-num-skirmisher >= 6)
		(up-compare-goal g-age-status >= LATE-IMPERIAL)
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-imperial-skirmisher c: 1)
		(up-modify-escrow wood g:- g-wood-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-imperial-skirmisher)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-imperial-skirmisher)
        (up-compare-goal g-highest-tech-priority <= 8)
		(up-compare-goal g-desired-num-skirmisher >= 6)
		(up-compare-goal g-age-status >= LATE-IMPERIAL)
        =>
        (research ri-imperial-skirmisher)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-imperial-skirmisher == research-available)
        (up-compare-goal g-highest-tech-priority <= 6)
		(up-compare-goal g-desired-num-skirmisher >= 6)
		(up-compare-goal g-age-status >= LATE-IMPERIAL)
		(building-type-count archery-range > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-imperial-skirmisher c: 1)
		(up-modify-goal g-max-wood-needed g:max g-wood-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 6)
		)

	;--------------------
	;	Elite Genitour
	;--------------------

		(defrule
		(up-research-status c: ri-elite-genitour != research-available)
		=>
		(up-jump-rule 3)
		)

        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-elite-genitour)
        (up-compare-goal g-highest-tech-priority <= 6)
		(up-compare-goal g-desired-num-genitour >= 6)
		(up-compare-goal g-age-status >= LATE-IMPERIAL)
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-elite-genitour c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow wood g:- g-wood-cost)
        (up-research g-escrow c: ri-elite-genitour)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-elite-genitour)
        (up-compare-goal g-highest-tech-priority <= 8)
		(up-compare-goal g-desired-num-genitour >= 6)
		(up-compare-goal g-age-status >= LATE-IMPERIAL)
        =>
        (research ri-elite-genitour)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-elite-genitour == research-available)
        (up-compare-goal g-highest-tech-priority <= 6)
		(up-compare-goal g-desired-num-genitour >= 6)
		(up-compare-goal g-age-status >= LATE-IMPERIAL)
		(building-type-count archery-range > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-elite-genitour c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-wood-needed g:max g-wood-cost)
		(up-modify-goal g-highest-tech-priority c:max 6)
		)

	;--------------------
	;	Double-Bit Axe
	;--------------------

		(defrule
		(up-research-status c: ri-double-bit-axe != research-available)
		=>
		(up-jump-rule 3)
		)

        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-double-bit-axe)
        (up-compare-goal g-highest-tech-priority <= 6)
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-double-bit-axe c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow wood g:- g-wood-cost)
        (up-research g-escrow c: ri-double-bit-axe)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-double-bit-axe)
        (up-compare-goal g-highest-tech-priority <= 8)
        =>
        (research ri-double-bit-axe)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-double-bit-axe == research-available)
        (up-compare-goal g-highest-tech-priority <= 6)
		(building-type-count lumber-camp > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-double-bit-axe c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-wood-needed g:max g-wood-cost)
		(up-modify-goal g-highest-tech-priority c:max 6)
		)

	;-------------
	;	Bow Saw
	;-------------

		(defrule
		(up-research-status c: ri-bow-saw != research-available)
		=>
		(up-jump-rule 3)
		)

        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-bow-saw)
        (up-compare-goal g-highest-tech-priority <= 6)
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-bow-saw c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow wood g:- g-wood-cost)
        (up-research g-escrow c: ri-bow-saw)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-bow-saw)
        (up-compare-goal g-highest-tech-priority <= 8)
        =>
        (research ri-bow-saw)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-bow-saw == research-available)
        (up-compare-goal g-highest-tech-priority <= 6)
		(building-type-count lumber-camp > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-bow-saw c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-wood-needed g:max g-wood-cost)
		(up-modify-goal g-highest-tech-priority c:max 6)
		)

	;------------------
	;	Horse Collar
	;------------------

		(defrule
		(up-research-status c: ri-horse-collar != research-available)
		=>
		(up-jump-rule 3)
		)

        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-horse-collar)
        (up-compare-goal g-highest-tech-priority <= 6)
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-horse-collar c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow wood g:- g-wood-cost)
        (up-research g-escrow c: ri-horse-collar)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-horse-collar)
        (up-compare-goal g-highest-tech-priority <= 8)
        =>
        (research ri-horse-collar)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-horse-collar == research-available)
        (up-compare-goal g-highest-tech-priority <= 6)
		(building-type-count mill > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-horse-collar c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-wood-needed g:max g-wood-cost)
		(up-modify-goal g-highest-tech-priority c:max 6)
		)

	;----------------
	;	Heavy Plow
	;----------------

		(defrule
		(up-research-status c: ri-heavy-plow != research-available)
		=>
		(up-jump-rule 3)
		)

        (defrule
		(up-compare-goal g-attack-status >= FIRST-CASTLE-ATTACK)
        (can-research-with-escrow ri-heavy-plow)
        (up-compare-goal g-highest-tech-priority <= 6)
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-heavy-plow c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow wood g:- g-wood-cost)
        (up-research g-escrow c: ri-heavy-plow)
        )

        (defrule
		(up-compare-goal g-attack-status >= FIRST-CASTLE-ATTACK)
        (can-research ri-heavy-plow)
        (up-compare-goal g-highest-tech-priority <= 8)
        =>
        (research ri-heavy-plow)
        )

		(defrule
		(up-compare-goal g-attack-status >= FIRST-CASTLE-ATTACK)
		(up-research-status c: ri-heavy-plow == research-available)
        (up-compare-goal g-highest-tech-priority <= 6)
		(building-type-count mill > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-heavy-plow c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-wood-needed g:max g-wood-cost)
		(up-modify-goal g-highest-tech-priority c:max 6)
		)

	;-----------------
	;	Wheelbarrow
	;-----------------

		(defrule
		(up-research-status c: ri-wheel-barrow != research-available)
		=>
		(up-jump-rule 3)
		)

        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-wheel-barrow)
        (up-compare-goal g-highest-tech-priority <= 6)
		(or
			(unit-type-count villager >= 55)
			(and
				(up-compare-goal g-game-focus != AGGRESSIVE)
				(unit-type-count villager >= 40)))
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-wheel-barrow c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow wood g:- g-wood-cost)
        (up-research g-escrow c: ri-wheel-barrow)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-wheel-barrow)
        (up-compare-goal g-highest-tech-priority <= 8)
		(or
			(unit-type-count villager >= 55)
			(and
				(up-compare-goal g-game-focus != AGGRESSIVE)
				(unit-type-count villager >= 40)))
        =>
        (research ri-wheel-barrow)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-wheel-barrow == research-available)
        (up-compare-goal g-highest-tech-priority <= 6)
		(or
			(unit-type-count villager >= 55)
			(and
				(up-compare-goal g-game-focus != AGGRESSIVE)
				(unit-type-count villager >= 40)))
		(building-type-count town-center > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-wheel-barrow c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-wood-needed g:max g-wood-cost)
		(up-modify-goal g-highest-tech-priority c:max 6)
		(set-goal g-allow-queued-villagers NO)
		)

	;-------------
	;	Caravan
	;-------------

		(defrule
		(up-research-status c: ri-caravan != research-available)
		=>
		(up-jump-rule 3)
		)

        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-caravan)
        (up-compare-goal g-highest-tech-priority <= 6)
		(or	
			(up-compare-goal g-desired-num-trade-cart >= 5)
			(unit-type-count trade-cart >= 5))
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-caravan c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-caravan)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-caravan)
        (up-compare-goal g-highest-tech-priority <= 8)
		(or	
			(up-compare-goal g-desired-num-trade-cart >= 5)
			(unit-type-count trade-cart >= 5))
        =>
        (research ri-caravan)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-caravan == research-available)
        (up-compare-goal g-highest-tech-priority <= 6)
		(or	
			(up-compare-goal g-desired-num-trade-cart >= 5)
			(unit-type-count trade-cart >= 5))
		(building-type-count market > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-caravan c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 6)
		)
		
	;---------------
	;	Fletching
	;---------------

		(defrule
		(up-research-status c: ri-fletching != research-available)
		=>
		(up-jump-rule 13)
		)

		;Check if support or unique unit benefits from fletching
		(defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-fletching)
        (up-compare-goal g-highest-tech-priority <= 8)
		=>
		(up-get-object-type-data g: g-support-unit object-data-class g-temp)
		(up-get-object-type-data c: my-unique-unit object-data-class g-temp-2)
		)

        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-fletching)
        (up-compare-goal g-highest-tech-priority <= 6)
		(current-age >= castle-age)
		(or
			(goal g-temp archery-class)			;support unit is a foot archer
			(goal g-temp cavalry-archer-class))	;support unit is a cavalry archer
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-fletching c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-fletching)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-fletching)
        (up-compare-goal g-highest-tech-priority <= 8)
		(current-age >= castle-age)
		(or
			(goal g-temp archery-class)			;support unit is a foot archer
			(goal g-temp cavalry-archer-class))	;support unit is a cavalry archer
        =>
        (research ri-fletching)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-fletching == research-available)
        (up-compare-goal g-highest-tech-priority <= 6)
		(current-age >= castle-age)
		(or
			(goal g-temp archery-class)			;support unit is a foot archer
			(goal g-temp cavalry-archer-class))	;support unit is a cavalry archer
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-fletching c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 6)
		)
		
		;Check if we want to train archery range units that require fletching
        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-fletching)
        (up-compare-goal g-highest-tech-priority <= 6)
		(current-age >= castle-age)
		(or
			(up-compare-goal g-desired-num-archer >= 12)
			(or
				(up-compare-goal g-desired-num-skirmisher >= 12)
				(up-compare-goal g-desired-num-cavalry-archer >= 10)))
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-fletching c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-fletching)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-fletching)
        (up-compare-goal g-highest-tech-priority <= 8)
		(current-age >= castle-age)
		(or
			(up-compare-goal g-desired-num-archer >= 12)
			(or
				(up-compare-goal g-desired-num-skirmisher >= 12)
				(up-compare-goal g-desired-num-cavalry-archer >= 10)))
        =>
        (research ri-fletching)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-fletching == research-available)
        (up-compare-goal g-highest-tech-priority <= 6)
		(current-age >= castle-age)
		(or
			(up-compare-goal g-desired-num-archer >= 12)
			(or
				(up-compare-goal g-desired-num-skirmisher >= 12)
				(up-compare-goal g-desired-num-cavalry-archer >= 10)))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-fletching c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 6)
		)
		
		;Check if we want to train unique archery range units that require fletching
        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-fletching)
        (up-compare-goal g-highest-tech-priority <= 6)
		(current-age >= castle-age)
		(or
			(up-compare-goal g-desired-num-slinger >= 12)
			(up-compare-goal g-desired-num-genitour >= 12))
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-fletching c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-fletching)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-fletching)
        (up-compare-goal g-highest-tech-priority <= 8)
		(current-age >= castle-age)
		(or
			(up-compare-goal g-desired-num-slinger >= 12)
			(up-compare-goal g-desired-num-genitour >= 12))
        =>
        (research ri-fletching)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-fletching == research-available)
        (up-compare-goal g-highest-tech-priority <= 6)
		(current-age >= castle-age)
		(or
			(up-compare-goal g-desired-num-slinger >= 12)
			(up-compare-goal g-desired-num-genitour >= 12))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-fletching c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 6)
		)
		
		;Check if we want to train unique units that require fletching
        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-fletching)
        (up-compare-goal g-highest-tech-priority <= 6)
		(current-age >= castle-age)
		(up-compare-goal g-desired-num-unique-unit >= 10)
		(or
			(goal g-temp-2 archery-class)			;unique unit is a foot archer
			(goal g-temp-2 cavalry-archer-class))	;unique unit is a cavalry archer
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-fletching c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-fletching)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-fletching)
        (up-compare-goal g-highest-tech-priority <= 8)
		(current-age >= castle-age)
		(up-compare-goal g-desired-num-unique-unit >= 10)
		(or
			(goal g-temp-2 archery-class)			;unique unit is a foot archer
			(goal g-temp-2 cavalry-archer-class))	;unique unit is a cavalry archer
        =>
        (research ri-fletching)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-fletching == research-available)
        (up-compare-goal g-highest-tech-priority <= 6)
		(current-age >= castle-age)
		(up-compare-goal g-desired-num-unique-unit >= 10)
		(or
			(goal g-temp-2 archery-class)			;unique unit is a foot archer
			(goal g-temp-2 cavalry-archer-class))	;unique unit is a cavalry archer
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-fletching c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 6)
		)
		
	;------------------
	;	Bodkin Arrow
	;------------------

		(defrule
		(up-research-status c: ri-bodkin-arrow != research-available)
		=>
		(up-jump-rule 13)
		)

		;Check if support or unique unit benefits from bodkin-arrow
		(defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-bodkin-arrow)
        (up-compare-goal g-highest-tech-priority <= 8)
		=>
		(up-get-object-type-data g: g-support-unit object-data-class g-temp)
		(up-get-object-type-data c: my-unique-unit object-data-class g-temp-2)
		)

        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-bodkin-arrow)
        (up-compare-goal g-highest-tech-priority <= 6)
		(current-age >= imperial-age)
		(or
			(goal g-temp archery-class)			;support unit is a foot archer
			(goal g-temp cavalry-archer-class))	;support unit is a cavalry archer
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-bodkin-arrow c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-bodkin-arrow)
		)

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-bodkin-arrow)
        (up-compare-goal g-highest-tech-priority <= 8)
		(current-age >= imperial-age)
		(or
			(goal g-temp archery-class)			;support unit is a foot archer
			(goal g-temp cavalry-archer-class))	;support unit is a cavalry archer
        =>
        (research ri-bodkin-arrow)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-bodkin-arrow == research-available)
        (up-compare-goal g-highest-tech-priority <= 6)
		(current-age >= imperial-age)
		(or
			(goal g-temp archery-class)			;support unit is a foot archer
			(goal g-temp cavalry-archer-class))	;support unit is a cavalry archer
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-bodkin-arrow c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 6)
		)
		
		;Check if we want to train archery range units that require bodkin-arrow
        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-bodkin-arrow)
        (up-compare-goal g-highest-tech-priority <= 6)
		(current-age >= imperial-age)
		(or
			(up-compare-goal g-desired-num-archer >= 12)
			(or
				(up-compare-goal g-desired-num-skirmisher >= 12)
				(up-compare-goal g-desired-num-cavalry-archer >= 10)))
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-bodkin-arrow c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-bodkin-arrow)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-bodkin-arrow)
        (up-compare-goal g-highest-tech-priority <= 8)
		(current-age >= imperial-age)
		(or
			(up-compare-goal g-desired-num-archer >= 12)
			(or
				(up-compare-goal g-desired-num-skirmisher >= 12)
				(up-compare-goal g-desired-num-cavalry-archer >= 10)))
        =>
        (research ri-bodkin-arrow)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-bodkin-arrow == research-available)
        (up-compare-goal g-highest-tech-priority <= 6)
		(current-age >= imperial-age)
		(or
			(up-compare-goal g-desired-num-archer >= 12)
			(or
				(up-compare-goal g-desired-num-skirmisher >= 12)
				(up-compare-goal g-desired-num-cavalry-archer >= 10)))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-bodkin-arrow c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 6)
		)
		
		;Check if we want to train unique archery range units that require bodkin-arrow
        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-bodkin-arrow)
        (up-compare-goal g-highest-tech-priority <= 6)
		(current-age >= imperial-age)
		(or
			(up-compare-goal g-desired-num-slinger >= 12)
			(up-compare-goal g-desired-num-genitour >= 12))
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-bodkin-arrow c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-bodkin-arrow)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-bodkin-arrow)
        (up-compare-goal g-highest-tech-priority <= 8)
		(current-age >= imperial-age)
		(or
			(up-compare-goal g-desired-num-slinger >= 12)
			(up-compare-goal g-desired-num-genitour >= 12))
        =>
        (research ri-bodkin-arrow)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-bodkin-arrow == research-available)
        (up-compare-goal g-highest-tech-priority <= 6)
		(current-age >= imperial-age)
		(or
			(up-compare-goal g-desired-num-slinger >= 12)
			(up-compare-goal g-desired-num-genitour >= 12))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-bodkin-arrow c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 6)
		)
		
		;Check if we want to train unique units that require bodkin-arrow
        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-bodkin-arrow)
        (up-compare-goal g-highest-tech-priority <= 6)
		(current-age >= imperial-age)
		(up-compare-goal g-desired-num-unique-unit >= 10)
		(or
			(goal g-temp-2 archery-class)			;unique unit is a foot archer
			(goal g-temp-2 cavalry-archer-class))	;unique unit is a cavalry archer
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-bodkin-arrow c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-bodkin-arrow)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-bodkin-arrow)
        (up-compare-goal g-highest-tech-priority <= 8)
		(current-age >= imperial-age)
		(up-compare-goal g-desired-num-unique-unit >= 10)
		(or
			(goal g-temp-2 archery-class)			;unique unit is a foot archer
			(goal g-temp-2 cavalry-archer-class))	;unique unit is a cavalry archer
        =>
        (research ri-bodkin-arrow)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-bodkin-arrow == research-available)
        (up-compare-goal g-highest-tech-priority <= 6)
		(current-age >= imperial-age)
		(up-compare-goal g-desired-num-unique-unit >= 10)
		(or
			(goal g-temp-2 archery-class)			;unique unit is a foot archer
			(goal g-temp-2 cavalry-archer-class))	;unique unit is a cavalry archer
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-bodkin-arrow c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 6)
		)

	;---------------
	;	Chemistry
	;---------------

		(defrule
		(up-research-status c: ri-chemistry != research-available)
		=>
		(up-jump-rule 3)
		)

        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-chemistry)
        (up-compare-goal g-highest-tech-priority <= 6)
		(or
			(up-compare-goal g-desired-num-hand-cannoneer > 0)
			(or
				(up-compare-goal g-desired-num-bombard-cannon > 0)
				(or
					(up-compare-goal g-desired-num-cannon-galleon > 0)
					(up-compare-goal g-desired-num-bombard-cannon > 0))))
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-chemistry c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-chemistry)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-chemistry)
        (up-compare-goal g-highest-tech-priority <= 8)
		(or
			(up-compare-goal g-desired-num-hand-cannoneer > 0)
			(or
				(up-compare-goal g-desired-num-bombard-cannon > 0)
				(or
					(up-compare-goal g-desired-num-cannon-galleon > 0)
					(up-compare-goal g-desired-num-bombard-cannon > 0))))
        =>
        (research ri-chemistry)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-chemistry == research-available)
        (up-compare-goal g-highest-tech-priority <= 6)
		(or
			(up-compare-goal g-desired-num-hand-cannoneer > 0)
			(or
				(up-compare-goal g-desired-num-bombard-cannon > 0)
				(or
					(up-compare-goal g-desired-num-cannon-galleon > 0)
					(up-compare-goal g-desired-num-bombard-cannon > 0))))
		(building-type-count university > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-chemistry c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 6)
		)

	;------------
	;	Heresy
	;------------

		(defrule
		(up-research-status c: ri-heresy != research-available)
		=>
		(up-jump-rule 3)
		)

        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-heresy)
        (up-compare-goal g-highest-tech-priority <= 6)
		(up-compare-goal g-enemy-monks-count >= 12)
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-heresy c: 1)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-heresy)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-heresy)
        (up-compare-goal g-highest-tech-priority <= 8)
		(up-compare-goal g-enemy-monks-count >= 12)
        =>
        (research ri-heresy)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-heresy == research-available)
        (up-compare-goal g-highest-tech-priority <= 6)
		(up-compare-goal g-enemy-monks-count >= 12)
		(building-type-count monastery > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-heresy c: 1)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 6)
		)

	;------------
	;	Escrow
	;------------

		(defrule
		(up-resource-amount amount-food g:< g-max-food-needed)    ;Need to escrow food
		(goal g-highest-tech-priority 6)
		=>
		(set-escrow-percentage food 36)
		)

		(defrule
		(up-resource-amount amount-wood g:< g-max-wood-needed)    ;Need to escrow wood
		(goal g-highest-tech-priority 6)
		=>
		(set-escrow-percentage wood 36)
		)

		(defrule
		(up-resource-amount amount-gold g:< g-max-gold-needed)    ;Need to escrow gold
		(goal g-highest-tech-priority 6)
		=>
		(set-escrow-percentage gold 36)
		)

		(defrule
		(up-resource-amount amount-stone g:< g-max-stone-needed)    ;Need to escrow stone
		(goal g-highest-tech-priority 6)
		=>
		(set-escrow-percentage stone 36)
		)

;=========================<>=========================
;				      PRIORITY 5
;=========================<>=========================

	;-----------------
	;	Man-at-Arms
	;-----------------

		(defrule
		(up-research-status c: ri-man-at-arms != research-available)
		=>
		(up-jump-rule 3)
		)

        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-man-at-arms)
        (up-compare-goal g-highest-tech-priority <= 5)
		(or
			(and
				(current-age >= castle-age)
				(up-compare-goal g-desired-num-militia >= 6))
			(goal g-support-unit militiaman))
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-man-at-arms c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-man-at-arms)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-man-at-arms)
        (up-compare-goal g-highest-tech-priority <= 7)
		(or
			(and
				(current-age >= castle-age)
				(up-compare-goal g-desired-num-militia >= 6))
			(goal g-support-unit militiaman))
        =>
        (research ri-man-at-arms)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-man-at-arms == research-available)
        (up-compare-goal g-highest-tech-priority <= 5)
		(or
			(and
				(current-age >= castle-age)
				(up-compare-goal g-desired-num-militia >= 6))
			(goal g-support-unit militiaman))
		(building-type-count barracks > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-man-at-arms c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 5)
		)

	;-----------------
	;	Crossbowman
	;-----------------

		(defrule
		(up-research-status c: ri-crossbow != research-available)
		=>
		(up-jump-rule 3)
		)

        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-crossbow)
        (up-compare-goal g-highest-tech-priority <= 5)
		(or
			(and
				(current-age >= imperial-age)
				(up-compare-goal g-desired-num-archer >= 6))
			(goal g-support-unit archer))
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-crossbow c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-crossbow)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-crossbow)
        (up-compare-goal g-highest-tech-priority <= 7)
		(or
			(and
				(current-age >= imperial-age)
				(up-compare-goal g-desired-num-archer >= 6))
			(goal g-support-unit archer))
        =>
        (research ri-crossbow)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-crossbow == research-available)
        (up-compare-goal g-highest-tech-priority <= 5)
		(or
			(and
				(current-age >= imperial-age)
				(up-compare-goal g-desired-num-archer >= 6))
			(goal g-support-unit archer))
		(building-type-count archery-range > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-crossbow c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 5)
		)

	;-------------
	;	Pikeman
	;-------------

		(defrule
		(up-research-status c: ri-pikeman != research-available)
		=>
		(up-jump-rule 3)
		)

        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-pikeman)
        (up-compare-goal g-highest-tech-priority <= 5)
		(or
			(and
				(current-age >= imperial-age)
				(up-compare-goal g-desired-num-spearman >= 6))
			(goal g-support-unit spearman))
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-pikeman c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-pikeman)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-pikeman)
        (up-compare-goal g-highest-tech-priority <= 7)
		(or
			(and
				(current-age >= imperial-age)
				(up-compare-goal g-desired-num-spearman >= 6))
			(goal g-support-unit spearman))
        =>
        (research ri-pikeman)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-pikeman == research-available)
        (up-compare-goal g-highest-tech-priority <= 5)
		(or
			(and
				(current-age >= imperial-age)
				(up-compare-goal g-desired-num-spearman >= 6))
			(goal g-support-unit spearman))
		(building-type-count barracks > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-pikeman c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 5)
		)

	#load-if-defined UP-GAME-WK

		;-------------------
		;	Eagle Warrior
		;-------------------

			(defrule
			(up-research-status c: ri-eagle-warrior != research-available)
			=>
			(up-jump-rule 3)
			)

			(defrule
			(goal g-first-attack-launched YES)
			(can-research-with-escrow ri-eagle-warrior)
        	(up-compare-goal g-highest-tech-priority <= 5)
			(or
				(and
					(current-age >= imperial-age)
					(up-compare-goal g-desired-num-eagle-warrior >= 6))
				(goal g-support-unit eagle-warrior))
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-eagle-warrior c: 1)
			(up-modify-escrow food g:- g-food-cost)
			(up-modify-escrow gold g:- g-gold-cost)
			(up-research g-escrow c: ri-eagle-warrior)
			)

			(defrule
			(goal g-first-attack-launched YES)
			(can-research ri-eagle-warrior)
			(up-compare-goal g-highest-tech-priority <= 7)
			(or
				(and
					(current-age >= imperial-age)
					(up-compare-goal g-desired-num-eagle-warrior >= 6))
				(goal g-support-unit eagle-warrior))
			=>
			(research ri-eagle-warrior)
			)

			(defrule
			(goal g-first-attack-launched YES)
			(up-research-status c: ri-eagle-warrior == research-available)
        	(up-compare-goal g-highest-tech-priority <= 5)
			(or
				(and
					(current-age >= imperial-age)
					(up-compare-goal g-desired-num-eagle-warrior >= 6))
				(goal g-support-unit eagle-warrior))
			(building-type-count barracks > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-eagle-warrior c: 1)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			(up-modify-goal g-highest-tech-priority c:max 5)
			)

	#end-if

	;-------------------
	;	Light Cavalry
	;-------------------

		(defrule
		(up-research-status c: ri-light-cavalry != research-available)
		=>
		(up-jump-rule 3)
		)

        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-light-cavalry)
        (up-compare-goal g-highest-tech-priority <= 5)
		(or
			(and
				(current-age >= imperial-age)
				(up-compare-goal g-desired-num-scout-cavalry >= 6))
			(goal g-support-unit scout-cavalry))
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-light-cavalry c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-light-cavalry)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-light-cavalry)
        (up-compare-goal g-highest-tech-priority <= 7)
		(or
			(and
				(current-age >= imperial-age)
				(up-compare-goal g-desired-num-scout-cavalry >= 6))
			(goal g-support-unit scout-cavalry))
        =>
        (research ri-light-cavalry)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-light-cavalry == research-available)
        (up-compare-goal g-highest-tech-priority <= 5)
		(or
			(and
				(current-age >= imperial-age)
				(up-compare-goal g-desired-num-scout-cavalry >= 6))
			(goal g-support-unit scout-cavalry))
		(building-type-count stable > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-light-cavalry c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 5)
		)

	;----------------------
	;	Elite Skirmisher
	;----------------------

		(defrule
		(up-research-status c: ri-elite-skirmisher != research-available)
		=>
		(up-jump-rule 3)
		)

        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-elite-skirmisher)
        (up-compare-goal g-highest-tech-priority <= 5)
		(or
			(and
				(current-age >= imperial-age)
				(up-compare-goal g-desired-num-skirmisher >= 6))
			(goal g-support-unit skirmisher))
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-elite-skirmisher c: 1)
		(up-modify-escrow wood g:- g-wood-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-elite-skirmisher)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-elite-skirmisher)
        (up-compare-goal g-highest-tech-priority <= 7)
		(or
			(and
				(current-age >= imperial-age)
				(up-compare-goal g-desired-num-skirmisher >= 6))
			(goal g-support-unit skirmisher))
        =>
        (research ri-elite-skirmisher)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-elite-skirmisher == research-available)
        (up-compare-goal g-highest-tech-priority <= 5)
		(or
			(and
				(current-age >= imperial-age)
				(up-compare-goal g-desired-num-skirmisher >= 6))
			(goal g-support-unit skirmisher))
		(building-type-count archery-range > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-elite-skirmisher c: 1)
		(up-modify-goal g-max-wood-needed g:max g-wood-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 5)
		)

	;--------------------
	;	Long Swordsman
	;--------------------

		(defrule
		(up-research-status c: ri-long-swordsman != research-available)
		=>
		(up-jump-rule 3)
		)

        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-long-swordsman)
        (up-compare-goal g-highest-tech-priority <= 5)
		(or
			(and
				(current-age >= imperial-age)
				(up-compare-goal g-desired-num-militia >= 6))
			(goal g-support-unit militiaman))
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-long-swordsman c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-long-swordsman)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-long-swordsman)
        (up-compare-goal g-highest-tech-priority <= 7)
		(or
			(and
				(current-age >= imperial-age)
				(up-compare-goal g-desired-num-militia >= 6))
			(goal g-support-unit militiaman))
        =>
        (research ri-long-swordsman)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-long-swordsman == research-available)
        (up-compare-goal g-highest-tech-priority <= 5)
		(or
			(and
				(current-age >= imperial-age)
				(up-compare-goal g-desired-num-militia >= 6))
			(goal g-support-unit militiaman))
		(building-type-count barracks > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-long-swordsman c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 5)
		)

	;--------------
	;	Cavalier
	;--------------

		(defrule
		(up-research-status c: ri-cavalier != research-available)
		=>
		(up-jump-rule 3)
		)

        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-cavalier)
        (up-compare-goal g-highest-tech-priority <= 5)
		(goal g-support-unit knight)
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-cavalier c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-cavalier)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-cavalier)
        (up-compare-goal g-highest-tech-priority <= 7)
		(goal g-support-unit knight)
        =>
        (research ri-cavalier)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-cavalier == research-available)
        (up-compare-goal g-highest-tech-priority <= 5)
		(goal g-support-unit knight)
		(building-type-count stable > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-cavalier c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 5)
		)

	;-------------
	;	Paladin
	;-------------

		(defrule
		(up-research-status c: ri-paladin != research-available)
		=>
		(up-jump-rule 3)
		)

        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-paladin)
        (up-compare-goal g-highest-tech-priority <= 5)
		(goal g-support-unit knight)
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-paladin c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-paladin)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-paladin)
        (up-compare-goal g-highest-tech-priority <= 7)
		(goal g-support-unit knight)
        =>
        (research ri-paladin)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-paladin == research-available)
        (up-compare-goal g-highest-tech-priority <= 5)
		(goal g-support-unit knight)
		(building-type-count stable > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-paladin c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 5)
		)

	;-------------------------
	;	Elite Eagle Warrior
	;-------------------------

		(defrule
		(up-research-status c: ri-elite-eagle-warrior != research-available)
		=>
		(up-jump-rule 3)
		)

        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-elite-eagle-warrior)
        (up-compare-goal g-highest-tech-priority <= 5)
		(goal g-support-unit eagle-warrior)
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-elite-eagle-warrior c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-elite-eagle-warrior)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-elite-eagle-warrior)
        (up-compare-goal g-highest-tech-priority <= 7)
		(goal g-support-unit eagle-warrior)
        =>
        (research ri-elite-eagle-warrior)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-elite-eagle-warrior == research-available)
        (up-compare-goal g-highest-tech-priority <= 5)
		(goal g-support-unit eagle-warrior)
		(building-type-count barracks > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-elite-eagle-warrior c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 5)
		)

	;--------------
	;	Arbalest
	;--------------

		(defrule
		(up-research-status c: ri-arbalest != research-available)
		=>
		(up-jump-rule 3)
		)

        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-arbalest)
        (up-compare-goal g-highest-tech-priority <= 5)
		(goal g-support-unit archer)
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-arbalest c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-arbalest)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-arbalest)
        (up-compare-goal g-highest-tech-priority <= 7)
		(goal g-support-unit archer)
        =>
        (research ri-arbalest)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-arbalest == research-available)
        (up-compare-goal g-highest-tech-priority <= 5)
		(goal g-support-unit archer)
		(building-type-count archery-range > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-arbalest c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 5)
		)

	;-----------------
	;	Heavy Camel
	;-----------------

		(defrule
		(up-research-status c: ri-heavy-camel != research-available)
		=>
		(up-jump-rule 3)
		)

        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-heavy-camel)
        (up-compare-goal g-highest-tech-priority <= 5)
		(goal g-support-unit camel)
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-heavy-camel c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-heavy-camel)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-heavy-camel)
        (up-compare-goal g-highest-tech-priority <= 7)
		(goal g-support-unit camel)
        =>
        (research ri-heavy-camel)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-heavy-camel == research-available)
        (up-compare-goal g-highest-tech-priority <= 5)
		(goal g-support-unit camel)
		(building-type-count stable > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-heavy-camel c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 5)
		)

	#load-if-defined UP-GAME-WK

		;--------------------
		;	Imperial Camel
		;--------------------

			(defrule
			(up-research-status c: ri-imperial-camel != research-available)
			=>
			(up-jump-rule 3)
			)

			(defrule
			(goal g-first-attack-launched YES)
			(can-research-with-escrow ri-imperial-camel)
        	(up-compare-goal g-highest-tech-priority <= 5)
			(goal g-support-unit camel)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-imperial-camel c: 1)
			(up-modify-escrow food g:- g-food-cost)
			(up-modify-escrow gold g:- g-gold-cost)
			(up-research g-escrow c: ri-imperial-camel)
			)

			(defrule
			(goal g-first-attack-launched YES)
			(can-research ri-imperial-camel)
			(up-compare-goal g-highest-tech-priority <= 7)
			(goal g-support-unit camel)
			=>
			(research ri-imperial-camel)
			)

			(defrule
			(goal g-first-attack-launched YES)
			(up-research-status c: ri-imperial-camel == research-available)
        	(up-compare-goal g-highest-tech-priority <= 5)
			(goal g-support-unit camel)
			(building-type-count stable > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-imperial-camel c: 1)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			(up-modify-goal g-highest-tech-priority c:max 5)
			)

	#end-if

	;-----------------
	;	Unique Unit
	;-----------------

		(defrule
		(up-research-status c: my-unique-unit-upgrade != research-available)
		=>
		(up-jump-rule 3)
		)

        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow my-unique-unit-upgrade)
        (up-compare-goal g-highest-tech-priority <= 5)
		(goal g-support-unit my-unique-unit)
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: my-unique-unit-upgrade c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
		(up-modify-escrow wood g:- g-wood-cost)
        (up-research g-escrow c: my-unique-unit-upgrade)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research my-unique-unit-upgrade)
        (up-compare-goal g-highest-tech-priority <= 7)
		(goal g-support-unit my-unique-unit)
        =>
        (research my-unique-unit-upgrade)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: my-unique-unit-upgrade == research-available)
        (up-compare-goal g-highest-tech-priority <= 5)
		(goal g-support-unit my-unique-unit)
		(building-type-count castle > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: my-unique-unit-upgrade c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-wood-needed g:max g-wood-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 5)
		)

	;----------------
	;	Halberdier
	;----------------

		(defrule
		(up-research-status c: ri-halberdier != research-available)
		=>
		(up-jump-rule 3)
		)

        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-halberdier)
        (up-compare-goal g-highest-tech-priority <= 5)
		(goal g-support-unit spearman)
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-halberdier c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-halberdier)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-halberdier)
        (up-compare-goal g-highest-tech-priority <= 7)
		(goal g-support-unit spearman)
        =>
        (research ri-halberdier)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-halberdier == research-available)
        (up-compare-goal g-highest-tech-priority <= 5)
		(goal g-support-unit spearman)
		(building-type-count barracks > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-halberdier c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 5)
		)

	;--------------
	;	Hussar
	;--------------

		(defrule
		(up-research-status c: ri-hussar != research-available)
		=>
		(up-jump-rule 3)
		)

        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-hussar)
        (up-compare-goal g-highest-tech-priority <= 5)
		(goal g-support-unit scout-cavalry)
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-hussar c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-hussar)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-hussar)
        (up-compare-goal g-highest-tech-priority <= 7)
		(goal g-support-unit scout-cavalry)
        =>
        (research ri-hussar)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-hussar == research-available)
        (up-compare-goal g-highest-tech-priority <= 5)
		(goal g-support-unit scout-cavalry)
		(building-type-count stable > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-hussar c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 5)
		)

	#load-if-defined UP-GAME-WK

		;---------------------------
		;	Elite Battle Elephant
		;---------------------------

			(defrule
			(up-research-status c: ri-elite-battle-elephant != research-available)
			=>
			(up-jump-rule 3)
			)

			(defrule
			(goal g-first-attack-launched YES)
			(can-research-with-escrow ri-elite-battle-elephant)
        	(up-compare-goal g-highest-tech-priority <= 5)
			(goal g-support-unit battle-elephant)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-elite-battle-elephant c: 1)
			(up-modify-escrow food g:- g-food-cost)
			(up-modify-escrow gold g:- g-gold-cost)
			(up-research g-escrow c: ri-elite-battle-elephant)
			)

			(defrule
			(goal g-first-attack-launched YES)
			(can-research ri-elite-battle-elephant)
			(up-compare-goal g-highest-tech-priority <= 7)
			(goal g-support-unit battle-elephant)
			=>
			(research ri-elite-battle-elephant)
			)

			(defrule
			(goal g-first-attack-launched YES)
			(up-research-status c: ri-elite-battle-elephant == research-available)
        	(up-compare-goal g-highest-tech-priority <= 5)
			(goal g-support-unit battle-elephant)
			(building-type-count stable > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-elite-battle-elephant c: 1)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			(up-modify-goal g-highest-tech-priority c:max 5)
			)

	#end-if

	;--------------------------
	;	Two-handed Swordsman
	;--------------------------

		(defrule
		(up-research-status c: ri-two-handed-swordsman != research-available)
		=>
		(up-jump-rule 3)
		)

        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-two-handed-swordsman)
        (up-compare-goal g-highest-tech-priority <= 5)
		(goal g-support-unit militiaman)
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-two-handed-swordsman c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-two-handed-swordsman)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-two-handed-swordsman)
        (up-compare-goal g-highest-tech-priority <= 7)
		(goal g-support-unit militiaman)
        =>
        (research ri-two-handed-swordsman)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-two-handed-swordsman == research-available)
        (up-compare-goal g-highest-tech-priority <= 5)
		(goal g-support-unit militiaman)
		(building-type-count barracks > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-two-handed-swordsman c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 5)
		)

	;--------------
	;	Champion
	;--------------

		(defrule
		(up-research-status c: ri-champion != research-available)
		=>
		(up-jump-rule 3)
		)

        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-champion)
        (up-compare-goal g-highest-tech-priority <= 5)
		(goal g-support-unit militiaman)
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-champion c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-champion)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-champion)
        (up-compare-goal g-highest-tech-priority <= 7)
		(goal g-support-unit militiaman)
        =>
        (research ri-champion)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-champion == research-available)
        (up-compare-goal g-highest-tech-priority <= 5)
		(goal g-support-unit militiaman)
		(building-type-count barracks > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-champion c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 5)
		)

	;--------------------------
	;	Heavy Cavalry Archer
	;--------------------------

		(defrule
		(up-research-status c: ri-heavy-cavalry-archer != research-available)
		=>
		(up-jump-rule 3)
		)

        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-heavy-cavalry-archer)
        (up-compare-goal g-highest-tech-priority <= 5)
		(goal g-support-unit cavalry-archer)
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-heavy-cavalry-archer c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-heavy-cavalry-archer)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-heavy-cavalry-archer)
        (up-compare-goal g-highest-tech-priority <= 7)
		(goal g-support-unit cavalry-archer)
        =>
        (research ri-heavy-cavalry-archer)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-heavy-cavalry-archer == research-available)
        (up-compare-goal g-highest-tech-priority <= 5)
		(goal g-support-unit cavalry-archer)
		(building-type-count archery-range > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-heavy-cavalry-archer c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 5)
		)

	#load-if-defined DE-AVAILABLE

		;-------------------------
		;	Elite Steppe Lancer
		;-------------------------

			(defrule
			(up-research-status c: ri-elite-steppe-lancer != research-available)
			=>
			(up-jump-rule 3)
			)

			(defrule
			(goal g-first-attack-launched YES)
			(can-research-with-escrow ri-elite-steppe-lancer)
        	(up-compare-goal g-highest-tech-priority <= 5)
			(goal g-support-unit steppe-lancer)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-elite-steppe-lancer c: 1)
			(up-modify-escrow food g:- g-food-cost)
			(up-modify-escrow gold g:- g-gold-cost)
			(up-research g-escrow c: ri-elite-steppe-lancer)
			)

			(defrule
			(goal g-first-attack-launched YES)
			(can-research ri-elite-steppe-lancer)
			(up-compare-goal g-highest-tech-priority <= 7)
			(goal g-support-unit steppe-lancer)
			=>
			(research ri-elite-steppe-lancer)
			)

			(defrule
			(goal g-first-attack-launched YES)
			(up-research-status c: ri-elite-steppe-lancer == research-available)
        	(up-compare-goal g-highest-tech-priority <= 5)
			(goal g-support-unit steppe-lancer)
			(building-type-count stable > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-elite-steppe-lancer c: 1)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			(up-modify-goal g-highest-tech-priority c:max 5)
			)

	#end-if

	#load-if-defined UP-GAME-WK

		;-------------------------
		;	Imperial Skirmisher
		;-------------------------

			(defrule
			(up-research-status c: ri-imperial-skirmisher != research-available)
			=>
			(up-jump-rule 3)
			)

			(defrule
			(goal g-first-attack-launched YES)
			(can-research-with-escrow ri-imperial-skirmisher)
       		(up-compare-goal g-highest-tech-priority <= 5)
			(goal g-support-unit skirmisher)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-imperial-skirmisher c: 1)
			(up-modify-escrow wood g:- g-wood-cost)
			(up-modify-escrow gold g:- g-gold-cost)
			(up-research g-escrow c: ri-imperial-skirmisher)
			)

			(defrule
			(goal g-first-attack-launched YES)
			(can-research ri-imperial-skirmisher)
			(up-compare-goal g-highest-tech-priority <= 7)
			(goal g-support-unit skirmisher)
			=>
			(research ri-imperial-skirmisher)
			)

			(defrule
			(goal g-first-attack-launched YES)
			(up-research-status c: ri-imperial-skirmisher == research-available)
        	(up-compare-goal g-highest-tech-priority <= 5)
			(goal g-support-unit skirmisher)
			(building-type-count archery-range > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-imperial-skirmisher c: 1)
			(up-modify-goal g-max-wood-needed g:max g-wood-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			(up-modify-goal g-highest-tech-priority c:max 5)
			)

		;--------------------
		;	Elite Genitour
		;--------------------

			(defrule
			(up-research-status c: ri-elite-genitour != research-available)
			=>
			(up-jump-rule 3)
			)

			(defrule
			(goal g-first-attack-launched YES)
			(can-research-with-escrow ri-elite-genitour)
        	(up-compare-goal g-highest-tech-priority <= 5)
			(goal g-support-unit genitour)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-elite-genitour c: 1)
			(up-modify-escrow food g:- g-food-cost)
			(up-modify-escrow wood g:- g-wood-cost)
			(up-research g-escrow c: ri-elite-genitour)
			)

			(defrule
			(goal g-first-attack-launched YES)
			(can-research ri-elite-genitour)
			(up-compare-goal g-highest-tech-priority <= 7)
			(goal g-support-unit genitour)
			=>
			(research ri-elite-genitour)
			)

			(defrule
			(goal g-first-attack-launched YES)
			(up-research-status c: ri-elite-genitour == research-available)
        	(up-compare-goal g-highest-tech-priority <= 5)
			(goal g-support-unit genitour)
			(building-type-count archery-range > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-elite-genitour c: 1)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-wood-needed g:max g-wood-cost)
			(up-modify-goal g-highest-tech-priority c:max 5)
			)

	#end-if
		
	;---------------
	;	Fletching
	;---------------

		(defrule
		(up-research-status c: ri-fletching != research-available)
		=>
		(up-jump-rule 13)
		)

		;Check if support or unique unit benefits from fletching
		(defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-fletching)
        (up-compare-goal g-highest-tech-priority <= 7)
		=>
		(up-get-object-type-data g: g-support-unit object-data-class g-temp)
		(up-get-object-type-data c: my-unique-unit object-data-class g-temp-2)
		)

        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-fletching)
        (up-compare-goal g-highest-tech-priority <= 5)
		(or
			(goal g-temp archery-class)			;support unit is a foot archer
			(goal g-temp cavalry-archer-class))	;support unit is a cavalry archer
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-fletching c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-fletching)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-fletching)
        (up-compare-goal g-highest-tech-priority <= 7)
		(or
			(goal g-temp archery-class)			;support unit is a foot archer
			(goal g-temp cavalry-archer-class))	;support unit is a cavalry archer
        =>
        (research ri-fletching)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-fletching == research-available)
        (up-compare-goal g-highest-tech-priority <= 5)
		(or
			(goal g-temp archery-class)			;support unit is a foot archer
			(goal g-temp cavalry-archer-class))	;support unit is a cavalry archer
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-fletching c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 5)
		)
		
		;Check if we want to train archery range units that require fletching
        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-fletching)
        (up-compare-goal g-highest-tech-priority <= 5)
		(or
			(up-compare-goal g-desired-num-archer >= 12)
			(or
				(up-compare-goal g-desired-num-skirmisher >= 12)
				(up-compare-goal g-desired-num-cavalry-archer >= 10)))
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-fletching c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-fletching)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-fletching)
        (up-compare-goal g-highest-tech-priority <= 7)
		(or
			(up-compare-goal g-desired-num-archer >= 12)
			(or
				(up-compare-goal g-desired-num-skirmisher >= 12)
				(up-compare-goal g-desired-num-cavalry-archer >= 10)))
        =>
        (research ri-fletching)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-fletching == research-available)
        (up-compare-goal g-highest-tech-priority <= 5)
		(or
			(up-compare-goal g-desired-num-archer >= 12)
			(or
				(up-compare-goal g-desired-num-skirmisher >= 12)
				(up-compare-goal g-desired-num-cavalry-archer >= 10)))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-fletching c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 5)
		)
		
		;Check if we want to train unique archery range units that require fletching
        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-fletching)
        (up-compare-goal g-highest-tech-priority <= 5)
		(or
			(up-compare-goal g-desired-num-slinger >= 12)
			(up-compare-goal g-desired-num-genitour >= 12))
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-fletching c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-fletching)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-fletching)
        (up-compare-goal g-highest-tech-priority <= 7)
		(or
			(up-compare-goal g-desired-num-slinger >= 12)
			(up-compare-goal g-desired-num-genitour >= 12))
        =>
        (research ri-fletching)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-fletching == research-available)
        (up-compare-goal g-highest-tech-priority <= 5)
		(or
			(up-compare-goal g-desired-num-slinger >= 12)
			(up-compare-goal g-desired-num-genitour >= 12))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-fletching c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 5)
		)
		
		;Check if we want to train unique units that require fletching
        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-fletching)
        (up-compare-goal g-highest-tech-priority <= 5)
		(up-compare-goal g-desired-num-unique-unit >= 10)
		(or
			(goal g-temp-2 archery-class)			;unique unit is a foot archer
			(goal g-temp-2 cavalry-archer-class))	;unique unit is a cavalry archer
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-fletching c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-fletching)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-fletching)
        (up-compare-goal g-highest-tech-priority <= 7)
		(up-compare-goal g-desired-num-unique-unit >= 10)
		(or
			(goal g-temp-2 archery-class)			;unique unit is a foot archer
			(goal g-temp-2 cavalry-archer-class))	;unique unit is a cavalry archer
        =>
        (research ri-fletching)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-fletching == research-available)
        (up-compare-goal g-highest-tech-priority <= 5)
		(up-compare-goal g-desired-num-unique-unit >= 10)
		(or
			(goal g-temp-2 archery-class)			;unique unit is a foot archer
			(goal g-temp-2 cavalry-archer-class))	;unique unit is a cavalry archer
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-fletching c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 5)
		)
		
	;------------------
	;	Bodkin Arrow
	;------------------

		(defrule
		(up-research-status c: ri-bodkin-arrow != research-available)
		=>
		(up-jump-rule 13)
		)

		;Check if support or unique unit benefits from bodkin-arrow
		(defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-bodkin-arrow)
        (up-compare-goal g-highest-tech-priority <= 7)
		=>
		(up-get-object-type-data g: g-support-unit object-data-class g-temp)
		(up-get-object-type-data c: my-unique-unit object-data-class g-temp-2)
		)

        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-bodkin-arrow)
        (up-compare-goal g-highest-tech-priority <= 5)
		(or
			(goal g-temp archery-class)			;support unit is a foot archer
			(goal g-temp cavalry-archer-class))	;support unit is a cavalry archer
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-bodkin-arrow c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-bodkin-arrow)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-bodkin-arrow)
        (up-compare-goal g-highest-tech-priority <= 7)
		(or
			(goal g-temp archery-class)			;support unit is a foot archer
			(goal g-temp cavalry-archer-class))	;support unit is a cavalry archer
        =>
        (research ri-bodkin-arrow)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-bodkin-arrow == research-available)
        (up-compare-goal g-highest-tech-priority <= 5)
		(or
			(goal g-temp archery-class)			;support unit is a foot archer
			(goal g-temp cavalry-archer-class))	;support unit is a cavalry archer
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-bodkin-arrow c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 5)
		)
		
		;Check if we want to train archery range units that require bodkin-arrow
        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-bodkin-arrow)
        (up-compare-goal g-highest-tech-priority <= 5)
		(or
			(up-compare-goal g-desired-num-archer >= 12)
			(or
				(up-compare-goal g-desired-num-skirmisher >= 12)
				(up-compare-goal g-desired-num-cavalry-archer >= 10)))
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-bodkin-arrow c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-bodkin-arrow)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-bodkin-arrow)
        (up-compare-goal g-highest-tech-priority <= 7)
		(or
			(up-compare-goal g-desired-num-archer >= 12)
			(or
				(up-compare-goal g-desired-num-skirmisher >= 12)
				(up-compare-goal g-desired-num-cavalry-archer >= 10)))
        =>
        (research ri-bodkin-arrow)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-bodkin-arrow == research-available)
        (up-compare-goal g-highest-tech-priority <= 5)
		(or
			(up-compare-goal g-desired-num-archer >= 12)
			(or
				(up-compare-goal g-desired-num-skirmisher >= 12)
				(up-compare-goal g-desired-num-cavalry-archer >= 10)))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-bodkin-arrow c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 5)
		)
		
		;Check if we want to train unique archery range units that require bodkin-arrow
        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-bodkin-arrow)
        (up-compare-goal g-highest-tech-priority <= 5)
		(or
			(up-compare-goal g-desired-num-slinger >= 12)
			(up-compare-goal g-desired-num-genitour >= 12))
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-bodkin-arrow c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-bodkin-arrow)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-bodkin-arrow)
        (up-compare-goal g-highest-tech-priority <= 7)
		(or
			(up-compare-goal g-desired-num-slinger >= 12)
			(up-compare-goal g-desired-num-genitour >= 12))
        =>
        (research ri-bodkin-arrow)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-bodkin-arrow == research-available)
        (up-compare-goal g-highest-tech-priority <= 5)
		(or
			(up-compare-goal g-desired-num-slinger >= 12)
			(up-compare-goal g-desired-num-genitour >= 12))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-bodkin-arrow c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 5)
		)
		
		;Check if we want to train unique units that require bodkin-arrow
        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-bodkin-arrow)
        (up-compare-goal g-highest-tech-priority <= 5)
		(up-compare-goal g-desired-num-unique-unit >= 10)
		(or
			(goal g-temp-2 archery-class)			;unique unit is a foot archer
			(goal g-temp-2 cavalry-archer-class))	;unique unit is a cavalry archer
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-bodkin-arrow c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-bodkin-arrow)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-bodkin-arrow)
        (up-compare-goal g-highest-tech-priority <= 7)
		(up-compare-goal g-desired-num-unique-unit >= 10)
		(or
			(goal g-temp-2 archery-class)			;unique unit is a foot archer
			(goal g-temp-2 cavalry-archer-class))	;unique unit is a cavalry archer
        =>
        (research ri-bodkin-arrow)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-bodkin-arrow == research-available)
        (up-compare-goal g-highest-tech-priority <= 5)
		(up-compare-goal g-desired-num-unique-unit >= 10)
		(or
			(goal g-temp-2 archery-class)			;unique unit is a foot archer
			(goal g-temp-2 cavalry-archer-class))	;unique unit is a cavalry archer
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-bodkin-arrow c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 5)
		)
		
	;------------
	;	Bracer
	;------------

		(defrule
		(up-research-status c: ri-bracer != research-available)
		=>
		(up-jump-rule 13)
		)

		;Check if support or unique unit benefits from bracer
		(defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-bracer)
        (up-compare-goal g-highest-tech-priority <= 7)
		=>
		(up-get-object-type-data g: g-support-unit object-data-class g-temp)
		(up-get-object-type-data c: my-unique-unit object-data-class g-temp-2)
		)

        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-bracer)
        (up-compare-goal g-highest-tech-priority <= 5)
		(or
			(goal g-temp archery-class)			;support unit is a foot archer
			(goal g-temp cavalry-archer-class))	;support unit is a cavalry archer
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-bracer c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-bracer)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-bracer)
        (up-compare-goal g-highest-tech-priority <= 7)
		(or
			(goal g-temp archery-class)			;support unit is a foot archer
			(goal g-temp cavalry-archer-class))	;support unit is a cavalry archer
        =>
        (research ri-bracer)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-bracer == research-available)
        (up-compare-goal g-highest-tech-priority <= 5)
		(or
			(goal g-temp archery-class)			;support unit is a foot archer
			(goal g-temp cavalry-archer-class))	;support unit is a cavalry archer
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-bracer c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 5)
		)
		
		;Check if we want to train archery range units that require bracer
        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-bracer)
        (up-compare-goal g-highest-tech-priority <= 5)
		(or
			(up-compare-goal g-desired-num-archer >= 12)
			(or
				(up-compare-goal g-desired-num-skirmisher >= 12)
				(up-compare-goal g-desired-num-cavalry-archer >= 10)))
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-bracer c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-bracer)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-bracer)
        (up-compare-goal g-highest-tech-priority <= 7)
		(or
			(up-compare-goal g-desired-num-archer >= 12)
			(or
				(up-compare-goal g-desired-num-skirmisher >= 12)
				(up-compare-goal g-desired-num-cavalry-archer >= 10)))
        =>
        (research ri-bracer)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-bracer == research-available)
        (up-compare-goal g-highest-tech-priority <= 5)
		(or
			(up-compare-goal g-desired-num-archer >= 12)
			(or
				(up-compare-goal g-desired-num-skirmisher >= 12)
				(up-compare-goal g-desired-num-cavalry-archer >= 10)))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-bracer c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 5)
		)
		
		;Check if we want to train unique archery range units that require bracer
        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-bracer)
        (up-compare-goal g-highest-tech-priority <= 5)
		(or
			(up-compare-goal g-desired-num-slinger >= 12)
			(up-compare-goal g-desired-num-genitour >= 12))
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-bracer c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-bracer)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-bracer)
        (up-compare-goal g-highest-tech-priority <= 7)
		(or
			(up-compare-goal g-desired-num-slinger >= 12)
			(up-compare-goal g-desired-num-genitour >= 12))
        =>
        (research ri-bracer)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-bracer == research-available)
        (up-compare-goal g-highest-tech-priority <= 5)
		(or
			(up-compare-goal g-desired-num-slinger >= 12)
			(up-compare-goal g-desired-num-genitour >= 12))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-bracer c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 5)
		)
		
		;Check if we want to train unique units that require bracer
        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-bracer)
        (up-compare-goal g-highest-tech-priority <= 5)
		(up-compare-goal g-desired-num-unique-unit >= 10)
		(or
			(goal g-temp-2 archery-class)			;unique unit is a foot archer
			(goal g-temp-2 cavalry-archer-class))	;unique unit is a cavalry archer
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-bracer c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-bracer)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-bracer)
        (up-compare-goal g-highest-tech-priority <= 7)
		(up-compare-goal g-desired-num-unique-unit >= 10)
		(or
			(goal g-temp-2 archery-class)			;unique unit is a foot archer
			(goal g-temp-2 cavalry-archer-class))	;unique unit is a cavalry archer
        =>
        (research ri-bracer)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-bracer == research-available)
        (up-compare-goal g-highest-tech-priority <= 5)
		(up-compare-goal g-desired-num-unique-unit >= 10)
		(or
			(goal g-temp-2 archery-class)			;unique unit is a foot archer
			(goal g-temp-2 cavalry-archer-class))	;unique unit is a cavalry archer
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-bracer c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 5)
		)
		
	;-------------------------
	;	Scale Barding Armor
	;-------------------------

		(defrule
		(up-research-status c: ri-scale-barding != research-available)
		=>
		(up-jump-rule 13)
		)

		;Check if support or unique unit benefits from scale-barding
		(defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-scale-barding)
        (up-compare-goal g-highest-tech-priority <= 7)
		=>
		(up-get-object-type-data g: g-support-unit object-data-class g-temp)
		(up-get-object-type-data c: my-unique-unit object-data-class g-temp-2)
		)

        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-scale-barding)
        (up-compare-goal g-highest-tech-priority <= 5)
		(current-age >= castle-age)
		(goal g-temp cavalry-class)			;support unit is cavalry
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-scale-barding c: 1)
		(up-modify-escrow food g:- g-food-cost)
        (up-research g-escrow c: ri-scale-barding)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-scale-barding)
        (up-compare-goal g-highest-tech-priority <= 7)
		(current-age >= castle-age)
		(goal g-temp cavalry-class)			;support unit is cavalry
        =>
        (research ri-scale-barding)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-scale-barding == research-available)
        (up-compare-goal g-highest-tech-priority <= 5)
		(current-age >= castle-age)
		(goal g-temp cavalry-class)			;support unit is cavalry
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-scale-barding c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-highest-tech-priority c:max 5)
		)
		
		;Check if we want to train stable units that require scale-barding
        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-scale-barding)
        (up-compare-goal g-highest-tech-priority <= 5)
		(current-age >= castle-age)
		(or
			(up-compare-goal g-desired-num-scout-cavalry >= 12)
			(or
				(up-compare-goal g-desired-num-knight >= 10)
				(up-compare-goal g-desired-num-camel >= 10)))
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-scale-barding c: 1)
		(up-modify-escrow food g:- g-food-cost)
        (up-research g-escrow c: ri-scale-barding)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-scale-barding)
        (up-compare-goal g-highest-tech-priority <= 7)
		(current-age >= castle-age)
		(or
			(up-compare-goal g-desired-num-scout-cavalry >= 12)
			(or
				(up-compare-goal g-desired-num-knight >= 10)
				(up-compare-goal g-desired-num-camel >= 10)))
        =>
        (research ri-scale-barding)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-scale-barding == research-available)
        (up-compare-goal g-highest-tech-priority <= 5)
		(current-age >= castle-age)
		(or
			(up-compare-goal g-desired-num-scout-cavalry >= 12)
			(or
				(up-compare-goal g-desired-num-knight >= 10)
				(up-compare-goal g-desired-num-camel >= 10)))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-scale-barding c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-highest-tech-priority c:max 5)
		)
		
		;Check if we want to train unique stable units
        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-scale-barding)
        (up-compare-goal g-highest-tech-priority <= 5)
		(current-age >= castle-age)
		(or
			(up-compare-goal g-desired-num-battle-elephant >= 8)
			(up-compare-goal g-desired-num-steppe-lancer >= 10))
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-scale-barding c: 1)
		(up-modify-escrow food g:- g-food-cost)
        (up-research g-escrow c: ri-scale-barding)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-scale-barding)
        (up-compare-goal g-highest-tech-priority <= 7)
		(current-age >= castle-age)
		(or
			(up-compare-goal g-desired-num-battle-elephant >= 8)
			(up-compare-goal g-desired-num-steppe-lancer >= 10))
        =>
        (research ri-scale-barding)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-scale-barding == research-available)
        (up-compare-goal g-highest-tech-priority <= 5)
		(current-age >= castle-age)
		(or
			(up-compare-goal g-desired-num-battle-elephant >= 8)
			(up-compare-goal g-desired-num-steppe-lancer >= 10))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-scale-barding c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-highest-tech-priority c:max 5)
		)
		
		;Check if we want to train unique units that require scale-barding
        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-scale-barding)
        (up-compare-goal g-highest-tech-priority <= 5)
		(current-age >= castle-age)
		(up-compare-goal g-desired-num-unique-unit >= 10)
		(goal g-temp-2 cavalry-class)			
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-scale-barding c: 1)
		(up-modify-escrow food g:- g-food-cost)
        (up-research g-escrow c: ri-scale-barding)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-scale-barding)
        (up-compare-goal g-highest-tech-priority <= 7)
		(current-age >= castle-age)
		(up-compare-goal g-desired-num-unique-unit >= 10)
		(goal g-temp-2 cavalry-class)	
        =>
        (research ri-scale-barding)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-scale-barding == research-available)
        (up-compare-goal g-highest-tech-priority <= 5)
		(current-age >= castle-age)
		(up-compare-goal g-desired-num-unique-unit >= 10)
		(goal g-temp-2 cavalry-class)	
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-scale-barding c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-highest-tech-priority c:max 5)
		)
		
	;-------------------------
	;	Chain Barding Armor
	;-------------------------

		(defrule
		(up-research-status c: ri-chain-barding != research-available)
		=>
		(up-jump-rule 13)
		)

		;Check if support or unique unit benefits from chain-barding
		(defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-chain-barding)
        (up-compare-goal g-highest-tech-priority <= 7)
		=>
		(up-get-object-type-data g: g-support-unit object-data-class g-temp)
		(up-get-object-type-data c: my-unique-unit object-data-class g-temp-2)
		)

        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-chain-barding)
        (up-compare-goal g-highest-tech-priority <= 5)
		(current-age == imperial-age)
		(goal g-temp cavalry-class)			;support unit is cavalry
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-chain-barding c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-chain-barding)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-chain-barding)
        (up-compare-goal g-highest-tech-priority <= 7)
		(current-age == imperial-age)
		(goal g-temp cavalry-class)			;support unit is cavalry
        =>
        (research ri-chain-barding)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-chain-barding == research-available)
        (up-compare-goal g-highest-tech-priority <= 5)
		(current-age == imperial-age)
		(goal g-temp cavalry-class)			;support unit is cavalry
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-chain-barding c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 5)
		)
		
		;Check if we want to train stable units that require chain-barding
        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-chain-barding)
        (up-compare-goal g-highest-tech-priority <= 5)
		(current-age == imperial-age)
		(or
			(up-compare-goal g-desired-num-scout-cavalry >= 12)
			(or
				(up-compare-goal g-desired-num-knight >= 10)
				(up-compare-goal g-desired-num-camel >= 10)))
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-chain-barding c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-chain-barding)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-chain-barding)
        (up-compare-goal g-highest-tech-priority <= 7)
		(current-age == imperial-age)
		(or
			(up-compare-goal g-desired-num-scout-cavalry >= 12)
			(or
				(up-compare-goal g-desired-num-knight >= 10)
				(up-compare-goal g-desired-num-camel >= 10)))
        =>
        (research ri-chain-barding)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-chain-barding == research-available)
        (up-compare-goal g-highest-tech-priority <= 5)
		(current-age == imperial-age)
		(or
			(up-compare-goal g-desired-num-scout-cavalry >= 12)
			(or
				(up-compare-goal g-desired-num-knight >= 10)
				(up-compare-goal g-desired-num-camel >= 10)))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-chain-barding c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 5)
		)
		
		;Check if we want to train unique stable units
        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-chain-barding)
        (up-compare-goal g-highest-tech-priority <= 5)
		(current-age == imperial-age)
		(or
			(up-compare-goal g-desired-num-battle-elephant >= 8)
			(up-compare-goal g-desired-num-steppe-lancer >= 10))
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-chain-barding c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-chain-barding)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-chain-barding)
        (up-compare-goal g-highest-tech-priority <= 7)
		(current-age == imperial-age)
		(or
			(up-compare-goal g-desired-num-battle-elephant >= 8)
			(up-compare-goal g-desired-num-steppe-lancer >= 10))
        =>
        (research ri-chain-barding)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-chain-barding == research-available)
        (up-compare-goal g-highest-tech-priority <= 5)
		(current-age == imperial-age)
		(or
			(up-compare-goal g-desired-num-battle-elephant >= 8)
			(up-compare-goal g-desired-num-steppe-lancer >= 10))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-chain-barding c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 5)
		)
		
		;Check if we want to train unique units that require chain-barding
        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-chain-barding)
        (up-compare-goal g-highest-tech-priority <= 5)
		(current-age == imperial-age)
		(up-compare-goal g-desired-num-unique-unit >= 10)
		(goal g-temp-2 cavalry-class)			
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-chain-barding c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-chain-barding)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-chain-barding)
        (up-compare-goal g-highest-tech-priority <= 7)
		(current-age == imperial-age)
		(up-compare-goal g-desired-num-unique-unit >= 10)
		(goal g-temp-2 cavalry-class)	
        =>
        (research ri-chain-barding)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-chain-barding == research-available)
        (up-compare-goal g-highest-tech-priority <= 5)
		(current-age == imperial-age)
		(up-compare-goal g-desired-num-unique-unit >= 10)
		(goal g-temp-2 cavalry-class)	
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-chain-barding c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 5)
		)
		
	;----------------------
	;	Scale Mail Armor
	;----------------------

		(defrule
		(up-research-status c: ri-scale-mail != research-available)
		=>
		(up-jump-rule 13)
		)

		;Check if support or unique unit benefits from scale-mail
		(defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-scale-mail)
        (up-compare-goal g-highest-tech-priority <= 7)
		=>
		(up-get-object-type-data g: g-support-unit object-data-class g-temp)
		(up-get-object-type-data c: my-unique-unit object-data-class g-temp-2)
		)

        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-scale-mail)
        (up-compare-goal g-highest-tech-priority <= 5)
		(current-age >= castle-age)
		(goal g-temp infantry-class)			;support unit is infantry
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-scale-mail c: 1)
		(up-modify-escrow food g:- g-food-cost)
        (up-research g-escrow c: ri-scale-mail)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-scale-mail)
        (up-compare-goal g-highest-tech-priority <= 7)
		(current-age >= castle-age)
		(goal g-temp infantry-class)			;support unit is infantry
        =>
        (research ri-scale-mail)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-scale-mail == research-available)
        (up-compare-goal g-highest-tech-priority <= 5)
		(current-age >= castle-age)
		(goal g-temp infantry-class)			;support unit is infantry
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-scale-mail c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-highest-tech-priority c:max 5)
		)
		
		;Check if we want to train barracks units that require scale-mail
        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-scale-mail)
        (up-compare-goal g-highest-tech-priority <= 5)
		(current-age >= castle-age)
		(or
			(up-compare-goal g-desired-num-militia >= 12)
			(or
				(up-compare-goal g-desired-num-spearman >= 14)
				(up-compare-goal g-desired-num-eagle-warrior >= 12)))
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-scale-mail c: 1)
		(up-modify-escrow food g:- g-food-cost)
        (up-research g-escrow c: ri-scale-mail)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-scale-mail)
        (up-compare-goal g-highest-tech-priority <= 7)
		(current-age >= castle-age)
		(or
			(up-compare-goal g-desired-num-militia >= 12)
			(or
				(up-compare-goal g-desired-num-spearman >= 14)
				(up-compare-goal g-desired-num-eagle-warrior >= 12)))
        =>
        (research ri-scale-mail)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-scale-mail == research-available)
        (up-compare-goal g-highest-tech-priority <= 5)
		(current-age >= castle-age)
		(or
			(up-compare-goal g-desired-num-militia >= 12)
			(or
				(up-compare-goal g-desired-num-spearman >= 14)
				(up-compare-goal g-desired-num-eagle-warrior >= 12)))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-scale-mail c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-highest-tech-priority c:max 5)
		)
		
		;Check if we want to train condottieros
        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-scale-mail)
        (up-compare-goal g-highest-tech-priority <= 5)
		(current-age >= castle-age)
		(up-compare-goal g-desired-num-condottiero >= 12)
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-scale-mail c: 1)
		(up-modify-escrow food g:- g-food-cost)
        (up-research g-escrow c: ri-scale-mail)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-scale-mail)
        (up-compare-goal g-highest-tech-priority <= 7)
		(current-age >= castle-age)
		(up-compare-goal g-desired-num-condottiero >= 12)
        =>
        (research ri-scale-mail)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-scale-mail == research-available)
        (up-compare-goal g-highest-tech-priority <= 5)
		(current-age >= castle-age)
		(up-compare-goal g-desired-num-condottiero >= 12)
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-scale-mail c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-highest-tech-priority c:max 5)
		)
		
		;Check if we want to train unique units that require scale-mail
        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-scale-mail)
        (up-compare-goal g-highest-tech-priority <= 5)
		(current-age >= castle-age)
		(up-compare-goal g-desired-num-unique-unit >= 10)
		(goal g-temp-2 infantry-class)		
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-scale-mail c: 1)
		(up-modify-escrow food g:- g-food-cost)
        (up-research g-escrow c: ri-scale-mail)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-scale-mail)
        (up-compare-goal g-highest-tech-priority <= 7)
		(current-age >= castle-age)
		(up-compare-goal g-desired-num-unique-unit >= 10)
		(goal g-temp-2 infantry-class)		
        =>
        (research ri-scale-mail)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-scale-mail == research-available)
        (up-compare-goal g-highest-tech-priority <= 5)
		(current-age >= castle-age)
		(up-compare-goal g-desired-num-unique-unit >= 10)
		(goal g-temp-2 infantry-class)	
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-scale-mail c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-highest-tech-priority c:max 5)
		)
		
	;----------------------
	;	Chain Mail Armor
	;----------------------

		(defrule
		(up-research-status c: ri-chain-mail != research-available)
		=>
		(up-jump-rule 13)
		)

		;Check if support or unique unit benefits from chain-mail
		(defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-chain-mail)
        (up-compare-goal g-highest-tech-priority <= 7)
		=>
		(up-get-object-type-data g: g-support-unit object-data-class g-temp)
		(up-get-object-type-data c: my-unique-unit object-data-class g-temp-2)
		)

        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-chain-mail)
        (up-compare-goal g-highest-tech-priority <= 5)
		(current-age == imperial-age)
		(goal g-temp infantry-class)			;support unit is infantry
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-chain-mail c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-chain-mail)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-chain-mail)
        (up-compare-goal g-highest-tech-priority <= 7)
		(current-age == imperial-age)
		(goal g-temp infantry-class)			;support unit is infantry
        =>
        (research ri-chain-mail)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-chain-mail == research-available)
        (up-compare-goal g-highest-tech-priority <= 5)
		(current-age == imperial-age)
		(goal g-temp infantry-class)			;support unit is infantry
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-chain-mail c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 5)
		)
		
		;Check if we want to train barracks units that require chain-mail
        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-chain-mail)
        (up-compare-goal g-highest-tech-priority <= 5)
		(current-age == imperial-age)
		(or
			(up-compare-goal g-desired-num-militia >= 12)
			(or
				(up-compare-goal g-desired-num-spearman >= 14)
				(up-compare-goal g-desired-num-eagle-warrior >= 12)))
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-chain-mail c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-chain-mail)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-chain-mail)
        (up-compare-goal g-highest-tech-priority <= 7)
		(current-age == imperial-age)
		(or
			(up-compare-goal g-desired-num-militia >= 12)
			(or
				(up-compare-goal g-desired-num-spearman >= 14)
				(up-compare-goal g-desired-num-eagle-warrior >= 12)))
        =>
        (research ri-chain-mail)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-chain-mail == research-available)
        (up-compare-goal g-highest-tech-priority <= 5)
		(current-age == imperial-age)
		(or
			(up-compare-goal g-desired-num-militia >= 12)
			(or
				(up-compare-goal g-desired-num-spearman >= 14)
				(up-compare-goal g-desired-num-eagle-warrior >= 12)))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-chain-mail c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 5)
		)
		
		;Check if we want to train condottieros
        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-chain-mail)
        (up-compare-goal g-highest-tech-priority <= 5)
		(current-age == imperial-age)
		(up-compare-goal g-desired-num-condottiero >= 12)
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-chain-mail c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-chain-mail)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-chain-mail)
        (up-compare-goal g-highest-tech-priority <= 7)
		(current-age == imperial-age)
		(up-compare-goal g-desired-num-condottiero >= 12)
        =>
        (research ri-chain-mail)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-chain-mail == research-available)
        (up-compare-goal g-highest-tech-priority <= 5)
		(current-age == imperial-age)
		(up-compare-goal g-desired-num-condottiero >= 12)
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-chain-mail c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 5)
		)
		
		;Check if we want to train unique units that require chain-mail
        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-chain-mail)
        (up-compare-goal g-highest-tech-priority <= 5)
		(current-age == imperial-age)
		(up-compare-goal g-desired-num-unique-unit >= 10)
		(goal g-temp-2 infantry-class)			
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-chain-mail c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-chain-mail)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-chain-mail)
        (up-compare-goal g-highest-tech-priority <= 7)
		(current-age == imperial-age)
		(up-compare-goal g-desired-num-unique-unit >= 10)
		(goal g-temp-2 infantry-class)
        =>
        (research ri-chain-mail)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-chain-mail == research-available)
        (up-compare-goal g-highest-tech-priority <= 5)
		(current-age == imperial-age)
		(up-compare-goal g-desired-num-unique-unit >= 10)
		(goal g-temp-2 infantry-class)
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-chain-mail c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 5)
		)
		
	;-------------------------
	;	Padded Archer Armor
	;-------------------------

		(defrule
		(up-research-status c: ri-padded-archer-armor != research-available)
		=>
		(up-jump-rule 16)
		)

		;Check if support or unique unit benefits from padded-archer-armor
		(defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-padded-archer-armor)
        (up-compare-goal g-highest-tech-priority <= 7)
		=>
		(up-get-object-type-data g: g-support-unit object-data-class g-temp)
		(up-get-object-type-data c: my-unique-unit object-data-class g-temp-2)
		)

        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-padded-archer-armor)
        (up-compare-goal g-highest-tech-priority <= 5)
		(current-age >= castle-age)
		(or
			(goal g-temp archery-class)
			(or
				(goal g-temp cavalry-archer-class)
				(goal g-temp archery-cannon-class)))
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-padded-archer-armor c: 1)
		(up-modify-escrow food g:- g-food-cost)
        (up-research g-escrow c: ri-padded-archer-armor)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-padded-archer-armor)
        (up-compare-goal g-highest-tech-priority <= 7)
		(current-age >= castle-age)
		(or
			(goal g-temp archery-class)
			(or
				(goal g-temp cavalry-archer-class)
				(goal g-temp archery-cannon-class)))
        =>
        (research ri-padded-archer-armor)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-padded-archer-armor == research-available)
        (up-compare-goal g-highest-tech-priority <= 5)
		(current-age >= castle-age)
		(or
			(goal g-temp archery-class)
			(or
				(goal g-temp cavalry-archer-class)
				(goal g-temp archery-cannon-class)))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-padded-archer-armor c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-highest-tech-priority c:max 5)
		)
		
		;Check if we want to train archery range units that require padded-archer-armor
        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-padded-archer-armor)
        (up-compare-goal g-highest-tech-priority <= 5)
		(current-age >= castle-age)
		(or
			(up-compare-goal g-desired-num-archer >= 12)
			(or
				(up-compare-goal g-desired-num-skirmisher >= 14)
				(up-compare-goal g-desired-num-cavalry-archer >= 10)))
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-padded-archer-armor c: 1)
		(up-modify-escrow food g:- g-food-cost)
        (up-research g-escrow c: ri-padded-archer-armor)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-padded-archer-armor)
        (up-compare-goal g-highest-tech-priority <= 7)
		(current-age >= castle-age)
		(or
			(up-compare-goal g-desired-num-archer >= 12)
			(or
				(up-compare-goal g-desired-num-skirmisher >= 14)
				(up-compare-goal g-desired-num-cavalry-archer >= 10)))
        =>
        (research ri-padded-archer-armor)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-padded-archer-armor == research-available)
        (up-compare-goal g-highest-tech-priority <= 5)
		(current-age >= castle-age)
		(or
			(up-compare-goal g-desired-num-archer >= 12)
			(or
				(up-compare-goal g-desired-num-skirmisher >= 14)
				(up-compare-goal g-desired-num-cavalry-archer >= 10)))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-padded-archer-armor c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-highest-tech-priority c:max 5)
		)
		
		;Check if we want to train other archery range units
        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-padded-archer-armor)
        (up-compare-goal g-highest-tech-priority <= 5)
		(current-age >= castle-age)
		(or
			(up-compare-goal g-desired-num-hand-cannoneer >= 12)
			(or
				(up-compare-goal g-desired-num-slinger >= 12)
				(up-compare-goal g-desired-num-genitour >= 12)))
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-padded-archer-armor c: 1)
		(up-modify-escrow food g:- g-food-cost)
        (up-research g-escrow c: ri-padded-archer-armor)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-padded-archer-armor)
        (up-compare-goal g-highest-tech-priority <= 7)
		(current-age >= castle-age)
		(or
			(up-compare-goal g-desired-num-hand-cannoneer >= 12)
			(or
				(up-compare-goal g-desired-num-slinger >= 12)
				(up-compare-goal g-desired-num-genitour >= 12)))
        =>
        (research ri-padded-archer-armor)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-padded-archer-armor == research-available)
        (up-compare-goal g-highest-tech-priority <= 5)
		(current-age >= castle-age)
		(or
			(up-compare-goal g-desired-num-hand-cannoneer >= 12)
			(or
				(up-compare-goal g-desired-num-slinger >= 12)
				(up-compare-goal g-desired-num-genitour >= 12)))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-padded-archer-armor c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-highest-tech-priority c:max 5)
		)
		
		;Check if we want to train unique units that require padded-archer-armor
        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-padded-archer-armor)
        (up-compare-goal g-highest-tech-priority <= 5)
		(current-age >= castle-age)
		(up-compare-goal g-desired-num-unique-unit >= 10)
		(or
			(goal g-temp-2 archery-class)
			(goal g-temp-2 cavalry-archer-class))
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-padded-archer-armor c: 1)
		(up-modify-escrow food g:- g-food-cost)
        (up-research g-escrow c: ri-padded-archer-armor)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-padded-archer-armor)
        (up-compare-goal g-highest-tech-priority <= 7)
		(current-age >= castle-age)
		(up-compare-goal g-desired-num-unique-unit >= 10)
		(or
			(goal g-temp-2 archery-class)
			(goal g-temp-2 cavalry-archer-class))
        =>
        (research ri-padded-archer-armor)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-padded-archer-armor == research-available)
        (up-compare-goal g-highest-tech-priority <= 5)
		(current-age >= castle-age)
		(up-compare-goal g-desired-num-unique-unit >= 10)
		(or
			(goal g-temp-2 archery-class)
			(goal g-temp-2 cavalry-archer-class))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-padded-archer-armor c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-highest-tech-priority c:max 5)
		)
		
		;Check if we want to train unique units that require padded-archer-armor
        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-padded-archer-armor)
        (up-compare-goal g-highest-tech-priority <= 5)
		(current-age >= castle-age)
		(up-compare-goal g-desired-num-unique-unit >= 10)
		(or
			(goal g-temp-2 archery-cannon-class)
			(goal g-temp-2 cavalry-cannon-class))
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-padded-archer-armor c: 1)
		(up-modify-escrow food g:- g-food-cost)
        (up-research g-escrow c: ri-padded-archer-armor)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-padded-archer-armor)
        (up-compare-goal g-highest-tech-priority <= 7)
		(current-age >= castle-age)
		(up-compare-goal g-desired-num-unique-unit >= 10)
		(or
			(goal g-temp-2 archery-cannon-class)
			(goal g-temp-2 cavalry-cannon-class))
        =>
        (research ri-padded-archer-armor)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-padded-archer-armor == research-available)
        (up-compare-goal g-highest-tech-priority <= 5)
		(current-age >= castle-age)
		(up-compare-goal g-desired-num-unique-unit >= 10)
		(or
			(goal g-temp-2 archery-cannon-class)
			(goal g-temp-2 cavalry-cannon-class))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-padded-archer-armor c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-highest-tech-priority c:max 5)
		)
		
	;--------------------------
	;	Leather Archer Armor
	;--------------------------

		(defrule
		(up-research-status c: ri-leather-archer-armor != research-available)
		=>
		(up-jump-rule 16)
		)

		;Check if support or unique unit benefits from leather-archer-armor
		(defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-leather-archer-armor)
        (up-compare-goal g-highest-tech-priority <= 7)
		=>
		(up-get-object-type-data g: g-support-unit object-data-class g-temp)
		(up-get-object-type-data c: my-unique-unit object-data-class g-temp-2)
		)

        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-leather-archer-armor)
        (up-compare-goal g-highest-tech-priority <= 5)
		(current-age == imperial-age)
		(or
			(goal g-temp archery-class)
			(or
				(goal g-temp cavalry-archer-class)
				(goal g-temp archery-cannon-class)))
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-leather-archer-armor c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-leather-archer-armor)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-leather-archer-armor)
        (up-compare-goal g-highest-tech-priority <= 7)
		(current-age == imperial-age)
		(or
			(goal g-temp archery-class)
			(or
				(goal g-temp cavalry-archer-class)
				(goal g-temp archery-cannon-class)))
        =>
        (research ri-leather-archer-armor)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-leather-archer-armor == research-available)
        (up-compare-goal g-highest-tech-priority <= 5)
		(current-age == imperial-age)
		(or
			(goal g-temp archery-class)
			(or
				(goal g-temp cavalry-archer-class)
				(goal g-temp archery-cannon-class)))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-leather-archer-armor c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 5)
		)
		
		;Check if we want to train archery range units that require leather-archer-armor
        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-leather-archer-armor)
        (up-compare-goal g-highest-tech-priority <= 5)
		(current-age == imperial-age)
		(or
			(up-compare-goal g-desired-num-archer >= 12)
			(or
				(up-compare-goal g-desired-num-skirmisher >= 14)
				(up-compare-goal g-desired-num-cavalry-archer >= 10)))
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-leather-archer-armor c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-leather-archer-armor)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-leather-archer-armor)
        (up-compare-goal g-highest-tech-priority <= 7)
		(current-age == imperial-age)
		(or
			(up-compare-goal g-desired-num-archer >= 12)
			(or
				(up-compare-goal g-desired-num-skirmisher >= 14)
				(up-compare-goal g-desired-num-cavalry-archer >= 10)))
        =>
        (research ri-leather-archer-armor)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-leather-archer-armor == research-available)
        (up-compare-goal g-highest-tech-priority <= 5)
		(current-age == imperial-age)
		(or
			(up-compare-goal g-desired-num-archer >= 12)
			(or
				(up-compare-goal g-desired-num-skirmisher >= 14)
				(up-compare-goal g-desired-num-cavalry-archer >= 10)))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-leather-archer-armor c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 5)
		)
		
		;Check if we want to train other archery range units
        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-leather-archer-armor)
        (up-compare-goal g-highest-tech-priority <= 5)
		(current-age == imperial-age)
		(or
			(up-compare-goal g-desired-num-hand-cannoneer >= 12)
			(or
				(up-compare-goal g-desired-num-slinger >= 12)
				(up-compare-goal g-desired-num-genitour >= 12)))
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-leather-archer-armor c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-leather-archer-armor)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-leather-archer-armor)
        (up-compare-goal g-highest-tech-priority <= 7)
		(current-age == imperial-age)
		(or
			(up-compare-goal g-desired-num-hand-cannoneer >= 12)
			(or
				(up-compare-goal g-desired-num-slinger >= 12)
				(up-compare-goal g-desired-num-genitour >= 12)))
        =>
        (research ri-leather-archer-armor)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-leather-archer-armor == research-available)
        (up-compare-goal g-highest-tech-priority <= 5)
		(current-age == imperial-age)
		(or
			(up-compare-goal g-desired-num-hand-cannoneer >= 12)
			(or
				(up-compare-goal g-desired-num-slinger >= 12)
				(up-compare-goal g-desired-num-genitour >= 12)))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-leather-archer-armor c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 5)
		)
		
		;Check if we want to train unique units that require leather-archer-armor
        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-leather-archer-armor)
        (up-compare-goal g-highest-tech-priority <= 5)
		(current-age == imperial-age)
		(up-compare-goal g-desired-num-unique-unit >= 10)
		(or
			(goal g-temp-2 archery-class)
			(goal g-temp-2 cavalry-archer-class))
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-leather-archer-armor c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-leather-archer-armor)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-leather-archer-armor)
        (up-compare-goal g-highest-tech-priority <= 7)
		(current-age == imperial-age)
		(up-compare-goal g-desired-num-unique-unit >= 10)
		(or
			(goal g-temp-2 archery-class)
			(goal g-temp-2 cavalry-archer-class))
        =>
        (research ri-leather-archer-armor)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-leather-archer-armor == research-available)
        (up-compare-goal g-highest-tech-priority <= 5)
		(current-age == imperial-age)
		(up-compare-goal g-desired-num-unique-unit >= 10)
		(or
			(goal g-temp-2 archery-class)
			(goal g-temp-2 cavalry-archer-class))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-leather-archer-armor c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 5)
		)
		
		;Check if we want to train unique units that require leather-archer-armor
        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-leather-archer-armor)
        (up-compare-goal g-highest-tech-priority <= 5)
		(current-age == imperial-age)
		(up-compare-goal g-desired-num-unique-unit >= 10)
		(or
			(goal g-temp-2 archery-cannon-class)
			(goal g-temp-2 cavalry-cannon-class))
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-leather-archer-armor c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-leather-archer-armor)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-leather-archer-armor)
        (up-compare-goal g-highest-tech-priority <= 7)
		(current-age == imperial-age)
		(up-compare-goal g-desired-num-unique-unit >= 10)
		(or
			(goal g-temp-2 archery-cannon-class)
			(goal g-temp-2 cavalry-cannon-class))
        =>
        (research ri-leather-archer-armor)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-leather-archer-armor == research-available)
        (up-compare-goal g-highest-tech-priority <= 5)
		(current-age == imperial-age)
		(up-compare-goal g-desired-num-unique-unit >= 10)
		(or
			(goal g-temp-2 archery-cannon-class)
			(goal g-temp-2 cavalry-cannon-class))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-leather-archer-armor c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 5)
		)
		
	;-------------
	;	Forging
	;-------------

		(defrule
		(up-research-status c: ri-forging != research-available)
		=>
		(up-jump-rule 13)
		)

		;Check if support or unique unit benefits from forging
		(defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-forging)
        (up-compare-goal g-highest-tech-priority <= 7)
		=>
		(up-get-object-type-data g: g-support-unit object-data-class g-temp)
		(up-get-object-type-data c: my-unique-unit object-data-class g-temp-2)
		)

        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-forging)
        (up-compare-goal g-highest-tech-priority <= 5)
		(current-age >= castle-age)
		(or
			(goal g-temp infantry-class)			;support unit is infantry
			(goal g-temp cavalry-class))			;support unit is cavalry
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-forging c: 1)
		(up-modify-escrow food g:- g-food-cost)
        (up-research g-escrow c: ri-forging)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-forging)
        (up-compare-goal g-highest-tech-priority <= 7)
		(current-age >= castle-age)
		(or
			(goal g-temp infantry-class)			;support unit is infantry
			(goal g-temp cavalry-class))			;support unit is cavalry
        =>
        (research ri-forging)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-forging == research-available)
        (up-compare-goal g-highest-tech-priority <= 5)
		(current-age >= castle-age)
		(or
			(goal g-temp infantry-class)			;support unit is infantry
			(goal g-temp cavalry-class))			;support unit is cavalry
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-forging c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-highest-tech-priority c:max 5)
		)
		
		;Check if we want to train barracks units that require forging
        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-forging)
        (up-compare-goal g-highest-tech-priority <= 5)
		(current-age >= castle-age)
		(or
			(up-compare-goal g-desired-num-militia >= 12)
			(or
				(up-compare-goal g-desired-num-spearman >= 14)
				(up-compare-goal g-desired-num-eagle-warrior >= 12)))
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-forging c: 1)
		(up-modify-escrow food g:- g-food-cost)
        (up-research g-escrow c: ri-forging)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-forging)
        (up-compare-goal g-highest-tech-priority <= 7)
		(current-age >= castle-age)
		(or
			(up-compare-goal g-desired-num-militia >= 12)
			(or
				(up-compare-goal g-desired-num-spearman >= 14)
				(up-compare-goal g-desired-num-eagle-warrior >= 12)))
        =>
        (research ri-forging)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-forging == research-available)
        (up-compare-goal g-highest-tech-priority <= 5)
		(current-age >= castle-age)
		(or
			(up-compare-goal g-desired-num-militia >= 12)
			(or
				(up-compare-goal g-desired-num-spearman >= 14)
				(up-compare-goal g-desired-num-eagle-warrior >= 12)))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-forging c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-highest-tech-priority c:max 5)
		)
		
		;Check if we want to train stable units that require forging
        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-forging)
        (up-compare-goal g-highest-tech-priority <= 5)
		(current-age >= castle-age)
		(or
			(up-compare-goal g-desired-num-scout-cavalry >= 12)
			(or
				(up-compare-goal g-desired-num-knight >= 12)
				(up-compare-goal g-desired-num-camel >= 12)))
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-forging c: 1)
		(up-modify-escrow food g:- g-food-cost)
        (up-research g-escrow c: ri-forging)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-forging)
        (up-compare-goal g-highest-tech-priority <= 7)
		(current-age >= castle-age)
		(or
			(up-compare-goal g-desired-num-scout-cavalry >= 12)
			(or
				(up-compare-goal g-desired-num-knight >= 12)
				(up-compare-goal g-desired-num-camel >= 12)))
        =>
        (research ri-forging)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-forging == research-available)
        (up-compare-goal g-highest-tech-priority <= 5)
		(current-age >= castle-age)
		(or
			(up-compare-goal g-desired-num-scout-cavalry >= 12)
			(or
				(up-compare-goal g-desired-num-knight >= 12)
				(up-compare-goal g-desired-num-camel >= 12)))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-forging c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-highest-tech-priority c:max 5)
		)
		
		;Check if we want to train unique barracks/stable units that require forging
        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-forging)
        (up-compare-goal g-highest-tech-priority <= 5)
		(current-age >= castle-age)
		(or
			(up-compare-goal g-desired-num-condottiero >= 12)
			(or
				(up-compare-goal g-desired-num-battle-elephant >= 10)
				(up-compare-goal g-desired-num-steppe-lancer >= 12)))
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-forging c: 1)
		(up-modify-escrow food g:- g-food-cost)
        (up-research g-escrow c: ri-forging)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-forging)
        (up-compare-goal g-highest-tech-priority <= 7)
		(current-age >= castle-age)
		(or
			(up-compare-goal g-desired-num-condottiero >= 12)
			(or
				(up-compare-goal g-desired-num-battle-elephant >= 10)
				(up-compare-goal g-desired-num-steppe-lancer >= 12)))
        =>
        (research ri-forging)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-forging == research-available)
        (up-compare-goal g-highest-tech-priority <= 5)
		(current-age >= castle-age)
		(or
			(up-compare-goal g-desired-num-condottiero >= 12)
			(or
				(up-compare-goal g-desired-num-battle-elephant >= 10)
				(up-compare-goal g-desired-num-steppe-lancer >= 12)))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-forging c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-highest-tech-priority c:max 5)
		)
		
		;Check if we want to train unique units that require forging
        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-forging)
        (up-compare-goal g-highest-tech-priority <= 5)
		(current-age >= castle-age)
		(up-compare-goal g-desired-num-unique-unit >= 10)
		(or
			(goal g-temp-2 infantry-class)			;unique unit is infantry
			(goal g-temp-2 cavalry-class))			;unique unit is cavalry
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-forging c: 1)
		(up-modify-escrow food g:- g-food-cost)
        (up-research g-escrow c: ri-forging)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-forging)
        (up-compare-goal g-highest-tech-priority <= 7)
		(current-age >= castle-age)
		(up-compare-goal g-desired-num-unique-unit >= 10)
		(or
			(goal g-temp-2 infantry-class)			;unique unit is infantry
			(goal g-temp-2 cavalry-class))			;unique unit is cavalry
        =>
        (research ri-forging)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-forging == research-available)
        (up-compare-goal g-highest-tech-priority <= 5)
		(current-age >= castle-age)
		(up-compare-goal g-desired-num-unique-unit >= 10)
		(or
			(goal g-temp-2 infantry-class)			;unique unit is infantry
			(goal g-temp-2 cavalry-class))			;unique unit is cavalry
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-forging c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-highest-tech-priority c:max 5)
		)
		
	;------------------
	;	Conscription
	;------------------

		(defrule
		(up-research-status c: ri-conscription != research-available)
		=>
		(up-jump-rule 3)
		)

        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-conscription)
        (up-compare-goal g-highest-tech-priority <= 5)
		(unit-type-count villager >= 80)
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-conscription c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-conscription)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-conscription)
        (up-compare-goal g-highest-tech-priority <= 7)
		(unit-type-count villager >= 80)
        =>
        (research ri-conscription)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-conscription == research-available)
        (up-compare-goal g-highest-tech-priority <= 5)
		(unit-type-count villager >= 80)
		(building-type-count castle > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-conscription c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 5)
		)
		
	;---------------
	;	Hand Cart
	;---------------

		(defrule
		(up-research-status c: ri-hand-cart != research-available)
		=>
		(up-jump-rule 3)
		)

        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-hand-cart)
        (up-compare-goal g-highest-tech-priority <= 5)
		(unit-type-count villager >= 80)
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-hand-cart c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow wood g:- g-wood-cost)
        (up-research g-escrow c: ri-hand-cart)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-hand-cart)
        (up-compare-goal g-highest-tech-priority <= 7)
		(unit-type-count villager >= 80)
        =>
        (research ri-hand-cart)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-hand-cart == research-available)
        (up-compare-goal g-highest-tech-priority <= 5)
		(unit-type-count villager >= 80)
		(building-type-count town-center > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-hand-cart c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-wood-needed g:max g-wood-cost)
		(up-modify-goal g-highest-tech-priority c:max 5)
		)
		
	;-----------
	;	Faith
	;-----------
		
		(defrule
		(up-research-status c: ri-faith != research-available)
		=>
		(up-jump-rule 3)
		)

		(defrule
		(goal g-first-attack-launched YES)
		(can-research-with-escrow ri-faith)
		(up-compare-goal g-enemy-monks-count >= 12)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-faith c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
		(up-research g-escrow c: ri-faith)
		)

		(defrule
		(goal g-first-attack-launched YES)
		(can-research ri-faith)
		(up-compare-goal g-highest-tech-priority <= 7)
		(up-compare-goal g-enemy-monks-count >= 12)
		=>
		(research ri-faith)
		)

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-faith == research-available)
		(up-compare-goal g-highest-tech-priority <= 5)
		(up-compare-goal g-enemy-monks-count >= 12)
		(building-type-count monastery > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-faith c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 5)
		)
		
	;----------------
	;	Redemption
	;----------------
		
		(defrule
		(up-research-status c: ri-redemption != research-available)
		=>
		(up-jump-rule 3)
		)

		(defrule
		(goal g-first-attack-launched YES)
		(can-research-with-escrow ri-redemption)
		(or
			(up-compare-goal g-desired-num-monks >= 7)
			(or
				(goal g-support-unit monk)
				(goal g-support-unit missionary)))
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-redemption c: 1)
		(up-modify-escrow gold g:- g-gold-cost)
		(up-research g-escrow c: ri-redemption)
		)

		(defrule
		(goal g-first-attack-launched YES)
		(can-research ri-redemption)
		(up-compare-goal g-highest-tech-priority <= 7)
		(or
			(up-compare-goal g-desired-num-monks >= 7)
			(or
				(goal g-support-unit monk)
				(goal g-support-unit missionary)))
		=>
		(research ri-redemption)
		)

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-redemption == research-available)
		(up-compare-goal g-highest-tech-priority <= 5)
		(or
			(up-compare-goal g-desired-num-monks >= 7)
			(or
				(goal g-support-unit monk)
				(goal g-support-unit missionary)))
		(building-type-count monastery > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-redemption c: 1)
		(up-modify-escrow gold g:- g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 5)
		)
		
	;--------------
	;	Sanctity
	;--------------
		
		(defrule
		(up-research-status c: ri-sanctity != research-available)
		=>
		(up-jump-rule 3)
		)

		(defrule
		(goal g-first-attack-launched YES)
		(can-research-with-escrow ri-sanctity)
		(or
			(up-compare-goal g-desired-num-monks >= 5)
			(or
				(goal g-support-unit monk)
				(goal g-support-unit missionary)))
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-sanctity c: 1)
		(up-modify-escrow gold g:- g-gold-cost)
		(up-research g-escrow c: ri-sanctity)
		)

		(defrule
		(goal g-first-attack-launched YES)
		(can-research ri-sanctity)
		(up-compare-goal g-highest-tech-priority <= 7)
		(or
			(up-compare-goal g-desired-num-monks >= 5)
			(or
				(goal g-support-unit monk)
				(goal g-support-unit missionary)))
		=>
		(research ri-sanctity)
		)

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-sanctity == research-available)
		(up-compare-goal g-highest-tech-priority <= 5)
		(or
			(up-compare-goal g-desired-num-monks >= 5)
			(or
				(goal g-support-unit monk)
				(goal g-support-unit missionary)))
		(building-type-count monastery > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-sanctity c: 1)
		(up-modify-escrow gold g:- g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 5)
		)
		
	;--------------------
	;	Block Printing
	;--------------------
		
		(defrule
		(up-research-status c: ri-block-printing != research-available)
		=>
		(up-jump-rule 3)
		)

		(defrule
		(goal g-first-attack-launched YES)
		(can-research-with-escrow ri-block-printing)
		(or
			(up-compare-goal g-desired-num-monks >= 7)
			(or
				(goal g-support-unit monk)
				(goal g-support-unit missionary)))
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-block-printing c: 1)
		(up-modify-escrow gold g:- g-gold-cost)
		(up-research g-escrow c: ri-block-printing)
		)

		(defrule
		(goal g-first-attack-launched YES)
		(can-research ri-block-printing)
		(up-compare-goal g-highest-tech-priority <= 7)
		(or
			(up-compare-goal g-desired-num-monks >= 7)
			(or
				(goal g-support-unit monk)
				(goal g-support-unit missionary)))
		=>
		(research ri-block-printing)
		)

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-block-printing == research-available)
		(up-compare-goal g-highest-tech-priority <= 5)
		(or
			(up-compare-goal g-desired-num-monks >= 7)
			(or
				(goal g-support-unit monk)
				(goal g-support-unit missionary)))
		(building-type-count monastery > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-block-printing c: 1)
		(up-modify-escrow gold g:- g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 5)
		)
		
	;---------------
	;	Theocracy
	;---------------
		
		(defrule
		(up-research-status c: ri-theocracy != research-available)
		=>
		(up-jump-rule 3)
		)

		(defrule
		(goal g-first-attack-launched YES)
		(can-research-with-escrow ri-theocracy)
		(unit-type-count monastery-class >= 5)
		(or
			(up-compare-goal g-desired-num-monks >= 7)
			(or
				(goal g-support-unit monk)
				(goal g-support-unit missionary)))
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-theocracy c: 1)
		(up-modify-escrow gold g:- g-gold-cost)
		(up-research g-escrow c: ri-theocracy)
		)

		(defrule
		(goal g-first-attack-launched YES)
		(can-research ri-theocracy)
		(up-compare-goal g-highest-tech-priority <= 7)
		(unit-type-count monastery-class >= 5)
		(or
			(up-compare-goal g-desired-num-monks >= 7)
			(or
				(goal g-support-unit monk)
				(goal g-support-unit missionary)))
		=>
		(research ri-theocracy)
		)

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-theocracy == research-available)
		(up-compare-goal g-highest-tech-priority <= 5)
		(unit-type-count monastery-class >= 5)
		(or
			(up-compare-goal g-desired-num-monks >= 7)
			(or
				(goal g-support-unit monk)
				(goal g-support-unit missionary)))
		(building-type-count monastery > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-theocracy c: 1)
		(up-modify-escrow gold g:- g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 5)
		)
		
	;------------------
	;	Illumination
	;------------------
		
		(defrule
		(up-research-status c: ri-illumination != research-available)
		=>
		(up-jump-rule 3)
		)

		(defrule
		(goal g-first-attack-launched YES)
		(can-research-with-escrow ri-illumination)
		(unit-type-count monastery-class >= 5)
		(or
			(up-compare-goal g-desired-num-monks >= 9)
			(or
				(goal g-support-unit monk)
				(goal g-support-unit missionary)))
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-illumination c: 1)
		(up-modify-escrow gold g:- g-gold-cost)
		(up-research g-escrow c: ri-illumination)
		)

		(defrule
		(goal g-first-attack-launched YES)
		(can-research ri-illumination)
		(up-compare-goal g-highest-tech-priority <= 7)
		(unit-type-count monastery-class >= 5)
		(or
			(up-compare-goal g-desired-num-monks >= 9)
			(or
				(goal g-support-unit monk)
				(goal g-support-unit missionary)))
		=>
		(research ri-illumination)
		)

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-illumination == research-available)
		(up-compare-goal g-highest-tech-priority <= 5)
		(unit-type-count monastery-class >= 5)
		(or
			(up-compare-goal g-desired-num-monks >= 9)
			(or
				(goal g-support-unit monk)
				(goal g-support-unit missionary)))
		(building-type-count monastery > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-illumination c: 1)
		(up-modify-escrow gold g:- g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 5)
		)

	;------------
	;	Escrow
	;------------

		(defrule
		(up-resource-amount amount-food g:< g-max-food-needed)    ;Need to escrow food
		(goal g-highest-tech-priority 5)
		=>
		(set-escrow-percentage food 24)
		)

		(defrule
		(up-resource-amount amount-wood g:< g-max-wood-needed)    ;Need to escrow wood
		(goal g-highest-tech-priority 5)
		=>
		(set-escrow-percentage wood 24)
		)

		(defrule
		(up-resource-amount amount-gold g:< g-max-gold-needed)    ;Need to escrow gold
		(goal g-highest-tech-priority 5)
		=>
		(set-escrow-percentage gold 24)
		)

		(defrule
		(up-resource-amount amount-stone g:< g-max-stone-needed)    ;Need to escrow stone
		(goal g-highest-tech-priority 5)
		=>
		(set-escrow-percentage stone 24)
		)

;=========================<>=========================
;				      PRIORITY 4
;=========================<>=========================

	;-----------------
	;	Man-at-Arms
	;-----------------

		(defrule
		(up-research-status c: ri-man-at-arms != research-available)
		=>
		(up-jump-rule 3)
		)

        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-man-at-arms)
        (up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-militia >= 6)
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-man-at-arms c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-man-at-arms)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-man-at-arms)
        (up-compare-goal g-highest-tech-priority <= 6)
		(up-compare-goal g-desired-num-militia >= 6)
        =>
        (research ri-man-at-arms)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-man-at-arms == research-available)
        (up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-militia >= 6)
		(building-type-count barracks > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-man-at-arms c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 4)
		)

	;-----------------
	;	Crossbowman
	;-----------------

		(defrule
		(up-research-status c: ri-crossbow != research-available)
		=>
		(up-jump-rule 3)
		)

        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-crossbow)
        (up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-archer >= 6)
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-crossbow c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-crossbow)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-crossbow)
        (up-compare-goal g-highest-tech-priority <= 6)
		(up-compare-goal g-desired-num-archer >= 6)
        =>
        (research ri-crossbow)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-crossbow == research-available)
        (up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-archer >= 6)
		(building-type-count archery-range > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-crossbow c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 4)
		)

	;-------------
	;	Pikeman
	;-------------

		(defrule
		(up-research-status c: ri-pikeman != research-available)
		=>
		(up-jump-rule 3)
		)

        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-pikeman)
        (up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-spearman >= 6)
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-pikeman c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-pikeman)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-pikeman)
        (up-compare-goal g-highest-tech-priority <= 6)
		(up-compare-goal g-desired-num-spearman >= 6)
        =>
        (research ri-pikeman)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-pikeman == research-available)
        (up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-spearman >= 6)
		(building-type-count barracks > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-pikeman c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 4)
		)

	#load-if-defined UP-GAME-WK

		;-------------------
		;	Eagle Warrior
		;-------------------

			(defrule
			(up-research-status c: ri-eagle-warrior != research-available)
			=>
			(up-jump-rule 3)
			)

			(defrule
			(goal g-first-attack-launched YES)
			(can-research-with-escrow ri-eagle-warrior)
        	(up-compare-goal g-highest-tech-priority <= 4)
			(up-compare-goal g-desired-num-eagle-warrior >= 6)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-eagle-warrior c: 1)
			(up-modify-escrow food g:- g-food-cost)
			(up-modify-escrow gold g:- g-gold-cost)
			(up-research g-escrow c: ri-eagle-warrior)
			)

			(defrule
			(goal g-first-attack-launched YES)
			(can-research ri-eagle-warrior)
        	(up-compare-goal g-highest-tech-priority <= 6)
			(up-compare-goal g-desired-num-eagle-warrior >= 6)
			=>
			(research ri-eagle-warrior)
			)

			(defrule
			(goal g-first-attack-launched YES)
			(up-research-status c: ri-eagle-warrior == research-available)
        	(up-compare-goal g-highest-tech-priority <= 4)
			(up-compare-goal g-desired-num-eagle-warrior >= 6)
			(building-type-count barracks > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-eagle-warrior c: 1)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			(up-modify-goal g-highest-tech-priority c:max 4)
			)

	#end-if

	;-------------------
	;	Light Cavalry
	;-------------------

		(defrule
		(up-research-status c: ri-light-cavalry != research-available)
		=>
		(up-jump-rule 3)
		)

        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-light-cavalry)
        (up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-scout-cavalry >= 6)
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-light-cavalry c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-light-cavalry)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-light-cavalry)
        (up-compare-goal g-highest-tech-priority <= 6)
		(up-compare-goal g-desired-num-scout-cavalry >= 6)
        =>
        (research ri-light-cavalry)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-light-cavalry == research-available)
        (up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-scout-cavalry >= 6)
		(building-type-count stable > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-light-cavalry c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 4)
		)

	;----------------------
	;	Elite Skirmisher
	;----------------------

		(defrule
		(up-research-status c: ri-elite-skirmisher != research-available)
		=>
		(up-jump-rule 3)
		)

        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-elite-skirmisher)
        (up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-skirmisher >= 6)
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-elite-skirmisher c: 1)
		(up-modify-escrow wood g:- g-wood-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-elite-skirmisher)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-elite-skirmisher)
        (up-compare-goal g-highest-tech-priority <= 6)
		(up-compare-goal g-desired-num-skirmisher >= 6)
        =>
        (research ri-elite-skirmisher)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-elite-skirmisher == research-available)
        (up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-skirmisher >= 6)
		(building-type-count archery-range > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-elite-skirmisher c: 1)
		(up-modify-goal g-max-wood-needed g:max g-wood-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 4)
		)

	;--------------------
	;	Long Swordsman
	;--------------------

		(defrule
		(up-research-status c: ri-long-swordsman != research-available)
		=>
		(up-jump-rule 3)
		)

        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-long-swordsman)
        (up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-militia >= 6)
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-long-swordsman c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-long-swordsman)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-long-swordsman)
        (up-compare-goal g-highest-tech-priority <= 6)
		(up-compare-goal g-desired-num-militia >= 6)
        =>
        (research ri-long-swordsman)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-long-swordsman == research-available)
        (up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-militia >= 6)
		(building-type-count barracks > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-long-swordsman c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 4)
		)

	;--------------
	;	Cavalier
	;--------------

		(defrule
		(up-research-status c: ri-cavalier != research-available)
		=>
		(up-jump-rule 3)
		)

        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-cavalier)
        (up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-knight >= 6)
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-cavalier c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-cavalier)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-cavalier)
        (up-compare-goal g-highest-tech-priority <= 6)
		(up-compare-goal g-desired-num-knight >= 6)
        =>
        (research ri-cavalier)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-cavalier == research-available)
        (up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-knight >= 6)
		(building-type-count stable > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-cavalier c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 4)
		)

	;-------------
	;	Paladin
	;-------------

		(defrule
		(up-research-status c: ri-paladin != research-available)
		=>
		(up-jump-rule 3)
		)

        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-paladin)
        (up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-knight >= 6)
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-paladin c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-paladin)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-paladin)
        (up-compare-goal g-highest-tech-priority <= 6)
		(up-compare-goal g-desired-num-knight >= 6)
        =>
        (research ri-paladin)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-paladin == research-available)
        (up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-knight >= 6)
		(building-type-count stable > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-paladin c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 4)
		)

	;-------------------------
	;	Elite Eagle Warrior
	;-------------------------

		(defrule
		(up-research-status c: ri-elite-eagle-warrior != research-available)
		=>
		(up-jump-rule 3)
		)

        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-elite-eagle-warrior)
        (up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-eagle-warrior >= 6)
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-elite-eagle-warrior c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-elite-eagle-warrior)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-elite-eagle-warrior)
        (up-compare-goal g-highest-tech-priority <= 6)
		(up-compare-goal g-desired-num-eagle-warrior >= 6)
        =>
        (research ri-elite-eagle-warrior)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-elite-eagle-warrior == research-available)
        (up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-eagle-warrior >= 6)
		(building-type-count barracks > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-elite-eagle-warrior c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 4)
		)

	;--------------
	;	Arbalest
	;--------------

		(defrule
		(up-research-status c: ri-arbalest != research-available)
		=>
		(up-jump-rule 3)
		)

        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-arbalest)
        (up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-archer >= 6)
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-arbalest c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-arbalest)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-arbalest)
        (up-compare-goal g-highest-tech-priority <= 6)
		(up-compare-goal g-desired-num-archer >= 6)
        =>
        (research ri-arbalest)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-arbalest == research-available)
        (up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-archer >= 6)
		(building-type-count archery-range > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-arbalest c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 4)
		)

	;-----------------
	;	Heavy Camel
	;-----------------

		(defrule
		(up-research-status c: ri-heavy-camel != research-available)
		=>
		(up-jump-rule 3)
		)

        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-heavy-camel)
        (up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-camel >= 6)
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-heavy-camel c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-heavy-camel)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-heavy-camel)
        (up-compare-goal g-highest-tech-priority <= 6)
		(up-compare-goal g-desired-num-camel >= 6)
        =>
        (research ri-heavy-camel)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-heavy-camel == research-available)
        (up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-camel >= 6)
		(building-type-count stable > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-heavy-camel c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 4)
		)

	#load-if-defined UP-GAME-WK

		;--------------------
		;	Imperial Camel
		;--------------------

			(defrule
			(up-research-status c: ri-imperial-camel != research-available)
			=>
			(up-jump-rule 3)
			)

			(defrule
			(goal g-first-attack-launched YES)
			(can-research-with-escrow ri-imperial-camel)
        	(up-compare-goal g-highest-tech-priority <= 4)
			(up-compare-goal g-desired-num-camel >= 6)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-imperial-camel c: 1)
			(up-modify-escrow food g:- g-food-cost)
			(up-modify-escrow gold g:- g-gold-cost)
			(up-research g-escrow c: ri-imperial-camel)
			)

			(defrule
			(goal g-first-attack-launched YES)
			(can-research ri-imperial-camel)
			(up-compare-goal g-highest-tech-priority <= 6)
			(up-compare-goal g-desired-num-camel >= 6)
			=>
			(research ri-imperial-camel)
			)

			(defrule
			(goal g-first-attack-launched YES)
			(up-research-status c: ri-imperial-camel == research-available)
        	(up-compare-goal g-highest-tech-priority <= 4)
			(up-compare-goal g-desired-num-camel >= 6)
			(building-type-count stable > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-imperial-camel c: 1)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			(up-modify-goal g-highest-tech-priority c:max 4)
			)

	#end-if

	;-----------------
	;	Unique Unit
	;-----------------

		(defrule
		(up-research-status c: my-unique-unit-upgrade != research-available)
		=>
		(up-jump-rule 3)
		)

        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow my-unique-unit-upgrade)
        (up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-unique-unit >= 6)
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: my-unique-unit-upgrade c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
		(up-modify-escrow wood g:- g-wood-cost)
        (up-research g-escrow c: my-unique-unit-upgrade)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research my-unique-unit-upgrade)
        (up-compare-goal g-highest-tech-priority <= 6)
		(up-compare-goal g-desired-num-unique-unit >= 6)
        =>
        (research my-unique-unit-upgrade)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: my-unique-unit-upgrade == research-available)
        (up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-unique-unit >= 6)
		(building-type-count castle > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: my-unique-unit-upgrade c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-wood-needed g:max g-wood-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 4)
		)

	;----------------
	;	Halberdier
	;----------------

		(defrule
		(up-research-status c: ri-halberdier != research-available)
		=>
		(up-jump-rule 3)
		)

        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-halberdier)
        (up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-spearman >= 6)
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-halberdier c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-halberdier)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-halberdier)
        (up-compare-goal g-highest-tech-priority <= 6)
		(up-compare-goal g-desired-num-spearman >= 6)
        =>
        (research ri-halberdier)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-halberdier == research-available)
        (up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-spearman >= 6)
		(building-type-count barracks > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-halberdier c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 4)
		)

	;--------------
	;	Hussar
	;--------------

		(defrule
		(up-research-status c: ri-hussar != research-available)
		=>
		(up-jump-rule 3)
		)

        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-hussar)
        (up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-scout-cavalry >= 6)
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-hussar c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-hussar)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-hussar)
        (up-compare-goal g-highest-tech-priority <= 6)
		(up-compare-goal g-desired-num-scout-cavalry >= 6)
        =>
        (research ri-hussar)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-hussar == research-available)
        (up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-scout-cavalry >= 6)
		(building-type-count stable > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-hussar c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 4)
		)

	#load-if-defined UP-GAME-WK

		;---------------------------
		;	Elite Battle Elephant
		;---------------------------

			(defrule
			(up-research-status c: ri-elite-battle-elephant != research-available)
			=>
			(up-jump-rule 3)
			)

			(defrule
			(goal g-first-attack-launched YES)
			(can-research-with-escrow ri-elite-battle-elephant)
        	(up-compare-goal g-highest-tech-priority <= 4)
			(up-compare-goal g-desired-num-battle-elephant >= 6)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-elite-battle-elephant c: 1)
			(up-modify-escrow food g:- g-food-cost)
			(up-modify-escrow gold g:- g-gold-cost)
			(up-research g-escrow c: ri-elite-battle-elephant)
			)

			(defrule
			(goal g-first-attack-launched YES)
			(can-research ri-elite-battle-elephant)
			(up-compare-goal g-highest-tech-priority <= 6)
			(up-compare-goal g-desired-num-battle-elephant >= 6)
			=>
			(research ri-elite-battle-elephant)
			)

			(defrule
			(goal g-first-attack-launched YES)
			(up-research-status c: ri-elite-battle-elephant == research-available)
        	(up-compare-goal g-highest-tech-priority <= 4)
			(up-compare-goal g-desired-num-battle-elephant >= 6)
			(building-type-count stable > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-elite-battle-elephant c: 1)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			(up-modify-goal g-highest-tech-priority c:max 4)
			)

	#end-if

	;--------------------------
	;	Two-handed Swordsman
	;--------------------------

		(defrule
		(up-research-status c: ri-two-handed-swordsman != research-available)
		=>
		(up-jump-rule 3)
		)

        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-two-handed-swordsman)
        (up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-militia >= 6)
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-two-handed-swordsman c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-two-handed-swordsman)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-two-handed-swordsman)
        (up-compare-goal g-highest-tech-priority <= 6)
		(up-compare-goal g-desired-num-militia >= 6)
        =>
        (research ri-two-handed-swordsman)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-two-handed-swordsman == research-available)
        (up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-militia >= 6)
		(building-type-count barracks > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-two-handed-swordsman c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 4)
		)

	;--------------
	;	Champion
	;--------------

		(defrule
		(up-research-status c: ri-champion != research-available)
		=>
		(up-jump-rule 3)
		)

        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-champion)
        (up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-militia >= 6)
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-champion c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-champion)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-champion)
        (up-compare-goal g-highest-tech-priority <= 6)
		(up-compare-goal g-desired-num-militia >= 6)
        =>
        (research ri-champion)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-champion == research-available)
        (up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-militia >= 6)
		(building-type-count barracks > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-champion c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 4)
		)

	;--------------------------
	;	Heavy Cavalry Archer
	;--------------------------

		(defrule
		(up-research-status c: ri-heavy-cavalry-archer != research-available)
		=>
		(up-jump-rule 3)
		)

        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-heavy-cavalry-archer)
        (up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-cavalry-archer >= 6)
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-heavy-cavalry-archer c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-heavy-cavalry-archer)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-heavy-cavalry-archer)
        (up-compare-goal g-highest-tech-priority <= 6)
		(up-compare-goal g-desired-num-cavalry-archer >= 6)
        =>
        (research ri-heavy-cavalry-archer)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-heavy-cavalry-archer == research-available)
        (up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-cavalry-archer >= 6)
		(building-type-count archery-range > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-heavy-cavalry-archer c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 4)
		)

	#load-if-defined DE-AVAILABLE

		;-------------------------
		;	Elite Steppe Lancer
		;-------------------------

			(defrule
			(up-research-status c: ri-elite-steppe-lancer != research-available)
			=>
			(up-jump-rule 3)
			)

			(defrule
			(goal g-first-attack-launched YES)
			(can-research-with-escrow ri-elite-steppe-lancer)
        	(up-compare-goal g-highest-tech-priority <= 4)
			(up-compare-goal g-desired-num-steppe-lancer >= 6)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-elite-steppe-lancer c: 1)
			(up-modify-escrow food g:- g-food-cost)
			(up-modify-escrow gold g:- g-gold-cost)
			(up-research g-escrow c: ri-elite-steppe-lancer)
			)

			(defrule
			(goal g-first-attack-launched YES)
			(can-research ri-elite-steppe-lancer)
			(up-compare-goal g-highest-tech-priority <= 6)
			(up-compare-goal g-desired-num-steppe-lancer >= 6)
			=>
			(research ri-elite-steppe-lancer)
			)

			(defrule
			(goal g-first-attack-launched YES)
			(up-research-status c: ri-elite-steppe-lancer == research-available)
        	(up-compare-goal g-highest-tech-priority <= 4)
			(up-compare-goal g-desired-num-steppe-lancer >= 6)
			(building-type-count stable > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-elite-steppe-lancer c: 1)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			(up-modify-goal g-highest-tech-priority c:max 4)
			)

	#end-if

	#load-if-defined UP-GAME-WK

		;-------------------------
		;	Imperial Skirmisher
		;-------------------------

			(defrule
			(up-research-status c: ri-imperial-skirmisher != research-available)
			=>
			(up-jump-rule 3)
			)

			(defrule
			(goal g-first-attack-launched YES)
			(can-research-with-escrow ri-imperial-skirmisher)
        	(up-compare-goal g-highest-tech-priority <= 4)
			(up-compare-goal g-desired-num-skirmisher >= 6)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-imperial-skirmisher c: 1)
			(up-modify-escrow wood g:- g-wood-cost)
			(up-modify-escrow gold g:- g-gold-cost)
			(up-research g-escrow c: ri-imperial-skirmisher)
			)

			(defrule
			(goal g-first-attack-launched YES)
			(can-research ri-imperial-skirmisher)
			(up-compare-goal g-highest-tech-priority <= 6)
			(up-compare-goal g-desired-num-skirmisher >= 6)
			=>
			(research ri-imperial-skirmisher)
			)

			(defrule
			(goal g-first-attack-launched YES)
			(up-research-status c: ri-imperial-skirmisher == research-available)
        	(up-compare-goal g-highest-tech-priority <= 4)
			(up-compare-goal g-desired-num-skirmisher >= 6)
			(building-type-count archery-range > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-imperial-skirmisher c: 1)
			(up-modify-goal g-max-wood-needed g:max g-wood-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			(up-modify-goal g-highest-tech-priority c:max 4)
			)

		;--------------------
		;	Elite Genitour
		;--------------------

			(defrule
			(up-research-status c: ri-elite-genitour != research-available)
			=>
			(up-jump-rule 3)
			)

			(defrule
			(goal g-first-attack-launched YES)
			(can-research-with-escrow ri-elite-genitour)
        	(up-compare-goal g-highest-tech-priority <= 4)
			(up-compare-goal g-desired-num-genitour >= 6)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-elite-genitour c: 1)
			(up-modify-escrow food g:- g-food-cost)
			(up-modify-escrow wood g:- g-wood-cost)
			(up-research g-escrow c: ri-elite-genitour)
			)

			(defrule
			(goal g-first-attack-launched YES)
			(can-research ri-elite-genitour)
			(up-compare-goal g-highest-tech-priority <= 6)
			(up-compare-goal g-desired-num-genitour >= 6)
			=>
			(research ri-elite-genitour)
			)

			(defrule
			(goal g-first-attack-launched YES)
			(up-research-status c: ri-elite-genitour == research-available)
        	(up-compare-goal g-highest-tech-priority <= 4)
			(up-compare-goal g-desired-num-genitour >= 6)
			(building-type-count archery-range > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-elite-genitour c: 1)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-wood-needed g:max g-wood-cost)
			(up-modify-goal g-highest-tech-priority c:max 4)
			)

	#end-if

	;----------------
	;	Capped Ram
	;----------------

		(defrule
		(up-research-status c: ri-capped-ram != research-available)
		=>
		(up-jump-rule 3)
		)

        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-capped-ram)
        (up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-battering-ram >= 2)
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-capped-ram c: 1)
		(up-modify-escrow food g:- g-food-cost)
        (up-research g-escrow c: ri-capped-ram)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-capped-ram)
        (up-compare-goal g-highest-tech-priority <= 6)
		(up-compare-goal g-desired-num-battering-ram >= 2)
        =>
        (research ri-capped-ram)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-capped-ram == research-available)
        (up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-battering-ram >= 2)
		(building-type-count siege-workshop > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-capped-ram c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-highest-tech-priority c:max 4)
		)

	;---------------
	;	Siege Ram
	;---------------

		(defrule
		(up-research-status c: ri-siege-ram != research-available)
		=>
		(up-jump-rule 3)
		)

        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-siege-ram)
        (up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-battering-ram >= 2)
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-siege-ram c: 1)
		(up-modify-escrow food g:- g-food-cost)
        (up-research g-escrow c: ri-siege-ram)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-siege-ram)
        (up-compare-goal g-highest-tech-priority <= 6)
		(up-compare-goal g-desired-num-battering-ram >= 2)
        =>
        (research ri-siege-ram)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-siege-ram == research-available)
        (up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-battering-ram >= 2)
		(building-type-count siege-workshop > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-siege-ram c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-highest-tech-priority c:max 4)
		)

	;------------
	;	Onager
	;------------

		(defrule
		(up-research-status c: ri-onager != research-available)
		=>
		(up-jump-rule 3)
		)

        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-onager)
        (up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-mangonel >= 2)
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-onager c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-onager)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-onager)
        (up-compare-goal g-highest-tech-priority <= 6)
		(up-compare-goal g-desired-num-mangonel >= 2)
        =>
        (research ri-onager)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-onager == research-available)
        (up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-mangonel >= 2)
		(building-type-count siege-workshop > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-onager c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 4)
		)

	;------------------
	;	Siege Onager
	;------------------

		(defrule
		(up-research-status c: ri-siege-onager != research-available)
		=>
		(up-jump-rule 3)
		)

        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-siege-onager)
        (up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-mangonel >= 2)
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-siege-onager c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-siege-onager)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-siege-onager)
        (up-compare-goal g-highest-tech-priority <= 6)
		(up-compare-goal g-desired-num-mangonel >= 2)
        =>
        (research ri-siege-onager)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-siege-onager == research-available)
        (up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-mangonel >= 2)
		(building-type-count siege-workshop > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-siege-onager c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 4)
		)

	;--------------------
	;	Heavy Scorpion
	;--------------------

		(defrule
		(up-research-status c: ri-heavy-scorpion != research-available)
		=>
		(up-jump-rule 3)
		)

        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-heavy-scorpion)
        (up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-scorpion >= 5)
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-heavy-scorpion c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow wood g:- g-wood-cost)
        (up-research g-escrow c: ri-heavy-scorpion)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-heavy-scorpion)
        (up-compare-goal g-highest-tech-priority <= 6)
		(up-compare-goal g-desired-num-scorpion >= 5)
        =>
        (research ri-heavy-scorpion)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-heavy-scorpion == research-available)
        (up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-scorpion >= 5)
		(building-type-count siege-workshop > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-heavy-scorpion c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-wood-needed g:max g-wood-cost)
		(up-modify-goal g-highest-tech-priority c:max 4)
		)
		
	;---------------
	;	Fletching
	;---------------

		(defrule
		(up-research-status c: ri-fletching != research-available)
		=>
		(up-jump-rule 10)
		)

		;Check if unique unit benefits from scale-barding
		(defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-fletching)
        (up-compare-goal g-highest-tech-priority <= 6)
		=>
		(up-get-object-type-data c: my-unique-unit object-data-class g-temp-2)
		)
		
		;Check if we want to train archery range units that require fletching
        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-fletching)
        (up-compare-goal g-highest-tech-priority <= 4)
		(or
			(up-compare-goal g-desired-num-archer > 0)
			(or
				(up-compare-goal g-desired-num-skirmisher > 0)
				(up-compare-goal g-desired-num-cavalry-archer > 0)))
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-fletching c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-fletching)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-fletching)
        (up-compare-goal g-highest-tech-priority <= 6)
		(or
			(up-compare-goal g-desired-num-archer > 0)
			(or
				(up-compare-goal g-desired-num-skirmisher > 0)
				(up-compare-goal g-desired-num-cavalry-archer > 0)))
        =>
        (research ri-fletching)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-fletching == research-available)
        (up-compare-goal g-highest-tech-priority <= 4)
		(or
			(up-compare-goal g-desired-num-archer > 0)
			(or
				(up-compare-goal g-desired-num-skirmisher > 0)
				(up-compare-goal g-desired-num-cavalry-archer > 0)))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-fletching c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 5)
		)
		
		;Check if we want to train unique archery range units that require fletching
        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-fletching)
        (up-compare-goal g-highest-tech-priority <= 4)
		(or
			(up-compare-goal g-desired-num-slinger > 0)
			(up-compare-goal g-desired-num-genitour > 0))
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-fletching c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-fletching)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-fletching)
        (up-compare-goal g-highest-tech-priority <= 6)
		(or
			(up-compare-goal g-desired-num-slinger > 0)
			(up-compare-goal g-desired-num-genitour > 0))
        =>
        (research ri-fletching)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-fletching == research-available)
        (up-compare-goal g-highest-tech-priority <= 4)
		(or
			(up-compare-goal g-desired-num-slinger > 0)
			(up-compare-goal g-desired-num-genitour > 0))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-fletching c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 4)
		)
		
		;Check if we want to train unique units that require fletching
        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-fletching)
        (up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-unique-unit > 0)
		(or
			(goal g-temp-2 archery-class)			;unique unit is a foot archer
			(goal g-temp-2 cavalry-archer-class))	;unique unit is a cavalry archer
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-fletching c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-fletching)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-fletching)
        (up-compare-goal g-highest-tech-priority <= 6)
		(up-compare-goal g-desired-num-unique-unit > 0)
		(or
			(goal g-temp-2 archery-class)			;unique unit is a foot archer
			(goal g-temp-2 cavalry-archer-class))	;unique unit is a cavalry archer
        =>
        (research ri-fletching)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-fletching == research-available)
        (up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-unique-unit > 0)
		(or
			(goal g-temp-2 archery-class)			;unique unit is a foot archer
			(goal g-temp-2 cavalry-archer-class))	;unique unit is a cavalry archer
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-fletching c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 4)
		)
		
	;------------------
	;	Bodkin Arrow
	;------------------

		(defrule
		(up-research-status c: ri-bodkin-arrow != research-available)
		=>
		(up-jump-rule 9)
		)

		;Check if unique unit benefits from scale-barding
		(defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-bodkin-arrow)
        (up-compare-goal g-highest-tech-priority <= 6)
		=>
		(up-get-object-type-data c: my-unique-unit object-data-class g-temp-2)
		)
		
		;Check if we want to train archery range units that require bodkin-arrow
        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-bodkin-arrow)
        (up-compare-goal g-highest-tech-priority <= 4)
		(or
			(up-compare-goal g-desired-num-archer > 0)
			(or
				(up-compare-goal g-desired-num-skirmisher > 0)
				(up-compare-goal g-desired-num-cavalry-archer > 0)))
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-bodkin-arrow c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-bodkin-arrow)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-bodkin-arrow)
        (up-compare-goal g-highest-tech-priority <= 6)
		(or
			(up-compare-goal g-desired-num-archer > 0)
			(or
				(up-compare-goal g-desired-num-skirmisher > 0)
				(up-compare-goal g-desired-num-cavalry-archer > 0)))
        =>
        (research ri-bodkin-arrow)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-bodkin-arrow == research-available)
        (up-compare-goal g-highest-tech-priority <= 4)
		(or
			(up-compare-goal g-desired-num-archer > 0)
			(or
				(up-compare-goal g-desired-num-skirmisher > 0)
				(up-compare-goal g-desired-num-cavalry-archer > 0)))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-bodkin-arrow c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 4)
		)
		
		;Check if we want to train unique archery range units that require bodkin-arrow
        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-bodkin-arrow)
        (up-compare-goal g-highest-tech-priority <= 4)
		(or
			(up-compare-goal g-desired-num-slinger > 0)
			(up-compare-goal g-desired-num-genitour > 0))
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-bodkin-arrow c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-bodkin-arrow)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-bodkin-arrow)
        (up-compare-goal g-highest-tech-priority <= 6)
		(or
			(up-compare-goal g-desired-num-slinger > 0)
			(up-compare-goal g-desired-num-genitour > 0))
        =>
        (research ri-bodkin-arrow)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-bodkin-arrow == research-available)
        (up-compare-goal g-highest-tech-priority <= 4)
		(or
			(up-compare-goal g-desired-num-slinger > 0)
			(up-compare-goal g-desired-num-genitour > 0))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-bodkin-arrow c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 4)
		)
		
		;Check if we want to train unique units that require bodkin-arrow
        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-bodkin-arrow)
        (up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-unique-unit > 0)
		(or
			(goal g-temp-2 archery-class)			;unique unit is a foot archer
			(goal g-temp-2 cavalry-archer-class))	;unique unit is a cavalry archer
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-bodkin-arrow c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-bodkin-arrow)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-bodkin-arrow)
        (up-compare-goal g-highest-tech-priority <= 6)
		(up-compare-goal g-desired-num-unique-unit > 0)
		(or
			(goal g-temp-2 archery-class)			;unique unit is a foot archer
			(goal g-temp-2 cavalry-archer-class))	;unique unit is a cavalry archer
        =>
        (research ri-bodkin-arrow)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-bodkin-arrow == research-available)
        (up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-unique-unit > 0)
		(or
			(goal g-temp-2 archery-class)			;unique unit is a foot archer
			(goal g-temp-2 cavalry-archer-class))	;unique unit is a cavalry archer
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-bodkin-arrow c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 4)
		)
		
	;------------
	;	Bracer
	;------------

		(defrule
		(up-research-status c: ri-bracer != research-available)
		=>
		(up-jump-rule 9)
		)

		;Check if unique unit benefits from scale-barding
		(defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-bracer)
        (up-compare-goal g-highest-tech-priority <= 6)
		=>
		(up-get-object-type-data c: my-unique-unit object-data-class g-temp-2)
		)
		
		;Check if we want to train archery range units that require bracer
        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-bracer)
        (up-compare-goal g-highest-tech-priority <= 4)
		(or
			(up-compare-goal g-desired-num-archer > 0)
			(or
				(up-compare-goal g-desired-num-skirmisher > 0)
				(up-compare-goal g-desired-num-cavalry-archer > 0)))
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-bracer c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-bracer)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-bracer)
        (up-compare-goal g-highest-tech-priority <= 6)
		(or
			(up-compare-goal g-desired-num-archer > 0)
			(or
				(up-compare-goal g-desired-num-skirmisher > 0)
				(up-compare-goal g-desired-num-cavalry-archer > 0)))
        =>
        (research ri-bracer)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-bracer == research-available)
        (up-compare-goal g-highest-tech-priority <= 4)
		(or
			(up-compare-goal g-desired-num-archer > 0)
			(or
				(up-compare-goal g-desired-num-skirmisher > 0)
				(up-compare-goal g-desired-num-cavalry-archer > 0)))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-bracer c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 4)
		)
		
		;Check if we want to train unique archery range units that require bracer
        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-bracer)
        (up-compare-goal g-highest-tech-priority <= 4)
		(or
			(up-compare-goal g-desired-num-slinger > 0)
			(up-compare-goal g-desired-num-genitour > 0))
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-bracer c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-bracer)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-bracer)
        (up-compare-goal g-highest-tech-priority <= 6)
		(or
			(up-compare-goal g-desired-num-slinger > 0)
			(up-compare-goal g-desired-num-genitour > 0))
        =>
        (research ri-bracer)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-bracer == research-available)
        (up-compare-goal g-highest-tech-priority <= 4)
		(or
			(up-compare-goal g-desired-num-slinger > 0)
			(up-compare-goal g-desired-num-genitour > 0))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-bracer c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 4)
		)
		
		;Check if we want to train unique units that require bracer
        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-bracer)
        (up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-unique-unit > 0)
		(or
			(goal g-temp-2 archery-class)			;unique unit is a foot archer
			(goal g-temp-2 cavalry-archer-class))	;unique unit is a cavalry archer
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-bracer c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-bracer)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-bracer)
        (up-compare-goal g-highest-tech-priority <= 6)
		(up-compare-goal g-desired-num-unique-unit > 0)
		(or
			(goal g-temp-2 archery-class)			;unique unit is a foot archer
			(goal g-temp-2 cavalry-archer-class))	;unique unit is a cavalry archer
        =>
        (research ri-bracer)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-bracer == research-available)
        (up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-unique-unit > 0)
		(or
			(goal g-temp-2 archery-class)			;unique unit is a foot archer
			(goal g-temp-2 cavalry-archer-class))	;unique unit is a cavalry archer
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-bracer c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 4)
		)
		
	;-------------------------
	;	Scale Barding Armor
	;-------------------------

		(defrule
		(up-research-status c: ri-scale-barding != research-available)
		=>
		(up-jump-rule 9)
		)

		;Check if support or unique unit benefits from scale-barding
		(defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-scale-barding)
        (up-compare-goal g-highest-tech-priority <= 6)
		=>
		(up-get-object-type-data g: g-support-unit object-data-class g-temp)
		(up-get-object-type-data c: my-unique-unit object-data-class g-temp-2)
		)

        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-scale-barding)
        (up-compare-goal g-highest-tech-priority <= 4)
		(goal g-temp cavalry-class)			;support unit is cavalry
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-scale-barding c: 1)
		(up-modify-escrow food g:- g-food-cost)
        (up-research g-escrow c: ri-scale-barding)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-scale-barding)
        (up-compare-goal g-highest-tech-priority <= 6)
		(goal g-temp cavalry-class)			;support unit is cavalry
        =>
        (research ri-scale-barding)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-scale-barding == research-available)
        (up-compare-goal g-highest-tech-priority <= 4)
		(goal g-temp cavalry-class)			;support unit is cavalry
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-scale-barding c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-highest-tech-priority c:max 4)
		)
		
		;Check if we want to train stable units that require scale-barding
        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-scale-barding)
        (up-compare-goal g-highest-tech-priority <= 4)
		(or
			(up-compare-goal g-desired-num-scout-cavalry >= 12)
			(or
				(up-compare-goal g-desired-num-knight >= 10)
				(up-compare-goal g-desired-num-camel >= 10)))
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-scale-barding c: 1)
		(up-modify-escrow food g:- g-food-cost)
        (up-research g-escrow c: ri-scale-barding)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-scale-barding)
        (up-compare-goal g-highest-tech-priority <= 6)
		(or
			(up-compare-goal g-desired-num-scout-cavalry >= 12)
			(or
				(up-compare-goal g-desired-num-knight >= 10)
				(up-compare-goal g-desired-num-camel >= 10)))
        =>
        (research ri-scale-barding)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-scale-barding == research-available)
        (up-compare-goal g-highest-tech-priority <= 4)
		(or
			(up-compare-goal g-desired-num-scout-cavalry >= 12)
			(or
				(up-compare-goal g-desired-num-knight >= 10)
				(up-compare-goal g-desired-num-camel >= 10)))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-scale-barding c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-highest-tech-priority c:max 4)
		)
		
		;Check if we want to train unique stable units
        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-scale-barding)
        (up-compare-goal g-highest-tech-priority <= 4)
		(or
			(up-compare-goal g-desired-num-battle-elephant >= 8)
			(up-compare-goal g-desired-num-steppe-lancer >= 10))
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-scale-barding c: 1)
		(up-modify-escrow food g:- g-food-cost)
        (up-research g-escrow c: ri-scale-barding)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-scale-barding)
        (up-compare-goal g-highest-tech-priority <= 6)
		(or
			(up-compare-goal g-desired-num-battle-elephant >= 8)
			(up-compare-goal g-desired-num-steppe-lancer >= 10))
        =>
        (research ri-scale-barding)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-scale-barding == research-available)
        (up-compare-goal g-highest-tech-priority <= 4)
		(or
			(up-compare-goal g-desired-num-battle-elephant >= 8)
			(up-compare-goal g-desired-num-steppe-lancer >= 10))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-scale-barding c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-highest-tech-priority c:max 4)
		)
		
		;Check if we want to train unique units that require scale-barding
        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-scale-barding)
        (up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-unique-unit >= 10)
		(goal g-temp-2 cavalry-class)			
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-scale-barding c: 1)
		(up-modify-escrow food g:- g-food-cost)
        (up-research g-escrow c: ri-scale-barding)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-scale-barding)
        (up-compare-goal g-highest-tech-priority <= 6)
		(up-compare-goal g-desired-num-unique-unit >= 10)
		(goal g-temp-2 cavalry-class)	
        =>
        (research ri-scale-barding)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-scale-barding == research-available)
        (up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-unique-unit >= 10)
		(goal g-temp-2 cavalry-class)	
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-scale-barding c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-highest-tech-priority c:max 4)
		)
		
	;-------------------------
	;	Chain Barding Armor
	;-------------------------

		(defrule
		(up-research-status c: ri-chain-barding != research-available)
		=>
		(up-jump-rule 13)
		)

		;Check if support or unique unit benefits from chain-barding
		(defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-chain-barding)
        (up-compare-goal g-highest-tech-priority <= 6)
		=>
		(up-get-object-type-data g: g-support-unit object-data-class g-temp)
		(up-get-object-type-data c: my-unique-unit object-data-class g-temp-2)
		)

        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-chain-barding)
        (up-compare-goal g-highest-tech-priority <= 4)
		(goal g-temp cavalry-class)			;support unit is cavalry
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-chain-barding c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-chain-barding)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-chain-barding)
        (up-compare-goal g-highest-tech-priority <= 6)
		(goal g-temp cavalry-class)			;support unit is cavalry
        =>
        (research ri-chain-barding)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-chain-barding == research-available)
        (up-compare-goal g-highest-tech-priority <= 4)
		(goal g-temp cavalry-class)			;support unit is cavalry
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-chain-barding c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 4)
		)
		
		;Check if we want to train stable units that require chain-barding
        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-chain-barding)
        (up-compare-goal g-highest-tech-priority <= 4)
		(or
			(up-compare-goal g-desired-num-scout-cavalry >= 12)
			(or
				(up-compare-goal g-desired-num-knight >= 10)
				(up-compare-goal g-desired-num-camel >= 10)))
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-chain-barding c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-chain-barding)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-chain-barding)
        (up-compare-goal g-highest-tech-priority <= 6)
		(or
			(up-compare-goal g-desired-num-scout-cavalry >= 12)
			(or
				(up-compare-goal g-desired-num-knight >= 10)
				(up-compare-goal g-desired-num-camel >= 10)))
        =>
        (research ri-chain-barding)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-chain-barding == research-available)
        (up-compare-goal g-highest-tech-priority <= 4)
		(or
			(up-compare-goal g-desired-num-scout-cavalry >= 12)
			(or
				(up-compare-goal g-desired-num-knight >= 10)
				(up-compare-goal g-desired-num-camel >= 10)))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-chain-barding c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 4)
		)
		
		;Check if we want to train unique stable units
        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-chain-barding)
        (up-compare-goal g-highest-tech-priority <= 4)
		(or
			(up-compare-goal g-desired-num-battle-elephant >= 8)
			(up-compare-goal g-desired-num-steppe-lancer >= 10))
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-chain-barding c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-chain-barding)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-chain-barding)
        (up-compare-goal g-highest-tech-priority <= 6)
		(or
			(up-compare-goal g-desired-num-battle-elephant >= 8)
			(up-compare-goal g-desired-num-steppe-lancer >= 10))
        =>
        (research ri-chain-barding)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-chain-barding == research-available)
        (up-compare-goal g-highest-tech-priority <= 4)
		(or
			(up-compare-goal g-desired-num-battle-elephant >= 8)
			(up-compare-goal g-desired-num-steppe-lancer >= 10))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-chain-barding c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 4)
		)
		
		;Check if we want to train unique units that require chain-barding
        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-chain-barding)
        (up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-unique-unit >= 10)
		(goal g-temp-2 cavalry-class)			
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-chain-barding c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-chain-barding)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-chain-barding)
        (up-compare-goal g-highest-tech-priority <= 6)
		(up-compare-goal g-desired-num-unique-unit >= 10)
		(goal g-temp-2 cavalry-class)	
        =>
        (research ri-chain-barding)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-chain-barding == research-available)
        (up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-unique-unit >= 10)
		(goal g-temp-2 cavalry-class)	
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-chain-barding c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 4)
		)
		
	;-------------------------
	;	Plate Barding Armor
	;-------------------------

		(defrule
		(up-research-status c: ri-plate-barding != research-available)
		=>
		(up-jump-rule 13)
		)

		;Check if support or unique unit benefits from plate-barding
		(defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-plate-barding)
        (up-compare-goal g-highest-tech-priority <= 6)
		=>
		(up-get-object-type-data g: g-support-unit object-data-class g-temp)
		(up-get-object-type-data c: my-unique-unit object-data-class g-temp-2)
		)

        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-plate-barding)
        (up-compare-goal g-highest-tech-priority <= 4)
		(goal g-temp cavalry-class)			;support unit is cavalry
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-plate-barding c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-plate-barding)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-plate-barding)
        (up-compare-goal g-highest-tech-priority <= 6)
		(goal g-temp cavalry-class)			;support unit is cavalry
        =>
        (research ri-plate-barding)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-plate-barding == research-available)
        (up-compare-goal g-highest-tech-priority <= 4)
		(goal g-temp cavalry-class)			;support unit is cavalry
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-plate-barding c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 4)
		)
		
		;Check if we want to train stable units that require plate-barding
        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-plate-barding)
        (up-compare-goal g-highest-tech-priority <= 4)
		(or
			(up-compare-goal g-desired-num-scout-cavalry >= 12)
			(or
				(up-compare-goal g-desired-num-knight >= 10)
				(up-compare-goal g-desired-num-camel >= 10)))
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-plate-barding c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-plate-barding)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-plate-barding)
        (up-compare-goal g-highest-tech-priority <= 6)
		(or
			(up-compare-goal g-desired-num-scout-cavalry >= 12)
			(or
				(up-compare-goal g-desired-num-knight >= 10)
				(up-compare-goal g-desired-num-camel >= 10)))
        =>
        (research ri-plate-barding)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-plate-barding == research-available)
        (up-compare-goal g-highest-tech-priority <= 4)
		(or
			(up-compare-goal g-desired-num-scout-cavalry >= 12)
			(or
				(up-compare-goal g-desired-num-knight >= 10)
				(up-compare-goal g-desired-num-camel >= 10)))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-plate-barding c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 4)
		)
		
		;Check if we want to train unique stable units
        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-plate-barding)
        (up-compare-goal g-highest-tech-priority <= 4)
		(or
			(up-compare-goal g-desired-num-battle-elephant >= 8)
			(up-compare-goal g-desired-num-steppe-lancer >= 10))
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-plate-barding c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-plate-barding)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-plate-barding)
        (up-compare-goal g-highest-tech-priority <= 6)
		(or
			(up-compare-goal g-desired-num-battle-elephant >= 8)
			(up-compare-goal g-desired-num-steppe-lancer >= 10))
        =>
        (research ri-plate-barding)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-plate-barding == research-available)
        (up-compare-goal g-highest-tech-priority <= 4)
		(or
			(up-compare-goal g-desired-num-battle-elephant >= 8)
			(up-compare-goal g-desired-num-steppe-lancer >= 10))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-plate-barding c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 4)
		)
		
		;Check if we want to train unique units that require plate-barding
        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-plate-barding)
        (up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-unique-unit >= 10)
		(goal g-temp-2 cavalry-class)			
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-plate-barding c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-plate-barding)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-plate-barding)
        (up-compare-goal g-highest-tech-priority <= 6)
		(up-compare-goal g-desired-num-unique-unit >= 10)
		(goal g-temp-2 cavalry-class)	
        =>
        (research ri-plate-barding)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-plate-barding == research-available)
        (up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-unique-unit >= 10)
		(goal g-temp-2 cavalry-class)	
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-plate-barding c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 4)
		)
		
	;----------------------
	;	Scale Mail Armor
	;----------------------

		(defrule
		(up-research-status c: ri-scale-mail != research-available)
		=>
		(up-jump-rule 13)
		)

		;Check if support or unique unit benefits from scale-mail
		(defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-scale-mail)
        (up-compare-goal g-highest-tech-priority <= 6)
		=>
		(up-get-object-type-data g: g-support-unit object-data-class g-temp)
		(up-get-object-type-data c: my-unique-unit object-data-class g-temp-2)
		)

        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-scale-mail)
        (up-compare-goal g-highest-tech-priority <= 4)
		(goal g-temp infantry-class)			;support unit is infantry
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-scale-mail c: 1)
		(up-modify-escrow food g:- g-food-cost)
        (up-research g-escrow c: ri-scale-mail)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-scale-mail)
        (up-compare-goal g-highest-tech-priority <= 6)
		(goal g-temp infantry-class)			;support unit is infantry
        =>
        (research ri-scale-mail)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-scale-mail == research-available)
        (up-compare-goal g-highest-tech-priority <= 4)
		(goal g-temp infantry-class)			;support unit is infantry
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-scale-mail c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-highest-tech-priority c:max 4)
		)
		
		;Check if we want to train barracks units that require scale-mail
        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-scale-mail)
        (up-compare-goal g-highest-tech-priority <= 4)
		(or
			(up-compare-goal g-desired-num-militia >= 12)
			(or
				(up-compare-goal g-desired-num-spearman >= 14)
				(up-compare-goal g-desired-num-eagle-warrior >= 12)))
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-scale-mail c: 1)
		(up-modify-escrow food g:- g-food-cost)
        (up-research g-escrow c: ri-scale-mail)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-scale-mail)
        (up-compare-goal g-highest-tech-priority <= 6)
		(or
			(up-compare-goal g-desired-num-militia >= 12)
			(or
				(up-compare-goal g-desired-num-spearman >= 14)
				(up-compare-goal g-desired-num-eagle-warrior >= 12)))
        =>
        (research ri-scale-mail)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-scale-mail == research-available)
        (up-compare-goal g-highest-tech-priority <= 4)
		(or
			(up-compare-goal g-desired-num-militia >= 12)
			(or
				(up-compare-goal g-desired-num-spearman >= 14)
				(up-compare-goal g-desired-num-eagle-warrior >= 12)))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-scale-mail c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-highest-tech-priority c:max 4)
		)
		
		;Check if we want to train condottieros
        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-scale-mail)
        (up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-condottiero >= 12)
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-scale-mail c: 1)
		(up-modify-escrow food g:- g-food-cost)
        (up-research g-escrow c: ri-scale-mail)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-scale-mail)
        (up-compare-goal g-highest-tech-priority <= 6)
		(up-compare-goal g-desired-num-condottiero >= 12)
        =>
        (research ri-scale-mail)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-scale-mail == research-available)
        (up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-condottiero >= 12)
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-scale-mail c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-highest-tech-priority c:max 4)
		)
		
		;Check if we want to train unique units that require scale-mail
        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-scale-mail)
        (up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-unique-unit >= 10)
		(goal g-temp-2 infantry-class)		
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-scale-mail c: 1)
		(up-modify-escrow food g:- g-food-cost)
        (up-research g-escrow c: ri-scale-mail)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-scale-mail)
        (up-compare-goal g-highest-tech-priority <= 6)
		(up-compare-goal g-desired-num-unique-unit >= 10)
		(goal g-temp-2 infantry-class)		
        =>
        (research ri-scale-mail)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-scale-mail == research-available)
        (up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-unique-unit >= 10)
		(goal g-temp-2 infantry-class)	
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-scale-mail c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-highest-tech-priority c:max 4)
		)
		
	;----------------------
	;	Chain Mail Armor
	;----------------------

		(defrule
		(up-research-status c: ri-chain-mail != research-available)
		=>
		(up-jump-rule 13)
		)

		;Check if support or unique unit benefits from chain-mail
		(defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-chain-mail)
        (up-compare-goal g-highest-tech-priority <= 6)
		=>
		(up-get-object-type-data g: g-support-unit object-data-class g-temp)
		(up-get-object-type-data c: my-unique-unit object-data-class g-temp-2)
		)

        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-chain-mail)
        (up-compare-goal g-highest-tech-priority <= 4)
		(goal g-temp infantry-class)			;support unit is infantry
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-chain-mail c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-chain-mail)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-chain-mail)
        (up-compare-goal g-highest-tech-priority <= 6)
		(goal g-temp infantry-class)			;support unit is infantry
        =>
        (research ri-chain-mail)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-chain-mail == research-available)
        (up-compare-goal g-highest-tech-priority <= 4)
		(goal g-temp infantry-class)			;support unit is infantry
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-chain-mail c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 4)
		)
		
		;Check if we want to train barracks units that require chain-mail
        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-chain-mail)
        (up-compare-goal g-highest-tech-priority <= 4)
		(or
			(up-compare-goal g-desired-num-militia >= 12)
			(or
				(up-compare-goal g-desired-num-spearman >= 14)
				(up-compare-goal g-desired-num-eagle-warrior >= 12)))
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-chain-mail c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-chain-mail)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-chain-mail)
        (up-compare-goal g-highest-tech-priority <= 6)
		(or
			(up-compare-goal g-desired-num-militia >= 12)
			(or
				(up-compare-goal g-desired-num-spearman >= 14)
				(up-compare-goal g-desired-num-eagle-warrior >= 12)))
        =>
        (research ri-chain-mail)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-chain-mail == research-available)
        (up-compare-goal g-highest-tech-priority <= 4)
		(or
			(up-compare-goal g-desired-num-militia >= 12)
			(or
				(up-compare-goal g-desired-num-spearman >= 14)
				(up-compare-goal g-desired-num-eagle-warrior >= 12)))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-chain-mail c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 4)
		)
		
		;Check if we want to train condottieros
        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-chain-mail)
        (up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-condottiero >= 12)
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-chain-mail c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-chain-mail)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-chain-mail)
        (up-compare-goal g-highest-tech-priority <= 6)
		(up-compare-goal g-desired-num-condottiero >= 12)
        =>
        (research ri-chain-mail)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-chain-mail == research-available)
        (up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-condottiero >= 12)
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-chain-mail c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 4)
		)
		
		;Check if we want to train unique units that require chain-mail
        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-chain-mail)
        (up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-unique-unit >= 10)
		(goal g-temp-2 infantry-class)			
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-chain-mail c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-chain-mail)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-chain-mail)
        (up-compare-goal g-highest-tech-priority <= 6)
		(up-compare-goal g-desired-num-unique-unit >= 10)
		(goal g-temp-2 infantry-class)
        =>
        (research ri-chain-mail)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-chain-mail == research-available)
        (up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-unique-unit >= 10)
		(goal g-temp-2 infantry-class)
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-chain-mail c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 4)
		)
		
	;----------------------
	;	Plate Mail Armor
	;----------------------

		(defrule
		(up-research-status c: ri-plate-mail != research-available)
		=>
		(up-jump-rule 13)
		)

		;Check if support or unique unit benefits from plate-mail
		(defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-plate-mail)
        (up-compare-goal g-highest-tech-priority <= 6)
		=>
		(up-get-object-type-data g: g-support-unit object-data-class g-temp)
		(up-get-object-type-data c: my-unique-unit object-data-class g-temp-2)
		)

        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-plate-mail)
        (up-compare-goal g-highest-tech-priority <= 4)
		(goal g-temp infantry-class)			;support unit is infantry
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-plate-mail c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-plate-mail)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-plate-mail)
        (up-compare-goal g-highest-tech-priority <= 6)
		(goal g-temp infantry-class)			;support unit is infantry
        =>
        (research ri-plate-mail)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-plate-mail == research-available)
        (up-compare-goal g-highest-tech-priority <= 4)
		(goal g-temp infantry-class)			;support unit is infantry
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-plate-mail c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 4)
		)
		
		;Check if we want to train barracks units that require plate-mail
        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-plate-mail)
        (up-compare-goal g-highest-tech-priority <= 4)
		(or
			(up-compare-goal g-desired-num-militia >= 12)
			(or
				(up-compare-goal g-desired-num-spearman >= 14)
				(up-compare-goal g-desired-num-eagle-warrior >= 12)))
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-plate-mail c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-plate-mail)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-plate-mail)
        (up-compare-goal g-highest-tech-priority <= 6)
		(or
			(up-compare-goal g-desired-num-militia >= 12)
			(or
				(up-compare-goal g-desired-num-spearman >= 14)
				(up-compare-goal g-desired-num-eagle-warrior >= 12)))
        =>
        (research ri-plate-mail)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-plate-mail == research-available)
        (up-compare-goal g-highest-tech-priority <= 4)
		(or
			(up-compare-goal g-desired-num-militia >= 12)
			(or
				(up-compare-goal g-desired-num-spearman >= 14)
				(up-compare-goal g-desired-num-eagle-warrior >= 12)))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-plate-mail c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 4)
		)
		
		;Check if we want to train condottieros
        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-plate-mail)
        (up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-condottiero >= 12)
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-plate-mail c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-plate-mail)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-plate-mail)
        (up-compare-goal g-highest-tech-priority <= 6)
		(up-compare-goal g-desired-num-condottiero >= 12)
        =>
        (research ri-plate-mail)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-plate-mail == research-available)
        (up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-condottiero >= 12)
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-plate-mail c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 4)
		)
		
		;Check if we want to train unique units that require plate-mail
        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-plate-mail)
        (up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-unique-unit >= 10)
		(goal g-temp-2 infantry-class)			
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-plate-mail c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-plate-mail)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-plate-mail)
        (up-compare-goal g-highest-tech-priority <= 6)
		(up-compare-goal g-desired-num-unique-unit >= 10)
		(goal g-temp-2 infantry-class)
        =>
        (research ri-plate-mail)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-plate-mail == research-available)
        (up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-unique-unit >= 10)
		(goal g-temp-2 infantry-class)
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-plate-mail c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 4)
		)
		
	;-------------------------
	;	Padded Archer Armor
	;-------------------------

		(defrule
		(up-research-status c: ri-padded-archer-armor != research-available)
		=>
		(up-jump-rule 16)
		)

		;Check if support or unique unit benefits from padded-archer-armor
		(defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-padded-archer-armor)
        (up-compare-goal g-highest-tech-priority <= 6)
		=>
		(up-get-object-type-data g: g-support-unit object-data-class g-temp)
		(up-get-object-type-data c: my-unique-unit object-data-class g-temp-2)
		)

        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-padded-archer-armor)
        (up-compare-goal g-highest-tech-priority <= 4)
		(or
			(goal g-temp archery-class)
			(or
				(goal g-temp cavalry-archer-class)
				(goal g-temp archery-cannon-class)))
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-padded-archer-armor c: 1)
		(up-modify-escrow food g:- g-food-cost)
        (up-research g-escrow c: ri-padded-archer-armor)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-padded-archer-armor)
        (up-compare-goal g-highest-tech-priority <= 6)
		(or
			(goal g-temp archery-class)
			(or
				(goal g-temp cavalry-archer-class)
				(goal g-temp archery-cannon-class)))
        =>
        (research ri-padded-archer-armor)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-padded-archer-armor == research-available)
        (up-compare-goal g-highest-tech-priority <= 4)
		(or
			(goal g-temp archery-class)
			(or
				(goal g-temp cavalry-archer-class)
				(goal g-temp archery-cannon-class)))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-padded-archer-armor c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-highest-tech-priority c:max 4)
		)
		
		;Check if we want to train archery range units that require padded-archer-armor
        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-padded-archer-armor)
        (up-compare-goal g-highest-tech-priority <= 4)
		(or
			(up-compare-goal g-desired-num-archer >= 12)
			(or
				(up-compare-goal g-desired-num-skirmisher >= 14)
				(up-compare-goal g-desired-num-cavalry-archer >= 10)))
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-padded-archer-armor c: 1)
		(up-modify-escrow food g:- g-food-cost)
        (up-research g-escrow c: ri-padded-archer-armor)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-padded-archer-armor)
        (up-compare-goal g-highest-tech-priority <= 6)
		(or
			(up-compare-goal g-desired-num-archer >= 12)
			(or
				(up-compare-goal g-desired-num-skirmisher >= 14)
				(up-compare-goal g-desired-num-cavalry-archer >= 10)))
        =>
        (research ri-padded-archer-armor)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-padded-archer-armor == research-available)
        (up-compare-goal g-highest-tech-priority <= 4)
		(or
			(up-compare-goal g-desired-num-archer >= 12)
			(or
				(up-compare-goal g-desired-num-skirmisher >= 14)
				(up-compare-goal g-desired-num-cavalry-archer >= 10)))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-padded-archer-armor c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-highest-tech-priority c:max 4)
		)
		
		;Check if we want to train other archery range units
        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-padded-archer-armor)
        (up-compare-goal g-highest-tech-priority <= 4)
		(or
			(up-compare-goal g-desired-num-hand-cannoneer >= 12)
			(or
				(up-compare-goal g-desired-num-slinger >= 12)
				(up-compare-goal g-desired-num-genitour >= 12)))
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-padded-archer-armor c: 1)
		(up-modify-escrow food g:- g-food-cost)
        (up-research g-escrow c: ri-padded-archer-armor)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-padded-archer-armor)
        (up-compare-goal g-highest-tech-priority <= 6)
		(or
			(up-compare-goal g-desired-num-hand-cannoneer >= 12)
			(or
				(up-compare-goal g-desired-num-slinger >= 12)
				(up-compare-goal g-desired-num-genitour >= 12)))
        =>
        (research ri-padded-archer-armor)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-padded-archer-armor == research-available)
        (up-compare-goal g-highest-tech-priority <= 4)
		(or
			(up-compare-goal g-desired-num-hand-cannoneer >= 12)
			(or
				(up-compare-goal g-desired-num-slinger >= 12)
				(up-compare-goal g-desired-num-genitour >= 12)))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-padded-archer-armor c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-highest-tech-priority c:max 4)
		)
		
		;Check if we want to train unique units that require padded-archer-armor
        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-padded-archer-armor)
        (up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-unique-unit >= 10)
		(or
			(goal g-temp-2 archery-class)
			(goal g-temp-2 cavalry-archer-class))
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-padded-archer-armor c: 1)
		(up-modify-escrow food g:- g-food-cost)
        (up-research g-escrow c: ri-padded-archer-armor)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-padded-archer-armor)
        (up-compare-goal g-highest-tech-priority <= 6)
		(up-compare-goal g-desired-num-unique-unit >= 10)
		(or
			(goal g-temp-2 archery-class)
			(goal g-temp-2 cavalry-archer-class))
        =>
        (research ri-padded-archer-armor)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-padded-archer-armor == research-available)
        (up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-unique-unit >= 10)
		(or
			(goal g-temp-2 archery-class)
			(goal g-temp-2 cavalry-archer-class))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-padded-archer-armor c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-highest-tech-priority c:max 4)
		)
		
		;Check if we want to train unique units that require padded-archer-armor
        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-padded-archer-armor)
        (up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-unique-unit >= 10)
		(or
			(goal g-temp-2 archery-cannon-class)
			(goal g-temp-2 cavalry-cannon-class))
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-padded-archer-armor c: 1)
		(up-modify-escrow food g:- g-food-cost)
        (up-research g-escrow c: ri-padded-archer-armor)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-padded-archer-armor)
        (up-compare-goal g-highest-tech-priority <= 6)
		(up-compare-goal g-desired-num-unique-unit >= 10)
		(or
			(goal g-temp-2 archery-cannon-class)
			(goal g-temp-2 cavalry-cannon-class))
        =>
        (research ri-padded-archer-armor)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-padded-archer-armor == research-available)
        (up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-unique-unit >= 10)
		(or
			(goal g-temp-2 archery-cannon-class)
			(goal g-temp-2 cavalry-cannon-class))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-padded-archer-armor c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-highest-tech-priority c:max 4)
		)
		
	;--------------------------
	;	Leather Archer Armor
	;--------------------------

		(defrule
		(up-research-status c: ri-leather-archer-armor != research-available)
		=>
		(up-jump-rule 16)
		)

		;Check if support or unique unit benefits from leather-archer-armor
		(defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-leather-archer-armor)
        (up-compare-goal g-highest-tech-priority <= 6)
		=>
		(up-get-object-type-data g: g-support-unit object-data-class g-temp)
		(up-get-object-type-data c: my-unique-unit object-data-class g-temp-2)
		)

        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-leather-archer-armor)
        (up-compare-goal g-highest-tech-priority <= 4)
		(or
			(goal g-temp archery-class)
			(or
				(goal g-temp cavalry-archer-class)
				(goal g-temp archery-cannon-class)))
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-leather-archer-armor c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-leather-archer-armor)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-leather-archer-armor)
        (up-compare-goal g-highest-tech-priority <= 6)
		(or
			(goal g-temp archery-class)
			(or
				(goal g-temp cavalry-archer-class)
				(goal g-temp archery-cannon-class)))
        =>
        (research ri-leather-archer-armor)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-leather-archer-armor == research-available)
        (up-compare-goal g-highest-tech-priority <= 4)
		(or
			(goal g-temp archery-class)
			(or
				(goal g-temp cavalry-archer-class)
				(goal g-temp archery-cannon-class)))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-leather-archer-armor c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 4)
		)
		
		;Check if we want to train archery range units that require leather-archer-armor
        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-leather-archer-armor)
        (up-compare-goal g-highest-tech-priority <= 4)
		(or
			(up-compare-goal g-desired-num-archer >= 12)
			(or
				(up-compare-goal g-desired-num-skirmisher >= 14)
				(up-compare-goal g-desired-num-cavalry-archer >= 10)))
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-leather-archer-armor c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-leather-archer-armor)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-leather-archer-armor)
        (up-compare-goal g-highest-tech-priority <= 6)
		(or
			(up-compare-goal g-desired-num-archer >= 12)
			(or
				(up-compare-goal g-desired-num-skirmisher >= 14)
				(up-compare-goal g-desired-num-cavalry-archer >= 10)))
        =>
        (research ri-leather-archer-armor)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-leather-archer-armor == research-available)
        (up-compare-goal g-highest-tech-priority <= 4)
		(or
			(up-compare-goal g-desired-num-archer >= 12)
			(or
				(up-compare-goal g-desired-num-skirmisher >= 14)
				(up-compare-goal g-desired-num-cavalry-archer >= 10)))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-leather-archer-armor c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 4)
		)
		
		;Check if we want to train other archery range units
        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-leather-archer-armor)
        (up-compare-goal g-highest-tech-priority <= 4)
		(or
			(up-compare-goal g-desired-num-hand-cannoneer >= 12)
			(or
				(up-compare-goal g-desired-num-slinger >= 12)
				(up-compare-goal g-desired-num-genitour >= 12)))
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-leather-archer-armor c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-leather-archer-armor)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-leather-archer-armor)
        (up-compare-goal g-highest-tech-priority <= 6)
		(or
			(up-compare-goal g-desired-num-hand-cannoneer >= 12)
			(or
				(up-compare-goal g-desired-num-slinger >= 12)
				(up-compare-goal g-desired-num-genitour >= 12)))
        =>
        (research ri-leather-archer-armor)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-leather-archer-armor == research-available)
        (up-compare-goal g-highest-tech-priority <= 4)
		(or
			(up-compare-goal g-desired-num-hand-cannoneer >= 12)
			(or
				(up-compare-goal g-desired-num-slinger >= 12)
				(up-compare-goal g-desired-num-genitour >= 12)))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-leather-archer-armor c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 4)
		)
		
		;Check if we want to train unique units that require leather-archer-armor
        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-leather-archer-armor)
        (up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-unique-unit >= 10)
		(or
			(goal g-temp-2 archery-class)
			(goal g-temp-2 cavalry-archer-class))
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-leather-archer-armor c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-leather-archer-armor)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-leather-archer-armor)
        (up-compare-goal g-highest-tech-priority <= 6)
		(up-compare-goal g-desired-num-unique-unit >= 10)
		(or
			(goal g-temp-2 archery-class)
			(goal g-temp-2 cavalry-archer-class))
        =>
        (research ri-leather-archer-armor)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-leather-archer-armor == research-available)
        (up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-unique-unit >= 10)
		(or
			(goal g-temp-2 archery-class)
			(goal g-temp-2 cavalry-archer-class))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-leather-archer-armor c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 4)
		)
		
		;Check if we want to train unique units that require leather-archer-armor
        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-leather-archer-armor)
        (up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-unique-unit >= 10)
		(or
			(goal g-temp-2 archery-cannon-class)
			(goal g-temp-2 cavalry-cannon-class))
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-leather-archer-armor c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-leather-archer-armor)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-leather-archer-armor)
        (up-compare-goal g-highest-tech-priority <= 6)
		(up-compare-goal g-desired-num-unique-unit >= 10)
		(or
			(goal g-temp-2 archery-cannon-class)
			(goal g-temp-2 cavalry-cannon-class))
        =>
        (research ri-leather-archer-armor)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-leather-archer-armor == research-available)
        (up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-unique-unit >= 10)
		(or
			(goal g-temp-2 archery-cannon-class)
			(goal g-temp-2 cavalry-cannon-class))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-leather-archer-armor c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 4)
		)
		
	;-----------------------
	;	Ring Archer Armor
	;-----------------------

		(defrule
		(up-research-status c: ri-ring-archer-armor != research-available)
		=>
		(up-jump-rule 16)
		)

		;Check if support or unique unit benefits from ring-archer-armor
		(defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-ring-archer-armor)
        (up-compare-goal g-highest-tech-priority <= 6)
		=>
		(up-get-object-type-data g: g-support-unit object-data-class g-temp)
		(up-get-object-type-data c: my-unique-unit object-data-class g-temp-2)
		)

        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-ring-archer-armor)
        (up-compare-goal g-highest-tech-priority <= 4)
		(or
			(goal g-temp archery-class)
			(or
				(goal g-temp cavalry-archer-class)
				(goal g-temp archery-cannon-class)))
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-ring-archer-armor c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-ring-archer-armor)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-ring-archer-armor)
        (up-compare-goal g-highest-tech-priority <= 6)
		(or
			(goal g-temp archery-class)
			(or
				(goal g-temp cavalry-archer-class)
				(goal g-temp archery-cannon-class)))
        =>
        (research ri-ring-archer-armor)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-ring-archer-armor == research-available)
        (up-compare-goal g-highest-tech-priority <= 4)
		(or
			(goal g-temp archery-class)
			(or
				(goal g-temp cavalry-archer-class)
				(goal g-temp archery-cannon-class)))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-ring-archer-armor c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 4)
		)
		
		;Check if we want to train archery range units that require ring-archer-armor
        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-ring-archer-armor)
        (up-compare-goal g-highest-tech-priority <= 4)
		(or
			(up-compare-goal g-desired-num-archer >= 12)
			(or
				(up-compare-goal g-desired-num-skirmisher >= 14)
				(up-compare-goal g-desired-num-cavalry-archer >= 10)))
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-ring-archer-armor c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-ring-archer-armor)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-ring-archer-armor)
        (up-compare-goal g-highest-tech-priority <= 6)
		(or
			(up-compare-goal g-desired-num-archer >= 12)
			(or
				(up-compare-goal g-desired-num-skirmisher >= 14)
				(up-compare-goal g-desired-num-cavalry-archer >= 10)))
        =>
        (research ri-ring-archer-armor)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-ring-archer-armor == research-available)
        (up-compare-goal g-highest-tech-priority <= 4)
		(or
			(up-compare-goal g-desired-num-archer >= 12)
			(or
				(up-compare-goal g-desired-num-skirmisher >= 14)
				(up-compare-goal g-desired-num-cavalry-archer >= 10)))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-ring-archer-armor c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 4)
		)
		
		;Check if we want to train other archery range units
        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-ring-archer-armor)
        (up-compare-goal g-highest-tech-priority <= 4)
		(or
			(up-compare-goal g-desired-num-hand-cannoneer >= 12)
			(or
				(up-compare-goal g-desired-num-slinger >= 12)
				(up-compare-goal g-desired-num-genitour >= 12)))
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-ring-archer-armor c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-ring-archer-armor)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-ring-archer-armor)
        (up-compare-goal g-highest-tech-priority <= 6)
		(or
			(up-compare-goal g-desired-num-hand-cannoneer >= 12)
			(or
				(up-compare-goal g-desired-num-slinger >= 12)
				(up-compare-goal g-desired-num-genitour >= 12)))
        =>
        (research ri-ring-archer-armor)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-ring-archer-armor == research-available)
        (up-compare-goal g-highest-tech-priority <= 4)
		(or
			(up-compare-goal g-desired-num-hand-cannoneer >= 12)
			(or
				(up-compare-goal g-desired-num-slinger >= 12)
				(up-compare-goal g-desired-num-genitour >= 12)))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-ring-archer-armor c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 4)
		)
		
		;Check if we want to train unique units that require ring-archer-armor
        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-ring-archer-armor)
        (up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-unique-unit >= 10)
		(or
			(goal g-temp-2 archery-class)
			(goal g-temp-2 cavalry-archer-class))
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-ring-archer-armor c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-ring-archer-armor)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-ring-archer-armor)
        (up-compare-goal g-highest-tech-priority <= 6)
		(up-compare-goal g-desired-num-unique-unit >= 10)
		(or
			(goal g-temp-2 archery-class)
			(goal g-temp-2 cavalry-archer-class))
        =>
        (research ri-ring-archer-armor)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-ring-archer-armor == research-available)
        (up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-unique-unit >= 10)
		(or
			(goal g-temp-2 archery-class)
			(goal g-temp-2 cavalry-archer-class))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-ring-archer-armor c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 4)
		)
		
		;Check if we want to train unique units that require ring-archer-armor
        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-ring-archer-armor)
        (up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-unique-unit >= 10)
		(or
			(goal g-temp-2 archery-cannon-class)
			(goal g-temp-2 cavalry-cannon-class))
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-ring-archer-armor c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-ring-archer-armor)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-ring-archer-armor)
        (up-compare-goal g-highest-tech-priority <= 6)
		(up-compare-goal g-desired-num-unique-unit >= 10)
		(or
			(goal g-temp-2 archery-cannon-class)
			(goal g-temp-2 cavalry-cannon-class))
        =>
        (research ri-ring-archer-armor)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-ring-archer-armor == research-available)
        (up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-unique-unit >= 10)
		(or
			(goal g-temp-2 archery-cannon-class)
			(goal g-temp-2 cavalry-cannon-class))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-ring-archer-armor c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 4)
		)
		
	;-------------
	;	Forging
	;-------------

		(defrule
		(up-research-status c: ri-forging != research-available)
		=>
		(up-jump-rule 13)
		)

		;Check if support or unique unit benefits from forging
		(defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-forging)
        (up-compare-goal g-highest-tech-priority <= 6)
		=>
		(up-get-object-type-data g: g-support-unit object-data-class g-temp)
		(up-get-object-type-data c: my-unique-unit object-data-class g-temp-2)
		)

        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-forging)
        (up-compare-goal g-highest-tech-priority <= 4)
		(or
			(goal g-temp infantry-class)			;support unit is infantry
			(goal g-temp cavalry-class))			;support unit is cavalry
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-forging c: 1)
		(up-modify-escrow food g:- g-food-cost)
        (up-research g-escrow c: ri-forging)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-forging)
        (up-compare-goal g-highest-tech-priority <= 6)
		(or
			(goal g-temp infantry-class)			;support unit is infantry
			(goal g-temp cavalry-class))			;support unit is cavalry
        =>
        (research ri-forging)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-forging == research-available)
        (up-compare-goal g-highest-tech-priority <= 4)
		(or
			(goal g-temp infantry-class)			;support unit is infantry
			(goal g-temp cavalry-class))			;support unit is cavalry
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-forging c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-highest-tech-priority c:max 4)
		)
		
		;Check if we want to train barracks units that require forging
        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-forging)
        (up-compare-goal g-highest-tech-priority <= 4)
		(or
			(up-compare-goal g-desired-num-militia >= 12)
			(or
				(up-compare-goal g-desired-num-spearman >= 14)
				(up-compare-goal g-desired-num-eagle-warrior >= 12)))
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-forging c: 1)
		(up-modify-escrow food g:- g-food-cost)
        (up-research g-escrow c: ri-forging)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-forging)
        (up-compare-goal g-highest-tech-priority <= 6)
		(or
			(up-compare-goal g-desired-num-militia >= 12)
			(or
				(up-compare-goal g-desired-num-spearman >= 14)
				(up-compare-goal g-desired-num-eagle-warrior >= 12)))
        =>
        (research ri-forging)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-forging == research-available)
        (up-compare-goal g-highest-tech-priority <= 4)
		(or
			(up-compare-goal g-desired-num-militia >= 12)
			(or
				(up-compare-goal g-desired-num-spearman >= 14)
				(up-compare-goal g-desired-num-eagle-warrior >= 12)))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-forging c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-highest-tech-priority c:max 4)
		)
		
		;Check if we want to train stable units that require forging
        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-forging)
        (up-compare-goal g-highest-tech-priority <= 4)
		(or
			(up-compare-goal g-desired-num-scout-cavalry >= 12)
			(or
				(up-compare-goal g-desired-num-knight >= 12)
				(up-compare-goal g-desired-num-camel >= 12)))
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-forging c: 1)
		(up-modify-escrow food g:- g-food-cost)
        (up-research g-escrow c: ri-forging)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-forging)
        (up-compare-goal g-highest-tech-priority <= 6)
		(current-age >= castle-age)
		(or
			(up-compare-goal g-desired-num-scout-cavalry >= 12)
			(or
				(up-compare-goal g-desired-num-knight >= 12)
				(up-compare-goal g-desired-num-camel >= 12)))
        =>
        (research ri-forging)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-forging == research-available)
        (up-compare-goal g-highest-tech-priority <= 4)
		(or
			(up-compare-goal g-desired-num-scout-cavalry >= 12)
			(or
				(up-compare-goal g-desired-num-knight >= 12)
				(up-compare-goal g-desired-num-camel >= 12)))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-forging c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-highest-tech-priority c:max 4)
		)
		
		;Check if we want to train unique barracks/stable units that require forging
        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-forging)
        (up-compare-goal g-highest-tech-priority <= 4)
		(or
			(up-compare-goal g-desired-num-condottiero >= 12)
			(or
				(up-compare-goal g-desired-num-battle-elephant >= 10)
				(up-compare-goal g-desired-num-steppe-lancer >= 12)))
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-forging c: 1)
		(up-modify-escrow food g:- g-food-cost)
        (up-research g-escrow c: ri-forging)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-forging)
        (up-compare-goal g-highest-tech-priority <= 6)
		(or
			(up-compare-goal g-desired-num-condottiero >= 12)
			(or
				(up-compare-goal g-desired-num-battle-elephant >= 10)
				(up-compare-goal g-desired-num-steppe-lancer >= 12)))
        =>
        (research ri-forging)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-forging == research-available)
        (up-compare-goal g-highest-tech-priority <= 4)
		(or
			(up-compare-goal g-desired-num-condottiero >= 12)
			(or
				(up-compare-goal g-desired-num-battle-elephant >= 10)
				(up-compare-goal g-desired-num-steppe-lancer >= 12)))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-forging c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-highest-tech-priority c:max 4)
		)
		
		;Check if we want to train unique units that require forging
        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-forging)
        (up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-unique-unit >= 10)
		(or
			(goal g-temp-2 infantry-class)			;support unit is infantry
			(goal g-temp-2 cavalry-class))			;support unit is cavalry
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-forging c: 1)
		(up-modify-escrow food g:- g-food-cost)
        (up-research g-escrow c: ri-forging)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-forging)
        (up-compare-goal g-highest-tech-priority <= 6)
		(up-compare-goal g-desired-num-unique-unit >= 10)
		(or
			(goal g-temp-2 infantry-class)			;support unit is infantry
			(goal g-temp-2 cavalry-class))			;support unit is cavalry
        =>
        (research ri-forging)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-forging == research-available)
        (up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-unique-unit >= 10)
		(or
			(goal g-temp-2 infantry-class)			;support unit is infantry
			(goal g-temp-2 cavalry-class))			;support unit is cavalry
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-forging c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-highest-tech-priority c:max 4)
		)
		
	;------------------
	;	Iron Casting
	;------------------

		(defrule
		(up-research-status c: ri-iron-casting != research-available)
		=>
		(up-jump-rule 13)
		)

		;Check if support or unique unit benefits from iron-casting
		(defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-iron-casting)
        (up-compare-goal g-highest-tech-priority <= 6)
		=>
		(up-get-object-type-data g: g-support-unit object-data-class g-temp)
		(up-get-object-type-data c: my-unique-unit object-data-class g-temp-2)
		)

        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-iron-casting)
        (up-compare-goal g-highest-tech-priority <= 4)
		(or
			(goal g-temp infantry-class)			;support unit is infantry
			(goal g-temp cavalry-class))			;support unit is cavalry
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-iron-casting c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-iron-casting)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-iron-casting)
        (up-compare-goal g-highest-tech-priority <= 6)
		(or
			(goal g-temp infantry-class)			;support unit is infantry
			(goal g-temp cavalry-class))			;support unit is cavalry
        =>
        (research ri-iron-casting)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-iron-casting == research-available)
        (up-compare-goal g-highest-tech-priority <= 4)
		(or
			(goal g-temp infantry-class)			;support unit is infantry
			(goal g-temp cavalry-class))			;support unit is cavalry
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-iron-casting c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 4)
		)
		
		;Check if we want to train barracks units that require iron-casting
        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-iron-casting)
        (up-compare-goal g-highest-tech-priority <= 4)
		(or
			(up-compare-goal g-desired-num-militia >= 12)
			(or
				(up-compare-goal g-desired-num-spearman >= 14)
				(up-compare-goal g-desired-num-eagle-warrior >= 12)))
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-iron-casting c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-iron-casting)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-iron-casting)
        (up-compare-goal g-highest-tech-priority <= 6)
		(or
			(up-compare-goal g-desired-num-militia >= 12)
			(or
				(up-compare-goal g-desired-num-spearman >= 14)
				(up-compare-goal g-desired-num-eagle-warrior >= 12)))
        =>
        (research ri-iron-casting)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-iron-casting == research-available)
        (up-compare-goal g-highest-tech-priority <= 4)
		(or
			(up-compare-goal g-desired-num-militia >= 12)
			(or
				(up-compare-goal g-desired-num-spearman >= 14)
				(up-compare-goal g-desired-num-eagle-warrior >= 12)))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-iron-casting c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 4)
		)
		
		;Check if we want to train stable units that require iron-casting
        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-iron-casting)
        (up-compare-goal g-highest-tech-priority <= 4)
		(or
			(up-compare-goal g-desired-num-scout-cavalry >= 12)
			(or
				(up-compare-goal g-desired-num-knight >= 12)
				(up-compare-goal g-desired-num-camel >= 12)))
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-iron-casting c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-iron-casting)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-iron-casting)
        (up-compare-goal g-highest-tech-priority <= 6)
		(current-age >= castle-age)
		(or
			(up-compare-goal g-desired-num-scout-cavalry >= 12)
			(or
				(up-compare-goal g-desired-num-knight >= 12)
				(up-compare-goal g-desired-num-camel >= 12)))
        =>
        (research ri-iron-casting)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-iron-casting == research-available)
        (up-compare-goal g-highest-tech-priority <= 4)
		(or
			(up-compare-goal g-desired-num-scout-cavalry >= 12)
			(or
				(up-compare-goal g-desired-num-knight >= 12)
				(up-compare-goal g-desired-num-camel >= 12)))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-iron-casting c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 4)
		)
		
		;Check if we want to train unique barracks/stable units that require iron-casting
        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-iron-casting)
        (up-compare-goal g-highest-tech-priority <= 4)
		(or
			(up-compare-goal g-desired-num-condottiero >= 12)
			(or
				(up-compare-goal g-desired-num-battle-elephant >= 10)
				(up-compare-goal g-desired-num-steppe-lancer >= 12)))
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-iron-casting c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-iron-casting)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-iron-casting)
        (up-compare-goal g-highest-tech-priority <= 6)
		(or
			(up-compare-goal g-desired-num-condottiero >= 12)
			(or
				(up-compare-goal g-desired-num-battle-elephant >= 10)
				(up-compare-goal g-desired-num-steppe-lancer >= 12)))
        =>
        (research ri-iron-casting)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-iron-casting == research-available)
        (up-compare-goal g-highest-tech-priority <= 4)
		(or
			(up-compare-goal g-desired-num-condottiero >= 12)
			(or
				(up-compare-goal g-desired-num-battle-elephant >= 10)
				(up-compare-goal g-desired-num-steppe-lancer >= 12)))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-iron-casting c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 4)
		)
		
		;Check if we want to train unique units that require iron-casting
        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-iron-casting)
        (up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-unique-unit >= 10)
		(or
			(goal g-temp-2 infantry-class)			;support unit is infantry
			(goal g-temp-2 cavalry-class))			;support unit is cavalry
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-iron-casting c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-iron-casting)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-iron-casting)
        (up-compare-goal g-highest-tech-priority <= 6)
		(up-compare-goal g-desired-num-unique-unit >= 10)
		(or
			(goal g-temp-2 infantry-class)			;support unit is infantry
			(goal g-temp-2 cavalry-class))			;support unit is cavalry
        =>
        (research ri-iron-casting)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-iron-casting == research-available)
        (up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-unique-unit >= 10)
		(or
			(goal g-temp-2 infantry-class)			;support unit is infantry
			(goal g-temp-2 cavalry-class))			;support unit is cavalry
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-iron-casting c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 4)
		)
		
	;-------------------
	;	Blast Furnace
	;-------------------

		(defrule
		(up-research-status c: ri-blast-furnace != research-available)
		=>
		(up-jump-rule 13)
		)

		;Check if support or unique unit benefits from blast-furnace
		(defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-blast-furnace)
        (up-compare-goal g-highest-tech-priority <= 6)
		=>
		(up-get-object-type-data g: g-support-unit object-data-class g-temp)
		(up-get-object-type-data c: my-unique-unit object-data-class g-temp-2)
		)

        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-blast-furnace)
        (up-compare-goal g-highest-tech-priority <= 4)
		(or
			(goal g-temp infantry-class)			;support unit is infantry
			(goal g-temp cavalry-class))			;support unit is cavalry
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-blast-furnace c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-blast-furnace)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-blast-furnace)
        (up-compare-goal g-highest-tech-priority <= 6)
		(or
			(goal g-temp infantry-class)			;support unit is infantry
			(goal g-temp cavalry-class))			;support unit is cavalry
        =>
        (research ri-blast-furnace)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-blast-furnace == research-available)
        (up-compare-goal g-highest-tech-priority <= 4)
		(or
			(goal g-temp infantry-class)			;support unit is infantry
			(goal g-temp cavalry-class))			;support unit is cavalry
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-blast-furnace c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 4)
		)
		
		;Check if we want to train barracks units that require blast-furnace
        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-blast-furnace)
        (up-compare-goal g-highest-tech-priority <= 4)
		(or
			(up-compare-goal g-desired-num-militia >= 12)
			(or
				(up-compare-goal g-desired-num-spearman >= 14)
				(up-compare-goal g-desired-num-eagle-warrior >= 12)))
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-blast-furnace c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-blast-furnace)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-blast-furnace)
        (up-compare-goal g-highest-tech-priority <= 6)
		(or
			(up-compare-goal g-desired-num-militia >= 12)
			(or
				(up-compare-goal g-desired-num-spearman >= 14)
				(up-compare-goal g-desired-num-eagle-warrior >= 12)))
        =>
        (research ri-blast-furnace)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-blast-furnace == research-available)
        (up-compare-goal g-highest-tech-priority <= 4)
		(or
			(up-compare-goal g-desired-num-militia >= 12)
			(or
				(up-compare-goal g-desired-num-spearman >= 14)
				(up-compare-goal g-desired-num-eagle-warrior >= 12)))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-blast-furnace c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 4)
		)
		
		;Check if we want to train stable units that require blast-furnace
        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-blast-furnace)
        (up-compare-goal g-highest-tech-priority <= 4)
		(or
			(up-compare-goal g-desired-num-scout-cavalry >= 12)
			(or
				(up-compare-goal g-desired-num-knight >= 12)
				(up-compare-goal g-desired-num-camel >= 12)))
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-blast-furnace c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-blast-furnace)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-blast-furnace)
        (up-compare-goal g-highest-tech-priority <= 6)
		(current-age >= castle-age)
		(or
			(up-compare-goal g-desired-num-scout-cavalry >= 12)
			(or
				(up-compare-goal g-desired-num-knight >= 12)
				(up-compare-goal g-desired-num-camel >= 12)))
        =>
        (research ri-blast-furnace)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-blast-furnace == research-available)
        (up-compare-goal g-highest-tech-priority <= 4)
		(or
			(up-compare-goal g-desired-num-scout-cavalry >= 12)
			(or
				(up-compare-goal g-desired-num-knight >= 12)
				(up-compare-goal g-desired-num-camel >= 12)))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-blast-furnace c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 4)
		)
		
		;Check if we want to train unique barracks/stable units that require blast-furnace
        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-blast-furnace)
        (up-compare-goal g-highest-tech-priority <= 4)
		(or
			(up-compare-goal g-desired-num-condottiero >= 12)
			(or
				(up-compare-goal g-desired-num-battle-elephant >= 10)
				(up-compare-goal g-desired-num-steppe-lancer >= 12)))
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-blast-furnace c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-blast-furnace)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-blast-furnace)
        (up-compare-goal g-highest-tech-priority <= 6)
		(or
			(up-compare-goal g-desired-num-condottiero >= 12)
			(or
				(up-compare-goal g-desired-num-battle-elephant >= 10)
				(up-compare-goal g-desired-num-steppe-lancer >= 12)))
        =>
        (research ri-blast-furnace)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-blast-furnace == research-available)
        (up-compare-goal g-highest-tech-priority <= 4)
		(or
			(up-compare-goal g-desired-num-condottiero >= 12)
			(or
				(up-compare-goal g-desired-num-battle-elephant >= 10)
				(up-compare-goal g-desired-num-steppe-lancer >= 12)))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-blast-furnace c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 4)
		)
		
		;Check if we want to train unique units that require blast-furnace
        (defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-blast-furnace)
        (up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-unique-unit >= 10)
		(or
			(goal g-temp-2 infantry-class)			;support unit is infantry
			(goal g-temp-2 cavalry-class))			;support unit is cavalry
        =>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-blast-furnace c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
        (up-research g-escrow c: ri-blast-furnace)
        )

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-blast-furnace)
        (up-compare-goal g-highest-tech-priority <= 6)
		(up-compare-goal g-desired-num-unique-unit >= 10)
		(or
			(goal g-temp-2 infantry-class)			;support unit is infantry
			(goal g-temp-2 cavalry-class))			;support unit is cavalry
        =>
        (research ri-blast-furnace)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-blast-furnace == research-available)
        (up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-unique-unit >= 10)
		(or
			(goal g-temp-2 infantry-class)			;support unit is infantry
			(goal g-temp-2 cavalry-class))			;support unit is cavalry
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-blast-furnace c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 4)
		)

	#load-if-defined DE-AVAILABLE

		;--------------
		;	Supplies
		;--------------

			(defrule
			(up-research-status c: ri-supplies != research-available)
			=>
			(up-jump-rule 3)
			)

			(defrule
			(goal g-first-attack-launched YES)
			(can-research-with-escrow ri-supplies)
			(up-compare-goal g-highest-tech-priority <= 4)
			(up-compare-goal g-desired-num-militia >= 6)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-supplies c: 1)
			(up-modify-escrow food g:- g-food-cost)
			(up-modify-escrow gold g:- g-gold-cost)
			(up-research g-escrow c: ri-supplies)
			)

			(defrule
			(goal g-first-attack-launched YES)
			(can-research ri-supplies)
			(up-compare-goal g-highest-tech-priority <= 6)
			(up-compare-goal g-desired-num-militia >= 6)
			=>
			(research ri-supplies)
			)

			(defrule
			(goal g-first-attack-launched YES)
			(up-research-status c: ri-supplies == research-available)
			(up-compare-goal g-highest-tech-priority <= 4)
			(up-compare-goal g-desired-num-militia >= 6)
			(building-type-count barracks > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-supplies c: 1)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			(up-modify-goal g-highest-tech-priority c:max 4)
			)

	#end-if

	;----------------
	;	Bloodlines
	;----------------

		(defrule
		(up-research-status c: ri-bloodlines != research-available)
		=>
		(up-jump-rule 3)
		)

		(defrule
		(goal g-first-attack-launched YES)
		(can-research-with-escrow ri-bloodlines)
		(up-compare-goal g-highest-tech-priority <= 4)
		(or
			(up-compare-goal g-desired-num-cavalry >= 10)
			(up-compare-goal g-desired-num-cavalry-archers >= 10))
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-bloodlines c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
		(up-research g-escrow c: ri-bloodlines)
		)

		(defrule
		(goal g-first-attack-launched YES)
		(can-research ri-bloodlines)
		(up-compare-goal g-highest-tech-priority <= 6)
		(or
			(up-compare-goal g-desired-num-cavalry >= 10)
			(up-compare-goal g-desired-num-cavalry-archers >= 10))
		=>
		(research ri-bloodlines)
		)

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-bloodlines == research-available)
		(up-compare-goal g-highest-tech-priority <= 4)
		(or
			(up-compare-goal g-desired-num-cavalry >= 10)
			(up-compare-goal g-desired-num-cavalry-archers >= 10))
		(building-type-count stable > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-bloodlines c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 4)
		)

	;----------------
	;	Thumb Ring
	;----------------

		(defrule
		(up-research-status c: ri-thumb-ring != research-available)
		=>
		(up-jump-rule 3)
		)

		(defrule
		(goal g-first-attack-launched YES)
		(can-research-with-escrow ri-thumb-ring)
		(up-compare-goal g-highest-tech-priority <= 4)
		(or
			(up-compare-goal g-desired-num-foot-archers >= 10)
			(up-compare-goal g-desired-num-cavalry-archers >= 8))
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-thumb-ring c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow gold g:- g-gold-cost)
		(up-research g-escrow c: ri-thumb-ring)
		)

		(defrule
		(goal g-first-attack-launched YES)
		(can-research ri-thumb-ring)
		(up-compare-goal g-highest-tech-priority <= 6)
		(or
			(up-compare-goal g-desired-num-foot-archers >= 10)
			(up-compare-goal g-desired-num-cavalry-archers >= 8))
		=>
		(research ri-thumb-ring)
		)

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-thumb-ring == research-available)
		(up-compare-goal g-highest-tech-priority <= 4)
		(or
			(up-compare-goal g-desired-num-foot-archers >= 10)
			(up-compare-goal g-desired-num-cavalry-archers >= 8))
		(building-type-count archery-range > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-thumb-ring c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 4)
		)

	;----------------
	;	Ballistics
	;----------------

		(defrule
		(up-research-status c: ri-ballistics != research-available)
		=>
		(up-jump-rule 4)
		)

		(defrule
		(goal g-first-attack-launched YES)
		(can-research-with-escrow ri-ballistics)
		(up-compare-goal g-highest-tech-priority <= 4)
		(or
			(up-compare-goal g-desired-num-foot-archers >= 10)
			(up-compare-goal g-desired-num-cavalry-archers >= 10))
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-ballistics c: 1)
		(up-modify-escrow wood g:- g-wood-cost)
		(up-modify-escrow gold g:- g-gold-cost)
		(up-research g-escrow c: ri-ballistics)
		)

		(defrule
		(goal g-first-attack-launched YES)
		(can-research ri-ballistics)
		(up-compare-goal g-highest-tech-priority <= 6)
		(or
			(up-compare-goal g-desired-num-foot-archers >= 10)
			(up-compare-goal g-desired-num-cavalry-archers >= 10))
		=>
		(research ri-ballistics)
		)

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-ballistics == research-available)
		(up-compare-goal g-highest-tech-priority <= 4)
		(or
			(up-compare-goal g-desired-num-foot-archers >= 10)
			(up-compare-goal g-desired-num-cavalry-archers >= 10))
		(building-type-count university > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-ballistics c: 1)
		(up-modify-goal g-max-wood-needed g:max g-wood-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 4)
		(up-modify-goal g-desired-num-university c:max 1)
		)

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-ballistics == research-available)
		(up-compare-goal g-highest-tech-priority <= 4)
		(or
			(up-compare-goal g-desired-num-foot-archers >= 10)
			(up-compare-goal g-desired-num-cavalry-archers >= 10))
		(building-type-count university == 0)
		=>
		(up-modify-goal g-desired-num-university c:max 1)
		)

	;---------------------
	;	Siege Engineers
	;---------------------

		(defrule
		(up-research-status c: ri-siege-engineers != research-available)
		=>
		(up-jump-rule 4)
		)

		(defrule
		(goal g-first-attack-launched YES)
		(can-research-with-escrow ri-siege-engineers)
		(up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-siege >= 3)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-siege-engineers c: 1)
		(up-modify-escrow wood g:- g-wood-cost)
		(up-modify-escrow food g:- g-food-cost)
		(up-research g-escrow c: ri-siege-engineers)
		)

		(defrule
		(goal g-first-attack-launched YES)
		(can-research ri-siege-engineers)
		(up-compare-goal g-highest-tech-priority <= 6)
		(up-compare-goal g-desired-num-siege >= 3)
		=>
		(research ri-siege-engineers)
		)

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-siege-engineers == research-available)
		(up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-siege >= 3)
		(building-type-count university > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-siege-engineers c: 1)
		(up-modify-goal g-max-wood-needed g:max g-wood-cost)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-highest-tech-priority c:max 4)
		(up-modify-goal g-desired-num-university c:max 1)
		)

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-siege-engineers == research-available)
		(up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-siege >= 3)
		(building-type-count university == 0)
		=>
		(up-modify-goal g-desired-num-university c:max 1)
		)

	;-----------------
	;	Gold Mining
	;-----------------

		(defrule
		(up-research-status c: ri-gold-mining != research-available)
		=>
		(up-jump-rule 3)
		)

		(defrule
		(goal g-first-attack-launched YES)
		(can-research-with-escrow ri-gold-mining)
		(up-compare-goal g-highest-tech-priority <= 4)
		(unit-type-count villager-gold >= 6)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-gold-mining c: 1)
		(up-modify-escrow food g:- g-food-cost)
		(up-modify-escrow wood g:- g-wood-cost)
		(up-research g-escrow c: ri-gold-mining)
		)

		(defrule
		(goal g-first-attack-launched YES)
		(can-research ri-gold-mining)
		(up-compare-goal g-highest-tech-priority <= 6)
		(unit-type-count villager-gold >= 6)
		=>
		(research ri-gold-mining)
		)

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-gold-mining == research-available)
		(up-compare-goal g-highest-tech-priority <= 4)
		(unit-type-count villager-gold >= 6)
		(building-type-count mining-camp > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-gold-mining c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-wood-needed g:max g-wood-cost)
		(up-modify-goal g-highest-tech-priority c:max 4)
		)

	;---------------
	;	Atonement
	;---------------

		(defrule
		(up-research-status c: ri-atonement != research-available)
		=>
		(up-jump-rule 3)
		)

		(defrule
		(goal g-first-attack-launched YES)
		(can-research-with-escrow ri-atonement)
		(up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-monks >= 5)
		(up-compare-goal g-enemy-monks-count >= 5)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-atonement c: 1)
		(up-modify-escrow gold g:- g-gold-cost)
		(up-research g-escrow c: ri-atonement)
		)

		(defrule
		(goal g-first-attack-launched YES)
		(can-research ri-atonement)
		(up-compare-goal g-highest-tech-priority <= 6)
		(up-compare-goal g-desired-num-monks >= 5)
		(up-compare-goal g-enemy-monks-count >= 5)
		=>
		(research ri-atonement)
		)

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-atonement == research-available)
		(up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-monks >= 5)
		(up-compare-goal g-enemy-monks-count >= 5)
		(building-type-count archery-range > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-atonement c: 1)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 4)
		)

	;------------
	;	Fervor
	;------------

		(defrule
		(up-research-status c: ri-fervor != research-available)
		=>
		(up-jump-rule 3)
		)

		(defrule
		(goal g-first-attack-launched YES)
		(can-research-with-escrow ri-fervor)
		(up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-monks >= 5)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-fervor c: 1)
		(up-modify-escrow gold g:- g-gold-cost)
		(up-research g-escrow c: ri-fervor)
		)

		(defrule
		(goal g-first-attack-launched YES)
		(can-research ri-fervor)
		(up-compare-goal g-highest-tech-priority <= 6)
		(up-compare-goal g-desired-num-monks >= 5)
		=>
		(research ri-fervor)
		)

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-fervor == research-available)
		(up-compare-goal g-highest-tech-priority <= 4)
		(up-compare-goal g-desired-num-monks >= 5)
		(building-type-count archery-range > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-fervor c: 1)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 4)
		)

	;------------
	;	Escrow
	;------------

		(defrule
		(up-resource-amount amount-food g:< g-max-food-needed)    ;Need to escrow food
		(goal g-highest-tech-priority 4)
		=>
		(set-escrow-percentage food 12)
		)

		(defrule
		(up-resource-amount amount-wood g:< g-max-wood-needed)    ;Need to escrow wood
		(goal g-highest-tech-priority 4)
		=>
		(set-escrow-percentage wood 12)
		)

		(defrule
		(up-resource-amount amount-gold g:< g-max-gold-needed)    ;Need to escrow gold
		(goal g-highest-tech-priority 4)
		=>
		(set-escrow-percentage gold 12)
		)

		(defrule
		(up-resource-amount amount-stone g:< g-max-stone-needed)    ;Need to escrow stone
		(goal g-highest-tech-priority 4)
		=>
		(set-escrow-percentage stone 12)
		)

	;----------------
	;	Cap Escrow
	;----------------

		(defrule
		(up-compare-goal g-highest-tech-priority > 7)
		=>
		(up-modify-escrow food g:min g-total-food-needed)
		(up-modify-escrow wood g:min g-total-wood-needed)
		(up-modify-escrow stone g:min g-total-stone-needed)
		(up-modify-escrow gold g:min g-total-gold-needed)
		)

		(defrule
		(up-compare-goal g-highest-tech-priority <= 7)
		=>
		(up-modify-escrow food g:min g-max-food-needed)
		(up-modify-escrow wood g:min g-max-wood-needed)
		(up-modify-escrow stone g:min g-max-stone-needed)
		(up-modify-escrow gold g:min g-max-gold-needed)
		)

;=========================<>=========================
;				      PRIORITY 3
;=========================<>=========================
		
	;-------------------------
	;	Scale Barding Armor
	;-------------------------

		(defrule
		(up-research-status c: ri-scale-barding != research-available)
		=>
		(up-jump-rule 7)
		)

		;Check if unique unit benefits from scale-barding
		(defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-scale-barding)
        (up-compare-goal g-highest-tech-priority <= 5)
		=>
		(up-get-object-type-data c: my-unique-unit object-data-class g-temp-2)
		)
		
		;Check if we want to train stable units that require scale-barding
        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-scale-barding)
        (up-compare-goal g-highest-tech-priority <= 5)
		(or
			(up-compare-goal g-desired-num-scout-cavalry > 0)
			(or
				(up-compare-goal g-desired-num-knight > 0)
				(up-compare-goal g-desired-num-camel > 0)))
        =>
        (research ri-scale-barding)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-scale-barding == research-available)
        (up-compare-goal g-highest-tech-priority <= 3)
		(or
			(up-compare-goal g-desired-num-scout-cavalry > 0)
			(or
				(up-compare-goal g-desired-num-knight > 0)
				(up-compare-goal g-desired-num-camel > 0)))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-scale-barding c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-highest-tech-priority c:max 3)
		)
		
		;Check if we want to train unique stable units
        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-scale-barding)
        (up-compare-goal g-highest-tech-priority <= 5)
		(or
			(up-compare-goal g-desired-num-battle-elephant > 0)
			(up-compare-goal g-desired-num-steppe-lancer > 0))
        =>
        (research ri-scale-barding)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-scale-barding == research-available)
        (up-compare-goal g-highest-tech-priority <= 3)
		(or
			(up-compare-goal g-desired-num-battle-elephant > 0)
			(up-compare-goal g-desired-num-steppe-lancer > 0))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-scale-barding c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-highest-tech-priority c:max 3)
		)
		
		;Check if we want to train unique units that require scale-barding
        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-scale-barding)
        (up-compare-goal g-highest-tech-priority <= 5)
		(up-compare-goal g-desired-num-unique-unit >= 10)
		(goal g-temp-2 cavalry-class)	
        =>
        (research ri-scale-barding)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-scale-barding == research-available)
        (up-compare-goal g-highest-tech-priority <= 3)
		(up-compare-goal g-desired-num-unique-unit >= 10)
		(goal g-temp-2 cavalry-class)	
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-scale-barding c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-highest-tech-priority c:max 3)
		)
		
	;-------------------------
	;	Chain Barding Armor
	;-------------------------

		(defrule
		(up-research-status c: ri-chain-barding != research-available)
		=>
		(up-jump-rule 7)
		)

		;Check if unique unit benefits from chain-barding
		(defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-chain-barding)
        (up-compare-goal g-highest-tech-priority <= 5)
		=>
		(up-get-object-type-data c: my-unique-unit object-data-class g-temp-2)
		)
		
		;Check if we want to train stable units that require chain-barding
        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-chain-barding)
        (up-compare-goal g-highest-tech-priority <= 5)
		(or
			(up-compare-goal g-desired-num-scout-cavalry > 0)
			(or
				(up-compare-goal g-desired-num-knight > 0)
				(up-compare-goal g-desired-num-camel > 0)))
        =>
        (research ri-chain-barding)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-chain-barding == research-available)
        (up-compare-goal g-highest-tech-priority <= 3)
		(or
			(up-compare-goal g-desired-num-scout-cavalry > 0)
			(or
				(up-compare-goal g-desired-num-knight > 0)
				(up-compare-goal g-desired-num-camel > 0)))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-chain-barding c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 3)
		)
		
		;Check if we want to train unique stable units
        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-chain-barding)
        (up-compare-goal g-highest-tech-priority <= 5)
		(or
			(up-compare-goal g-desired-num-battle-elephant > 0)
			(up-compare-goal g-desired-num-steppe-lancer > 0))
        =>
        (research ri-chain-barding)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-chain-barding == research-available)
        (up-compare-goal g-highest-tech-priority <= 3)
		(or
			(up-compare-goal g-desired-num-battle-elephant > 0)
			(up-compare-goal g-desired-num-steppe-lancer > 0))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-chain-barding c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 3)
		)
		
		;Check if we want to train unique units that require chain-barding
        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-chain-barding)
        (up-compare-goal g-highest-tech-priority <= 5)
		(up-compare-goal g-desired-num-unique-unit > 0)
		(goal g-temp-2 cavalry-class)	
        =>
        (research ri-chain-barding)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-chain-barding == research-available)
        (up-compare-goal g-highest-tech-priority <= 3)
		(up-compare-goal g-desired-num-unique-unit > 0)
		(goal g-temp-2 cavalry-class)	
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-chain-barding c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 3)
		)
		
	;-------------------------
	;	Plate Barding Armor
	;-------------------------

		(defrule
		(up-research-status c: ri-plate-barding != research-available)
		=>
		(up-jump-rule 7)
		)

		;Check if unique unit benefits from plate-barding
		(defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-plate-barding)
        (up-compare-goal g-highest-tech-priority <= 5)
		=>
		(up-get-object-type-data c: my-unique-unit object-data-class g-temp-2)
		)

		;Check if we want to train stable units that require plate-barding
        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-plate-barding)
        (up-compare-goal g-highest-tech-priority <= 5)
		(or
			(up-compare-goal g-desired-num-scout-cavalry > 0)
			(or
				(up-compare-goal g-desired-num-knight > 0)
				(up-compare-goal g-desired-num-camel > 0)))
        =>
        (research ri-plate-barding)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-plate-barding == research-available)
        (up-compare-goal g-highest-tech-priority <= 3)
		(or
			(up-compare-goal g-desired-num-scout-cavalry > 0)
			(or
				(up-compare-goal g-desired-num-knight > 0)
				(up-compare-goal g-desired-num-camel > 0)))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-plate-barding c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 3)
		)
		
		;Check if we want to train unique stable units
        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-plate-barding)
        (up-compare-goal g-highest-tech-priority <= 5)
		(or
			(up-compare-goal g-desired-num-battle-elephant > 0)
			(up-compare-goal g-desired-num-steppe-lancer > 0))
        =>
        (research ri-plate-barding)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-plate-barding == research-available)
        (up-compare-goal g-highest-tech-priority <= 3)
		(or
			(up-compare-goal g-desired-num-battle-elephant > 0)
			(up-compare-goal g-desired-num-steppe-lancer > 0))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-plate-barding c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 3)
		)
		
		;Check if we want to train unique units that require plate-barding
        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-plate-barding)
        (up-compare-goal g-highest-tech-priority <= 5)
		(up-compare-goal g-desired-num-unique-unit > 0)
		(goal g-temp-2 cavalry-class)	
        =>
        (research ri-plate-barding)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-plate-barding == research-available)
        (up-compare-goal g-highest-tech-priority <= 3)
		(up-compare-goal g-desired-num-unique-unit > 0)
		(goal g-temp-2 cavalry-class)	
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-plate-barding c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 3)
		)
		
	;----------------------
	;	Scale Mail Armor
	;----------------------

		(defrule
		(up-research-status c: ri-scale-mail != research-available)
		=>
		(up-jump-rule 7)
		)

		;Check if unique unit benefits from scale-mail
		(defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-scale-mail)
        (up-compare-goal g-highest-tech-priority <= 5)
		=>
		(up-get-object-type-data c: my-unique-unit object-data-class g-temp-2)
		)
		
		;Check if we want to train barracks units that require scale-mail
        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-scale-mail)
        (up-compare-goal g-highest-tech-priority <= 5)
		(or
			(up-compare-goal g-desired-num-militia > 0)
			(or
				(up-compare-goal g-desired-num-spearman > 0)
				(up-compare-goal g-desired-num-eagle-warrior > 0)))
        =>
        (research ri-scale-mail)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-scale-mail == research-available)
        (up-compare-goal g-highest-tech-priority <= 3)
		(or
			(up-compare-goal g-desired-num-militia > 0)
			(or
				(up-compare-goal g-desired-num-spearman > 0)
				(up-compare-goal g-desired-num-eagle-warrior > 0)))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-scale-mail c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-highest-tech-priority c:max 3)
		)
		
		;Check if we want to train condottieros
        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-scale-mail)
        (up-compare-goal g-highest-tech-priority <= 5)
		(up-compare-goal g-desired-num-condottiero > 0)
        =>
        (research ri-scale-mail)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-scale-mail == research-available)
        (up-compare-goal g-highest-tech-priority <= 3)
		(up-compare-goal g-desired-num-condottiero > 0)
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-scale-mail c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-highest-tech-priority c:max 3)
		)
		
		;Check if we want to train unique units that require scale-mail
        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-scale-mail)
        (up-compare-goal g-highest-tech-priority <= 5)
		(up-compare-goal g-desired-num-unique-unit > 0)
		(goal g-temp-2 infantry-class)		
        =>
        (research ri-scale-mail)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-scale-mail == research-available)
        (up-compare-goal g-highest-tech-priority <= 3)
		(up-compare-goal g-desired-num-unique-unit > 0)
		(goal g-temp-2 infantry-class)	
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-scale-mail c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-highest-tech-priority c:max 3)
		)
		
	;----------------------
	;	Chain Mail Armor
	;----------------------

		(defrule
		(up-research-status c: ri-chain-mail != research-available)
		=>
		(up-jump-rule 7)
		)

		;Check if unique unit benefits from chain-mail
		(defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-chain-mail)
        (up-compare-goal g-highest-tech-priority <= 5)
		=>
		(up-get-object-type-data c: my-unique-unit object-data-class g-temp-2)
		)
		
		;Check if we want to train barracks units that require chain-mail
        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-chain-mail)
        (up-compare-goal g-highest-tech-priority <= 5)
		(or
			(up-compare-goal g-desired-num-militia > 0)
			(or
				(up-compare-goal g-desired-num-spearman > 0)
				(up-compare-goal g-desired-num-eagle-warrior > 0)))
        =>
        (research ri-chain-mail)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-chain-mail == research-available)
        (up-compare-goal g-highest-tech-priority <= 3)
		(or
			(up-compare-goal g-desired-num-militia > 0)
			(or
				(up-compare-goal g-desired-num-spearman > 0)
				(up-compare-goal g-desired-num-eagle-warrior > 0)))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-chain-mail c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 3)
		)
		
		;Check if we want to train condottieros
        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-chain-mail)
        (up-compare-goal g-highest-tech-priority <= 5)
		(up-compare-goal g-desired-num-condottiero > 0)
        =>
        (research ri-chain-mail)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-chain-mail == research-available)
        (up-compare-goal g-highest-tech-priority <= 3)
		(up-compare-goal g-desired-num-condottiero > 0)
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-chain-mail c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 3)
		)
		
		;Check if we want to train unique units that require chain-mail
        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-chain-mail)
        (up-compare-goal g-highest-tech-priority <= 5)
		(up-compare-goal g-desired-num-unique-unit > 0)
		(goal g-temp-2 infantry-class)
        =>
        (research ri-chain-mail)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-chain-mail == research-available)
        (up-compare-goal g-highest-tech-priority <= 3)
		(up-compare-goal g-desired-num-unique-unit > 0)
		(goal g-temp-2 infantry-class)
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-chain-mail c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 3)
		)
		
	;----------------------
	;	Plate Mail Armor
	;----------------------

		(defrule
		(up-research-status c: ri-plate-mail != research-available)
		=>
		(up-jump-rule 7)
		)

		;Check if unique unit benefits from plate-mail
		(defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-plate-mail)
        (up-compare-goal g-highest-tech-priority <= 5)
		=>
		(up-get-object-type-data c: my-unique-unit object-data-class g-temp-2)
		)
		
		;Check if we want to train barracks units that require plate-mail
        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-plate-mail)
        (up-compare-goal g-highest-tech-priority <= 5)
		(or
			(up-compare-goal g-desired-num-militia > 0)
			(or
				(up-compare-goal g-desired-num-spearman > 0)
				(up-compare-goal g-desired-num-eagle-warrior > 0)))
        =>
        (research ri-plate-mail)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-plate-mail == research-available)
        (up-compare-goal g-highest-tech-priority <= 3)
		(or
			(up-compare-goal g-desired-num-militia > 0)
			(or
				(up-compare-goal g-desired-num-spearman > 0)
				(up-compare-goal g-desired-num-eagle-warrior > 0)))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-plate-mail c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 3)
		)
		
		;Check if we want to train condottieros
        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-plate-mail)
        (up-compare-goal g-highest-tech-priority <= 5)
		(up-compare-goal g-desired-num-condottiero > 0)
        =>
        (research ri-plate-mail)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-plate-mail == research-available)
        (up-compare-goal g-highest-tech-priority <= 3)
		(up-compare-goal g-desired-num-condottiero > 0)
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-plate-mail c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 3)
		)
		
		;Check if we want to train unique units that require plate-mail
        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-plate-mail)
        (up-compare-goal g-highest-tech-priority <= 5)
		(up-compare-goal g-desired-num-unique-unit > 0)
		(goal g-temp-2 infantry-class)
        =>
        (research ri-plate-mail)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-plate-mail == research-available)
        (up-compare-goal g-highest-tech-priority <= 3)
		(up-compare-goal g-desired-num-unique-unit > 0)
		(goal g-temp-2 infantry-class)
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-plate-mail c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 3)
		)
		
	;-------------------------
	;	Padded Archer Armor
	;-------------------------

		(defrule
		(up-research-status c: ri-padded-archer-armor != research-available)
		=>
		(up-jump-rule 9)
		)

		;Check if unique unit benefits from padded-archer-armor
		(defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-padded-archer-armor)
        (up-compare-goal g-highest-tech-priority <= 5)
		=>
		(up-get-object-type-data c: my-unique-unit object-data-class g-temp-2)
		)
		
		;Check if we want to train archery range units that require padded-archer-armor
        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-padded-archer-armor)
        (up-compare-goal g-highest-tech-priority <= 5)
		(or
			(up-compare-goal g-desired-num-archer > 0)
			(or
				(up-compare-goal g-desired-num-skirmisher > 0)
				(up-compare-goal g-desired-num-cavalry-archer > 0)))
        =>
        (research ri-padded-archer-armor)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-padded-archer-armor == research-available)
        (up-compare-goal g-highest-tech-priority <= 3)
		(or
			(up-compare-goal g-desired-num-archer > 0)
			(or
				(up-compare-goal g-desired-num-skirmisher > 0)
				(up-compare-goal g-desired-num-cavalry-archer > 0)))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-padded-archer-armor c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-highest-tech-priority c:max 3)
		)
		
		;Check if we want to train other archery range units
        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-padded-archer-armor)
        (up-compare-goal g-highest-tech-priority <= 5)
		(or
			(up-compare-goal g-desired-num-hand-cannoneer > 0)
			(or
				(up-compare-goal g-desired-num-slinger > 0)
				(up-compare-goal g-desired-num-genitour > 0)))
        =>
        (research ri-padded-archer-armor)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-padded-archer-armor == research-available)
        (up-compare-goal g-highest-tech-priority <= 3)
		(or
			(up-compare-goal g-desired-num-hand-cannoneer > 0)
			(or
				(up-compare-goal g-desired-num-slinger > 0)
				(up-compare-goal g-desired-num-genitour > 0)))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-padded-archer-armor c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-highest-tech-priority c:max 3)
		)
		
		;Check if we want to train unique units that require padded-archer-armor
        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-padded-archer-armor)
        (up-compare-goal g-highest-tech-priority <= 5)
		(up-compare-goal g-desired-num-unique-unit > 0)
		(or
			(goal g-temp-2 archery-class)
			(goal g-temp-2 cavalry-archer-class))
        =>
        (research ri-padded-archer-armor)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-padded-archer-armor == research-available)
        (up-compare-goal g-highest-tech-priority <= 3)
		(up-compare-goal g-desired-num-unique-unit > 0)
		(or
			(goal g-temp-2 archery-class)
			(goal g-temp-2 cavalry-archer-class))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-padded-archer-armor c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-highest-tech-priority c:max 3)
		)
		
		;Check if we want to train unique units that require padded-archer-armor
        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-padded-archer-armor)
        (up-compare-goal g-highest-tech-priority <= 5)
		(up-compare-goal g-desired-num-unique-unit > 0)
		(or
			(goal g-temp-2 archery-cannon-class)
			(goal g-temp-2 cavalry-cannon-class))
        =>
        (research ri-padded-archer-armor)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-padded-archer-armor == research-available)
        (up-compare-goal g-highest-tech-priority <= 3)
		(up-compare-goal g-desired-num-unique-unit > 0)
		(or
			(goal g-temp-2 archery-cannon-class)
			(goal g-temp-2 cavalry-cannon-class))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-padded-archer-armor c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-highest-tech-priority c:max 3)
		)
		
	;--------------------------
	;	Leather Archer Armor
	;--------------------------

		(defrule
		(up-research-status c: ri-leather-archer-armor != research-available)
		=>
		(up-jump-rule 9)
		)

		;Check if unique unit benefits from leather-archer-armor
		(defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-leather-archer-armor)
        (up-compare-goal g-highest-tech-priority <= 5)
		=>
		(up-get-object-type-data c: my-unique-unit object-data-class g-temp-2)
		)

		;Check if we want to train archery range units that require leather-archer-armor
        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-leather-archer-armor)
        (up-compare-goal g-highest-tech-priority <= 5)
		(or
			(up-compare-goal g-desired-num-archer > 0)
			(or
				(up-compare-goal g-desired-num-skirmisher > 0)
				(up-compare-goal g-desired-num-cavalry-archer > 0)))
        =>
        (research ri-leather-archer-armor)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-leather-archer-armor == research-available)
        (up-compare-goal g-highest-tech-priority <= 3)
		(or
			(up-compare-goal g-desired-num-archer > 0)
			(or
				(up-compare-goal g-desired-num-skirmisher > 0)
				(up-compare-goal g-desired-num-cavalry-archer > 0)))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-leather-archer-armor c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 3)
		)
		
		;Check if we want to train other archery range units
        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-leather-archer-armor)
        (up-compare-goal g-highest-tech-priority <= 5)
		(or
			(up-compare-goal g-desired-num-hand-cannoneer > 0)
			(or
				(up-compare-goal g-desired-num-slinger > 0)
				(up-compare-goal g-desired-num-genitour > 0)))
        =>
        (research ri-leather-archer-armor)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-leather-archer-armor == research-available)
        (up-compare-goal g-highest-tech-priority <= 3)
		(or
			(up-compare-goal g-desired-num-hand-cannoneer > 0)
			(or
				(up-compare-goal g-desired-num-slinger > 0)
				(up-compare-goal g-desired-num-genitour > 0)))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-leather-archer-armor c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 3)
		)
		
		;Check if we want to train unique units that require leather-archer-armor
        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-leather-archer-armor)
        (up-compare-goal g-highest-tech-priority <= 5)
		(up-compare-goal g-desired-num-unique-unit > 0)
		(or
			(goal g-temp-2 archery-class)
			(goal g-temp-2 cavalry-archer-class))
        =>
        (research ri-leather-archer-armor)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-leather-archer-armor == research-available)
        (up-compare-goal g-highest-tech-priority <= 3)
		(up-compare-goal g-desired-num-unique-unit > 0)
		(or
			(goal g-temp-2 archery-class)
			(goal g-temp-2 cavalry-archer-class))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-leather-archer-armor c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 3)
		)
		
		;Check if we want to train unique units that require leather-archer-armor
        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-leather-archer-armor)
        (up-compare-goal g-highest-tech-priority <= 5)
		(up-compare-goal g-desired-num-unique-unit > 0)
		(or
			(goal g-temp-2 archery-cannon-class)
			(goal g-temp-2 cavalry-cannon-class))
        =>
        (research ri-leather-archer-armor)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-leather-archer-armor == research-available)
        (up-compare-goal g-highest-tech-priority <= 3)
		(up-compare-goal g-desired-num-unique-unit > 0)
		(or
			(goal g-temp-2 archery-cannon-class)
			(goal g-temp-2 cavalry-cannon-class))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-leather-archer-armor c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 3)
		)
		
	;-----------------------
	;	Ring Archer Armor
	;-----------------------

		(defrule
		(up-research-status c: ri-ring-archer-armor != research-available)
		=>
		(up-jump-rule 9)
		)

		;Check if unique unit benefits from ring-archer-armor
		(defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-ring-archer-armor)
        (up-compare-goal g-highest-tech-priority <= 5)
		=>
		(up-get-object-type-data c: my-unique-unit object-data-class g-temp-2)
		)
		
		;Check if we want to train archery range units that require ring-archer-armor
        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-ring-archer-armor)
        (up-compare-goal g-highest-tech-priority <= 5)
		(or
			(up-compare-goal g-desired-num-archer > 0)
			(or
				(up-compare-goal g-desired-num-skirmisher > 0)
				(up-compare-goal g-desired-num-cavalry-archer > 0)))
        =>
        (research ri-ring-archer-armor)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-ring-archer-armor == research-available)
        (up-compare-goal g-highest-tech-priority <= 3)
		(or
			(up-compare-goal g-desired-num-archer > 0)
			(or
				(up-compare-goal g-desired-num-skirmisher > 0)
				(up-compare-goal g-desired-num-cavalry-archer > 0)))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-ring-archer-armor c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 3)
		)
		
		;Check if we want to train other archery range units
        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-ring-archer-armor)
        (up-compare-goal g-highest-tech-priority <= 5)
		(or
			(up-compare-goal g-desired-num-hand-cannoneer > 0)
			(or
				(up-compare-goal g-desired-num-slinger > 0)
				(up-compare-goal g-desired-num-genitour > 0)))
        =>
        (research ri-ring-archer-armor)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-ring-archer-armor == research-available)
        (up-compare-goal g-highest-tech-priority <= 3)
		(or
			(up-compare-goal g-desired-num-hand-cannoneer > 0)
			(or
				(up-compare-goal g-desired-num-slinger > 0)
				(up-compare-goal g-desired-num-genitour > 0)))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-ring-archer-armor c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 3)
		)
		
		;Check if we want to train unique units that require ring-archer-armor
        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-ring-archer-armor)
        (up-compare-goal g-highest-tech-priority <= 5)
		(up-compare-goal g-desired-num-unique-unit > 0)
		(or
			(goal g-temp-2 archery-class)
			(goal g-temp-2 cavalry-archer-class))
        =>
        (research ri-ring-archer-armor)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-ring-archer-armor == research-available)
        (up-compare-goal g-highest-tech-priority <= 3)
		(up-compare-goal g-desired-num-unique-unit > 0)
		(or
			(goal g-temp-2 archery-class)
			(goal g-temp-2 cavalry-archer-class))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-ring-archer-armor c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 3)
		)
		
		;Check if we want to train unique units that require ring-archer-armor
        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-ring-archer-armor)
        (up-compare-goal g-highest-tech-priority <= 5)
		(up-compare-goal g-desired-num-unique-unit > 0)
		(or
			(goal g-temp-2 archery-cannon-class)
			(goal g-temp-2 cavalry-cannon-class))
        =>
        (research ri-ring-archer-armor)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-ring-archer-armor == research-available)
        (up-compare-goal g-highest-tech-priority <= 3)
		(up-compare-goal g-desired-num-unique-unit > 0)
		(or
			(goal g-temp-2 archery-cannon-class)
			(goal g-temp-2 cavalry-cannon-class))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-ring-archer-armor c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 3)
		)
		
	;-------------
	;	Forging
	;-------------

		(defrule
		(up-research-status c: ri-forging != research-available)
		=>
		(up-jump-rule 9)
		)

		;Check if unique unit benefits from forging
		(defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-forging)
        (up-compare-goal g-highest-tech-priority <= 5)
		=>
		(up-get-object-type-data c: my-unique-unit object-data-class g-temp-2)
		)

		;Check if we want to train barracks units that require forging
        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-forging)
        (up-compare-goal g-highest-tech-priority <= 5)
		(or
			(up-compare-goal g-desired-num-militia > 0)
			(or
				(up-compare-goal g-desired-num-spearman > 0)
				(up-compare-goal g-desired-num-eagle-warrior > 0)))
        =>
        (research ri-forging)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-forging == research-available)
        (up-compare-goal g-highest-tech-priority <= 3)
		(or
			(up-compare-goal g-desired-num-militia > 0)
			(or
				(up-compare-goal g-desired-num-spearman > 0)
				(up-compare-goal g-desired-num-eagle-warrior > 0)))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-forging c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-highest-tech-priority c:max 3)
		)
		
		;Check if we want to train stable units that require forging
        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-forging)
        (up-compare-goal g-highest-tech-priority <= 5)
		(current-age >= castle-age)
		(or
			(up-compare-goal g-desired-num-scout-cavalry > 0)
			(or
				(up-compare-goal g-desired-num-knight > 0)
				(up-compare-goal g-desired-num-camel > 0)))
        =>
        (research ri-forging)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-forging == research-available)
        (up-compare-goal g-highest-tech-priority <= 3)
		(or
			(up-compare-goal g-desired-num-scout-cavalry > 0)
			(or
				(up-compare-goal g-desired-num-knight > 0)
				(up-compare-goal g-desired-num-camel > 0)))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-forging c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-highest-tech-priority c:max 3)
		)
		
		;Check if we want to train unique barracks/stable units that require forging
        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-forging)
        (up-compare-goal g-highest-tech-priority <= 5)
		(or
			(up-compare-goal g-desired-num-condottiero > 0)
			(or
				(up-compare-goal g-desired-num-battle-elephant > 0)
				(up-compare-goal g-desired-num-steppe-lancer > 0)))
        =>
        (research ri-forging)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-forging == research-available)
        (up-compare-goal g-highest-tech-priority <= 3)
		(or
			(up-compare-goal g-desired-num-condottiero > 0)
			(or
				(up-compare-goal g-desired-num-battle-elephant > 0)
				(up-compare-goal g-desired-num-steppe-lancer > 0)))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-forging c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-highest-tech-priority c:max 3)
		)
		
		;Check if we want to train unique units that require forging

        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-forging)
        (up-compare-goal g-highest-tech-priority <= 5)
		(up-compare-goal g-desired-num-unique-unit > 0)
		(or
			(goal g-temp-2 infantry-class)			;unique unit is infantry
			(goal g-temp-2 cavalry-class))			;unique unit is cavalry
        =>
        (research ri-forging)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-forging == research-available)
        (up-compare-goal g-highest-tech-priority <= 3)
		(up-compare-goal g-desired-num-unique-unit > 0)
		(or
			(goal g-temp-2 infantry-class)			;unique unit is infantry
			(goal g-temp-2 cavalry-class))			;unique unit is cavalry
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-forging c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-highest-tech-priority c:max 3)
		)
		
	;------------------
	;	Iron Casting
	;------------------

		(defrule
		(up-research-status c: ri-iron-casting != research-available)
		=>
		(up-jump-rule 9)
		)

		;Check if unique unit benefits from iron-casting
		(defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-iron-casting)
        (up-compare-goal g-highest-tech-priority <= 5)
		=>
		(up-get-object-type-data c: my-unique-unit object-data-class g-temp-2)
		)
		
		;Check if we want to train barracks units that require iron-casting
        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-iron-casting)
        (up-compare-goal g-highest-tech-priority <= 5)
		(or
			(up-compare-goal g-desired-num-militia > 0)
			(or
				(up-compare-goal g-desired-num-spearman > 0)
				(up-compare-goal g-desired-num-eagle-warrior > 0)))
        =>
        (research ri-iron-casting)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-iron-casting == research-available)
        (up-compare-goal g-highest-tech-priority <= 3)
		(or
			(up-compare-goal g-desired-num-militia > 0)
			(or
				(up-compare-goal g-desired-num-spearman > 0)
				(up-compare-goal g-desired-num-eagle-warrior > 0)))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-iron-casting c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 3)
		)
		
		;Check if we want to train stable units that require iron-casting
        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-iron-casting)
        (up-compare-goal g-highest-tech-priority <= 5)
		(current-age >= castle-age)
		(or
			(up-compare-goal g-desired-num-scout-cavalry > 0)
			(or
				(up-compare-goal g-desired-num-knight > 0)
				(up-compare-goal g-desired-num-camel > 0)))
        =>
        (research ri-iron-casting)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-iron-casting == research-available)
        (up-compare-goal g-highest-tech-priority <= 3)
		(or
			(up-compare-goal g-desired-num-scout-cavalry > 0)
			(or
				(up-compare-goal g-desired-num-knight > 0)
				(up-compare-goal g-desired-num-camel > 0)))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-iron-casting c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 3)
		)
		
		;Check if we want to train unique barracks/stable units that require iron-casting
        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-iron-casting)
        (up-compare-goal g-highest-tech-priority <= 5)
		(or
			(up-compare-goal g-desired-num-condottiero > 0)
			(or
				(up-compare-goal g-desired-num-battle-elephant > 0)
				(up-compare-goal g-desired-num-steppe-lancer > 0)))
        =>
        (research ri-iron-casting)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-iron-casting == research-available)
        (up-compare-goal g-highest-tech-priority <= 3)
		(or
			(up-compare-goal g-desired-num-condottiero > 0)
			(or
				(up-compare-goal g-desired-num-battle-elephant > 0)
				(up-compare-goal g-desired-num-steppe-lancer > 0)))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-iron-casting c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 3)
		)
		
		;Check if we want to train unique units that require iron-casting
        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-iron-casting)
        (up-compare-goal g-highest-tech-priority <= 5)
		(up-compare-goal g-desired-num-unique-unit > 0)
		(or
			(goal g-temp-2 infantry-class)			;unique unit is infantry
			(goal g-temp-2 cavalry-class))			;unique unit is cavalry
        =>
        (research ri-iron-casting)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-iron-casting == research-available)
        (up-compare-goal g-highest-tech-priority <= 3)
		(up-compare-goal g-desired-num-unique-unit > 0)
		(or
			(goal g-temp-2 infantry-class)			;unique unit is infantry
			(goal g-temp-2 cavalry-class))			;unique unit is cavalry
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-iron-casting c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 3)
		)
		
	;-------------------
	;	Blast Furnace
	;-------------------

		(defrule
		(up-research-status c: ri-blast-furnace != research-available)
		=>
		(up-jump-rule 9)
		)

		;Check if unique unit benefits from blast-furnace
		(defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-blast-furnace)
        (up-compare-goal g-highest-tech-priority <= 5)
		=>
		(up-get-object-type-data c: my-unique-unit object-data-class g-temp-2)
		)
		
		;Check if we want to train barracks units that require blast-furnace
        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-blast-furnace)
        (up-compare-goal g-highest-tech-priority <= 5)
		(or
			(up-compare-goal g-desired-num-militia > 0)
			(or
				(up-compare-goal g-desired-num-spearman > 0)
				(up-compare-goal g-desired-num-eagle-warrior > 0)))
        =>
        (research ri-blast-furnace)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-blast-furnace == research-available)
        (up-compare-goal g-highest-tech-priority <= 3)
		(or
			(up-compare-goal g-desired-num-militia > 0)
			(or
				(up-compare-goal g-desired-num-spearman > 0)
				(up-compare-goal g-desired-num-eagle-warrior > 0)))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-blast-furnace c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 3)
		)
		
		;Check if we want to train stable units that require blast-furnace
        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-blast-furnace)
        (up-compare-goal g-highest-tech-priority <= 5)
		(current-age >= castle-age)
		(or
			(up-compare-goal g-desired-num-scout-cavalry > 0)
			(or
				(up-compare-goal g-desired-num-knight > 0)
				(up-compare-goal g-desired-num-camel > 0)))
        =>
        (research ri-blast-furnace)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-blast-furnace == research-available)
        (up-compare-goal g-highest-tech-priority <= 3)
		(or
			(up-compare-goal g-desired-num-scout-cavalry > 0)
			(or
				(up-compare-goal g-desired-num-knight > 0)
				(up-compare-goal g-desired-num-camel > 0)))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-blast-furnace c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 3)
		)
		
		;Check if we want to train unique barracks/stable units that require blast-furnace
        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-blast-furnace)
        (up-compare-goal g-highest-tech-priority <= 5)
		(or
			(up-compare-goal g-desired-num-condottiero > 0)
			(or
				(up-compare-goal g-desired-num-battle-elephant > 0)
				(up-compare-goal g-desired-num-steppe-lancer > 0)))
        =>
        (research ri-blast-furnace)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-blast-furnace == research-available)
        (up-compare-goal g-highest-tech-priority <= 3)
		(or
			(up-compare-goal g-desired-num-condottiero > 0)
			(or
				(up-compare-goal g-desired-num-battle-elephant > 0)
				(up-compare-goal g-desired-num-steppe-lancer > 0)))
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-blast-furnace c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 3)
		)
		
		;Check if we want to train unique units that require blast-furnace
        (defrule
		(goal g-first-attack-launched YES)
        (can-research ri-blast-furnace)
        (up-compare-goal g-highest-tech-priority <= 5)
		(up-compare-goal g-desired-num-unique-unit > 0)
		(or
			(goal g-temp-2 infantry-class)			;unique unit is infantry
			(goal g-temp-2 cavalry-class))			;unique unit is cavalry
        =>
        (research ri-blast-furnace)
        )

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-blast-furnace == research-available)
        (up-compare-goal g-highest-tech-priority <= 3)
		(up-compare-goal g-desired-num-unique-unit > 0)
		(or
			(goal g-temp-2 infantry-class)			;unique unit is infantry
			(goal g-temp-2 cavalry-class))			;unique unit is cavalry
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-blast-furnace c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 3)
		)

	;----------------------
	;	Parthian Tactics
	;----------------------

		(defrule
		(up-research-status c: ri-parthian-tactics != research-available)
		=>
		(up-jump-rule 3)
		)

		(defrule
		(goal g-first-attack-launched YES)
        (can-research-with-escrow ri-parthian-tactics)
        (up-compare-goal g-highest-tech-priority <= 5)
		=>
		(up-get-object-type-data c: my-unique-unit object-data-class g-temp-2)
		)

		(defrule
		(goal g-first-attack-launched YES)
		(can-research ri-parthian-tactics)
		(up-compare-goal g-highest-tech-priority <= 5)
		(up-research-status c: ri-ring-archer-armor != research-available)
		(or
			(up-compare-goal g-desired-num-cavalry-archer > 0)
			(and
				(goal g-temp-2 cavalry-archer-class)
				(up-compare-goal g-desired-num-unique-unit > 0)))
		=>
		(research ri-parthian-tactics)
		)

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-parthian-tactics == research-available)
		(up-compare-goal g-highest-tech-priority <= 3)
		(up-research-status c: ri-ring-archer-armor != research-available)
		(or
			(up-compare-goal g-desired-num-cavalry-archer > 0)
			(and
				(goal g-temp-2 cavalry-archer-class)
				(up-compare-goal g-desired-num-unique-unit > 0)))
		(building-type-count archery-range > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-parthian-tactics c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 3)
		)

	;------------------
	;	Murder Holes
	;------------------

		(defrule
		(up-research-status c: ri-murder-holes != research-available)
		=>
		(up-jump-rule 2)
		)

		(defrule
		(goal g-first-attack-launched YES)
		(can-research ri-murder-holes)
		(up-compare-goal g-highest-tech-priority <= 5)
		(building-type-count castle > 0)
		(or
			(goal g-town-under-attack YES)
			(up-compare-goal g-top-enemy-military-parity < 0))
		=>
		(research ri-murder-holes)
		)

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-murder-holes == research-available)
		(up-compare-goal g-highest-tech-priority <= 3)
		(building-type-count castle > 0)
		(or
			(goal g-town-under-attack YES)
			(up-compare-goal g-top-enemy-military-parity < 0))
		(building-type-count university > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-murder-holes c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-stone-needed g:max g-stone-cost)
		(up-modify-goal g-highest-tech-priority c:max 3)
		(up-modify-goal g-desired-num-university c:max 1)
		)

	;-----------------
	;	Cartography
	;-----------------

		(defrule
		(up-research-status c: ri-cartography != research-available)
		=>
		(up-jump-rule 2)
		)

		(defrule
		(goal g-first-attack-launched YES)
		(can-research ri-cartography)
		(up-compare-goal g-highest-tech-priority <= 5)
		(goal g-town-under-attack NO)
		(player-in-game any-ally)
		(current-age >= castle-age)
		=>
		(research ri-cartography)
		)

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-cartography == research-available)
		(up-compare-goal g-highest-tech-priority <= 3)
		(goal g-town-under-attack NO)
		(player-in-game any-ally)
		(current-age >= castle-age)
		(building-type-count market > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-cartography c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 3)
		)

	;-----------------------
	;	Gold Shaft Mining
	;-----------------------

		(defrule
		(up-research-status c: ri-gold-shaft-mining != research-available)
		=>
		(up-jump-rule 2)
		)

		(defrule
		(goal g-first-attack-launched YES)
		(can-research ri-gold-shaft-mining)
		(up-compare-goal g-highest-tech-priority <= 5)
		(unit-type-count villager-gold >= 6)
		=>
		(research ri-gold-shaft-mining)
		)

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-gold-shaft-mining == research-available)
		(up-compare-goal g-highest-tech-priority <= 3)
		(unit-type-count villager-gold >= 6)
		(building-type-count mining-camp > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-gold-shaft-mining c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-wood-needed g:max g-wood-cost)
		(up-modify-goal g-highest-tech-priority c:max 3)
		)

	;------------------
	;	Stone Mining
	;------------------

		(defrule
		(up-research-status c: ri-stone-mining != research-available)
		=>
		(up-jump-rule 2)
		)

		(defrule
		(goal g-first-attack-launched YES)
		(can-research ri-stone-mining)
		(up-compare-goal g-highest-tech-priority <= 5)
		(or
			(up-object-type-count-total c: castle g:<= g-desired-num-castle)
			(up-resource-amount amount-stone g:< g-max-stone-needed))
		(unit-type-count villager-stone >= 3)
		(current-age >= castle-age)
		=>
		(research ri-stone-mining)
		)

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-stone-mining == research-available)
		(up-compare-goal g-highest-tech-priority <= 3)
		(or
			(up-object-type-count-total c: castle g:<= g-desired-num-castle)
			(up-resource-amount amount-stone g:< g-max-stone-needed))
		(unit-type-count villager-stone >= 3)
		(current-age >= castle-age)
		(building-type-count mining-camp > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-stone-mining c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-wood-needed g:max g-wood-cost)
		(up-modify-goal g-highest-tech-priority c:max 3)
		)

	;---------------
	;	Husbandry
	;---------------

		(defrule
		(up-research-status c: ri-husbandry != research-available)
		=>
		(up-jump-rule 2)
		)

		(defrule
		(goal g-first-attack-launched YES)
		(can-research ri-husbandry)
		(up-compare-goal g-highest-tech-priority <= 5)
		(or
			(unit-type-count cavalry-class >= 5)
			(or
				(unit-type-count cavalry-archer-class >= 6)
				(unit-type-count cavalry-cannon-class >= 6)))
		=>
		(research ri-husbandry)
		)

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-husbandry == research-available)
		(up-compare-goal g-highest-tech-priority <= 3)
		(or
			(unit-type-count cavalry-class >= 5)
			(or
				(unit-type-count cavalry-archer-class >= 6)
				(unit-type-count cavalry-cannon-class >= 6)))
		(building-type-count stable > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-husbandry c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-highest-tech-priority c:max 3)
		)

	;-------------
	;	Squires
	;-------------

		(defrule
		(up-research-status c: ri-squires != research-available)
		=>
		(up-jump-rule 2)
		)

		(defrule
		(goal g-first-attack-launched YES)
		(can-research ri-squires)
		(up-compare-goal g-highest-tech-priority <= 5)
		(unit-type-count infantry-class >= 5)
		=>
		(research ri-squires)
		)

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-squires == research-available)
		(up-compare-goal g-highest-tech-priority <= 3)
		(unit-type-count infantry-class >= 5)
		(building-type-count barracks > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-squires c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-highest-tech-priority c:max 3)
		)

	;----------------
	;	Redemption
	;----------------

		(defrule
		(up-research-status c: ri-redemption != research-available)
		=>
		(up-jump-rule 2)
		)

		(defrule
		(goal g-first-attack-launched YES)
		(can-research ri-redemption)
		(up-compare-goal g-highest-tech-priority <= 5)
		(or
			(up-compare-goal g-desired-num-monks >= 4)
			(and
				(up-compare-goal g-desired-num-monks >= 2)
				(up-compare-goal g-enemy-field-siege-count > 1)))
		=>
		(research ri-redemption)
		)

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-redemption == research-available)
		(up-compare-goal g-highest-tech-priority <= 3)
		(or
			(up-compare-goal g-desired-num-monks >= 4)
			(and
				(up-compare-goal g-desired-num-monks >= 2)
				(up-compare-goal g-enemy-field-siege-count > 1)))
		(building-type-count monastery > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-redemption c: 1)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 3)
		)

	;--------------
	;	Sanctity
	;--------------

		(defrule
		(up-research-status c: ri-sanctity != research-available)
		=>
		(up-jump-rule 2)
		)

		(defrule
		(goal g-first-attack-launched YES)
		(can-research ri-sanctity)
		(up-compare-goal g-highest-tech-priority <= 5)
		(up-compare-goal g-desired-num-monks >= 3)
		=>
		(research ri-sanctity)
		)

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-sanctity == research-available)
		(up-compare-goal g-highest-tech-priority <= 3)
		(up-compare-goal g-desired-num-monks >= 3)
		(building-type-count monastery > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-sanctity c: 1)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 3)
		)

	;--------------------
	;	Block Printing
	;--------------------

		(defrule
		(up-research-status c: ri-block-printing != research-available)
		=>
		(up-jump-rule 2)
		)

		(defrule
		(goal g-first-attack-launched YES)
		(can-research ri-block-printing)
		(up-compare-goal g-highest-tech-priority <= 5)
		(up-compare-goal g-desired-num-monks >= 3)
		=>
		(research ri-block-printing)
		)

		(defrule
		(goal g-first-attack-launched YES)
		(up-research-status c: ri-block-printing == research-available)
		(up-compare-goal g-highest-tech-priority <= 3)
		(up-compare-goal g-desired-num-monks >= 3)
		(building-type-count monastery > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-block-printing c: 1)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-highest-tech-priority c:max 3)
		)






(defrule
(current-age >= feudal-age)
(timer-triggered t-10-sec)
=>
(up-chat-data-to-self "Current tech priority: %d" g: g-highest-tech-priority)
)