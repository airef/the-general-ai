;Needed Resources.per

;====================================================
;						RESET
;====================================================

	(defrule
	(true)
	=>
	(up-reset-cost-data g-max-food-needed)
	(up-reset-cost-data g-important-techs-food-needed)
	)

;=========================<>=========================
;				      ECO TECHS
;=========================<>=========================
			
	;--------------------
	;	Double-Bit Axe
	;--------------------

		(defrule
		(up-compare-goal g-difficulty != EASIEST)
		(or
			(goal g-strategy-type FAST-CASTLE)
			(goal g-strategy-type FAST-IMPERIAL))
		(or
			(up-compare-goal g-current-strategy != FC-STRONGBOW)
			(up-compare-goal g-primary-unit-tech-progress >= PRIORITY-CASTLE-COMPLETE))
		(up-research-status c: ri-double-bit-axe == research-available)
		(up-compare-goal g-age-status >= TO-CASTLE)
		(building-type-count lumber-camp > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-double-bit-axe c: 1)
		(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
		(up-modify-goal g-important-techs-wood-needed g:+ g-wood-cost)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-wood-needed g:max g-wood-cost)
		)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(up-compare-goal g-difficulty != EASIEST)
		(or
			(goal g-strategy-type FAST-CASTLE)
			(goal g-strategy-type FAST-IMPERIAL))
		(or
			(up-compare-goal g-current-strategy != FC-STRONGBOW)
			(up-compare-goal g-primary-unit-tech-progress >= PRIORITY-CASTLE-COMPLETE))
		(up-research-status c: ri-double-bit-axe == research-available)
		(up-compare-goal g-age-status >= TO-CASTLE)
		(building-type-count lumber-camp > 0)
		=>
		(up-store-tech-name c: ri-double-bit-axe)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		)

		#load-if-not-defined BURGUNDIANS-CIV

			(defrule
			(up-compare-goal g-difficulty != EASIEST)
			(or
				(goal g-strategy-type DRUSH)
				(or
					(goal g-strategy-type FLUSH)
					(and
						(up-compare-goal g-current-strategy >= BOOMI-STRATS-START)	;Boom Imperial Strats
						(up-compare-goal g-current-strategy <= BOOMI-STRATS-END))))
			(up-research-status c: ri-double-bit-axe == research-available)
			(up-compare-goal g-age-status >= TO-FEUDAL)
			(building-type-count lumber-camp > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-double-bit-axe c: 1)
			(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
			(up-modify-goal g-important-techs-wood-needed g:+ g-wood-cost)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-wood-needed g:max g-wood-cost)
			)

		#else

			(defrule
			(up-compare-goal g-difficulty != EASIEST)
			(or
				(goal g-strategy-type DRUSH)
				(or
					(goal g-strategy-type FLUSH)
					(and
						(up-compare-goal g-current-strategy >= BOOMI-STRATS-START)	;Boom Imperial Strats
						(up-compare-goal g-current-strategy <= BOOMI-STRATS-END))))
			(up-research-status c: ri-double-bit-axe == research-available)
			(unit-type-count villager >= 10)
			(building-type-count lumber-camp > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-double-bit-axe c: 1)
			(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
			(up-modify-goal g-important-techs-wood-needed g:+ g-wood-cost)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-wood-needed g:max g-wood-cost)
			)

		#end-if

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(up-compare-goal g-difficulty != EASIEST)
		(or
			(goal g-strategy-type DRUSH)
			(or
				(goal g-strategy-type FLUSH)
				(and
					(up-compare-goal g-current-strategy >= BOOMI-STRATS-START)	;Boom Imperial Strats
					(up-compare-goal g-current-strategy <= BOOMI-STRATS-END))))
		(up-research-status c: ri-double-bit-axe == research-available)
		(unit-type-count villager >= 10)
		(building-type-count lumber-camp > 0)
		=>
		(up-store-tech-name c: ri-double-bit-axe)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		)

    ;-------------
    ;   Bow Saw
    ;-------------

		(defrule
		(up-compare-goal g-difficulty > STANDARD)
		(up-research-status c: ri-bow-saw < research-pending)
		(up-compare-goal g-age-status >= TO-CASTLE)
		(or
			(up-compare-goal g-current-strategy != FC-STRONGBOW)
			(up-compare-goal g-age-status >= MID-CASTLE))
		(or
			(goal g-town-under-attack NO)
			(up-compare-goal g-human-military-count g:>= g-min-military-pop))
		(building-type-count lumber-camp > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-bow-saw c: 1)
		(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
		(up-modify-goal g-important-techs-wood-needed g:+ g-wood-cost)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-wood-needed g:max g-wood-cost)
		)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(up-compare-goal g-difficulty > STANDARD)
		(up-research-status c: ri-bow-saw < research-pending)
		(up-compare-goal g-age-status >= TO-CASTLE)
		(or
			(up-compare-goal g-current-strategy != FC-STRONGBOW)
			(up-compare-goal g-age-status >= MID-CASTLE))
		(or
			(goal g-town-under-attack NO)
			(up-compare-goal g-human-military-count g:>= g-min-military-pop))
		(building-type-count lumber-camp > 0)
		=>
		(up-store-tech-name c: ri-bow-saw)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		)

	;------------------
	;	Horse Collar
	;------------------

		(defrule
		(up-compare-goal g-difficulty > EASIEST)
		(goal g-strategy-type FAST-CASTLE)
		(or
			(up-compare-goal g-current-strategy != FC-STRONGBOW)
			(up-compare-goal g-primary-unit-tech-progress >= SECONDARY-CASTLE-COMPLETE))
		(up-research-status c: ri-double-bit-axe >= research-pending)
		(or
			(goal g-town-under-attack NO)
			(up-compare-goal g-human-military-count g:>= g-min-military-pop))
		(up-research-status c: ri-horse-collar == research-available)
		(up-compare-goal g-age-status >= TO-CASTLE)
		(building-type-count mill > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-horse-collar c: 1)
		(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
		(up-modify-goal g-important-techs-wood-needed g:+ g-wood-cost)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-wood-needed g:max g-wood-cost)
		)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(up-compare-goal g-difficulty > EASIEST)
		(or
			(goal g-strategy-type FAST-CASTLE)
			(goal g-strategy-type FAST-IMPERIAL))
		(or
			(up-compare-goal g-current-strategy != FC-STRONGBOW)
			(up-compare-goal g-primary-unit-tech-progress >= SECONDARY-CASTLE-COMPLETE))
		(up-research-status c: ri-double-bit-axe >= research-pending)
		(or
			(goal g-town-under-attack NO)
			(up-compare-goal g-human-military-count g:>= g-min-military-pop))
		(up-research-status c: ri-horse-collar == research-available)
		(up-compare-goal g-age-status >= TO-CASTLE)
		(building-type-count mill > 0)
		=>
		(up-store-tech-name c: ri-horse-collar)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		)

    ;----------------
    ;   Heavy Plow
    ;----------------

		(defrule
		(up-compare-goal g-difficulty > STANDARD)
		(or
			(up-compare-goal g-usable-farm-count < 20)
			(or
				(and
					(up-object-type-count c: town-center g:< g-desired-num-town-center)
					(and
						(building-type-count-total town-center < 2)
						(up-compare-goal g-usable-farm-count < 25)))
				(and
					(goal g-game-focus DEFENSIVE)
					(up-compare-goal g-human-military-count g:< g-min-military-pop))))
		=>
		(up-jump-rule 2)
		)

			(defrule
			(up-compare-goal g-difficulty > STANDARD)
			(up-research-status c: ri-heavy-plow == research-available)
			(up-research-status c: ri-bow-saw >= research-pending)
			(or
				(up-compare-goal g-age-status >= MID-CASTLE)
				(and
					(goal g-position POCKET)
					(up-compare-goal g-primary-unit-tech-progress >= PRIORITY-CASTLE-COMPLETE)))
			(or
				(goal g-town-under-attack NO)
				(up-compare-goal g-human-military-count g:>= g-min-military-pop))
			(building-type-count mill > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-heavy-plow c: 1)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-wood-needed g:max g-wood-cost)
			)

			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(up-compare-goal g-difficulty > STANDARD)
			(up-research-status c: ri-heavy-plow == research-available)
			(up-research-status c: ri-bow-saw >= research-pending)
			(or
				(up-compare-goal g-age-status >= MID-CASTLE)
				(and
					(goal g-position POCKET)
					(up-compare-goal g-primary-unit-tech-progress >= PRIORITY-CASTLE-COMPLETE)))
			(or
				(goal g-town-under-attack NO)
				(up-compare-goal g-human-military-count g:>= g-min-military-pop))
			(building-type-count mill > 0)
			=>
			(up-store-tech-name c: ri-heavy-plow)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

	;-----------------
	;	Wheelbarrow
	;-----------------

		(defrule
		(up-compare-goal g-difficulty > EASIEST)
		(or
			(building-type-count town-center > 1)
			(up-compare-goal g-usable-farm-count >= 18))
		(up-compare-goal g-usable-farm-count >= 14)
		(or
			(up-compare-goal g-game-focus != DEFENSIVE)
			(up-compare-goal g-human-military-count g:>= g-min-military-pop))
		(up-research-status c: ri-wheel-barrow == research-available)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-wheel-barrow c: 1)
		(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
		(up-modify-goal g-important-techs-wood-needed g:+ g-wood-cost)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-wood-needed g:max g-wood-cost)
		)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(up-compare-goal g-difficulty > EASIEST)
		(or
			(building-type-count town-center > 1)
			(up-compare-goal g-usable-farm-count >= 18))
		(up-compare-goal g-usable-farm-count >= 14)
		(or
			(up-compare-goal g-game-focus != DEFENSIVE)
			(up-compare-goal g-human-military-count g:>= g-min-military-pop))
		(up-research-status c: ri-wheel-barrow == research-available)
		=>
		(up-store-tech-name c: ri-wheel-barrow)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		)

	;---------------
	;	Hand Cart
	;---------------

		(defrule
		(up-compare-goal g-difficulty > STANDARD)
		(goal g-game-focus BOOM)
		(or
			(building-type-count town-center > 1)
			(up-compare-goal g-usable-farm-count >= 25))
		(up-compare-goal g-usable-farm-count >= 20)
		(population >= 80)
		(or
			(goal g-town-under-attack NO)
			(up-compare-goal g-human-military-count g:>= g-min-military-pop))
		(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
		(up-research-status c: ri-heavy-plow >= research-pending)
		(up-research-status c: ri-hand-cart == research-available)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-hand-cart c: 1)
		(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
		(up-modify-goal g-important-techs-wood-needed g:+ g-wood-cost)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-wood-needed g:max g-wood-cost)
		)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(up-compare-goal g-difficulty > STANDARD)
		(goal g-game-focus BOOM)
		(or
			(building-type-count town-center > 1)
			(up-compare-goal g-usable-farm-count >= 25))
		(up-compare-goal g-usable-farm-count >= 20)
		(population >= 80)
		(or
			(goal g-town-under-attack NO)
			(up-compare-goal g-human-military-count g:>= g-min-military-pop))
		(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
		(up-research-status c: ri-heavy-plow >= research-pending)
		(up-research-status c: ri-hand-cart == research-available)
		=>
		(up-store-tech-name c: ri-hand-cart)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		)

;=========================<>=========================
;				    CRITICAL TECHS
;=========================<>=========================
		
	;-----------------
	;	Castle Age
	;-----------------

		(defrule
		(current-age == feudal-age)
		(up-research-status c: castle-age == research-available)
		(or
			(up-object-type-count c: villager g:>= g-required-num-villager)
			(or
				(goal g-game-focus REBUILD)
				(goal g-game-focus DEFENSIVE)))
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: castle-age c: 1)
		(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
		(up-modify-goal g-important-techs-gold-needed g:+ g-gold-cost)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(current-age == feudal-age)
		(up-research-status c: castle-age == research-available)
		(or
			(up-object-type-count c: villager g:>= g-required-num-villager)
			(or
				(goal g-game-focus REBUILD)
				(goal g-game-focus DEFENSIVE)))
		=>
		(up-store-tech-name c: castle-age)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		)
		
	;-----------------
	;	Imperial Age
	;-----------------

		(defrule
		(or
			(goal g-age-status SAVE-FOR-IMPERIAL)
			(or
				(up-object-type-count c: villager g:>= g-required-num-villager)
				(and
					(goal g-game-focus REBUILD)
					(up-object-type-count c: villager >= 80))))
		(up-research-status c: imperial-age == research-available)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: imperial-age c: 1)
		(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
		(up-modify-goal g-important-techs-gold-needed g:+ g-gold-cost)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-jump-rule 1)
		)
			(defrule
			(up-get-fact current-age 0 g-temp)						;store our current age
			(up-get-fact-max any-enemy current-age 0 g-temp2)		;store current age of most advanced enemy
			(up-compare-goal g-temp g:< g-temp2)
			(up-research-status c: imperial-age == research-available)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: imperial-age c: 1)
			(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
			(up-modify-goal g-important-techs-gold-needed g:+ g-gold-cost)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(or
			(goal g-age-status SAVE-FOR-IMPERIAL)
			(or
				(up-object-type-count c: villager g:>= g-required-num-villager)
				(and
					(goal g-game-focus REBUILD)
					(up-object-type-count c: villager >= 80))))
		(up-research-status c: imperial-age == research-available)
		=>
		(up-store-tech-name c: imperial-age)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		(up-jump-rule 1)
		)
			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(up-get-fact current-age 0 g-temp)					;store our current age
			(up-get-fact-max any-enemy current-age 0 g-temp2)		;store current age of most advanced enemy
			(up-compare-goal g-temp g:< g-temp2)
			(up-research-status c: imperial-age == research-available)
			=>
			(up-store-tech-name c: imperial-age)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

	;---------------------------------------------------------------
	;	Unique Unit Upgrade - Priority or Secondary Imperial Tech
	;---------------------------------------------------------------

		#load-if-not-defined KOREAN-CIV

			(defrule
			(goal g-primary-unit my-unique-unit)
			(up-compare-goal g-age-status >= TO-IMPERIAL)
			(up-research-status c: my-unique-unit-upgrade < research-pending)
			(building-type-count castle > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: my-unique-unit-upgrade c: 1)
			(up-modify-goal g-important-techs-wood-needed g:+ g-wood-cost)
			(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
			(up-modify-goal g-important-techs-gold-needed g:+ g-gold-cost)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			(up-modify-goal g-max-wood-needed g:max g-food-cost)
			)
			(defrule
			(goal g-support-unit my-unique-unit)
			(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
			; (or
			; 	(up-compare-goal g-unique-unit-line >= 7)
			; 	(up-compare-goal g-unique-unit-line g:>= g-desired-num-unique-unit))
			(current-age == imperial-age)
			(up-research-status c: my-unique-unit-upgrade == research-available)
			(building-type-count castle > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: my-unique-unit-upgrade c: 1)
			(up-modify-goal g-important-techs-wood-needed g:+ g-food-cost)
			(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
			(up-modify-goal g-important-techs-gold-needed g:+ g-gold-cost)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			(up-modify-goal g-max-wood-needed g:max g-food-cost)
			)

			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(goal g-primary-unit my-unique-unit)
			(up-compare-goal g-age-status >= TO-IMPERIAL)
			(up-research-status c: my-unique-unit-upgrade < research-pending)
			(building-type-count castle > 0)
			=>
			(up-store-tech-name c: my-unique-unit-upgrade)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)
			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(goal g-support-unit my-unique-unit)
			(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
			; (or
			; 	(up-compare-goal g-unique-unit-line >= 7)
			; 	(up-compare-goal g-unique-unit-line g:>= g-desired-num-unique-unit))
			(up-research-status c: my-unique-unit-upgrade == research-available)
			(building-type-count castle > 0)
			=>
			(up-store-tech-name c: my-unique-unit-upgrade)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

		#else

			(defrule
			(goal g-primary-unit my-unique-unit)
			(up-compare-goal g-age-status >= TO-IMPERIAL)
			(up-research-status c: ri-elite-war-wagon < research-pending)
			(building-type-count castle > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-elite-war-wagon c: 1)
			(up-modify-goal g-important-techs-wood-needed g:+ g-wood-cost)
			(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
			(up-modify-goal g-important-techs-gold-needed g:+ g-gold-cost)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			(up-modify-goal g-max-wood-needed g:max g-food-cost)
			)
			(defrule
			(goal g-support-unit my-unique-unit)
			(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
			; (or
			; 	(up-compare-goal g-unique-unit-line >= 7)
			; 	(up-compare-goal g-unique-unit-line g:>= g-desired-num-unique-unit))
			(current-age == imperial-age)
			(up-research-status c: ri-elite-war-wagon == research-available)
			(building-type-count castle > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-elite-war-wagon c: 1)
			(up-modify-goal g-important-techs-wood-needed g:+ g-food-cost)
			(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
			(up-modify-goal g-important-techs-gold-needed g:+ g-gold-cost)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			(up-modify-goal g-max-wood-needed g:max g-food-cost)
			)

			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(goal g-primary-unit my-unique-unit)
			(up-compare-goal g-age-status >= TO-IMPERIAL)
			(up-research-status c: ri-elite-war-wagon < research-pending)
			(building-type-count castle > 0)
			=>
			(up-store-tech-name c: ri-elite-war-wagon)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)
			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(goal g-support-unit my-unique-unit)
			(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
			; (or
			; 	(up-compare-goal g-unique-unit-line >= 7)
			; 	(up-compare-goal g-unique-unit-line g:>= g-desired-num-unique-unit))
			(up-research-status c: ri-elite-war-wagon == research-available)
			(building-type-count castle > 0)
			=>
			(up-store-tech-name c: ri-elite-war-wagon)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

		#end-if

;=========================<>=========================
;				     UNIQUE TECHS
;=========================<>=========================

	#load-if-defined AZTEC-CIV

		;------------------
		;	Garland Wars
		;------------------

			(defrule
			(goal g-primary-unit-class infantry-class)
			; (unit-type-count infantry-class >= 10)
			(up-compare-goal g-primary-unit-tech-progress >= PRIORITY-IMPERIAL-COMPLETE)
			(up-research-status c: ri-garland-wars == research-available)
			(building-type-count castle > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-garland-wars c: 1)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)
			(defrule
			(goal g-support-unit-class infantry-class)
			(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
			; (unit-type-count infantry-class >= 15)
			(up-compare-goal g-primary-unit-tech-progress >= PRIORITY-IMPERIAL-COMPLETE)
			(up-research-status c: ri-garland-wars == research-available)
			(building-type-count castle > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-garland-wars c: 1)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)

			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(goal g-primary-unit-class infantry-class)
			; (unit-type-count infantry-class >= 10)
			(up-compare-goal g-primary-unit-tech-progress >= PRIORITY-IMPERIAL-COMPLETE)
			(up-research-status c: ri-garland-wars == research-available)
			(building-type-count castle > 0)
			=>
			(up-store-tech-name c: ri-garland-wars)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)
			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(goal g-support-unit-class infantry-class)
			(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
			; (unit-type-count infantry-class >= 15)
			(up-compare-goal g-primary-unit-tech-progress >= PRIORITY-IMPERIAL-COMPLETE)
			(up-research-status c: ri-garland-wars == research-available)
			(building-type-count castle > 0)
			=>
			(up-store-tech-name c: ri-garland-wars)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

		;------------
		;	Atlatl
		;------------

			(defrule
			(goal g-primary-unit skirmisher)
			(or
				(up-compare-goal g-skirmisher-line >= 10)
				(up-compare-goal g-skirmisher-line g:>= g-desired-num-skirmisher))
			(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
			(up-compare-goal g-skirmisher-tech-progress >= SECONDARY-CASTLE-COMPLETE)
			(up-research-status c: ri-atlatl == research-available)
			(building-type-count castle > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-atlatl c: 1)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)

			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(goal g-primary-unit skirmisher)
			(or
				(up-compare-goal g-skirmisher-line >= 10)
				(up-compare-goal g-skirmisher-line g:>= g-desired-num-skirmisher))
			(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
			(up-compare-goal g-skirmisher-tech-progress >= SECONDARY-CASTLE-COMPLETE)
			(up-research-status c: ri-atlatl == research-available)
			(building-type-count castle > 0)
			=>
			(up-store-tech-name c: ri-atlatl)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

			(defrule
			(goal g-support-unit skirmisher)
			(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
			(or
				(up-compare-goal g-skirmisher-line >= 15)
				(up-compare-goal g-skirmisher-line g:>= g-desired-num-skirmisher))
			(up-compare-goal g-skirmisher-tech-progress >= SECONDARY-CASTLE-COMPLETE)
			(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
			(up-research-status c: ri-atlatl == research-available)
			(building-type-count castle > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-atlatl c: 1)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)

			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(goal g-support-unit skirmisher)
			(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
			(or
				(up-compare-goal g-skirmisher-line >= 15)
				(up-compare-goal g-skirmisher-line g:>= g-desired-num-skirmisher))
			(up-compare-goal g-skirmisher-tech-progress >= SECONDARY-CASTLE-COMPLETE)
			(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
			(up-research-status c: ri-atlatl == research-available)
			(building-type-count castle > 0)
			=>
			(up-store-tech-name c: ri-atlatl)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

	#end-if

	#load-if-defined BENGALIS-CIV

		;-----------
		;	Paiks
		;-----------

			(defrule
			(or
				(goal g-primary-unit battle-elephant)
				(or
					(goal g-primary-unit elephant-archer)
					(and
						(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
						(or
							(goal g-support-unit battle-elephant)
							(goal g-support-unit elephant-archer)))))
			(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
			(up-research-status c: ri-paiks == research-available)
			(building-type-count castle > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-paiks c: 1)
			(up-modify-goal g-max-wood-needed g:max g-wood-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)
			(defrule
			(or
				(goal g-primary-unit my-unique-unit)
				(and
					(goal g-support-unit my-unique-unit)
					(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
			(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
			(up-research-status c: ri-paiks == research-available)
			(building-type-count castle > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-paiks c: 1)
			(up-modify-goal g-max-wood-needed g:max g-wood-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)

			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(or
				(goal g-primary-unit battle-elephant)
				(or
					(goal g-primary-unit elephant-archer)
					(and
						(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
						(or
							(goal g-support-unit battle-elephant)
							(goal g-support-unit elephant-archer)))))
			(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
			(up-research-status c: ri-paiks == research-available)
			(building-type-count castle > 0)
			=>
			(up-store-tech-name c: ri-paiks)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)
			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(or
				(goal g-primary-unit my-unique-unit)
				(and
					(goal g-support-unit my-unique-unit)
					(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
			(up-research-status c: ri-paiks == research-available)
			(building-type-count castle > 0)
			=>
			(up-store-tech-name c: ri-paiks)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

	#end-if

	#load-if-defined BERBERS-CIV

		;---------------------
		;	Maghrabi Camels
		;---------------------

			(defrule
			(or
				(goal g-primary-unit camel)
				(goal g-primary-unit my-unique-unit))
			(or
				(up-compare-goal g-camel-line >= 10)
				(up-compare-goal g-unique-unit-line >= 12))
			(up-compare-goal g-primary-unit-tech-progress >= PRIORITY-IMPERIAL-COMPLETE)
			(up-research-status c: ri-maghrabi-camels == research-available)
			(building-type-count castle > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-maghrabi-camels c: 1)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)
			(defrule
			(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
			(or
				(goal g-support-unit camel)
				(goal g-support-unit my-unique-unit))
			(or
				(up-compare-goal g-camel-line >= 12)
				(up-compare-goal g-unique-unit-line >= 15))
			(up-compare-goal g-primary-unit-tech-progress >= PRIORITY-IMPERIAL-COMPLETE)
			(up-research-status c: ri-maghrabi-camels == research-available)
			(building-type-count castle > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-maghrabi-camels c: 1)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)

			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(or
				(goal g-primary-unit camel)
				(goal g-primary-unit my-unique-unit))
			(or
				(up-compare-goal g-camel-line >= 10)
				(up-compare-goal g-unique-unit-line >= 12))
			(up-compare-goal g-primary-unit-tech-progress >= PRIORITY-IMPERIAL-COMPLETE)
			(up-research-status c: ri-maghrabi-camels == research-available)
			(building-type-count castle > 0)
			=>
			(up-store-tech-name c: ri-maghrabi-camels)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)
			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
			(or
				(goal g-support-unit camel)
				(goal g-support-unit my-unique-unit))
			(or
				(up-compare-goal g-camel-line >= 12)
				(up-compare-goal g-unique-unit-line >= 15))
			(up-compare-goal g-primary-unit-tech-progress >= PRIORITY-IMPERIAL-COMPLETE)
			(up-research-status c: ri-maghrabi-camels == research-available)
			(building-type-count castle > 0)
			=>
			(up-store-tech-name c: ri-maghrabi-camels)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

		;------------
		;	Kasbah
		;------------

			(defrule
			(goal g-primary-unit my-unique-unit)
			(or
				(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
				(food-amount >= 1250))
			(up-compare-goal g-primary-unit-tech-progress >= SECONDARY-CASTLE-COMPLETE)
			(up-compare-goal g-current-age-primary-unit-tech-progress >= PRIORITY-COMPLETE)
			(up-research-status c: ri-kasbah == research-available)
			(building-type-count castle > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-kasbah c: 1)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)
			(defrule
			(goal g-support-unit my-unique-unit)
			(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
			(up-compare-goal g-desired-num-support-unit >= 15)
			(up-compare-goal g-primary-unit-tech-progress >= PRIORITY-IMPERIAL-COMPLETE)
			(up-research-status c: ri-kasbah == research-available)
			(building-type-count castle > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-kasbah c: 1)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)

			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(goal g-primary-unit my-unique-unit)
			(or
				(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
				(food-amount >= 1250))
			(up-compare-goal g-primary-unit-tech-progress >= SECONDARY-CASTLE-COMPLETE)
			(up-compare-goal g-current-age-primary-unit-tech-progress >= PRIORITY-COMPLETE)
			(up-research-status c: ri-kasbah == research-available)
			(building-type-count castle > 0)
			=>
			(up-store-tech-name c: ri-kasbah)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)
			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(goal g-support-unit my-unique-unit)
			(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
			(up-compare-goal g-desired-num-support-unit >= 15)
			(up-compare-goal g-primary-unit-tech-progress >= PRIORITY-IMPERIAL-COMPLETE)
			(up-research-status c: ri-kasbah == research-available)
			(building-type-count castle > 0)
			=>
			(up-store-tech-name c: ri-kasbah)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

	#end-if

	#load-if-defined BOHEMIANS-CIV

		;-----------------------
		;	Wagenburg Tactics
		;-----------------------

			(defrule
			(or
				(goal g-primary-unit hand-cannoneer)
				(or
					(goal g-primary-unit my-unique-unit)
					(and
						(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
						(or
							(goal g-support-unit hand-cannoneer)
							(goal g-support-unit my-unique-unit)))))
			(up-research-status c: ri-wagenburg-tactics == research-available)
			(building-type-count castle > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-wagenburg-tactics c: 1)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)

			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(or
				(goal g-primary-unit hand-cannoneer)
				(or
					(goal g-primary-unit my-unique-unit)
					(and
						(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
						(or
							(goal g-support-unit hand-cannoneer)
							(goal g-support-unit my-unique-unit)))))
			(up-research-status c: ri-wagenburg-tactics == research-available)
			(building-type-count castle > 0)
			=>
			(up-store-tech-name c: ri-wagenburg-tactics)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

	#end-if

	#load-if-defined BRITON-CIV

		;------------
		;	Yeomen
		;------------

			(defrule
			(or
				(goal g-primary-unit-class archery-class)
				(and
					(goal g-support-unit-class archery-class)
					(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
			(unit-type-count archery-class >= 12)
			(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
			(up-research-status c: ri-yeomen == research-available)
			(building-type-count castle > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-yeomen c: 1)
			(up-modify-goal g-max-wood-needed g:max g-wood-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)

			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(or
				(goal g-primary-unit-class archery-class)
				(and
					(goal g-support-unit-class archery-class)
					(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
			(unit-type-count archery-class >= 12)
			(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
			(up-research-status c: ri-yeomen == research-available)
			(building-type-count castle > 0)
			=>
			(up-store-tech-name c: ri-yeomen)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

		;-------------
		;	Warwolf
		;-------------

			(defrule
			(up-compare-goal g-desired-num-trebuchet > 3)
			(unit-type-count trebuchet-set > 1)
			(up-research-status c: ri-warwolf == research-available)
			(building-type-count castle > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-warwolf c: 1)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			(up-modify-goal g-max-wood-needed g:max g-wood-cost)
			)

			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(up-compare-goal g-desired-num-trebuchet > 3)
			(unit-type-count trebuchet-set > 1)
			(up-research-status c: ri-warwolf == research-available)
			(building-type-count castle > 0)
			=>
			(up-store-tech-name c: ri-warwolf)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

	#end-if

	#load-if-defined BULGARIANS-CIV

		;--------------
		;	Stirrups
		;--------------

			(defrule
			(or
				(goal g-primary-unit-class cavalry-class)
				(and
					(goal g-support-unit-class cavalry-class)
					(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
			(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
			(up-research-status c: ri-stirrups == research-available)
			(building-type-count castle > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-stirrups c: 1)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)

			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(or
				(goal g-primary-unit-class cavalry-class)
				(and
					(goal g-support-unit-class cavalry-class)
					(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
			(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
			(up-research-status c: ri-stirrups == research-available)
			(building-type-count castle > 0)
			=>
			(up-store-tech-name c: ri-stirrups)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

		;-------------
		;	Bagains
		;-------------

			(defrule
			(or
				(goal g-primary-unit militiaman)
				(and
					(goal g-support-unit militiaman)
					(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
			(up-research-status c: ri-bagains == research-available)
			(building-type-count castle > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-bagains c: 1)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)

			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(or
				(goal g-primary-unit militiaman)
				(and
					(goal g-support-unit militiaman)
					(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
			(up-research-status c: ri-bagains == research-available)
			(building-type-count castle > 0)
			=>
			(up-store-tech-name c: ri-bagains)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

	#end-if

	#load-if-defined BURMESE-CIV

		;-------------
		;	Howdah
		;-------------

			(defrule
			(or
				(goal g-primary-unit battle-elephant)
				(and
					(goal g-support-unit battle-elephant)
					(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
			(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
			(up-research-status c: ri-howdah == research-available)
			(building-type-count castle > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-howdah c: 1)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-wood-needed g:max g-wood-cost)
			)

			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(or
				(goal g-primary-unit battle-elephant)
				(and
					(goal g-support-unit battle-elephant)
					(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
			(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
			(up-research-status c: ri-howdah == research-available)
			(building-type-count castle > 0)
			=>
			(up-store-tech-name c: ri-howdah)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

		;---------------------
		;	Manipur Cavalry
		;---------------------

			(defrule
			(or
				(goal g-primary-unit-class cavalry-class)
				(and
					(goal g-support-unit-class cavalry-class)
					(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
			(up-research-status c: ri-manipur-cavalry == research-available)
			(building-type-count castle > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-manipur-cavalry c: 1)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)

			#load-if-not-defined DE-AVAILABLE
			(defrule
			(or
				(goal g-primary-unit my-unique-unit)
				(and
					(goal g-support-unit my-unique-unit)
					(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
			(up-research-status c: ri-manipur-cavalry == research-available)
			(building-type-count castle > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-manipur-cavalry c: 1)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)
			#end-if

			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(or
				(goal g-primary-unit-class cavalry-class)
				(and
					(goal g-support-unit-class cavalry-class)
					(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
			(up-research-status c: ri-manipur-cavalry == research-available)
			(building-type-count castle > 0)
			=>
			(up-store-tech-name c: ri-manipur-cavalry)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

			#load-if-not-defined DE-AVAILABLE
			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(or
				(goal g-primary-unit my-unique-unit)
				(and
					(goal g-support-unit my-unique-unit)
					(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
			(up-research-status c: ri-manipur-cavalry == research-available)
			(building-type-count castle > 0)
			=>
			(up-store-tech-name c: ri-manipur-cavalry)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)
			#end-if

	#end-if

	#load-if-defined BYZANTINE-CIV

		;----------------
		;	Greek Fire
		;----------------

			(defrule
			(up-compare-goal g-desired-num-fire-ship >= 10)
			(research-completed ri-war-galley)
			(or
				(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
				(food-amount >= 1250))
			(up-research-status c: ri-greek-fire == research-available)
			(building-type-count castle > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-greek-fire c: 1)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-wood-needed g:max g-wood-cost)
			)

			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(up-compare-goal g-desired-num-fire-ship >= 10)
			(research-completed ri-war-galley)
			(or
				(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
				(food-amount >= 1250))
			(up-research-status c: ri-greek-fire == research-available)
			(building-type-count castle > 0)
			=>
			(up-store-tech-name c: ri-greek-fire)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

		;---------------
		;	Logistica
		;---------------

			(defrule
			(or
				(goal g-primary-unit my-unique-unit)
				(and
					(goal g-support-unit my-unique-unit)
					(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
			(up-research-status c: ri-logistica == research-available)
			(building-type-count castle > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-logistica c: 1)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)

			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(or
				(goal g-primary-unit my-unique-unit)
				(and
					(goal g-support-unit my-unique-unit)
					(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
			(up-research-status c: ri-logistica == research-available)
			(building-type-count castle > 0)
			=>
			(up-store-tech-name c: ri-logistica)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

	#end-if

	#load-if-defined CELTIC-CIV

		;-------------------
		;	Furor Celtica
		;-------------------

			(defrule
			(or
				(up-compare-goal g-desired-num-ram-type >= 3)
				(or
					(up-compare-goal g-desired-num-mangonel >= 3)
					(up-compare-goal g-desired-num-scorpion >= 5)))
			(up-research-status c: ri-furor-celtica == research-available)
			(building-type-count castle > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-furor-celtica c: 1)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)

			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(or
				(up-compare-goal g-desired-num-ram-type >= 3)
				(or
					(up-compare-goal g-desired-num-mangonel >= 3)
					(up-compare-goal g-desired-num-scorpion >= 5)))
			(up-research-status c: ri-furor-celtica == research-available)
			(building-type-count castle > 0)
			=>
			(up-store-tech-name c: ri-furor-celtica)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

	#end-if

	#load-if-defined CHINESE-CIV

		;--------------
		;	Rocketry
		;--------------

			(defrule
			(or
				(goal g-primary-unit my-unique-unit)
				(or
					(and
						(goal g-support-unit my-unique-unit)
						(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS))
					(up-compare-goal g-desired-num-scorpion > 4)))
			(up-research-status c: ri-rocketry == research-available)
			(building-type-count castle > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-rocketry c: 1)
			(up-modify-goal g-max-wood-needed g:max g-wood-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)

			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(or
				(goal g-primary-unit my-unique-unit)
				(or
					(and
						(goal g-support-unit my-unique-unit)
						(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS))
					(up-compare-goal g-desired-num-scorpion > 4)))
			(up-research-status c: ri-rocketry == research-available)
			(building-type-count castle > 0)
			=>
			(up-store-tech-name c: ri-rocketry)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

	#end-if

	#load-if-defined CUMANS-CIV

		;----------------------
		;	Steppe Husbandry
		;----------------------

			(defrule
			(or
				(goal g-primary-unit scout-cavalry)
				(or
					(goal g-primary-unit cavalry-archer)
					(goal g-primary-unit steppe-lancer)))
			(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
			(up-research-status c: ri-steppe-husbandry == research-available)
			(building-type-count castle > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-steppe-husbandry c: 1)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-wood-needed g:max g-wood-cost)
			(up-jump-rule 1)
			)
				(defrule
				(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
				(or
					(goal g-support-unit scout-cavalry)
					(or
						(goal g-support-unit cavalry-archer)
						(goal g-support-unit steppe-lancer)))
				(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
				(up-research-status c: ri-steppe-husbandry == research-available)
				(building-type-count castle > 0)
				=>
				(up-setup-cost-data 1 g-food-cost)
				(up-add-research-cost c: ri-steppe-husbandry c: 1)
				(up-modify-goal g-max-food-needed g:max g-food-cost)
				(up-modify-goal g-max-wood-needed g:max g-wood-cost)
				)

			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(or
				(goal g-primary-unit scout-cavalry)
				(or
					(goal g-primary-unit cavalry-archer)
					(goal g-primary-unit steppe-lancer)))
			(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
			(up-research-status c: ri-steppe-husbandry == research-available)
			(building-type-count castle > 0)
			=>
			(up-store-tech-name c: ri-steppe-husbandry)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			(up-jump-rule 1)
			)
				(defrule
				(taunt-detected TAUNT-PLAYER 246)
				(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
				(or
					(goal g-support-unit scout-cavalry)
					(or
						(goal g-support-unit cavalry-archer)
						(goal g-support-unit steppe-lancer)))
				(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
				(up-research-status c: ri-steppe-husbandry == research-available)
				(building-type-count castle > 0)
				=>
				(up-store-tech-name c: ri-steppe-husbandry)
				(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
				)

	#end-if

	#load-if-defined DRAVIDIANS-CIV

		;-----------------
		;	Wootz Steel
		;-----------------

			(defrule
			(or
				(goal g-primary-unit militiaman)
				(or
					(goal g-primary-unit condottiero)
					(goal g-primary-unit my-unique-unit)))
			(up-research-status c: ri-wootz-steel == research-available)
			(building-type-count castle > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-wootz-steel c: 1)
			(up-modify-escrow food g:- g-food-cost)
			(up-modify-escrow gold g:- g-gold-cost)
			)
			(defrule
			(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
			(or
				(goal g-support-unit militiaman)
				(or
					(goal g-support-unit condottiero)
					(goal g-support-unit my-unique-unit)))
			(up-research-status c: ri-wootz-steel == research-available)
			(building-type-count castle > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-wootz-steel c: 1)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)

			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(or
				(goal g-primary-unit militiaman)
				(or
					(goal g-primary-unit condottiero)
					(goal g-primary-unit my-unique-unit)))
			(up-research-status c: ri-wootz-steel == research-available)
			(building-type-count castle > 0)
			=>
			(up-store-tech-name c: ri-wootz-steel)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)
			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
			(or
				(goal g-support-unit militiaman)
				(or
					(goal g-support-unit condottiero)
					(goal g-support-unit my-unique-unit)))
			(up-research-status c: ri-wootz-steel == research-available)
			(building-type-count castle > 0)
			=>
			(up-store-tech-name c: ri-wootz-steel)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

	#end-if

	#load-if-defined ETHIOPIAN-CIV

		;-----------------
		;	Royal Heirs
		;-----------------

			(defrule
			(or
				(goal g-primary-unit my-unique-unit)
				(and
					(goal g-support-unit my-unique-unit)
					(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
			(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
			(up-research-status c: ri-royal-heirs == research-available)
			(building-type-count castle > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-royal-heirs c: 1)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)

			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(or
				(goal g-primary-unit my-unique-unit)
				(and
					(goal g-support-unit my-unique-unit)
					(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
			(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
			(up-research-status c: ri-royal-heirs == research-available)
			(building-type-count castle > 0)
			=>
			(up-store-tech-name c: ri-royal-heirs)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

		;---------------------
		;	Torsion Engines
		;---------------------

			(defrule
			(or
				(up-compare-goal g-desired-num-ram-type >= 3)
				(or
					(up-compare-goal g-desired-num-mangonel >= 3)
					(up-compare-goal g-desired-num-scorpion >= 5)))
			(up-research-status c: ri-torsion-engines == research-available)
			(building-type-count castle > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-torsion-engines c: 1)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)

			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(or
				(up-compare-goal g-desired-num-ram-type >= 3)
				(or
					(up-compare-goal g-desired-num-mangonel >= 3)
					(up-compare-goal g-desired-num-scorpion >= 5)))
			(up-research-status c: ri-torsion-engines == research-available)
			(building-type-count castle > 0)
			=>
			(up-store-tech-name c: ri-torsion-engines)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

	#end-if

	#load-if-defined FRANKISH-CIV

		;--------------
		;	Chivalry
		;--------------

			(defrule
			(or
				(goal g-primary-unit-class cavalry-class)
				(and
					(goal g-support-unit-class cavalry-class)
					(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
			(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
			(up-research-status c: ri-chivalry == research-available)
			(building-type-count castle > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-chivalry c: 1)
			(up-modify-goal g-important-techs-wood-needed g:+ g-wood-cost)
			(up-modify-goal g-important-techs-gold-needed g:+ g-gold-cost)
			(up-modify-goal g-max-wood-needed g:max g-wood-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)

			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(or
				(goal g-primary-unit-class cavalry-class)
				(and
					(goal g-support-unit-class cavalry-class)
					(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
			(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
			(up-research-status c: ri-chivalry == research-available)
			(building-type-count castle > 0)
			=>
			(up-store-tech-name c: ri-chivalry)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

		;-----------------
		;	Bearded Axe
		;-----------------

			(defrule
			(or
				(goal g-primary-unit my-unique-unit)
				(and
					(goal g-support-unit my-unique-unit)
					(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
			(up-research-status c: ri-bearded-axe == research-available)
			(building-type-count castle > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-bearded-axe c: 1)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)

			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(or
				(goal g-primary-unit my-unique-unit)
				(and
					(goal g-support-unit my-unique-unit)
					(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
			(up-research-status c: ri-bearded-axe == research-available)
			(building-type-count castle > 0)
			=>
			(up-store-tech-name c: ri-bearded-axe)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

	#end-if

	#load-if-defined GOTHIC-CIV
	
		;-------------
		;	Anarchy
		;-------------

			(defrule
			(or
				(goal g-primary-unit my-unique-unit)
				(and
					(goal g-support-unit my-unique-unit)
					(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
			(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
			(up-research-status c: ri-anarchy == research-available)
			(building-type-count castle > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-anarchy c: 1)
			(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
			(up-modify-goal g-important-techs-gold-needed g:+ g-gold-cost)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)

			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(or
				(goal g-primary-unit my-unique-unit)
				(and
					(goal g-support-unit my-unique-unit)
					(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
			(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
			(up-research-status c: ri-anarchy == research-available)
			(building-type-count castle > 0)
			=>
			(up-store-tech-name c: ri-anarchy)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

		;---------------
		;	Perfusion
		;---------------

			(defrule
			(or
				(goal g-primary-unit-class infantry-class)
				(and
					(goal g-support-unit-class infantry-class)
					(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
			(up-research-status c: ri-perfusion == research-available)
			(building-type-count castle > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-perfusion c: 1)
			(up-modify-goal g-important-techs-wood-needed g:+ g-wood-cost)
			(up-modify-goal g-important-techs-gold-needed g:+ g-gold-cost)
			(up-modify-goal g-max-wood-needed g:max g-wood-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)

			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(or
				(goal g-primary-unit-class infantry-class)
				(and
					(goal g-support-unit-class infantry-class)
					(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
			(up-research-status c: ri-perfusion == research-available)
			(building-type-count castle > 0)
			=>
			(up-store-tech-name c: ri-perfusion)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

	#end-if

	#load-if-defined GURJARAS-CIV

		;----------------
		;	Kshatriyas
		;----------------

			(defrule
			(or
				(goal g-primary-unit camel)
				(or
					(goal g-primary-unit scout-cavalry)
					(or
						(goal g-primary-unit elephant-archer)
						(or
							(goal g-primary-unit my-unique-unit)
							(goal g-primary-unit my-second-unique-unit)))))
			(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
			(up-research-status c: ri-kshatriyas == research-available)
			(building-type-count castle > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-kshatriyas c: 1)
			(up-modify-escrow food g:- g-food-cost)
			(up-modify-escrow gold g:- g-gold-cost)
			)
			(defrule
			(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
			(or
				(goal g-support-unit camel)
				(or
					(goal g-support-unit scout-cavalry)
					(goal g-support-unit elephant-archer)))
			(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
			(up-research-status c: ri-kshatriyas == research-available)
			(building-type-count castle > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-kshatriyas c: 1)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)
			(defrule
			(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
			(or
				(goal g-support-unit my-unique-unit)
				(goal g-support-unit my-second-unique-unit))
			(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
			(up-research-status c: ri-kshatriyas == research-available)
			(building-type-count castle > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-kshatriyas c: 1)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)

			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(or
				(goal g-primary-unit camel)
				(or
					(goal g-primary-unit scout-cavalry)
					(or
						(goal g-primary-unit elephant-archer)
						(or
							(goal g-primary-unit my-unique-unit)
							(goal g-primary-unit my-second-unique-unit)))))
			(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
			(up-research-status c: ri-kshatriyas == research-available)
			(building-type-count castle > 0)
			=>
			(up-store-tech-name c: ri-kshatriyas)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)
			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
			(or
				(goal g-support-unit camel)
				(or
					(goal g-support-unit scout-cavalry)
					(or
						(goal g-support-unit elephant-archer)
						(or
							(goal g-support-unit my-unique-unit)
							(goal g-support-unit my-second-unique-unit)))))
			(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
			(up-research-status c: ri-kshatriyas == research-available)
			(building-type-count castle > 0)
			=>
			(up-store-tech-name c: ri-kshatriyas)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

		;---------------------
		;	Frontier Guards
		;---------------------

			(defrule
			(or
				(goal g-primary-unit camel)
				(goal g-primary-unit elephant-archer))
			(up-research-status c: ri-frontier-guards == research-available)
			(building-type-count castle > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-frontier-guards c: 1)
			(up-modify-escrow food g:- g-food-cost)
			(up-modify-escrow gold g:- g-gold-cost)
			)
			(defrule
			(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
			(or
				(goal g-support-unit camel)
				(goal g-support-unit elephant-archer))
			(up-research-status c: ri-frontier-guards == research-available)
			(building-type-count castle > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-frontier-guards c: 1)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)

			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(or
				(goal g-primary-unit camel)
				(goal g-primary-unit elephant-archer))
			(up-research-status c: ri-frontier-guards == research-available)
			(building-type-count castle > 0)
			=>
			(up-store-tech-name c: ri-frontier-guards)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)
			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
			(or
				(goal g-support-unit camel)
				(goal g-support-unit elephant-archer))
			(up-research-status c: ri-frontier-guards == research-available)
			(building-type-count castle > 0)
			=>
			(up-store-tech-name c: ri-frontier-guards)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

	#end-if

	#load-if-defined HUN-CIV

		;---------------
		;	Marauders
		;---------------

			(defrule
			(goal g-primary-unit my-unique-unit)
			(up-compare-goal g-unique-unit-tech-progress >= SECONDARY-CASTLE-COMPLETE)
			(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
			(up-research-status c: ri-marauders == research-available)
			(building-type-count castle > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-marauders c: 1)
			(up-modify-goal g-max-wood-needed g:max g-wood-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)
			(defrule
			(goal g-support-unit my-unique-unit)
			(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
			(up-compare-goal g-unique-unit-tech-progress >= SECONDARY-CASTLE-COMPLETE)
			(up-compare-goal g-desired-num-unique-unit >= 12)
			(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
			(up-research-status c: ri-marauders == research-available)
			(building-type-count castle > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-marauders c: 1)
			(up-modify-goal g-max-wood-needed g:max g-wood-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)

			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(up-compare-goal g-unique-unit-tech-progress >= SECONDARY-CASTLE-COMPLETE)
			(goal g-primary-unit my-unique-unit)
			(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
			(up-research-status c: ri-marauders == research-available)
			(building-type-count castle > 0)
			=>
			(up-store-tech-name c: ri-marauders)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)
			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(goal g-support-unit my-unique-unit)
			(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
			(up-compare-goal g-unique-unit-tech-progress >= SECONDARY-CASTLE-COMPLETE)
			(up-compare-goal g-desired-num-unique-unit >= 12)
			(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
			(up-research-status c: ri-marauders == research-available)
			(building-type-count castle > 0)
			=>
			(up-store-tech-name c: ri-marauders)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

	#end-if

	#load-if-defined INCAN-CIV

		;------------------
		;	Andean Sling
		;------------------

			(defrule
			(goal g-primary-unit skirmisher)
			(or
				(up-compare-goal g-skirmisher-line >= 10)
				(up-compare-goal g-skirmisher-line g:>= g-desired-num-skirmisher))
			(or
				(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
				(food-amount >= 1200))
			(up-research-status c: ri-andean-sling == research-available)
			(building-type-count castle > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-andean-sling c: 1)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			(up-jump-rule 3)
			)
				(defrule
				(goal g-primary-unit slinger)
				(or
					(unit-type-count slinger >= 10)
					(unit-type-count slinger g:>= g-desired-num-skirmisher))
				(or
					(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
					(food-amount >= 1200))
				(up-research-status c: ri-andean-sling == research-available)
				(building-type-count castle > 0)
				=>
				(up-setup-cost-data 1 g-food-cost)
				(up-add-research-cost c: ri-andean-sling c: 1)
				(up-modify-goal g-max-food-needed g:max g-food-cost)
				(up-modify-goal g-max-gold-needed g:max g-gold-cost)
				(up-jump-rule 2)
				)
				(defrule
				(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
				(goal g-support-unit skirmisher)
				(or
					(up-compare-goal g-skirmisher-line >= 12)
					(up-compare-goal g-skirmisher-line g:>= g-desired-num-skirmisher))
				(or
					(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
					(food-amount >= 1200))
				(up-research-status c: ri-andean-sling == research-available)
				(building-type-count castle > 0)
				=>
				(up-setup-cost-data 1 g-food-cost)
				(up-add-research-cost c: ri-andean-sling c: 1)
				(up-modify-goal g-max-food-needed g:max g-food-cost)
				(up-modify-goal g-max-gold-needed g:max g-gold-cost)
				(up-jump-rule 1)
				)
				(defrule
				(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
				(goal g-support-unit slinger)
				(or
					(unit-type-count slinger >= 12)
					(unit-type-count slinger g:>= g-desired-num-skirmisher))
				(or
					(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
					(food-amount >= 1200))
				(up-research-status c: ri-andean-sling == research-available)
				(building-type-count castle > 0)
				=>
				(up-setup-cost-data 1 g-food-cost)
				(up-add-research-cost c: ri-andean-sling c: 1)
				(up-modify-goal g-max-food-needed g:max g-food-cost)
				(up-modify-goal g-max-gold-needed g:max g-gold-cost)
				)

			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(goal g-primary-unit skirmisher)
			(or
				(up-compare-goal g-skirmisher-line >= 10)
				(up-compare-goal g-skirmisher-line g:>= g-desired-num-skirmisher))
			(or
				(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
				(food-amount >= 1200))
			(up-research-status c: ri-andean-sling == research-available)
			(building-type-count castle > 0)
			=>
			(up-store-tech-name c: ri-andean-sling)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			(up-jump-rule 3)
			)
				(defrule
				(taunt-detected TAUNT-PLAYER 246)
				(goal g-primary-unit slinger)
				(or
					(unit-type-count slinger >= 10)
					(unit-type-count slinger g:>= g-desired-num-skirmisher))
				(or
					(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
					(food-amount >= 1200))
				(up-research-status c: ri-andean-sling == research-available)
				(building-type-count castle > 0)
				=>
				(up-store-tech-name c: ri-andean-sling)
				(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
				(up-jump-rule 2)
				)
				(defrule
				(taunt-detected TAUNT-PLAYER 246)
				(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
				(goal g-support-unit skirmisher)
				(or
					(up-compare-goal g-skirmisher-line >= 12)
					(up-compare-goal g-skirmisher-line g:>= g-desired-num-skirmisher))
				(or
					(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
					(food-amount >= 1200))
				(up-research-status c: ri-andean-sling == research-available)
				(building-type-count castle > 0)
				=>
				(up-store-tech-name c: ri-andean-sling)
				(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
				(up-jump-rule 1)
				)
				(defrule
				(taunt-detected TAUNT-PLAYER 246)
				(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
				(goal g-support-unit slinger)
				(or
					(unit-type-count slinger >= 12)
					(unit-type-count slinger g:>= g-desired-num-skirmisher))
				(or
					(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
					(food-amount >= 1200))
				(up-research-status c: ri-andean-sling == research-available)
				(building-type-count castle > 0)
				=>
				(up-store-tech-name c: ri-andean-sling)
				(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
				)

		;-----------------------------
		;	Couriers/Fabric Shields
		;-----------------------------

			(defrule
			(or
				(goal g-primary-unit eagle-warrior)
				(or
					(goal g-primary-unit slinger)
					(goal g-primary-unit my-unique-unit)))
			(up-research-status c: ri-fabric-shields == research-available)
			(building-type-count castle > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-fabric-shields c: 1)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			(up-jump-rule 1)
			)
				(defrule
				(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
				(or
					(goal g-support-unit eagle-warrior)
					(or
						(goal g-support-unit slinger)
						(goal g-support-unit my-unique-unit)))
				(up-research-status c: ri-fabric-shields == research-available)
				(building-type-count castle > 0)
				=>
				(up-setup-cost-data 1 g-food-cost)
				(up-add-research-cost c: ri-fabric-shields c: 1)
				(up-modify-goal g-max-food-needed g:max g-food-cost)
				(up-modify-goal g-max-gold-needed g:max g-gold-cost)
				)

			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(or
				(goal g-primary-unit eagle-warrior)
				(or
					(goal g-primary-unit slinger)
					(goal g-primary-unit my-unique-unit)))
			(up-research-status c: ri-fabric-shields == research-available)
			(building-type-count castle > 0)
			=>
			(up-store-tech-name c: ri-fabric-shields)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			(up-jump-rule 1)
			)
				(defrule
				(taunt-detected TAUNT-PLAYER 246)
				(or
					(goal g-support-unit eagle-warrior)
					(or
						(goal g-support-unit slinger)
						(goal g-support-unit my-unique-unit)))
				(up-research-status c: ri-fabric-shields == research-available)
				(building-type-count castle > 0)
				=>
				(up-store-tech-name c: ri-fabric-shields)
				(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
				)

	#end-if

	#load-if-defined INDIAN-CIV

		;--------------
		;	Shatagni
		;--------------

			(defrule
			(or
				(goal g-primary-unit hand-cannoneer)
				(and
					(goal g-support-unit hand-cannoneer)
					(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
			(up-research-status c: ri-shatagni == research-available)
			(building-type-count castle > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-shatagni c: 1)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)

			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(or
				(goal g-primary-unit hand-cannoneer)
				(and
					(goal g-support-unit hand-cannoneer)
					(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
			(up-research-status c: ri-shatagni == research-available)
			(building-type-count castle > 0)
			=>
			(up-store-tech-name c: ri-shatagni)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

	#end-if

	#load-if-defined ITALIAN-CIV

		;------------
		;	Pavise
		;------------

			#load-if-defined DE-AVAILABLE

				(defrule
				(or
					(goal g-primary-unit condottiero)
					(and
						(goal g-support-unit condottiero)
						(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
				(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
				(up-research-status c: ri-chain-mail >= research-pending)
				(up-research-status c: ri-iron-casting >= research-pending)
				(up-research-status c: ri-pavise == research-available)
				(building-type-count castle > 0)
				=>
				(up-setup-cost-data 1 g-food-cost)
				(up-add-research-cost c: ri-pavise c: 1)
				(up-modify-goal g-max-food-needed g:max g-food-cost)
				(up-modify-goal g-max-gold-needed g:max g-gold-cost)
				)

				(defrule
				(taunt-detected TAUNT-PLAYER 246)
				(or
					(goal g-primary-unit condottiero)
					(and
						(goal g-support-unit condottiero)
						(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
				(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
				(up-research-status c: ri-chain-mail >= research-pending)
				(up-research-status c: ri-iron-casting >= research-pending)
				(up-research-status c: ri-pavise == research-available)
				(building-type-count castle > 0)
				=>
				(up-store-tech-name c: ri-pavise)
				(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
				)

			#end-if

			(defrule
			(or
				(goal g-primary-unit archer)
				(goal g-primary-unit my-unique-unit))
			(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
			(up-research-status c: ri-leather-archer-armor >= research-pending)
			(up-research-status c: ri-bodkin-arrow >= research-pending)
			(up-research-status c: ri-pavise == research-available)
			(building-type-count castle > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-pavise c: 1)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			(up-jump-rule 1)
			)
				(defrule
				(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
				(or
					(goal g-support-unit archer)
					(goal g-support-unit my-unique-unit))
				(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
				(up-research-status c: ri-leather-archer-armor >= research-pending)
				(up-research-status c: ri-bodkin-arrow >= research-pending)
				(up-research-status c: ri-pavise == research-available)
				(building-type-count castle > 0)
				=>
				(up-setup-cost-data 1 g-food-cost)
				(up-add-research-cost c: ri-pavise c: 1)
				(up-modify-goal g-max-food-needed g:max g-food-cost)
				(up-modify-goal g-max-gold-needed g:max g-gold-cost)
				)

			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(or
				(goal g-primary-unit archer)
				(goal g-primary-unit my-unique-unit))
			(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
			(up-research-status c: ri-leather-archer-armor >= research-pending)
			(up-research-status c: ri-bodkin-arrow >= research-pending)
			(up-research-status c: ri-pavise == research-available)
			(building-type-count castle > 0)
			=>
			(up-store-tech-name c: ri-pavise)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			(up-jump-rule 1)
			)
				(defrule
				(taunt-detected TAUNT-PLAYER 246)
				(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
				(or
					(goal g-support-unit archer)
					(goal g-support-unit my-unique-unit))
				(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
				(up-research-status c: ri-leather-archer-armor >= research-pending)
				(up-research-status c: ri-bodkin-arrow >= research-pending)
				(up-research-status c: ri-pavise == research-available)
				(building-type-count castle > 0)
				=>
				(up-store-tech-name c: ri-pavise)
				(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
				)

		;---------------
		;	Silk Road
		;---------------

			(defrule
			(or
				(up-compare-goal g-desired-num-trade-cart > 0)
				(up-compare-goal g-desired-num-trade-cog > 0))
			(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
			(up-research-status c: ri-silk-road == research-available)
			(building-type-count castle > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-silk-road c: 1)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)

			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(or
				(up-compare-goal g-desired-num-trade-cart > 0)
				(up-compare-goal g-desired-num-trade-cog > 0))
			(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
			(up-research-status c: ri-silk-road == research-available)
			(building-type-count castle > 0)
			=>
			(up-store-tech-name c: ri-silk-road)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

	#end-if

	#load-if-defined JAPANESE-CIV

		;------------
		;	Yasama
		;------------

			(defrule
			(up-compare-goal g-desired-num-tower >= 4)
			(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
			(up-research-status c: ri-yasama == research-available)
			(building-type-count castle > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-yasama c: 1)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-wood-needed g:max g-wood-cost)
			)

			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(up-compare-goal g-desired-num-tower >= 4)
			(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
			(up-research-status c: ri-yasama == research-available)
			(building-type-count castle > 0)
			=>
			(up-store-tech-name c: ri-yasama)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

		;----------------
		;	Kataparuto
		;----------------

			(defrule
			(up-compare-goal g-desired-num-trebuchet >= 3)
			(up-research-status c: ri-kataparuto == research-available)
			(building-type-count castle > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-kataparuto c: 1)
			(up-modify-goal g-max-wood-needed g:max g-wood-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)

			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(up-compare-goal g-desired-num-trebuchet >= 3)
			(up-research-status c: ri-kataparuto == research-available)
			(building-type-count castle > 0)
			=>
			(up-store-tech-name c: ri-kataparuto)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

	#end-if

	#load-if-defined KHMER-CIV

		;-----------------
		;	Tusk Swords
		;-----------------

			(defrule
			(or
				(goal g-primary-unit battle-elephant)
				(and
					(goal g-support-unit battle-elephant)
					(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
			(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
			(up-research-status c: ri-tusk-swords == research-available)
			(building-type-count castle > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-tusk-swords c: 1)
			(up-modify-goal g-max-wood-needed g:max g-wood-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)

			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(or
				(goal g-primary-unit battle-elephant)
				(and
					(goal g-support-unit battle-elephant)
					(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
			(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
			(up-research-status c: ri-tusk-swords == research-available)
			(building-type-count castle > 0)
			=>
			(up-store-tech-name c: ri-tusk-swords)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

		;---------------------
		;	Double Crossbow
		;---------------------

			(defrule
			(or
				(goal g-primary-unit my-unique-unit)
				(or
					(and
						(goal g-support-unit my-unique-unit)
						(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS))
					(up-compare-goal g-desired-num-scorpion > 5)))
			(up-research-status c: ri-double-crossbow == research-available)
			(building-type-count castle > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-double-crossbow c: 1)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)

			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(or
				(goal g-primary-unit my-unique-unit)
				(or
					(and
						(goal g-support-unit my-unique-unit)
						(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS))
					(up-compare-goal g-desired-num-scorpion > 5)))
			(up-research-status c: ri-double-crossbow == research-available)
			(building-type-count castle > 0)
			=>
			(up-store-tech-name c: ri-double-crossbow)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

	#end-if

	#load-if-defined KOREAN-CIV

		#load-if-defined DE-AVAILABLE

			;--------------
			;	Eupseong
			;--------------

				(defrule
				(up-compare-goal g-desired-num-tower >= 3)
				(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
				(up-research-status c: ri-eupseong == research-available)
				(building-type-count castle > 0)
				=>
				(up-setup-cost-data 1 g-food-cost)
				(up-add-research-cost c: ri-eupseong c: 1)
				(up-modify-goal g-max-food-needed g:max g-food-cost)
				(up-modify-goal g-max-wood-needed g:max g-wood-cost)
				)

				(defrule
				(taunt-detected TAUNT-PLAYER 246)
				(up-compare-goal g-desired-num-tower >= 3)
				(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
				(up-research-status c: ri-eupseong == research-available)
				(building-type-count castle > 0)
				=>
				(up-store-tech-name c: ri-eupseong)
				(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
				)

		#end-if

		;----------------
		;	Shinkichon
		;----------------

			(defrule
			(up-compare-goal g-desired-num-mangonel >= 3)
			(up-research-status c: ri-shinkichon == research-available)
			(building-type-count castle > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-shinkichon c: 1)
			(up-modify-goal g-max-wood-needed g:max g-wood-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)

			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(up-compare-goal g-desired-num-mangonel >= 3)
			(up-research-status c: ri-shinkichon == research-available)
			(building-type-count castle > 0)
			=>
			(up-store-tech-name c: ri-shinkichon)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

	#end-if

	#load-if-defined LITHUANIANS-CIV

		;-------------------
		;	Tower Shields
		;-------------------

			(defrule
			(or
				(goal g-primary-unit spearman)
				(goal g-primary-unit skirmisher))
			(up-research-status c: ri-tower-shields == research-available)
			(building-type-count castle > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-tower-shields c: 1)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			(up-jump-rule 1)
			)
				(defrule
				(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
				(or
					(goal g-support-unit spearman)
					(goal g-support-unit skirmisher))
				(up-research-status c: ri-tower-shields == research-available)
				(building-type-count castle > 0)
				=>
				(up-setup-cost-data 1 g-food-cost)
				(up-add-research-cost c: ri-tower-shields c: 1)
				(up-modify-goal g-max-food-needed g:max g-food-cost)
				(up-modify-goal g-max-gold-needed g:max g-gold-cost)
				)

			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(or
				(goal g-primary-unit spearman)
				(goal g-primary-unit skirmisher))
			(up-research-status c: ri-tower-shields == research-available)
			(building-type-count castle > 0)
			=>
			(up-store-tech-name c: ri-tower-shields)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			(up-jump-rule 1)
			)
				(defrule
				(taunt-detected TAUNT-PLAYER 246)
				(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
				(or
					(goal g-support-unit spearman)
					(goal g-support-unit skirmisher))
				(up-research-status c: ri-tower-shields == research-available)
				(building-type-count castle > 0)
				=>
				(up-store-tech-name c: ri-tower-shields)
				(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
				)

	#end-if

	#load-if-defined MAGYAR-CIV

		;--------------------
		;	Corvinian Army
		;--------------------

			(defrule
			(goal g-primary-unit my-unique-unit)
			(up-compare-goal g-desired-num-unique-unit >= 15)
			(up-compare-goal g-unique-unit-tech-progress >= REQUIRED-IMPERIAL-COMPLETE)
			(up-research-status c: ri-corvinian-army == research-available)
			(building-type-count castle > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-corvinian-army c: 1)
			(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
			(up-modify-goal g-important-techs-gold-needed g:+ g-gold-cost)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			(up-jump-rule 2)
			)
				(defrule
				(goal g-support-unit my-unique-unit)
				(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
				(up-compare-goal g-desired-num-unique-unit >= 15)
				(up-compare-goal g-primary-unit-tech-progress >= PRIORITY-IMPERIAL-COMPLETE)
				(up-compare-goal g-unique-unit-tech-progress >= REQUIRED-IMPERIAL-COMPLETE)
				(up-research-status c: ri-corvinian-army == research-available)
				(building-type-count castle > 0)
				=>
				(up-setup-cost-data 1 g-food-cost)
				(up-add-research-cost c: ri-corvinian-army c: 1)
				(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
				(up-modify-goal g-important-techs-gold-needed g:+ g-gold-cost)
				(up-modify-goal g-max-food-needed g:max g-food-cost)
				(up-modify-goal g-max-gold-needed g:max g-gold-cost)
				(up-jump-rule 1)
				)
				(defrule
				(goal g-age-status LATE-IMPERIAL)
				(or
					(goal g-primary-unit my-unique-unit)
					(and
						(goal g-support-unit my-unique-unit)
						(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
				(up-compare-goal g-desired-num-unique-unit > 10)
				(up-research-status c: ri-corvinian-army == research-available)
				(building-type-count castle > 0)
				=>
				(up-setup-cost-data 1 g-food-cost)
				(up-add-research-cost c: ri-corvinian-army c: 1)
				(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
				(up-modify-goal g-important-techs-gold-needed g:+ g-gold-cost)
				(up-modify-goal g-max-food-needed g:max g-food-cost)
				(up-modify-goal g-max-gold-needed g:max g-gold-cost)
				)

			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(goal g-primary-unit my-unique-unit)
			(up-compare-goal g-desired-num-unique-unit >= 15)
			(up-compare-goal g-unique-unit-tech-progress >= REQUIRED-IMPERIAL-COMPLETE)
			(up-research-status c: ri-corvinian-army == research-available)
			(building-type-count castle > 0)
			=>
			(up-store-tech-name c: ri-corvinian-army)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			(up-jump-rule 2)
			)
				(defrule
				(taunt-detected TAUNT-PLAYER 246)
				(goal g-support-unit my-unique-unit)
				(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
				(up-compare-goal g-desired-num-unique-unit >= 15)
				(up-compare-goal g-primary-unit-tech-progress >= PRIORITY-IMPERIAL-COMPLETE)
				(up-compare-goal g-unique-unit-tech-progress >= REQUIRED-IMPERIAL-COMPLETE)
				(up-research-status c: ri-corvinian-army == research-available)
				(building-type-count castle > 0)
				=>
				(up-store-tech-name c: ri-corvinian-army)
				(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
				(up-jump-rule 1)
				)
				(defrule
				(taunt-detected TAUNT-PLAYER 246)
				(goal g-age-status LATE-IMPERIAL)
				(or
					(goal g-primary-unit my-unique-unit)
					(and
						(goal g-support-unit my-unique-unit)
						(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
				(up-compare-goal g-desired-num-unique-unit > 10)
				(up-research-status c: ri-corvinian-army == research-available)
				(building-type-count castle > 0)
				=>
				(up-store-tech-name c: ri-corvinian-army)
				(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
				)

		;-----------------
		;	Recurve Bow
		;-----------------

			(defrule
			(goal g-primary-unit cavalry-archer)
			(up-compare-goal g-cavalry-archer-tech-progress >= PRIORITY-IMPERIAL-COMPLETE)
			(up-research-status c: ri-recurve-bow == research-available)
			(building-type-count castle > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-recurve-bow c: 1)
			(up-modify-goal g-max-wood-needed g:max g-wood-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)
			(defrule
			(goal g-support-unit cavalry-archer)
			(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
			(up-compare-goal g-primary-unit-tech-progress >= PRIORITY-IMPERIAL-COMPLETE)
			(up-compare-goal g-cavalry-archer-tech-progress >= PRIORITY-IMPERIAL-COMPLETE)
			(up-research-status c: ri-recurve-bow == research-available)
			(building-type-count castle > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-recurve-bow c: 1)
			(up-modify-goal g-max-wood-needed g:max g-wood-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)

			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(goal g-primary-unit cavalry-archer)
			(up-compare-goal g-cavalry-archer-tech-progress >= PRIORITY-IMPERIAL-COMPLETE)
			(up-research-status c: ri-recurve-bow == research-available)
			(building-type-count castle > 0)
			=>
			(up-store-tech-name c: ri-recurve-bow)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)
			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(goal g-support-unit cavalry-archer)
			(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
			(up-compare-goal g-primary-unit-tech-progress >= PRIORITY-IMPERIAL-COMPLETE)
			(up-compare-goal g-cavalry-archer-tech-progress >= PRIORITY-IMPERIAL-COMPLETE)
			(up-research-status c: ri-recurve-bow == research-available)
			(building-type-count castle > 0)
			=>
			(up-store-tech-name c: ri-recurve-bow)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

	#end-if

	#load-if-defined MALAY-CIV

		;-------------------
		;	Thalassocracy
		;-------------------

			(defrule
			(up-compare-goal g-desired-num-dock >= 4)
			(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
			(up-research-status c: ri-thalassocracy == research-available)
			(building-type-count castle > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-thalassocracy c: 1)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)

			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(up-compare-goal g-desired-num-dock >= 4)
			(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
			(up-research-status c: ri-thalassocracy == research-available)
			(building-type-count castle > 0)
			=>
			(up-store-tech-name c: ri-thalassocracy)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

		;-----------------
		;	Forced Levy
		;-----------------

			(defrule
			(or
				(goal g-primary-unit militiaman)
				(and
					(goal g-support-unit militiaman)
					(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
			(up-research-status c: ri-forced-levy == research-available)
			(building-type-count castle > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-forced-levy c: 1)
			(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
			(up-modify-goal g-important-techs-gold-needed g:+ g-gold-cost)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			(up-jump-rule 1)
			)
				(defrule
				(up-compare-goal g-desired-num-militia > 10)
				(goal g-age-status LATE-IMPERIAL)
				(up-research-status c: ri-forced-levy == research-available)
				(building-type-count castle > 0)
				=>
				(up-setup-cost-data 1 g-food-cost)
				(up-add-research-cost c: ri-forced-levy c: 1)
				(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
				(up-modify-goal g-important-techs-gold-needed g:+ g-gold-cost)
				(up-modify-goal g-max-food-needed g:max g-food-cost)
				(up-modify-goal g-max-gold-needed g:max g-gold-cost)
				)

			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(or
				(goal g-primary-unit militiaman)
				(and
					(goal g-support-unit militiaman)
					(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
			(up-research-status c: ri-forced-levy == research-available)
			(building-type-count castle > 0)
			=>
			(up-store-tech-name c: ri-forced-levy)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			(up-jump-rule 1)
			)
				(defrule
				(taunt-detected TAUNT-PLAYER 246)
				(up-compare-goal g-desired-num-militia > 10)
				(goal g-age-status LATE-IMPERIAL)
				(up-research-status c: ri-forced-levy == research-available)
				(building-type-count castle > 0)
				=>
				(up-store-tech-name c: ri-forced-levy)
				(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
				)

	#end-if

	#load-if-defined MALIAN-CIV

		;-------------
		;	Farimba
		;-------------

			(defrule
			(or
				(goal g-primary-unit-class cavalry-class)
				(and
					(goal g-support-unit-class cavalry-class)
					(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
			(up-research-status c: ri-farimba == research-available)
			(building-type-count castle > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-farimba c: 1)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)

			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(or
				(goal g-primary-unit-class cavalry-class)
				(and
					(goal g-support-unit-class cavalry-class)
					(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
			(up-research-status c: ri-farimba == research-available)
			(building-type-count castle > 0)
			=>
			(up-store-tech-name c: ri-farimba)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

	#end-if

	#load-if-defined MAYAN-CIV

		#load-if-not-defined DE-AVAILABLE
		
			;---------------------
			;	Obsidian Arrows
			;---------------------

				(defrule
				(or
					(goal g-primary-unit archer)
					(and
						(goal g-support-unit archer)
						(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
				(unit-type-count archer-line >= 12)
				(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
				(up-research-status c: my-second-unique-research == research-available)
				(building-type-count castle > 0)
				=>
				(up-setup-cost-data 1 g-food-cost)
				(up-add-research-cost c: my-second-unique-research c: 1)
				(up-modify-goal g-max-food-needed g:max g-food-cost)
				(up-modify-goal g-max-gold-needed g:max g-gold-cost)
				)

				(defrule
				(taunt-detected TAUNT-PLAYER 246)
				(or
					(goal g-primary-unit archer)
					(and
						(goal g-support-unit archer)
						(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
				(unit-type-count archer-line >= 12)
				(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
				(up-research-status c: my-second-unique-research == research-available)
				(building-type-count castle > 0)
				=>
				(up-store-tech-name c: my-second-unique-research)
				(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
				)

		#else
		
			;-------------------------
			;	Hul'Che Javelineers
			;-------------------------

				(defrule
				(or
					(goal g-primary-unit skirmisher)
					(and
						(goal g-support-unit skirmisher)
						(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
				(or
					(up-compare-goal g-skirmisher-line >= 12)
					(up-compare-goal g-skirmisher-line g:>= g-desired-num-skirmisher))
				(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
				(up-research-status c: ri-hulche-javelineers == research-available)
				(building-type-count castle > 0)
				=>
				(up-setup-cost-data 1 g-food-cost)
				(up-add-research-cost c: ri-hulche-javelineers c: 1)
				(up-modify-goal g-max-food-needed g:max g-food-cost)
				(up-modify-goal g-max-gold-needed g:max g-gold-cost)
				)

				(defrule
				(taunt-detected TAUNT-PLAYER 246)
				(or
					(goal g-primary-unit skirmisher)
					(and
						(goal g-support-unit skirmisher)
						(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
				(or
					(up-compare-goal g-skirmisher-line >= 12)
					(up-compare-goal g-skirmisher-line g:>= g-desired-num-skirmisher))
				(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
				(up-research-status c: ri-hulche-javelineers == research-available)
				(building-type-count castle > 0)
				=>
				(up-store-tech-name c: ri-hulche-javelineers)
				(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
				)

		#end-if

		;---------------
		;	El Dorado
		;---------------

			(defrule
			(or
				(goal g-primary-unit eagle-warrior)
				(and
					(goal g-support-unit eagle-warrior)
					(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
			(up-research-status c: ri-elite-eagle-warrior >= research-pending)
			(up-research-status c: ri-el-dorado == research-available)
			(building-type-count castle > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-el-dorado c: 1)
			(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
			(up-modify-goal g-important-techs-gold-needed g:+ g-gold-cost)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)

			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(or
				(goal g-primary-unit eagle-warrior)
				(and
					(goal g-support-unit eagle-warrior)
					(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
			(up-research-status c: ri-elite-eagle-warrior >= research-pending)
			(up-research-status c: ri-el-dorado == research-available)
			(building-type-count castle > 0)
			=>
			(up-store-tech-name c: ri-el-dorado)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

	#end-if

	#load-if-defined MONGOL-CIV

		;-----------
		;	Drill
		;-----------

			(defrule
			(or
				(up-compare-goal g-desired-num-ram-type >= 3)
				(or
					(up-compare-goal g-desired-num-mangonel >= 3)
					(up-compare-goal g-desired-num-scorpion >= 5)))
			(up-research-status c: ri-drill == research-available)
			(building-type-count castle > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-drill c: 1)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)

			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(or
				(up-compare-goal g-desired-num-ram-type >= 3)
				(or
					(up-compare-goal g-desired-num-mangonel >= 3)
					(up-compare-goal g-desired-num-scorpion >= 5)))
			(up-research-status c: ri-drill == research-available)
			(building-type-count castle > 0)
			=>
			(up-store-tech-name c: ri-drill)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

	#end-if

	#load-if-defined PERSIAN-CIV

		;----------------
		;	Kamandaran
		;----------------
			
			#load-if-defined DE-AVAILABLE

				(defrule
				(or
					(goal g-primary-unit archer)
					(and
						(goal g-support-unit archer)
						(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
				(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
				(up-research-status c: ri-kamandaran == research-available)
				(building-type-count castle > 0)
				=>
				(up-setup-cost-data 1 g-food-cost)
				(up-add-research-cost c: ri-kamandaran c: 1)
				(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
				(up-modify-goal g-important-techs-gold-needed g:+ g-gold-cost)
				(up-modify-goal g-max-food-needed g:max g-food-cost)
				(up-modify-goal g-max-gold-needed g:max g-gold-cost)
				(up-jump-rule 1)
				)
					(defrule
					(up-compare-goal g-desired-num-archer > 10)
					(goal g-age-status LATE-IMPERIAL)
					(up-research-status c: ri-kamandaran == research-available)
					(building-type-count castle > 0)
					=>
					(up-setup-cost-data 1 g-food-cost)
					(up-add-research-cost c: ri-kamandaran c: 1)
					(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
					(up-modify-goal g-important-techs-gold-needed g:+ g-gold-cost)
					(up-modify-goal g-max-food-needed g:max g-food-cost)
					(up-modify-goal g-max-gold-needed g:max g-gold-cost)
					)

				(defrule
				(taunt-detected TAUNT-PLAYER 246)
				(or
					(goal g-primary-unit archer)
					(and
						(goal g-support-unit archer)
						(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
				(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
				(up-research-status c: ri-kamandaran == research-available)
				(building-type-count castle > 0)
				=>
				(up-store-tech-name c: ri-kamandaran)
				(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
				(up-jump-rule 1)
				)
					(defrule
					(up-compare-goal g-desired-num-archer > 10)
					(goal g-age-status LATE-IMPERIAL)
					(up-research-status c: ri-kamandaran == research-available)
					(building-type-count castle > 0)
					=>
					(up-store-tech-name c: ri-kamandaran)
					(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
					)

			#end-if

		;-------------
		;	Mahouts
		;-------------

			(defrule
			(or
				(goal g-primary-unit my-unique-unit)
				(and
					(goal g-support-unit my-unique-unit)
					(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
			(up-research-status c: ri-mahouts == research-available)
			(building-type-count castle > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-mahouts c: 1)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)

			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(or
				(goal g-primary-unit my-unique-unit)
				(and
					(goal g-support-unit my-unique-unit)
					(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
			(up-research-status c: ri-mahouts == research-available)
			(building-type-count castle > 0)
			=>
			(up-store-tech-name c: ri-mahouts)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

	#end-if

	#load-if-defined POLES-CIV

		;-------------------------
		;	Szlachta Privileges
		;-------------------------
			
			(defrule
			(or
				(goal g-primary-unit knight)
				(and
					(goal g-support-unit knight)
					(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
			(up-research-status c: ri-szlachta-privileges == research-available)
			(building-type-count castle > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-szlachta-privileges c: 1)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)
			
			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(or
				(goal g-primary-unit knight)
				(and
					(goal g-support-unit knight)
					(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
			(up-research-status c: ri-szlachta-privileges == research-available)
			(building-type-count castle > 0)
			=>
			(up-store-tech-name c: ri-szlachta-privileges)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

		;---------------------
		;	Lechitic Legacy
		;---------------------
			
			(defrule
			(or
				(goal g-primary-unit scout-cavalry)
				(and
					(goal g-support-unit scout-cavalry)
					(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
			(up-research-status c: ri-lechitic-legacy == research-available)
			(building-type-count castle > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-lechitic-legacy c: 1)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)
			
			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(or
				(goal g-primary-unit scout-cavalry)
				(and
					(goal g-support-unit scout-cavalry)
					(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
			(up-research-status c: ri-lechitic-legacy == research-available)
			(building-type-count castle > 0)
			=>
			(up-store-tech-name c: ri-lechitic-legacy)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

	#end-if

	#load-if-defined PORTUGUESE-CIV

		;--------------
		;	Arquebus
		;--------------

			(defrule
			(or
				(goal g-primary-unit hand-cannoneer)
				(or
					(goal g-primary-unit my-unique-unit)
					(up-compare-goal g-desired-num-bombard-cannon > 2)))
			(up-research-status c: ri-arquebus == research-available)
			(building-type-count castle > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-arquebus c: 1)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			(up-jump-rule 1)
			)
				(defrule
				(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
				(or
					(goal g-support-unit hand-cannoneer)
					(goal g-support-unit my-unique-unit))
				(up-research-status c: ri-arquebus == research-available)
				(building-type-count castle > 0)
				=>
				(up-setup-cost-data 1 g-food-cost)
				(up-add-research-cost c: ri-arquebus c: 1)
				(up-modify-goal g-max-food-needed g:max g-food-cost)
				(up-modify-goal g-max-gold-needed g:max g-gold-cost)
				)

			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(or
				(goal g-primary-unit hand-cannoneer)
				(or
					(goal g-primary-unit my-unique-unit)
					(up-compare-goal g-desired-num-bombard-cannon > 2)))
			(up-research-status c: ri-arquebus == research-available)
			(building-type-count castle > 0)
			=>
			(up-store-tech-name c: ri-arquebus)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			(up-jump-rule 1)
			)
				(defrule
				(taunt-detected TAUNT-PLAYER 246)
				(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
				(or
					(goal g-support-unit hand-cannoneer)
					(goal g-support-unit my-unique-unit))
				(up-research-status c: ri-arquebus == research-available)
				(building-type-count castle > 0)
				=>
				(up-store-tech-name c: ri-arquebus)
				(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
				)

	#end-if

	#load-if-defined ROMANS-CIV

		;---------------
		;	Ballistas
		;---------------

			(defrule
			(up-compare-goal g-desired-num-scorpion >= 4)
			(up-research-status c: ri-ballistas == research-available)
			(building-type-count castle > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-ballistas c: 1)
			(up-modify-goal g-max-wood-needed g:max g-wood-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)

			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(up-compare-goal g-desired-num-scorpion >= 4)
			(up-research-status c: ri-ballistas == research-available)
			(building-type-count castle > 0)
			=>
			(up-store-tech-name c: ri-ballistas)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

		;------------------
		;	Comitatenses
		;------------------

			(defrule
			(or
				(goal g-primary-unit militiaman)
				(or
					(goal g-primary-unit knight)
					(goal g-primary-unit my-unique-unit)))
			(up-research-status c: ri-comitatenses == research-available)
			(building-type-count castle > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-comitatenses c: 1)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)
			(defrule
			(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
			(or
				(goal g-support-unit militiaman)
				(or
					(goal g-support-unit knight)
					(goal g-support-unit my-unique-unit)))
			(up-research-status c: ri-comitatenses == research-available)
			(building-type-count castle > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-comitatenses c: 1)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)

			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(or
				(goal g-primary-unit militiaman)
				(or
					(goal g-primary-unit knight)
					(goal g-primary-unit my-unique-unit)))
			(up-research-status c: ri-comitatenses == research-available)
			(building-type-count castle > 0)
			=>
			(up-store-tech-name c: ri-comitatenses)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)
			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
			(or
				(goal g-support-unit militiaman)
				(or
					(goal g-support-unit knight)
					(goal g-support-unit my-unique-unit)))
			(up-research-status c: ri-comitatenses == research-available)
			(building-type-count castle > 0)
			=>
			(up-store-tech-name c: ri-comitatenses)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

	#end-if

	#load-if-defined SARACEN-CIV

		;--------------
		;	Zealotry
		;--------------

			(defrule
			(or
				(goal g-primary-unit camel)
				(goal g-primary-unit my-unique-unit))
			(up-research-status c: ri-zealotry == research-available)
			(building-type-count castle > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-zealotry c: 1)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)
			(defrule
			(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
			(or
				(goal g-support-unit camel)
				(goal g-support-unit my-unique-unit))
			(up-research-status c: ri-zealotry == research-available)
			(building-type-count castle > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-zealotry c: 1)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)

			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(or
				(goal g-primary-unit camel)
				(goal g-primary-unit my-unique-unit))
			(up-research-status c: ri-zealotry == research-available)
			(building-type-count castle > 0)
			=>
			(up-store-tech-name c: ri-zealotry)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)
			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
			(or
				(goal g-support-unit camel)
				(goal g-support-unit my-unique-unit))
			(up-research-status c: ri-zealotry == research-available)
			(building-type-count castle > 0)
			=>
			(up-store-tech-name c: ri-zealotry)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

	#end-if

	#load-if-defined SICILIANS-CIV

		;-------------
		;	Hauberk
		;-------------

			(defrule
			(or
				(goal g-primary-unit knight)
				(and
					(goal g-support-unit knight)
					(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
			(up-research-status c: ri-hauberk == research-available)
			(building-type-count castle > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-hauberk c: 1)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)

			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(or
				(goal g-primary-unit knight)
				(and
					(goal g-support-unit knight)
					(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
			(up-research-status c: ri-hauberk == research-available)
			(building-type-count castle > 0)
			=>
			(up-store-tech-name c: ri-hauberk)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

	#end-if

	#load-if-defined SLAVIC-CIV
			
		;--------------
		;	Druzhina
		;--------------

			(defrule
			(or
				(goal g-primary-unit-class infantry-class)
				(and
					(goal g-support-unit-class infantry-class)
					(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
			(up-research-status c: ri-druzhina == research-available)
			(building-type-count castle > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-druzhina c: 1)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)

			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(or
				(goal g-primary-unit-class infantry-class)
				(and
					(goal g-support-unit-class infantry-class)
					(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
			(up-research-status c: ri-druzhina == research-available)
			(building-type-count castle > 0)
			=>
			(up-store-tech-name c: ri-druzhina)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

	#end-if

	#load-if-defined SPANISH-CIV
	#end-if

	#load-if-defined TATARS-CIV

		;----------------
		;	Silk Armor
		;----------------

			(defrule
			(or
				(goal g-primary-unit scout-cavalry)
				(or
					(goal g-primary-unit cavalry-archer)
					(goal g-primary-unit steppe-lancer)))
			(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
			(up-research-status c: ri-silk-armor == research-available)
			(building-type-count castle > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-silk-armor c: 1)
			(up-modify-goal g-max-wood-needed g:max g-wood-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)
			(defrule
			(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
			(or
				(goal g-support-unit scout-cavalry)
				(or
					(goal g-support-unit cavalry-archer)
					(goal g-support-unit steppe-lancer)))
			(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
			(up-research-status c: ri-silk-armor == research-available)
			(building-type-count castle > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-silk-armor c: 1)
			(up-modify-goal g-max-wood-needed g:max g-wood-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)

			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(or
				(goal g-primary-unit scout-cavalry)
				(or
					(goal g-primary-unit cavalry-archer)
					(goal g-primary-unit steppe-lancer)))
			(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
			(up-research-status c: ri-silk-armor == research-available)
			(building-type-count castle > 0)
			=>
			(up-store-tech-name c: ri-silk-armor)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)
			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
			(or
				(goal g-support-unit scout-cavalry)
				(or
					(goal g-support-unit cavalry-archer)
					(goal g-support-unit steppe-lancer)))
			(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
			(up-research-status c: ri-silk-armor == research-available)
			(building-type-count castle > 0)
			=>
			(up-store-tech-name c: ri-silk-armor)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

		;------------------------
		;	Timurid Siegecraft
		;------------------------

			(defrule
			(up-compare-goal g-desired-num-trebuchet >= 4)
			(up-research-status c: ri-timurid-siegecraft == research-available)
			(building-type-count castle > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-timurid-siegecraft c: 1)
			(up-modify-goal g-max-wood-needed g:max g-wood-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)

			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(up-compare-goal g-desired-num-trebuchet >= 4)
			(up-research-status c: ri-timurid-siegecraft == research-available)
			(building-type-count castle > 0)
			=>
			(up-store-tech-name c: ri-timurid-siegecraft)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

	#end-if

	#load-if-defined TEUTONIC-CIV

		;--------------
		;	Ironclad
		;--------------

			(defrule
			(or
				(up-compare-goal g-desired-num-ram-type >= 3)
				(or
					(up-compare-goal g-desired-num-mangonel >= 3)
					(or
						(up-compare-goal g-desired-num-scorpion >= 5)
						(or
							(up-compare-goal g-desired-num-bombard-cannon >= 3)
							(up-compare-goal g-desired-num-trebuchet >= 3)))))
			(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
			(up-research-status c: ri-ironclad == research-available)
			(building-type-count castle > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-ironclad c: 1)
			(up-modify-goal g-max-wood-needed g:max g-wood-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)

			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(or
				(up-compare-goal g-desired-num-ram-type >= 3)
				(or
					(up-compare-goal g-desired-num-mangonel >= 3)
					(or
						(up-compare-goal g-desired-num-scorpion >= 5)
						(or
							(up-compare-goal g-desired-num-bombard-cannon >= 3)
							(up-compare-goal g-desired-num-trebuchet >= 3)))))
			(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
			(up-research-status c: ri-ironclad == research-available)
			(building-type-count castle > 0)
			=>
			(up-store-tech-name c: ri-ironclad)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

		;-------------------
		;	Crenellations
		;-------------------

			(defrule
			(or
				(up-compare-goal g-desired-num-castle > 1)
				(and
					(up-compare-goal g-desired-num-castle > 0)
					(goal g-game-focus DEFENSIVE)))
			(up-research-status c: ri-crenellations == research-available)
			(building-type-count castle > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-crenellations c: 1)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-stone-needed g:max g-stone-cost)
			)

			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(or
				(up-compare-goal g-desired-num-castle > 1)
				(and
					(up-compare-goal g-desired-num-castle > 0)
					(goal g-game-focus DEFENSIVE)))
			(up-research-status c: ri-crenellations == research-available)
			(building-type-count castle > 0)
			=>
			(up-store-tech-name c: ri-crenellations)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

	#end-if

	#load-if-defined TURKISH-CIV

		;------------
		;	Sipahi
		;------------

			(defrule
			(or
				(goal g-primary-unit cavalry-archer)
				(goal g-primary-unit genitour))
			(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
			(up-research-status c: ri-sipahi == research-available)
			(building-type-count castle > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-sipahi c: 1)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			(up-jump-rule 1)
			)
				(defrule
				(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
				(or
					(goal g-support-unit cavalry-archer)
					(goal g-support-unit genitour))
				(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
				(up-research-status c: ri-sipahi == research-available)
				(building-type-count castle > 0)
				=>
				(up-setup-cost-data 1 g-food-cost)
				(up-add-research-cost c: ri-sipahi c: 1)
				(up-modify-goal g-max-food-needed g:max g-food-cost)
				(up-modify-goal g-max-gold-needed g:max g-gold-cost)
				)

			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(or
				(goal g-primary-unit cavalry-archer)
				(goal g-primary-unit genitour))
			(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
			(up-research-status c: ri-sipahi == research-available)
			(building-type-count castle > 0)
			=>
			(up-store-tech-name c: ri-sipahi)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			(up-jump-rule 1)
			)
				(defrule
				(taunt-detected TAUNT-PLAYER 246)
				(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
				(or
					(goal g-support-unit cavalry-archer)
					(goal g-support-unit genitour))
				(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
				(up-research-status c: ri-sipahi == research-available)
				(building-type-count castle > 0)
				=>
				(up-store-tech-name c: ri-sipahi)
				(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
				)

		;---------------
		;	Artillery
		;---------------

			(defrule
			(or
				(up-compare-goal g-desired-num-bombard-tower >= 3)
				(or
					(up-compare-goal g-desired-num-bombard-cannon >= 2)
					(up-compare-goal g-desired-num-cannon-galleon >= 2)))
			(up-research-status c: ri-artillery == research-available)
			(building-type-count castle > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-artillery c: 1)
			(up-modify-goal g-max-stone-needed g:max g-stone-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)

			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(or
				(up-compare-goal g-desired-num-bombard-tower >= 3)
				(or
					(up-compare-goal g-desired-num-bombard-cannon >= 2)
					(up-compare-goal g-desired-num-cannon-galleon >= 2)))
			(up-research-status c: ri-artillery == research-available)
			(building-type-count castle > 0)
			=>
			(up-store-tech-name c: ri-artillery)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

	#end-if

	#load-if-defined VIETNAMESE-CIV

		;-------------
		;	Chatras
		;-------------

			(defrule
			(or
				(goal g-primary-unit battle-elephant)
				(and
					(goal g-support-unit battle-elephant)
					(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
			(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
			(up-research-status c: ri-chatras == research-available)
			(building-type-count castle > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-chatras c: 1)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)

			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(or
				(goal g-primary-unit battle-elephant)
				(and
					(goal g-support-unit battle-elephant)
					(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
			(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
			(up-research-status c: ri-chatras == research-available)
			(building-type-count castle > 0)
			=>
			(up-store-tech-name c: ri-chatras)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

	#end-if

	#load-if-defined VIKING-CIV

		;----------------
		;	Chieftains
		;----------------

			(defrule
			(or
				(goal g-primary-unit-class infantry-class)
				(and
					(goal g-support-unit-class infantry-class)
					(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
			(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
			(up-research-status c: ri-chieftains == research-available)
			(building-type-count castle > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-chieftains c: 1)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)

			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(or
				(goal g-primary-unit-class infantry-class)
				(and
					(goal g-support-unit-class infantry-class)
					(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
			(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
			(up-research-status c: ri-chieftains == research-available)
			(building-type-count castle > 0)
			=>
			(up-store-tech-name c: ri-chieftains)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

		;----------------
		;	Bogsveigar
		;----------------

			(defrule
			(or
				(goal g-primary-unit archer)
				(and
					(goal g-support-unit archer)
					(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
			(up-research-status c: ri-bogsveigar == research-available)
			(building-type-count castle > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-bogsveigar c: 1)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)

			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(or
				(goal g-primary-unit archer)
				(and
					(goal g-support-unit archer)
					(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
			(up-research-status c: ri-bogsveigar == research-available)
			(building-type-count castle > 0)
			=>
			(up-store-tech-name c: ri-bogsveigar)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

	#end-if

;=========================<>=========================
;				    CAVALRY TECHS
;=========================<>=========================

	;-----------------------------------------------------
	;	Elite Battle Elephant - Secondary Imperial Tech
	;-----------------------------------------------------

		#load-if-defined UP-GAME-WK

			(defrule
			(or
				(goal g-primary-unit battle-elephant)
				(and
					(goal g-support-unit battle-elephant)
					(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
			(up-research-status c: ri-elite-battle-elephant == research-available)
			(building-type-count stable > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-elite-battle-elephant c: 1)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)

			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(or
				(goal g-primary-unit battle-elephant)
				(and
					(goal g-support-unit battle-elephant)
					(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
			(up-research-status c: ri-elite-battle-elephant == research-available)
			(building-type-count stable > 0)
			=>
			(up-store-tech-name c: ri-elite-battle-elephant)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

		#end-if

	;---------------------------------------
	;	Cavalier - Required Imperial Tech
	;---------------------------------------

		(defrule
		(goal g-primary-unit knight)
		(goal g-age-status TO-IMPERIAL)
		(up-compare-const CAVALIER-AVAILABLE == YES)
		(building-type-count stable > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-cavalier c: 1)
		(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
		(up-modify-goal g-important-techs-gold-needed g:+ g-gold-cost)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(goal g-primary-unit knight)
		(goal g-age-status TO-IMPERIAL)
		(up-compare-const CAVALIER-AVAILABLE == YES)
		(building-type-count stable > 0)
		=>
		(up-store-tech-name c: ri-cavalier)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		)

		(defrule
		(or
			(goal g-primary-unit knight)
			(goal g-support-unit knight))
		(up-research-status c: ri-cavalier == research-available)
		(building-type-count stable > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-cavalier c: 1)
		(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
		(up-modify-goal g-important-techs-gold-needed g:+ g-gold-cost)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(or
			(goal g-primary-unit knight)
			(goal g-support-unit knight))
		(up-research-status c: ri-cavalier == research-available)
		(building-type-count stable > 0)
		=>
		(up-store-tech-name c: ri-cavalier)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		)

	;---------------------------------------
	;	Paladin - Secondary Imperial Tech
	;---------------------------------------

		(defrule
		(or
			(goal g-primary-unit knight)
			(and
				(goal g-support-unit knight)
				(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
		(player-in-game any-ally)
		(up-research-status c: ri-paladin == research-available)
		(building-type-count stable > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-paladin c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(or
			(goal g-primary-unit knight)
			(and
				(goal g-support-unit knight)
				(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
		(player-in-game any-ally)
		(up-research-status c: ri-paladin == research-available)
		(building-type-count stable > 0)
		=>
		(up-store-tech-name c: ri-paladin)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		)

	;---------------------------------------
	;	Savar - Secondary Imperial Tech
	;---------------------------------------

		(defrule
		(or
			(goal g-primary-unit knight)
			(and
				(goal g-support-unit knight)
				(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
		(player-in-game any-ally)
		(up-research-status c: ri-savar == research-available)
		(building-type-count stable > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-savar c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(or
			(goal g-primary-unit knight)
			(and
				(goal g-support-unit knight)
				(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
		(player-in-game any-ally)
		(up-research-status c: ri-savar == research-available)
		(building-type-count stable > 0)
		=>
		(up-store-tech-name c: ri-savar)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		)

	;-----------------------------------------------------
	;	Elite Shrivamsha Rider - Priority Imperial Tech
	;-----------------------------------------------------

		#load-if-defined GURJARAS-CIV

			(defrule
			(goal g-primary-unit shrivamsha-rider)
			(goal g-age-status TO-IMPERIAL)
			(up-compare-const ELITE-STEPPE-LANCER-AVAILABLE == YES)
			(building-type-count stable > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-elite-shrivamsha-rider c: 1)
			(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
			(up-modify-goal g-important-techs-gold-needed g:+ g-gold-cost)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)

			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(goal g-primary-unit shrivamsha-rider)
			(goal g-age-status TO-IMPERIAL)
			(up-compare-const ELITE-STEPPE-LANCER-AVAILABLE == YES)
			(building-type-count stable > 0)
			=>
			(up-store-tech-name c: ri-elite-shrivamsha-rider)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

			(defrule
			(or
				(goal g-primary-unit shrivamsha-rider)
				(and
					(goal g-support-unit shrivamsha-rider)
					(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
			(up-research-status c: ri-elite-shrivamsha-rider == research-available)
			(building-type-count stable > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-elite-shrivamsha-rider c: 1)
			(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
			(up-modify-goal g-important-techs-gold-needed g:+ g-gold-cost)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)

			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(or
				(goal g-primary-unit shrivamsha-rider)
				(and
					(goal g-support-unit shrivamsha-rider)
					(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
			(up-research-status c: ri-elite-shrivamsha-rider == research-available)
			(building-type-count stable > 0)
			=>
			(up-store-tech-name c: ri-elite-shrivamsha-rider)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

		#end-if

	;------------------------------------------
	;	Heavy Camel - Required Imperial Tech
	;------------------------------------------

		(defrule
		(goal g-primary-unit camel)
		(goal g-age-status TO-IMPERIAL)
		(up-compare-const HEAVY-CAMEL-AVAILABLE == YES)
		(building-type-count stable > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-heavy-camel c: 1)
		(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
		(up-modify-goal g-important-techs-gold-needed g:+ g-gold-cost)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(goal g-primary-unit camel)
		(goal g-age-status TO-IMPERIAL)
		(up-compare-const HEAVY-CAMEL-AVAILABLE == YES)
		(building-type-count stable > 0)
		=>
		(up-store-tech-name c: ri-heavy-camel)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		)

		(defrule
		(or
			(goal g-primary-unit camel)
			(goal g-support-unit camel))
		(up-research-status c: ri-heavy-camel == research-available)
		(building-type-count stable > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-heavy-camel c: 1)
		(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
		(up-modify-goal g-important-techs-gold-needed g:+ g-gold-cost)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(or
			(goal g-primary-unit camel)
			(goal g-support-unit camel))
		(up-research-status c: ri-heavy-camel == research-available)
		(building-type-count stable > 0)
		=>
		(up-store-tech-name c: ri-heavy-camel)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		)

	;----------------------------------------------
	;	Imperial Camel - Secondary Imperial Tech
	;----------------------------------------------

		#load-if-defined INDIAN-CIV

			(defrule
			(or
				(goal g-primary-unit camel)
				(and
					(goal g-support-unit camel)
					(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
			(player-in-game any-ally)
			(up-research-status c: ri-imperial-camel == research-available)
			(building-type-count stable > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-imperial-camel c: 1)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)

			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(or
				(goal g-primary-unit camel)
				(and
					(goal g-support-unit camel)
					(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
			(player-in-game any-ally)
			(up-research-status c: ri-imperial-camel == research-available)
			(building-type-count stable > 0)
			=>
			(up-store-tech-name c: ri-imperial-camel)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

		#end-if

	;--------------------------------------------------
	;	Elite Steppe Lancer - Priority Imperial Tech
	;--------------------------------------------------

		(defrule
		(goal g-primary-unit steppe-lancer)
		(goal g-age-status TO-IMPERIAL)
		(up-compare-const ELITE-STEPPE-LANCER-AVAILABLE == YES)
		(building-type-count stable > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-elite-steppe-lancer c: 1)
		(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
		(up-modify-goal g-important-techs-gold-needed g:+ g-gold-cost)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(goal g-primary-unit steppe-lancer)
		(goal g-age-status TO-IMPERIAL)
		(up-compare-const ELITE-STEPPE-LANCER-AVAILABLE == YES)
		(building-type-count stable > 0)
		=>
		(up-store-tech-name c: ri-elite-steppe-lancer)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		)

		(defrule
		(or
			(goal g-primary-unit steppe-lancer)
			(and
				(goal g-support-unit steppe-lancer)
				(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
		(up-research-status c: ri-elite-steppe-lancer == research-available)
		(building-type-count stable > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-elite-steppe-lancer c: 1)
		(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
		(up-modify-goal g-important-techs-gold-needed g:+ g-gold-cost)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(or
			(goal g-primary-unit steppe-lancer)
			(and
				(goal g-support-unit steppe-lancer)
				(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
		(up-research-status c: ri-elite-steppe-lancer == research-available)
		(building-type-count stable > 0)
		=>
		(up-store-tech-name c: ri-elite-steppe-lancer)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		)

	;------------------------------------------
	;	Light Cavalry - Required Castle Tech
	;------------------------------------------

		(defrule
		(goal g-primary-unit scout-cavalry)
		(goal g-age-status TO-CASTLE)
		(up-compare-const LIGHT-CAVALRY-AVAILABLE == YES)
		(building-type-count stable > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-light-cavalry c: 1)
		(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
		(up-modify-goal g-important-techs-gold-needed g:+ g-gold-cost)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(goal g-primary-unit scout-cavalry)
		(goal g-age-status TO-CASTLE)
		(up-compare-const LIGHT-CAVALRY-AVAILABLE == YES)
		(building-type-count stable > 0)
		=>
		(up-store-tech-name c: ri-light-cavalry)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		)

		(defrule
		(or
			(up-compare-goal g-game-focus != BOOM)
			(or
				(up-compare-goal g-eco-tech-progress >= PRIORITY-CASTLE-COMPLETE)
				(or
					(goal g-town-under-attack YES)
					(goal g-primary-unit scout-cavalry))))
		(up-compare-goal g-desired-num-scout-cavalry > 0)
		(up-research-status c: ri-light-cavalry == research-available)
		(building-type-count stable > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-light-cavalry c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(or
			(up-compare-goal g-game-focus != BOOM)
			(or
				(up-compare-goal g-eco-tech-progress >= PRIORITY-CASTLE-COMPLETE)
				(or
					(goal g-town-under-attack YES)
					(goal g-primary-unit scout-cavalry))))
		(up-compare-goal g-desired-num-scout-cavalry > 0)
		(up-research-status c: ri-light-cavalry == research-available)
		(building-type-count stable > 0)
		=>
		(up-store-tech-name c: ri-light-cavalry)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		)

	;-------------------------------------
	;	Hussar - Priority Imperial Tech
	;-------------------------------------

		(defrule
		(goal g-primary-unit scout-cavalry)
		(goal g-age-status TO-IMPERIAL)
		(research-completed ri-light-cavalry)
		(up-compare-const HUSSAR-AVAILABLE == YES)
		(building-type-count stable > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-hussar c: 1)
		(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
		(up-modify-goal g-important-techs-gold-needed g:+ g-gold-cost)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(goal g-primary-unit scout-cavalry)
		(research-completed ri-light-cavalry)
		(goal g-age-status TO-IMPERIAL)
		(up-compare-const HUSSAR-AVAILABLE == YES)
		(building-type-count stable > 0)
		=>
		(up-store-tech-name c: ri-hussar)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		)

		(defrule
		(or
			(goal g-primary-unit scout-cavalry)
			(or
				(and
					(goal g-support-unit scout-cavalry)
					(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS))
				(and
					(up-compare-goal g-desired-num-scout-cavalry > 0)
					(goal g-age-status LATE-IMPERIAL))))
		(up-research-status c: ri-hussar == research-available)
		(building-type-count stable > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-hussar c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(or
			(goal g-primary-unit scout-cavalry)
			(or
				(and
					(goal g-support-unit scout-cavalry)
					(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS))
				(and
					(up-compare-goal g-desired-num-scout-cavalry > 0)
					(goal g-age-status LATE-IMPERIAL))))
		(up-research-status c: ri-hussar == research-available)
		(building-type-count stable > 0)
		=>
		(up-store-tech-name c: ri-hussar)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		)

    ;------------------------------------------------
    ;   Scale Barding Armor - Priority Castle Tech (>= 3 cavalry)
    ;------------------------------------------------

		(defrule
		(current-age == feudal-age)
		(up-compare-goal g-strategy-type < FAST-CASTLE)
		(goal g-primary-unit scout-cavalry)
		(or
			(up-compare-goal g-age-status != SAVE-FOR-CASTLE)
			(food-amount >= 950))
		; (unit-type-count scout-cavalry-line >= 4)
		(up-research-status c: ri-scale-barding == research-available)
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-scale-barding c: 1)
		(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(current-age == feudal-age)
		(up-compare-goal g-strategy-type < FAST-CASTLE)
		(goal g-primary-unit scout-cavalry)
		(or
			(up-compare-goal g-age-status != SAVE-FOR-CASTLE)
			(food-amount >= 950))
		; (unit-type-count scout-cavalry-line >= 4)
		(up-research-status c: ri-scale-barding == research-available)
		(building-type-count blacksmith > 0)
		=>
		(up-store-tech-name c: ri-scale-barding)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		)

		(defrule
		(current-age >= castle-age)
		(or
			(up-compare-goal g-game-focus != BOOM)
			(or
				(up-compare-goal g-eco-tech-progress >= PRIORITY-CASTLE-COMPLETE)
				(goal g-town-under-attack YES)))
		(goal g-primary-unit-class cavalry-class)
		(up-compare-goal g-age-status >= TO-IMPERIAL)
		(up-research-status c: ri-scale-barding == research-available)
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-scale-barding c: 1)
		(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-jump-rule 3)
		)
			(defrule
			(current-age >= castle-age)
			(or
				(up-compare-goal g-game-focus != BOOM)
				(or
					(up-compare-goal g-eco-tech-progress >= PRIORITY-CASTLE-COMPLETE)
					(goal g-town-under-attack YES)))
			(goal g-primary-unit-class cavalry-class)
			(or
				(unit-type-count cavalry-class >= 3)
				(unit-type-count scout-cavalry-line >= 3))
			(up-research-status c: ri-scale-barding == research-available)
			(building-type-count blacksmith > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-scale-barding c: 1)
			(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-jump-rule 2)
			)
			(defrule
			(current-age >= castle-age)
			(or
				(up-compare-goal g-game-focus != BOOM)
				(or
					(up-compare-goal g-eco-tech-progress >= PRIORITY-CASTLE-COMPLETE)
					(goal g-town-under-attack YES)))
			(goal g-primary-unit-class cavalry-class)
			(or
				(goal g-primary-unit scout-cavalry)
				(goal g-primary-unit camel))
			(up-research-status c: ri-scale-barding == research-available)
			(building-type-count blacksmith > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-scale-barding c: 1)
			(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-jump-rule 1)
			)
			(defrule
			(current-age >= castle-age)
			(or
				(up-compare-goal g-game-focus != BOOM)
				(or
					(up-compare-goal g-eco-tech-progress >= PRIORITY-CASTLE-COMPLETE)
					(goal g-town-under-attack YES)))
			(goal g-support-unit-class cavalry-class)
			(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
			(or
				(unit-type-count cavalry-class >= 3)
				(unit-type-count scout-cavalry-line >= 3))
			(up-research-status c: ri-scale-barding == research-available)
			(building-type-count blacksmith > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-scale-barding c: 1)
			(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(current-age >= castle-age)
		(or
			(up-compare-goal g-game-focus != BOOM)
			(or
				(up-compare-goal g-eco-tech-progress >= PRIORITY-CASTLE-COMPLETE)
				(goal g-town-under-attack YES)))
		(goal g-primary-unit-class cavalry-class)
		(up-compare-goal g-age-status >= TO-IMPERIAL)
		(up-research-status c: ri-scale-barding == research-available)
		(building-type-count blacksmith > 0)
		=>
		(up-store-tech-name c: ri-scale-barding)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		(up-jump-rule 2)
		)
			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(current-age >= castle-age)
			(or
				(up-compare-goal g-game-focus != BOOM)
				(or
					(up-compare-goal g-eco-tech-progress >= PRIORITY-CASTLE-COMPLETE)
					(goal g-town-under-attack YES)))
			(goal g-primary-unit-class cavalry-class)
			(or
				(unit-type-count cavalry-class >= 3)
				(or
					(unit-type-count scout-cavalry-line >= 3)
					(or
						(goal g-primary-unit scout-cavalry)
						(goal g-primary-unit camel))))
			(up-research-status c: ri-scale-barding == research-available)
			(building-type-count blacksmith > 0)
			=>
			(up-store-tech-name c: ri-scale-barding)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			(up-jump-rule 1)
			)
			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(current-age >= castle-age)
			(or
				(up-compare-goal g-game-focus != BOOM)
				(or
					(up-compare-goal g-eco-tech-progress >= PRIORITY-CASTLE-COMPLETE)
					(goal g-town-under-attack YES)))
			(goal g-support-unit-class cavalry-class)
			(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
			(or
				(unit-type-count cavalry-class >= 3)
				(unit-type-count scout-cavalry-line >= 3))
			(up-research-status c: ri-scale-barding == research-available)
			(building-type-count blacksmith > 0)
			=>
			(up-store-tech-name c: ri-scale-barding)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

    ;-------------------------------------------------
    ;   Chain Barding Armor - Secondary Castle Tech (>= 12/15 cavalry or >= 8/10 camels)
    ;-------------------------------------------------

		(defrule
		(goal g-primary-unit-class cavalry-class)
		(or
			(unit-type-count cavalry-class >= 12)
			(or
				(unit-type-count scout-cavalry-line >= 12)
				(or
					(up-compare-goal g-camel-line >= 8)
					(or
						(up-compare-goal g-age-status >= TO-IMPERIAL)
						(unit-type-count cavalry-class g:>= g-desired-num-cavalry)))))
		(or
			(goal g-town-under-attack NO)
			(up-compare-goal g-human-military-count g:>= g-min-military-pop))
		(up-research-status c: ri-chain-barding == research-available)
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-chain-barding c: 1)
		(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
		(up-modify-goal g-important-techs-gold-needed g:+ g-gold-cost)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		)
		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(goal g-primary-unit-class cavalry-class)
		(or
			(unit-type-count cavalry-class >= 12)
			(or
				(unit-type-count scout-cavalry-line >= 12)
				(or
					(up-compare-goal g-camel-line >= 8)
					(or
						(up-compare-goal g-age-status >= TO-IMPERIAL)
						(unit-type-count cavalry-class g:>= g-desired-num-cavalry)))))
		(or
			(goal g-town-under-attack NO)
			(up-compare-goal g-human-military-count g:>= g-min-military-pop))
		(up-research-status c: ri-chain-barding == research-available)
		(building-type-count blacksmith > 0)
		=>
		(up-store-tech-name c: ri-chain-barding)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		)

		(defrule
		(goal g-support-unit-class cavalry-class)
		(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
		(or
			(unit-type-count cavalry-class >= 15)
			(or
				(unit-type-count scout-cavalry-line >= 15)
				(or
					(up-compare-goal g-camel-line >= 10)
					(or
						(up-compare-goal g-age-status >= TO-IMPERIAL)
						(unit-type-count cavalry-class g:>= g-desired-num-cavalry)))))
		(or
			(goal g-town-under-attack NO)
			(up-compare-goal g-human-military-count g:>= g-min-military-pop))
		(up-research-status c: ri-chain-barding == research-available)
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-chain-barding c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		)
		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(goal g-support-unit-class cavalry-class)
		(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
		(or
			(unit-type-count cavalry-class >= 12)
			(or
				(unit-type-count scout-cavalry-line >= 12)
				(or
					(up-compare-goal g-camel-line >= 8)
					(or
						(up-compare-goal g-age-status >= TO-IMPERIAL)
						(unit-type-count cavalry-class g:>= g-desired-num-cavalry)))))
		(or
			(goal g-town-under-attack NO)
			(up-compare-goal g-human-military-count g:>= g-min-military-pop))
		(up-research-status c: ri-chain-barding == research-available)
		(building-type-count blacksmith > 0)
		=>
		(up-store-tech-name c: ri-chain-barding)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		)

    ;--------------------------------------------------
    ;   Plate Barding Armor - Priority Imperial Tech
    ;--------------------------------------------------

		(defrule
		(goal g-primary-unit-class cavalry-class)
		(goal g-age-status TO-IMPERIAL)
		(research-completed ri-chain-barding)
		(up-compare-const PLATE-BARDING-ARMOR-AVAILABLE == YES)
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-plate-barding c: 1)
		(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
		(up-modify-goal g-important-techs-gold-needed g:+ g-gold-cost)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(goal g-primary-unit-class cavalry-class)
		(goal g-age-status TO-IMPERIAL)
		(research-completed ri-chain-barding)
		(up-compare-const PLATE-BARDING-ARMOR-AVAILABLE == YES)
		(building-type-count blacksmith > 0)
		=>
		(up-store-tech-name c: ri-plate-barding)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		)

		(defrule
		(goal g-primary-unit-class cavalry-class)
		(up-research-status c: ri-plate-barding == research-available)
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-plate-barding c: 1)
		(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
		(up-modify-goal g-important-techs-gold-needed g:+ g-gold-cost)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		)
		(defrule
		(goal g-support-unit-class cavalry-class)
		(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
		(up-research-status c: ri-plate-barding == research-available)
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-plate-barding c: 1)
		(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
		(up-modify-goal g-important-techs-gold-needed g:+ g-gold-cost)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(goal g-primary-unit-class cavalry-class)
		(up-research-status c: ri-plate-barding == research-available)
		(building-type-count blacksmith > 0)
		=>
		(up-store-tech-name c: ri-plate-barding)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		)
		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(goal g-support-unit-class cavalry-class)
		(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
		(up-research-status c: ri-plate-barding == research-available)
		(building-type-count blacksmith > 0)
		=>
		(up-store-tech-name c: ri-plate-barding)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		)

    ;----------------------------------------
    ;   Bloodlines - Secondary Castle Tech (>= 6 cavalry)
    ;----------------------------------------
		
		(defrule
		(or
			(unit-type-count cavalry-class < 4)
			(or
				(unit-type-count scout-cavalry-line < 4)
				(and
					(current-age >= castle-age)
					(unit-type-count cavalry-class < 6))))
		(unit-type-count cavalry-class g:< g-desired-num-cavalry)
		=>
		(up-jump-rule 4)
		)

			(defrule
			(current-age >= castle-age)
			(or
				(up-compare-goal g-game-focus != BOOM)
				(or
					(up-compare-goal g-eco-tech-progress >= PRIORITY-CASTLE-COMPLETE)
					(goal g-town-under-attack YES)))
			(or
				(goal g-town-under-attack NO)
				(up-compare-goal g-human-military-count g:>= g-min-military-pop))
			(goal g-primary-unit-class cavalry-class)
			(up-research-status c: ri-bloodlines == research-available)
			(building-type-count stable > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-bloodlines c: 1)
			(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
			(up-modify-goal g-important-techs-gold-needed g:+ g-gold-cost)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)
			(defrule
			(current-age >= castle-age)
			(or
				(up-compare-goal g-game-focus != BOOM)
				(or
					(up-compare-goal g-eco-tech-progress >= PRIORITY-CASTLE-COMPLETE)
					(goal g-town-under-attack YES)))
			(or
				(goal g-town-under-attack NO)
				(up-compare-goal g-human-military-count g:>= g-min-military-pop))
			(goal g-support-unit-class cavalry-class)
			(up-compare-goal g-support-unit != battle-elephant)
			(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
			(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
			(up-research-status c: ri-bloodlines == research-available)
			(building-type-count stable > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-bloodlines c: 1)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)

			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(current-age >= castle-age)
			(or
				(up-compare-goal g-game-focus != BOOM)
				(or
					(up-compare-goal g-eco-tech-progress >= PRIORITY-CASTLE-COMPLETE)
					(goal g-town-under-attack YES)))
			(or
				(goal g-town-under-attack NO)
				(up-compare-goal g-human-military-count g:>= g-min-military-pop))
			(goal g-primary-unit-class cavalry-class)
			(up-research-status c: ri-bloodlines == research-available)
			(building-type-count stable > 0)
			=>
			(up-store-tech-name c: ri-bloodlines)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)
			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(current-age >= castle-age)
			(or
				(up-compare-goal g-game-focus != BOOM)
				(or
					(up-compare-goal g-eco-tech-progress >= PRIORITY-CASTLE-COMPLETE)
					(goal g-town-under-attack YES)))
			(or
				(goal g-town-under-attack NO)
				(up-compare-goal g-human-military-count g:>= g-min-military-pop))
			(goal g-support-unit-class cavalry-class)
			(up-compare-goal g-support-unit != battle-elephant)
			(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
			(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
			(up-research-status c: ri-bloodlines == research-available)
			(building-type-count stable > 0)
			=>
			(up-store-tech-name c: ri-bloodlines)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

    ;----------------------------------------
    ;   Husbandry - Secondary Castle Tech (>= 6 cavalry)
    ;----------------------------------------
		
		(defrule
		(or
			(unit-type-count cavalry-class < 6)
			(unit-type-count scout-cavalry-line < 6))
		(or
			(unit-type-count cavalry-class g:< g-desired-num-cavalry)
			(unit-type-count scout-cavalry-line g:< g-desired-num-cavalry))
		=>
		(up-jump-rule 4)
		)

			(defrule
			(current-age >= castle-age)
			(or
				(up-compare-goal g-game-focus != BOOM)
				(or
					(up-compare-goal g-eco-tech-progress >= PRIORITY-CASTLE-COMPLETE)
					(goal g-town-under-attack YES)))
			(or
				(goal g-town-under-attack NO)
				(up-compare-goal g-human-military-count g:>= g-min-military-pop))
			(goal g-primary-unit-class cavalry-class)
			(up-research-status c: ri-husbandry == research-available)
			(building-type-count stable > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-husbandry c: 1)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			)
			(defrule
			(current-age >= castle-age)
			(or
				(up-compare-goal g-game-focus != BOOM)
				(or
					(up-compare-goal g-eco-tech-progress >= PRIORITY-CASTLE-COMPLETE)
					(goal g-town-under-attack YES)))
			(or
				(goal g-town-under-attack NO)
				(up-compare-goal g-human-military-count g:>= g-min-military-pop))
			(goal g-support-unit-class cavalry-class)
			(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
			(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
			(up-research-status c: ri-husbandry == research-available)
			(building-type-count stable > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-husbandry c: 1)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			)

			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(current-age >= castle-age)
			(or
				(up-compare-goal g-game-focus != BOOM)
				(or
					(up-compare-goal g-eco-tech-progress >= PRIORITY-CASTLE-COMPLETE)
					(goal g-town-under-attack YES)))
			(or
				(goal g-town-under-attack NO)
				(up-compare-goal g-human-military-count g:>= g-min-military-pop))
			(goal g-primary-unit-class cavalry-class)
			(up-research-status c: ri-husbandry == research-available)
			(building-type-count stable > 0)
			=>
			(up-store-tech-name c: ri-husbandry)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)
			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(current-age >= castle-age)
			(or
				(up-compare-goal g-game-focus != BOOM)
				(or
					(up-compare-goal g-eco-tech-progress >= PRIORITY-CASTLE-COMPLETE)
					(goal g-town-under-attack YES)))
			(or
				(goal g-town-under-attack NO)
				(up-compare-goal g-human-military-count g:>= g-min-military-pop))
			(goal g-support-unit-class cavalry-class)
			(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
			(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
			(up-research-status c: ri-husbandry == research-available)
			(building-type-count stable > 0)
			=>
			(up-store-tech-name c: ri-husbandry)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

;=========================<>=========================
;				    ARCHERY TECHS
;=========================<>=========================

	;-----------------------------------------------------
	;	Elite Elephant Archer - Secondary Imperial Tech
	;-----------------------------------------------------

		(defrule
		(or
			(goal g-primary-unit elephant-archer)
			(and
				(goal g-support-unit elephant-archer)
				(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
		(up-research-status c: ri-elite-elephant-archer == research-available)
		(building-type-count archery-range > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-elite-elephant-archer c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(or
			(goal g-primary-unit elephant-archer)
			(and
				(goal g-support-unit elephant-archer)
				(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
		(up-research-status c: ri-elite-elephant-archer == research-available)
		(building-type-count archery-range > 0)
		=>
		(up-store-tech-name c: ri-elite-elephant-archer)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		)

	;----------------------------------------------------
	;	Heavy Cavalry Archer - Secondary Imperial Tech
	;----------------------------------------------------

		(defrule
		(or
			(goal g-primary-unit cavalry-archer)
			(and
				(goal g-support-unit cavalry-archer)
				(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
		(up-research-status c: ri-heavy-cavalry-archer == research-available)
		(building-type-count archery-range > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-heavy-cavalry-archer c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(or
			(goal g-primary-unit cavalry-archer)
			(and
				(goal g-support-unit cavalry-archer)
				(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
		(up-research-status c: ri-heavy-cavalry-archer == research-available)
		(building-type-count archery-range > 0)
		=>
		(up-store-tech-name c: ri-heavy-cavalry-archer)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		)

	;----------------------------------------------
	;	Elite Genitour - Secondary Imperial Tech
	;----------------------------------------------

		#load-if-defined UP-GAME-WK

			(defrule
			(goal g-primary-unit genitour)
			(goal g-age-status TO-IMPERIAL)
			(up-research-status c: ri-elite-genitour < research-pending)
			(building-type-count archery-range > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-elite-genitour c: 1)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-wood-needed g:max g-wood-cost)
			)

			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(goal g-primary-unit genitour)
			(goal g-age-status TO-IMPERIAL)
			(up-research-status c: ri-elite-genitour < research-pending)
			(building-type-count archery-range > 0)
			=>
			(up-store-tech-name c: ri-elite-genitour)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

			(defrule
			(or
				(goal g-primary-unit genitour)
				(and
					(goal g-support-unit genitour)
					(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
			(up-research-status c: ri-elite-genitour == research-available)
			(building-type-count archery-range > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-elite-genitour c: 1)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-wood-needed g:max g-wood-cost)
			)

			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(or
				(goal g-primary-unit genitour)
				(and
					(goal g-support-unit genitour)
					(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
			(up-research-status c: ri-elite-genitour == research-available)
			(building-type-count archery-range > 0)
			=>
			(up-store-tech-name c: ri-elite-genitour)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

		#end-if

	;----------------------------------------
	;	Crossbowman - Required Castle Tech (>= 5 archers)
	;----------------------------------------

		(defrule
		(goal g-primary-unit archer)
		(goal g-age-status TO-CASTLE)
		(up-compare-const CROSSBOWMAN-AVAILABLE == YES)
		(building-type-count archery-range > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-crossbow c: 1)
		(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
		(up-modify-goal g-important-techs-gold-needed g:+ g-gold-cost)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(goal g-primary-unit archer)
		(goal g-age-status TO-CASTLE)
		(up-compare-const CROSSBOWMAN-AVAILABLE == YES)
		(building-type-count archery-range > 0)
		=>
		(up-store-tech-name c: ri-crossbow)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		)

		(defrule
		(or
			(up-compare-goal g-game-focus != BOOM)
			(or
				(up-compare-goal g-eco-tech-progress >= PRIORITY-CASTLE-COMPLETE)
				(goal g-town-under-attack YES)))
		(goal g-primary-unit archer)
		(up-research-status c: ri-crossbow == research-available)
		(building-type-count archery-range > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-crossbow c: 1)
		(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
		(up-modify-goal g-important-techs-gold-needed g:+ g-gold-cost)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-jump-rule 1)
		)
			(defrule
			(or
				(up-compare-goal g-game-focus != BOOM)
				(or
					(up-compare-goal g-eco-tech-progress >= PRIORITY-CASTLE-COMPLETE)
					(goal g-town-under-attack YES)))
			(goal g-support-unit archer)
			(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
			; (or
			; 	(unit-type-count archer-line >= 5)
			; 	(or
			; 		(unit-type-count archer-line g:>= g-desired-num-archer)
			; 		(up-compare-goal g-age-status >= TO-IMPERIAL)))
			(up-research-status c: ri-crossbow == research-available)
			(building-type-count archery-range > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-crossbow c: 1)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(or
			(up-compare-goal g-game-focus != BOOM)
			(or
				(up-compare-goal g-eco-tech-progress >= PRIORITY-CASTLE-COMPLETE)
				(goal g-town-under-attack YES)))
		(goal g-primary-unit archer)
		(up-research-status c: ri-crossbow == research-available)
		(building-type-count archery-range > 0)
		=>
		(up-store-tech-name c: ri-crossbow)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		(up-jump-rule 1)
		)
			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(or
				(up-compare-goal g-game-focus != BOOM)
				(or
					(up-compare-goal g-eco-tech-progress >= PRIORITY-CASTLE-COMPLETE)
					(goal g-town-under-attack YES)))
			(goal g-support-unit archer)
			(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
			; (or
			; 	(unit-type-count archer-line >= 5)
			; 	(or
			; 		(unit-type-count archer-line g:>= g-desired-num-archer)
			; 		(up-compare-goal g-age-status >= TO-IMPERIAL)))
			(up-research-status c: ri-crossbow == research-available)
			(building-type-count archery-range > 0)
			=>
			(up-store-tech-name c: ri-crossbow)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

	;---------------------------------------
	;	Arbalest - Priority Imperial Tech
	;---------------------------------------

		(defrule
		(goal g-primary-unit archer)
		(goal g-age-status TO-IMPERIAL)
		(up-compare-const ARBALEST-AVAILABLE == YES)
		(building-type-count archery-range > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-arbalest c: 1)
		(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
		(up-modify-goal g-important-techs-gold-needed g:+ g-gold-cost)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(goal g-primary-unit archer)
		(goal g-age-status TO-IMPERIAL)
		(up-compare-const ARBALEST-AVAILABLE == YES)
		(building-type-count archery-range > 0)
		=>
		(up-store-tech-name c: ri-arbalest)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		)

		(defrule
		(goal g-primary-unit archer)
		(up-research-status c: ri-arbalest == research-available)
		(building-type-count archery-range > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-arbalest c: 1)
		(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
		(up-modify-goal g-important-techs-gold-needed g:+ g-gold-cost)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-jump-rule 1)
		)
			(defrule
			(goal g-support-unit archer)
			(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
			(up-research-status c: ri-arbalest == research-available)
			(building-type-count archery-range > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-arbalest c: 1)
			(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
			(up-modify-goal g-important-techs-gold-needed g:+ g-gold-cost)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(or
			(goal g-primary-unit archer)
			(and
				(goal g-support-unit archer)
				(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
		(up-research-status c: ri-arbalest == research-available)
		(building-type-count archery-range > 0)
		=>
		(up-store-tech-name c: ri-arbalest)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		)

	;---------------------------------------------
	;	Elite Skirmisher - Priority Castle Tech (>= 8 skirms)
	;---------------------------------------------

		(defrule
		(goal g-primary-unit skirmisher)
		(goal g-age-status TO-CASTLE)
		(up-compare-const ELITE-SKIRMISHER-AVAILABLE == YES)
		(building-type-count archery-range > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-elite-skirmisher c: 1)
		(up-modify-goal g-important-techs-wood-needed g:+ g-wood-cost)
		(up-modify-goal g-important-techs-gold-needed g:+ g-gold-cost)
		(up-modify-goal g-max-wood-needed g:max g-wood-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(goal g-primary-unit skirmisher)
		(goal g-age-status TO-CASTLE)
		(up-compare-const ELITE-SKIRMISHER-AVAILABLE == YES)
		(building-type-count archery-range > 0)
		=>
		(up-store-tech-name c: ri-elite-skirmisher)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		)

		(defrule
		(or
			(up-compare-goal g-game-focus != BOOM)
			(or
				(up-compare-goal g-eco-tech-progress >= PRIORITY-CASTLE-COMPLETE)
				(goal g-town-under-attack YES)))
		(goal g-primary-unit skirmisher)
		(up-research-status c: ri-elite-skirmisher == research-available)
		(building-type-count archery-range > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-elite-skirmisher c: 1)
		(up-modify-goal g-important-techs-wood-needed g:+ g-wood-cost)
		(up-modify-goal g-important-techs-gold-needed g:+ g-gold-cost)
		(up-modify-goal g-max-wood-needed g:max g-wood-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-jump-rule 1)
		)
			(defrule
			(or
				(up-compare-goal g-game-focus != BOOM)
				(or
					(up-compare-goal g-eco-tech-progress >= PRIORITY-CASTLE-COMPLETE)
					(goal g-town-under-attack YES)))
			(goal g-support-unit skirmisher)
			; (or
			; 	(up-compare-goal g-skirmisher-line >= 8)
			; 	(or
			; 		(up-compare-goal g-skirmisher-line g:>= g-desired-num-skirmisher)
			; 		(up-compare-goal g-age-status >= TO-IMPERIAL)))
			(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
			(up-research-status c: ri-elite-skirmisher == research-available)
			(building-type-count archery-range > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-elite-skirmisher c: 1)
			(up-modify-goal g-max-wood-needed g:max g-wood-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(or
			(up-compare-goal g-game-focus != BOOM)
			(or
				(up-compare-goal g-eco-tech-progress >= PRIORITY-CASTLE-COMPLETE)
				(goal g-town-under-attack YES)))
		(goal g-primary-unit skirmisher)
		(up-research-status c: ri-elite-skirmisher == research-available)
		(building-type-count archery-range > 0)
		=>
		(up-store-tech-name c: ri-elite-skirmisher)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		(up-jump-rule 1)
		)
			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(or
				(up-compare-goal g-game-focus != BOOM)
				(or
					(up-compare-goal g-eco-tech-progress >= PRIORITY-CASTLE-COMPLETE)
					(goal g-town-under-attack YES)))
			(goal g-support-unit skirmisher)
			; (or
			; 	(up-compare-goal g-skirmisher-line >= 8)
			; 	(or
			; 		(up-compare-goal g-skirmisher-line g:>= g-desired-num-skirmisher)
			; 		(up-compare-goal g-age-status >= TO-IMPERIAL)))
			(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
			(up-research-status c: ri-elite-skirmisher == research-available)
			(building-type-count archery-range > 0)
			=>
			(up-store-tech-name c: ri-elite-skirmisher)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

	;--------------------------------------------------
	;	Imperial Skirmisher - Priority Imperial Tech
	;--------------------------------------------------

		#load-if-defined UP-GAME-WK

			(defrule
			(goal g-primary-unit skirmisher)
			(goal g-age-status TO-IMPERIAL)
			(or
				(civ-selected vietnamese)
				(players-civ any-ally vietnamese))
			(building-type-count archery-range > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-imperial-skirmisher c: 1)
			(up-modify-goal g-max-wood-needed g:max g-wood-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)

			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(goal g-primary-unit skirmisher)
			(goal g-age-status TO-IMPERIAL)
			(or
				(civ-selected vietnamese)
				(players-civ any-ally vietnamese))
			(building-type-count archery-range > 0)
			=>
			(up-store-tech-name c: ri-imperial-skirmisher)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

			(defrule
			(or
				(goal g-primary-unit skirmisher)
				(and
					(goal g-support-unit skirmisher)
					(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
			(up-research-status c: ri-imperial-skirmisher == research-available)
			(building-type-count archery-range > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-imperial-skirmisher c: 1)
			(up-modify-goal g-max-wood-needed g:max g-wood-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)

			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(or
				(goal g-primary-unit skirmisher)
				(and
					(goal g-support-unit skirmisher)
					(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
			(up-research-status c: ri-imperial-skirmisher == research-available)
			(building-type-count archery-range > 0)
			=>
			(up-store-tech-name c: ri-imperial-skirmisher)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

		#end-if

	;---------------
	;	Chemistry
	;---------------

		(defrule
		(up-research-status c: ri-chemistry == research-available)
		(goal g-primary-unit hand-cannoneer)
		(goal g-age-status TO-IMPERIAL)
		(building-type-count university > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-chemistry c: 1)
		(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
		(up-modify-goal g-important-techs-gold-needed g:+ g-gold-cost)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(up-research-status c: ri-chemistry == research-available)
		(goal g-primary-unit hand-cannoneer)
		(goal g-age-status TO-IMPERIAL)
		(building-type-count university > 0)
		=>
		(up-store-tech-name c: ri-chemistry)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		)

		(defrule
		(up-research-status c: ri-chemistry == research-available)
		(or
			(up-compare-goal g-desired-num-hand-cannoneer > 0)
			(or
				(up-compare-goal g-desired-num-bombard-cannon > 0)
				(or
					(up-compare-goal g-desired-num-cannon-galleon > 0)
					(up-compare-goal g-desired-num-bombard-cannon > 0))))
		(building-type-count university > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-chemistry c: 1)
		(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
		(up-modify-goal g-important-techs-gold-needed g:+ g-gold-cost)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(up-research-status c: ri-chemistry == research-available)
		(or
			(up-compare-goal g-desired-num-hand-cannoneer > 0)
			(or
				(up-compare-goal g-desired-num-bombard-cannon > 0)
				(or
					(up-compare-goal g-desired-num-cannon-galleon > 0)
					(up-compare-goal g-desired-num-bombard-cannon > 0))))
		(building-type-count university > 0)
		=>
		(up-store-tech-name c: ri-chemistry)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		)

	;--------------------------------------
	;	Fletching - Priority Castle Tech (>= 4 ranged units)
	;--------------------------------------

		(defrule
		(current-age == feudal-age)
		(up-compare-goal g-age-status < SAVE-FOR-CASTLE)
		(up-compare-goal g-strategy-type < FAST-CASTLE)
		(or
			(goal g-primary-unit-class archery-class)
			(goal g-support-unit-class archery-class))
		; (unit-type-count archery-class >= 4)
		(up-research-status c: ri-fletching == research-available)
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-fletching c: 1)
		(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
		(up-modify-goal g-important-techs-gold-needed g:+ g-gold-cost)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(current-age == feudal-age)
		(up-compare-goal g-age-status < SAVE-FOR-CASTLE)
		(up-compare-goal g-strategy-type < FAST-CASTLE)
		(or
			(goal g-primary-unit-class archery-class)
			(goal g-support-unit-class archery-class))
		; (unit-type-count archery-class >= 4)
		(up-research-status c: ri-fletching == research-available)
		(building-type-count blacksmith > 0)
		=>
		(up-store-tech-name c: ri-fletching)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		)

		(defrule
		(up-compare-goal g-age-status >= TO-CASTLE)
		(or
			(goal g-primary-unit-class archery-class)
			(goal g-primary-unit-class cavalry-archer-class))
		; (or
		; 	(unit-type-count archery-class >= 4)
		; 	(unit-type-count cavalry-archer-class >= 4))
		(up-research-status c: ri-fletching < research-pending)
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-fletching c: 1)
		(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
		(up-modify-goal g-important-techs-gold-needed g:+ g-gold-cost)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-jump-rule 1)
		)
			(defrule
			(up-compare-goal g-age-status >= TO-CASTLE)
			(or
				(goal g-primary-unit-class archery-class)
				(goal g-primary-unit-class cavalry-archer-class))
			(up-compare-goal g-age-status >= TO-IMPERIAL)
			(up-research-status c: ri-fletching < research-pending)
			(building-type-count blacksmith > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-fletching c: 1)
			(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
			(up-modify-goal g-important-techs-gold-needed g:+ g-gold-cost)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(up-compare-goal g-age-status >= TO-CASTLE)
		(or
			(goal g-primary-unit-class archery-class)
			(goal g-primary-unit-class cavalry-archer-class))
		; (or
		; 	(unit-type-count archery-class >= 4)
		; 	(or
		; 		(unit-type-count cavalry-archer-class >= 4)
		; 		(up-compare-goal g-age-status >= TO-IMPERIAL)))
		(up-research-status c: ri-fletching < research-pending)
		(building-type-count blacksmith > 0)
		=>
		(up-store-tech-name c: ri-fletching)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		)

		(defrule
		(current-age >= castle-age)
		(or
			(goal g-support-unit-class archery-class)
			(goal g-support-unit-class cavalry-archer-class))
		; (or
		; 	(unit-type-count archery-class >= 4)
		; 	(or
		; 		(unit-type-count cavalry-archer-class >= 4)
		; 		(up-compare-goal g-age-status >= TO-IMPERIAL)))
		(up-research-status c: ri-fletching == research-available)
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-fletching c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(current-age >= castle-age)
		(or
			(goal g-support-unit-class archery-class)
			(goal g-support-unit-class cavalry-archer-class))
		; (or
		; 	(unit-type-count archery-class >= 4)
		; 	(or
		; 		(unit-type-count cavalry-archer-class >= 4)
		; 		(up-compare-goal g-age-status >= TO-IMPERIAL)))
		(up-research-status c: ri-fletching == research-available)
		(building-type-count blacksmith > 0)
		=>
		(up-store-tech-name c: ri-fletching)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		)

	;------------------------------------------
	;	Bodkin Arrow - Secondary Castle Tech (>= 8/12 ranged units)
	;------------------------------------------

		(defrule
		(goal g-primary-unit-class archery-class)
		(or
			(unit-type-count archery-class >= 4)
			(unit-type-count archery-class g:>= g-desired-num-foot-archers))
		(or
			(goal g-town-under-attack NO)
			(up-compare-goal g-human-military-count g:>= g-min-military-pop))
		(up-research-status c: ri-bodkin-arrow == research-available)
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-bodkin-arrow c: 1)
		(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
		(up-modify-goal g-important-techs-gold-needed g:+ g-gold-cost)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-jump-rule 5)
		)
			(defrule
			(goal g-support-unit-class archery-class)
			(or
				(unit-type-count archery-class >= 6)
				(unit-type-count archery-class g:>= g-desired-num-foot-archers))
			(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
			(or
				(goal g-town-under-attack NO)
				(up-compare-goal g-human-military-count g:>= g-min-military-pop))
			(up-research-status c: ri-bodkin-arrow == research-available)
			(building-type-count blacksmith > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-bodkin-arrow c: 1)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			(up-jump-rule 4)
			)
			(defrule
			(goal g-primary-unit-class cavalry-archer-class)
			(or
				(unit-type-count cavalry-archer-class >= 4)
				(unit-type-count cavalry-archer-class g:>= g-desired-num-cavalry-archers))
			(or
				(goal g-town-under-attack NO)
				(up-compare-goal g-human-military-count g:>= g-min-military-pop))
			(up-research-status c: ri-bodkin-arrow == research-available)
			(building-type-count blacksmith > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-bodkin-arrow c: 1)
			(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
			(up-modify-goal g-important-techs-gold-needed g:+ g-gold-cost)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			(up-jump-rule 3)
			)
			(defrule
			(goal g-support-unit-class cavalry-archer-class)
			(or
				(unit-type-count cavalry-archer-class >= 6)
				(unit-type-count cavalry-archer-class g:>= g-desired-num-cavalry-archers))
			(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
			(or
				(goal g-town-under-attack NO)
				(up-compare-goal g-human-military-count g:>= g-min-military-pop))
			(up-research-status c: ri-bodkin-arrow == research-available)
			(building-type-count blacksmith > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-bodkin-arrow c: 1)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			(up-jump-rule 2)
			)
			(defrule
			(or
				(goal g-primary-unit-class archery-class)
				(goal g-primary-unit-class cavalry-archer-class))
			(up-compare-goal g-age-status >= TO-IMPERIAL)
			(or
				(goal g-town-under-attack NO)
				(up-compare-goal g-human-military-count g:>= g-min-military-pop))
			(up-research-status c: ri-bodkin-arrow == research-available)
			(building-type-count blacksmith > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-bodkin-arrow c: 1)
			(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
			(up-modify-goal g-important-techs-gold-needed g:+ g-gold-cost)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			(up-jump-rule 1)
			)
			(defrule
			(or
				(goal g-support-unit-class archery-class)
				(goal g-support-unit-class cavalry-archer-class))
			(up-compare-goal g-age-status >= TO-IMPERIAL)
			(or
				(goal g-town-under-attack NO)
				(up-compare-goal g-human-military-count g:>= g-min-military-pop))
			(up-research-status c: ri-bodkin-arrow == research-available)
			(building-type-count blacksmith > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-bodkin-arrow c: 1)
			(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
			(up-modify-goal g-important-techs-gold-needed g:+ g-gold-cost)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(goal g-primary-unit-class archery-class)
		(or
			(unit-type-count archery-class >= 4)
			(unit-type-count archery-class g:>= g-desired-num-foot-archers))
		(or
			(goal g-town-under-attack NO)
			(up-compare-goal g-human-military-count g:>= g-min-military-pop))
		(up-research-status c: ri-bodkin-arrow == research-available)
		(building-type-count blacksmith > 0)
		=>
		(up-store-tech-name c: ri-bodkin-arrow)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		(up-jump-rule 5)
		)
			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(goal g-support-unit-class archery-class)
			(or
				(unit-type-count archery-class >= 6)
				(unit-type-count archery-class g:>= g-desired-num-foot-archers))
			(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
			(or
				(goal g-town-under-attack NO)
				(up-compare-goal g-human-military-count g:>= g-min-military-pop))
			(up-research-status c: ri-bodkin-arrow == research-available)
			(building-type-count blacksmith > 0)
			=>
			(up-store-tech-name c: ri-bodkin-arrow)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			(up-jump-rule 4)
			)
			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(goal g-primary-unit-class cavalry-archer-class)
			(or
				(unit-type-count cavalry-archer-class >= 4)
				(unit-type-count cavalry-archer-class g:>= g-desired-num-cavalry-archers))
			(or
				(goal g-town-under-attack NO)
				(up-compare-goal g-human-military-count g:>= g-min-military-pop))
			(up-research-status c: ri-bodkin-arrow == research-available)
			(building-type-count blacksmith > 0)
			=>
			(up-store-tech-name c: ri-bodkin-arrow)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			(up-jump-rule 3)
			)
			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(goal g-support-unit-class cavalry-archer-class)
			(or
				(unit-type-count cavalry-archer-class >= 6)
				(unit-type-count cavalry-archer-class g:>= g-desired-num-cavalry-archers))
			(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
			(or
				(goal g-town-under-attack NO)
				(up-compare-goal g-human-military-count g:>= g-min-military-pop))
			(up-research-status c: ri-bodkin-arrow == research-available)
			(building-type-count blacksmith > 0)
			=>
			(up-store-tech-name c: ri-bodkin-arrow)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			(up-jump-rule 2)
			)
			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(or
				(goal g-primary-unit-class archery-class)
				(goal g-primary-unit-class cavalry-archer-class))
			(up-compare-goal g-age-status >= TO-IMPERIAL)
			(or
				(goal g-town-under-attack NO)
				(up-compare-goal g-human-military-count g:>= g-min-military-pop))
			(up-research-status c: ri-bodkin-arrow == research-available)
			(building-type-count blacksmith > 0)
			=>
			(up-store-tech-name c: ri-bodkin-arrow)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			(up-jump-rule 1)
			)
			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(or
				(goal g-support-unit-class archery-class)
				(goal g-support-unit-class cavalry-archer-class))
			(up-compare-goal g-age-status >= TO-IMPERIAL)
			(or
				(goal g-town-under-attack NO)
				(up-compare-goal g-human-military-count g:>= g-min-military-pop))
			(up-research-status c: ri-bodkin-arrow == research-available)
			(building-type-count blacksmith > 0)
			=>
			(up-store-tech-name c: ri-bodkin-arrow)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

	;-------------------------------------
	;	Bracer - Priority Imperial Tech
	;-------------------------------------

		(defrule
		(goal g-primary-unit-class archery-class)
		(up-research-status c: ri-bracer == research-available)
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-bracer c: 1)
		(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
		(up-modify-goal g-important-techs-gold-needed g:+ g-gold-cost)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-jump-rule 3)
		)
			(defrule
			(goal g-support-unit-class archery-class)
			(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
			(up-research-status c: ri-bracer == research-available)
			(building-type-count blacksmith > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-bracer c: 1)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			(up-jump-rule 2)
			)
			(defrule
			(goal g-primary-unit-class cavalry-archer-class)
			(up-research-status c: ri-bracer == research-available)
			(building-type-count blacksmith > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-bracer c: 1)
			(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
			(up-modify-goal g-important-techs-gold-needed g:+ g-gold-cost)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			(up-jump-rule 1)
			)
			(defrule
			(goal g-support-unit-class cavalry-archer-class)
			(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
			(up-research-status c: ri-bracer == research-available)
			(building-type-count blacksmith > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-bracer c: 1)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(or
			(goal g-primary-unit-class archery-class)
			(goal g-primary-unit-class cavalry-archer-class))
		(up-research-status c: ri-bracer == research-available)
		(building-type-count blacksmith > 0)
		=>
		(up-store-tech-name c: ri-bracer)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		(up-jump-rule 1)
		)
			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(or
				(goal g-support-unit-class archery-class)
				(goal g-support-unit-class cavalry-archer-class))
			(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
			(up-research-status c: ri-bracer == research-available)
			(building-type-count blacksmith > 0)
			=>
			(up-store-tech-name c: ri-bracer)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

	;-----------------------------------------
	;	Thumb Ring - Priority Imperial Tech (Secondary Castle for cav archers) (>= 7/10 cav archers)
	;-----------------------------------------

		(defrule
		(goal g-primary-unit cavalry-archer)
		(or
			(unit-type-count cavalry-archer-line >= 7)
			(unit-type-count cavalry-archer-line g:>= g-desired-num-cavalry-archer))
		(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
		(or
			(goal g-town-under-attack NO)
			(up-compare-goal g-human-military-count g:>= g-min-military-pop))
		(up-research-status c: ri-thumb-ring == research-available)
		(building-type-count archery-range > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-thumb-ring c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-wood-needed g:max g-wood-cost)
		(up-jump-rule 1)
		)
			(defrule
			(goal g-support-unit cavalry-archer)
			(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
			(or
				(unit-type-count cavalry-archer-line >= 10)
				(unit-type-count cavalry-archer-line g:>= g-desired-num-cavalry-archer))
			(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
			(or
				(goal g-town-under-attack NO)
				(up-compare-goal g-human-military-count g:>= g-min-military-pop))
			(up-research-status c: ri-thumb-ring == research-available)
			(building-type-count archery-range > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-thumb-ring c: 1)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-wood-needed g:max g-wood-cost)
			)
			
		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(goal g-primary-unit cavalry-archer)
		(or
			(unit-type-count cavalry-archer-line >= 7)
			(unit-type-count cavalry-archer-line g:>= g-desired-num-cavalry-archer))
		(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
		(or
			(goal g-town-under-attack NO)
			(up-compare-goal g-human-military-count g:>= g-min-military-pop))
		(up-research-status c: ri-thumb-ring == research-available)
		(building-type-count archery-range > 0)
		=>
		(up-store-tech-name c: ri-thumb-ring)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		(up-jump-rule 1)
		)
			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(goal g-support-unit cavalry-archer)
			(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
			(or
				(unit-type-count cavalry-archer-line >= 10)
				(unit-type-count cavalry-archer-line g:>= g-desired-num-cavalry-archer))
			(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
			(or
				(goal g-town-under-attack NO)
				(up-compare-goal g-human-military-count g:>= g-min-military-pop))
			(up-research-status c: ri-thumb-ring == research-available)
			(building-type-count archery-range > 0)
			=>
			(up-store-tech-name c: ri-thumb-ring)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

	;-------------------------------------------------
	;	Padded Archer Armor - Secondary Castle Tech (>= 7/10 ranged units)
	;-------------------------------------------------

		(defrule
		(current-age == feudal-age)
		(up-compare-goal g-strategy-type < FAST-CASTLE)
		(goal g-primary-unit-class archery-class)
		(unit-type-count archery-class >= 7)
		(or
			(goal g-town-under-attack NO)
			(up-compare-goal g-human-military-count g:>= g-min-military-pop))
		(up-research-status c: ri-padded-archer-armor == research-available)
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-padded-archer-armor c: 1)
		(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-jump-rule 1)
		)
			(defrule
			(current-age == feudal-age)
			(up-compare-goal g-strategy-type < FAST-CASTLE)
			(goal g-support-unit-class archery-class)
			(unit-type-count archery-class >= 10)
			(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
			(or
				(goal g-town-under-attack NO)
				(up-compare-goal g-human-military-count g:>= g-min-military-pop))
			(up-research-status c: ri-padded-archer-armor == research-available)
			(building-type-count blacksmith > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-padded-archer-armor c: 1)
			(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(current-age == feudal-age)
		(up-compare-goal g-strategy-type < FAST-CASTLE)
		(goal g-primary-unit-class archery-class)
		(unit-type-count archery-class >= 7)
		(or
			(goal g-town-under-attack NO)
			(up-compare-goal g-human-military-count g:>= g-min-military-pop))
		(up-research-status c: ri-padded-archer-armor == research-available)
		(building-type-count blacksmith > 0)
		=>
		(up-store-tech-name c: ri-padded-archer-armor)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		(up-jump-rule 1)
		)
			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(current-age == feudal-age)
			(up-compare-goal g-strategy-type < FAST-CASTLE)
			(goal g-support-unit-class archery-class)
			(unit-type-count archery-class >= 10)
			(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
			(or
				(goal g-town-under-attack NO)
				(up-compare-goal g-human-military-count g:>= g-min-military-pop))
			(up-research-status c: ri-padded-archer-armor == research-available)
			(building-type-count blacksmith > 0)
			=>
			(up-store-tech-name c: ri-padded-archer-armor)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

		(defrule
		(current-age >= castle-age)
		(or
			(goal g-primary-unit-class archery-class)
			(goal g-support-unit-class archery-class))
		(or
			(unit-type-count archery-class >= 8)
			(or
				(unit-type-count archery-class g:>= g-desired-num-foot-archers)
				(up-compare-goal g-age-status >= TO-IMPERIAL)))
		(or
			(goal g-town-under-attack NO)
			(up-compare-goal g-human-military-count g:>= g-min-military-pop))
		(up-research-status c: ri-padded-archer-armor == research-available)
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-padded-archer-armor c: 1)
		(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-jump-rule 1)
		)
			(defrule
			(current-age >= castle-age)
			(or
				(goal g-primary-unit-class cavalry-archer-class)
				(goal g-support-unit-class cavalry-archer-class))
			(or
				(unit-type-count cavalry-archer-class >= 8)
				(or
					(unit-type-count cavalry-archer-class g:>= g-desired-num-cavalry-archers)
					(up-compare-goal g-age-status >= TO-IMPERIAL)))
			(or
				(goal g-town-under-attack NO)
				(up-compare-goal g-human-military-count g:>= g-min-military-pop))
			(up-research-status c: ri-padded-archer-armor == research-available)
			(building-type-count blacksmith > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-padded-archer-armor c: 1)
			(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(current-age >= castle-age)
		(or
			(goal g-primary-unit-class archery-class)
			(goal g-support-unit-class archery-class))
		(or
			(unit-type-count archery-class >= 8)
			(or
				(unit-type-count archery-class g:>= g-desired-num-foot-archers)
				(up-compare-goal g-age-status >= TO-IMPERIAL)))
		(or
			(goal g-town-under-attack NO)
			(up-compare-goal g-human-military-count g:>= g-min-military-pop))
		(up-research-status c: ri-padded-archer-armor == research-available)
		(building-type-count blacksmith > 0)
		=>
		(up-store-tech-name c: ri-padded-archer-armor)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		(up-jump-rule 1)
		)
			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(current-age >= castle-age)
			(or
				(goal g-primary-unit-class cavalry-archer-class)
				(goal g-support-unit-class cavalry-archer-class))
			(or
				(unit-type-count cavalry-archer-class >= 8)
				(or
					(unit-type-count cavalry-archer-class g:>= g-desired-num-cavalry-archers)
					(up-compare-goal g-age-status >= TO-IMPERIAL)))
			(or
				(goal g-town-under-attack NO)
				(up-compare-goal g-human-military-count g:>= g-min-military-pop))
			(up-research-status c: ri-padded-archer-armor == research-available)
			(building-type-count blacksmith > 0)
			=>
			(up-store-tech-name c: ri-padded-archer-armor)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

		(defrule
		(current-age >= castle-age)
		(or
			(goal g-primary-unit-class archery-cannon-class)
			(goal g-support-unit-class archery-cannon-class))
		(or
			(unit-type-count archery-cannon-class >= 8)
			(or
				(unit-type-count archery-cannon-class g:>= g-desired-num-hand-cannoneers)
				(up-compare-goal g-age-status >= TO-IMPERIAL)))
		(or
			(goal g-town-under-attack NO)
			(up-compare-goal g-human-military-count g:>= g-min-military-pop))
		(up-research-status c: ri-padded-archer-armor == research-available)
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-padded-archer-armor c: 1)
		(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-jump-rule 1)
		)
			(defrule
			(current-age >= castle-age)
			(or
				(goal g-primary-unit-class cavalry-cannon-class)
				(goal g-support-unit-class cavalry-cannon-class))
			(or
				(unit-type-count cavalry-cannon-class >= 8)
				(or
					(unit-type-count cavalry-cannon-class g:>= g-desired-num-hand-cannoneers)
					(up-compare-goal g-age-status >= TO-IMPERIAL)))
			(or
				(goal g-town-under-attack NO)
				(up-compare-goal g-human-military-count g:>= g-min-military-pop))
			(up-research-status c: ri-padded-archer-armor == research-available)
			(building-type-count blacksmith > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-padded-archer-armor c: 1)
			(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(current-age >= castle-age)
		(or
			(goal g-primary-unit-class archery-cannon-class)
			(goal g-support-unit-class archery-cannon-class))
		(or
			(unit-type-count archery-cannon-class >= 8)
			(or
				(unit-type-count archery-cannon-class g:>= g-desired-num-hand-cannoneers)
				(up-compare-goal g-age-status >= TO-IMPERIAL)))
		(or
			(goal g-town-under-attack NO)
			(up-compare-goal g-human-military-count g:>= g-min-military-pop))
		(up-research-status c: ri-padded-archer-armor == research-available)
		(building-type-count blacksmith > 0)
		=>
		(up-store-tech-name c: ri-padded-archer-armor)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		(up-jump-rule 1)
		)
			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(current-age >= castle-age)
			(or
				(goal g-primary-unit-class cavalry-cannon-class)
				(goal g-support-unit-class cavalry-cannon-class))
			(or
				(unit-type-count cavalry-cannon-class >= 8)
				(or
					(unit-type-count cavalry-cannon-class g:>= g-desired-num-hand-cannoneers)
					(up-compare-goal g-age-status >= TO-IMPERIAL)))
			(or
				(goal g-town-under-attack NO)
				(up-compare-goal g-human-military-count g:>= g-min-military-pop))
			(up-research-status c: ri-padded-archer-armor == research-available)
			(building-type-count blacksmith > 0)
			=>
			(up-store-tech-name c: ri-padded-archer-armor)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

	;---------------------------------------------------
	;	Leather Archer Armor - Priority Imperial Tech (Secondary Castle for Skirms) (>= 11 ranged units)
	;---------------------------------------------------

		(defrule
		(or
			(goal g-primary-unit-class archery-class)
			(and
				(goal g-support-unit-class archery-class)
				(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
		(or
			(unit-type-count archery-class >= 11)
			(or
				(unit-type-count archery-class g:>= g-desired-num-foot-archers)
				(up-compare-goal g-age-status >= TO-IMPERIAL)))
		(or
			(goal g-town-under-attack NO)
			(up-compare-goal g-human-military-count g:>= g-min-military-pop))
		(can-research-with-escrow ri-leather-archer-armor)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-leather-archer-armor c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-jump-rule 3)
		)
			(defrule
			(or
				(goal g-primary-unit-class cavalry-archer-class)
				(and
					(goal g-support-unit-class cavalry-archer-class)
					(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
			(or
				(unit-type-count cavalry-archer-class >= 11)
				(or
					(unit-type-count cavalry-archer-class g:>= g-desired-num-cavalry-archers)
					(up-compare-goal g-age-status >= TO-IMPERIAL)))
			(or
				(goal g-town-under-attack NO)
				(up-compare-goal g-human-military-count g:>= g-min-military-pop))
			(can-research-with-escrow ri-leather-archer-armor)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-leather-archer-armor c: 1)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			(up-jump-rule 2)
			)
			(defrule
			(or
				(goal g-primary-unit-class archery-cannon-class)
				(and
					(goal g-support-unit-class archery-cannon-class)
					(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
			(or
				(unit-type-count archery-cannon-class >= 11)
				(or
					(unit-type-count archery-cannon-class g:>= g-desired-num-hand-cannoneers)
					(up-compare-goal g-age-status >= TO-IMPERIAL)))
			(or
				(goal g-town-under-attack NO)
				(up-compare-goal g-human-military-count g:>= g-min-military-pop))
			(can-research-with-escrow ri-leather-archer-armor)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-leather-archer-armor c: 1)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			(up-jump-rule 1)
			)
			(defrule
			(or
				(goal g-primary-unit-class cavalry-cannon-class)
				(and
					(goal g-support-unit-class cavalry-cannon-class)
					(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
			(or
				(unit-type-count cavalry-cannon-class >= 11)
				(or
					(unit-type-count cavalry-cannon-class g:>= g-desired-num-hand-cannoneers)
					(up-compare-goal g-age-status >= TO-IMPERIAL)))
			(or
				(goal g-town-under-attack NO)
				(up-compare-goal g-human-military-count g:>= g-min-military-pop))
			(can-research-with-escrow ri-leather-archer-armor)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-leather-archer-armor c: 1)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(or
			(goal g-primary-unit-class archery-class)
			(and
				(goal g-support-unit-class archery-class)
				(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
		(or
			(unit-type-count archery-class >= 11)
			(or
				(unit-type-count archery-class g:>= g-desired-num-foot-archers)
				(up-compare-goal g-age-status >= TO-IMPERIAL)))
		(or
			(goal g-town-under-attack NO)
			(up-compare-goal g-human-military-count g:>= g-min-military-pop))
		(can-research-with-escrow ri-leather-archer-armor)
		=>
		(up-store-tech-name c: ri-leather-archer-armor)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		(up-jump-rule 3)
		)
			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(or
				(goal g-primary-unit-class cavalry-archer-class)
				(and
					(goal g-support-unit-class cavalry-archer-class)
					(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
			(or
				(unit-type-count cavalry-archer-class >= 11)
				(or
					(unit-type-count cavalry-archer-class g:>= g-desired-num-cavalry-archers)
					(up-compare-goal g-age-status >= TO-IMPERIAL)))
			(or
				(goal g-town-under-attack NO)
				(up-compare-goal g-human-military-count g:>= g-min-military-pop))
			(can-research-with-escrow ri-leather-archer-armor)
			=>
			(up-store-tech-name c: ri-leather-archer-armor)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			(up-jump-rule 2)
			)
			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(or
				(goal g-primary-unit-class archery-cannon-class)
				(and
					(goal g-support-unit-class archery-cannon-class)
					(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
			(or
				(unit-type-count archery-cannon-class >= 11)
				(or
					(unit-type-count archery-cannon-class g:>= g-desired-num-hand-cannoneers)
					(up-compare-goal g-age-status >= TO-IMPERIAL)))
			(or
				(goal g-town-under-attack NO)
				(up-compare-goal g-human-military-count g:>= g-min-military-pop))
			(can-research-with-escrow ri-leather-archer-armor)
			=>
			(up-store-tech-name c: ri-leather-archer-armor)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			(up-jump-rule 1)
			)
			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(or
				(goal g-primary-unit-class cavalry-cannon-class)
				(and
					(goal g-support-unit-class cavalry-cannon-class)
					(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
			(or
				(unit-type-count cavalry-cannon-class >= 11)
				(or
					(unit-type-count cavalry-cannon-class g:>= g-desired-num-hand-cannoneers)
					(up-compare-goal g-age-status >= TO-IMPERIAL)))
			(or
				(goal g-town-under-attack NO)
				(up-compare-goal g-human-military-count g:>= g-min-military-pop))
			(can-research-with-escrow ri-leather-archer-armor)
			=>
			(up-store-tech-name c: ri-leather-archer-armor)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(or
			(and
				(goal g-primary-unit-class archery-class)
				(unit-type-count archery-class >= 10))
			(and
				(goal g-primary-unit-class cavalry-archer-class)
				(unit-type-count cavalry-archer-class >= 10)))
		(or
			(goal g-town-under-attack NO)
			(up-compare-goal g-human-military-count g:>= g-min-military-pop))
		(up-research-status c: ri-leather-archer-armor == research-available)
		(building-type-count blacksmith > 0)
		=>
		(up-store-tech-name c: ri-leather-archer-armor)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		(up-jump-rule 3)
		)
			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(or
				(and
					(goal g-support-unit-class archery-class)
					(unit-type-count archery-class >= 12))
				(and
					(goal g-support-unit-class cavalry-archer-class)
					(unit-type-count cavalry-archer-class >= 12)))
			(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
			(or
				(goal g-town-under-attack NO)
				(up-compare-goal g-human-military-count g:>= g-min-military-pop))
			(up-research-status c: ri-leather-archer-armor == research-available)
			(building-type-count blacksmith > 0)
			=>
			(up-store-tech-name c: ri-leather-archer-armor)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			(up-jump-rule 2)
			)
			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(or
				(goal g-primary-unit-class archery-class)
				(goal g-primary-unit-class cavalry-archer-class))
			(up-compare-goal g-age-status >= TO-IMPERIAL)
			(or
				(goal g-town-under-attack NO)
				(up-compare-goal g-human-military-count g:>= g-min-military-pop))
			(up-research-status c: ri-leather-archer-armor == research-available)
			(building-type-count blacksmith > 0)
			=>
			(up-store-tech-name c: ri-leather-archer-armor)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			(up-jump-rule 1)
			)
			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(or
				(goal g-support-unit-class archery-class)
				(goal g-support-unit-class cavalry-archer-class))
			(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
			(up-compare-goal g-age-status >= TO-IMPERIAL)
			(or
				(goal g-town-under-attack NO)
				(up-compare-goal g-human-military-count g:>= g-min-military-pop))
			(up-research-status c: ri-leather-archer-armor == research-available)
			(building-type-count blacksmith > 0)
			=>
			(up-store-tech-name c: ri-leather-archer-armor)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

		(defrule
		(or
			(and
				(goal g-primary-unit-class archery-cannon-class)
				(unit-type-count archery-cannon-class >= 10))
			(and
				(goal g-primary-unit-class cavalry-cannon-class)
				(unit-type-count cavalry-cannon-class >= 10)))
		(or
			(goal g-town-under-attack NO)
			(up-compare-goal g-human-military-count g:>= g-min-military-pop))
		(up-research-status c: ri-leather-archer-armor == research-available)
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-leather-archer-armor c: 1)
		(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
		(up-modify-goal g-important-techs-gold-needed g:+ g-gold-cost)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-jump-rule 3)
		)
			(defrule
			(or
				(and
					(goal g-support-unit-class archery-cannon-class)
					(unit-type-count archery-cannon-class >= 12))
				(and
					(goal g-support-unit-class cavalry-cannon-class)
					(unit-type-count cavalry-cannon-class >= 12)))
			(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
			(or
				(goal g-town-under-attack NO)
				(up-compare-goal g-human-military-count g:>= g-min-military-pop))
			(up-research-status c: ri-leather-archer-armor == research-available)
			(building-type-count blacksmith > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-leather-archer-armor c: 1)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			(up-jump-rule 2)
			)
			(defrule
			(or
				(goal g-primary-unit-class archery-cannon-class)
				(goal g-primary-unit-class cavalry-cannon-class))
			(up-compare-goal g-age-status >= TO-IMPERIAL)
			(or
				(goal g-town-under-attack NO)
				(up-compare-goal g-human-military-count g:>= g-min-military-pop))
			(up-research-status c: ri-leather-archer-armor == research-available)
			(building-type-count blacksmith > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-leather-archer-armor c: 1)
			(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
			(up-modify-goal g-important-techs-gold-needed g:+ g-gold-cost)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			(up-jump-rule 1)
			)
			(defrule
			(or
				(goal g-support-unit-class archery-cannon-class)
				(goal g-support-unit-class cavalry-cannon-class))
			(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
			(up-compare-goal g-age-status >= TO-IMPERIAL)
			(or
				(goal g-town-under-attack NO)
				(up-compare-goal g-human-military-count g:>= g-min-military-pop))
			(up-research-status c: ri-leather-archer-armor == research-available)
			(building-type-count blacksmith > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-leather-archer-armor c: 1)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(or
			(and
				(goal g-primary-unit-class archery-cannon-class)
				(unit-type-count archery-cannon-class >= 10))
			(and
				(goal g-primary-unit-class cavalry-cannon-class)
				(unit-type-count cavalry-cannon-class >= 10)))
		(or
			(goal g-town-under-attack NO)
			(up-compare-goal g-human-military-count g:>= g-min-military-pop))
		(up-research-status c: ri-leather-archer-armor == research-available)
		(building-type-count blacksmith > 0)
		=>
		(up-store-tech-name c: ri-leather-archer-armor)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		(up-jump-rule 3)
		)
			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(or
				(and
					(goal g-support-unit-class archery-cannon-class)
					(unit-type-count archery-cannon-class >= 12))
				(and
					(goal g-support-unit-class cavalry-cannon-class)
					(unit-type-count cavalry-cannon-class >= 12)))
			(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
			(or
				(goal g-town-under-attack NO)
				(up-compare-goal g-human-military-count g:>= g-min-military-pop))
			(up-research-status c: ri-leather-archer-armor == research-available)
			(building-type-count blacksmith > 0)
			=>
			(up-store-tech-name c: ri-leather-archer-armor)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			(up-jump-rule 2)
			)
			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(or
				(goal g-primary-unit-class archery-cannon-class)
				(goal g-primary-unit-class cavalry-cannon-class))
			(up-compare-goal g-age-status >= TO-IMPERIAL)
			(or
				(goal g-town-under-attack NO)
				(up-compare-goal g-human-military-count g:>= g-min-military-pop))
			(up-research-status c: ri-leather-archer-armor == research-available)
			(building-type-count blacksmith > 0)
			=>
			(up-store-tech-name c: ri-leather-archer-armor)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			(up-jump-rule 1)
			)
			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(or
				(goal g-support-unit-class archery-cannon-class)
				(goal g-support-unit-class cavalry-cannon-class))
			(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
			(up-compare-goal g-age-status >= TO-IMPERIAL)
			(or
				(goal g-town-under-attack NO)
				(up-compare-goal g-human-military-count g:>= g-min-military-pop))
			(up-research-status c: ri-leather-archer-armor == research-available)
			(building-type-count blacksmith > 0)
			=>
			(up-store-tech-name c: ri-leather-archer-armor)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

	;-------------------------------------------------
	;	Ring Archer Armor - Secondary Imperial Tech (Priority Imperial for Skirms)
	;-------------------------------------------------

		(defrule
		(or
			(goal g-primary-unit-class archery-class)
			(or
				(goal g-primary-unit-class cavalry-archer-class)
				(or
					(goal g-primary-unit-class archery-cannon-class)
					(goal g-primary-unit-class cavalry-cannon-class))))
		(up-research-status c: ri-ring-archer-armor == research-available)
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-ring-archer-armor c: 1)
		(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
		(up-modify-goal g-important-techs-gold-needed g:+ g-gold-cost)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-jump-rule 1)
		)
			(defrule
			(or
				(goal g-support-unit-class archery-class)
				(or
					(goal g-support-unit-class cavalry-archer-class)
					(or
						(goal g-support-unit-class archery-cannon-class)
						(goal g-support-unit-class cavalry-cannon-class))))
			(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
			(up-research-status c: ri-ring-archer-armor == research-available)
			(building-type-count blacksmith > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-ring-archer-armor c: 1)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(or
			(goal g-primary-unit-class archery-class)
			(or
				(goal g-primary-unit-class cavalry-archer-class)
				(or
					(goal g-primary-unit-class archery-cannon-class)
					(goal g-primary-unit-class cavalry-cannon-class))))
		(up-research-status c: ri-ring-archer-armor == research-available)
		(building-type-count blacksmith > 0)
		=>
		(up-store-tech-name c: ri-ring-archer-armor)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		(up-jump-rule 1)
		)
			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(or
				(goal g-support-unit-class archery-class)
				(or
					(goal g-support-unit-class cavalry-archer-class)
					(or
						(goal g-support-unit-class archery-cannon-class)
						(goal g-support-unit-class cavalry-cannon-class))))
			(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
			(up-research-status c: ri-ring-archer-armor == research-available)
			(building-type-count blacksmith > 0)
			=>
			(up-store-tech-name c: ri-ring-archer-armor)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

	;-----------------------------------------
	;	Ballistics - Priority Imperial Tech (>= 11 ranged units)
	;-----------------------------------------

		(defrule
		(or
			(goal g-primary-unit-class archery-class)
			(goal g-support-unit-class archery-class))
		(or
			(unit-type-count archery-class >= 11)
			(or
				(unit-type-count archery-class g:>= g-desired-num-foot-archers)
				(up-compare-goal g-age-status >= TO-IMPERIAL)))
		(or
			(goal g-town-under-attack NO)
			(up-compare-goal g-human-military-count g:>= g-min-military-pop))
		(up-research-status c: ri-ballistics == research-available)
		(building-type-count university > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-ballistics c: 1)
		(up-modify-goal g-max-wood-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-jump-rule 1)
		)
			(defrule
			(or
				(goal g-primary-unit-class cavalry-archer-class)
				(goal g-support-unit-class cavalry-archer-class))
			(or
				(unit-type-count cavalry-archer-class >= 11)
				(or
					(unit-type-count cavalry-archer-class g:>= g-desired-num-cavalry-archers)
					(up-compare-goal g-age-status >= TO-IMPERIAL)))
			(or
				(goal g-town-under-attack NO)
				(up-compare-goal g-human-military-count g:>= g-min-military-pop))
			(up-research-status c: ri-ballistics == research-available)
			(building-type-count university > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-ballistics c: 1)
			(up-modify-goal g-max-wood-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(or
			(goal g-primary-unit-class archery-class)
			(goal g-support-unit-class archery-class))
		(or
			(unit-type-count archery-class >= 11)
			(or
				(unit-type-count archery-class g:>= g-desired-num-foot-archers)
				(up-compare-goal g-age-status >= TO-IMPERIAL)))
		(or
			(goal g-town-under-attack NO)
			(up-compare-goal g-human-military-count g:>= g-min-military-pop))
		(up-research-status c: ri-ballistics == research-available)
		(building-type-count university > 0)
		=>
		(up-store-tech-name c: ri-ballistics)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		(up-jump-rule 1)
		)
			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(or
				(goal g-primary-unit-class cavalry-archer-class)
				(goal g-support-unit-class cavalry-archer-class))
			(or
				(unit-type-count cavalry-archer-class >= 11)
				(or
					(unit-type-count cavalry-archer-class g:>= g-desired-num-cavalry-archers)
					(up-compare-goal g-age-status >= TO-IMPERIAL)))
			(or
				(goal g-town-under-attack NO)
				(up-compare-goal g-human-military-count g:>= g-min-military-pop))
			(up-research-status c: ri-ballistics == research-available)
			(building-type-count university > 0)
			=>
			(up-store-tech-name c: ri-ballistics)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

		#load-if-defined BURMESE-CIV

			(defrule
			(or
				(goal g-primary-unit my-unique-unit)
				(and
					(goal g-support-unit my-unique-unit)
					(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
			(or
				(up-compare-goal g-unique-unit-line >= 11)
				(or
					(up-compare-goal g-unique-unit-line g:>= g-desired-num-unique-unit)
					(up-compare-goal g-age-status >= TO-IMPERIAL)))
			(or
				(goal g-town-under-attack NO)
				(up-compare-goal g-human-military-count g:>= g-min-military-pop))
			(up-research-status c: ri-ballistics == research-available)
			(building-type-count university > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-ballistics c: 1)
			(up-modify-goal g-max-wood-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)

			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(or
				(goal g-primary-unit my-unique-unit)
				(and
					(goal g-support-unit my-unique-unit)
					(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
			(or
				(up-compare-goal g-unique-unit-line >= 11)
				(or
					(up-compare-goal g-unique-unit-line g:>= g-desired-num-unique-unit)
					(up-compare-goal g-age-status >= TO-IMPERIAL)))
			(or
				(goal g-town-under-attack NO)
				(up-compare-goal g-human-military-count g:>= g-min-military-pop))
			(up-research-status c: ri-ballistics == research-available)
			(building-type-count university > 0)
			=>
			(up-store-tech-name c: ri-ballistics)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

		#end-if

;=========================<>=========================
;				    INFANTRY TECHS
;=========================<>=========================

	;------------------------------------------
	;	Eagle Warrior - Required Castle Tech
	;------------------------------------------

		#load-if-defined UP-GAME-WK

			(defrule
			(goal g-primary-unit eagle-warrior)
			(goal g-age-status TO-CASTLE)
			(building-type-count barracks > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-eagle-warrior c: 1)
			(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
			(up-modify-goal g-important-techs-gold-needed g:+ g-gold-cost)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)

			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(goal g-primary-unit eagle-warrior)
			(goal g-age-status TO-CASTLE)
			(building-type-count barracks > 0)
			=>
			(up-store-tech-name c: ri-eagle-warrior)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

			(defrule
			(or
				(up-compare-goal g-game-focus != BOOM)
				(or
					(up-compare-goal g-eco-tech-progress >= PRIORITY-CASTLE-COMPLETE)
					(goal g-town-under-attack YES)))
			(or
				(goal g-primary-unit eagle-warrior)
				(goal g-support-unit eagle-warrior))
			(up-research-status c: ri-eagle-warrior == research-available)
			(building-type-count barracks > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-eagle-warrior c: 1)
			(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
			(up-modify-goal g-important-techs-gold-needed g:+ g-gold-cost)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)

			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(or
				(up-compare-goal g-game-focus != BOOM)
				(or
					(up-compare-goal g-eco-tech-progress >= PRIORITY-CASTLE-COMPLETE)
					(goal g-town-under-attack YES)))
			(or
				(goal g-primary-unit eagle-warrior)
				(goal g-support-unit eagle-warrior))
			(up-research-status c: ri-eagle-warrior == research-available)
			(building-type-count barracks > 0)
			=>
			(up-store-tech-name c: ri-eagle-warrior)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

		#end-if

	;--------------------------------------------------
	;	Elite Eagle Warrior - Required Imperial Tech
	;--------------------------------------------------

		(defrule
		(goal g-primary-unit eagle-warrior)
		(goal g-age-status TO-IMPERIAL)
		(building-type-count barracks > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-elite-eagle-warrior c: 1)
		(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
		(up-modify-goal g-important-techs-gold-needed g:+ g-gold-cost)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(goal g-primary-unit eagle-warrior)
		(goal g-age-status TO-IMPERIAL)
		(building-type-count barracks > 0)
		=>
		(up-store-tech-name c: ri-elite-eagle-warrior)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		)

		(defrule
		(or
			(goal g-primary-unit eagle-warrior)
			(and
				(goal g-support-unit eagle-warrior)
				(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
		(up-research-status c: ri-elite-eagle-warrior == research-available)
		(building-type-count barracks > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-elite-eagle-warrior c: 1)
		(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
		(up-modify-goal g-important-techs-gold-needed g:+ g-gold-cost)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(or
			(goal g-primary-unit eagle-warrior)
			(and
				(goal g-support-unit eagle-warrior)
				(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
		(up-research-status c: ri-elite-eagle-warrior == research-available)
		(building-type-count barracks > 0)
		=>
		(up-store-tech-name c: ri-elite-eagle-warrior)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		)

	;------------------------------------
	;	Pikeman - Required Castle Tech
	;------------------------------------

		(defrule
		(goal g-primary-unit spearman)
		(goal g-age-status TO-CASTLE)
		(up-compare-const PIKEMAN-AVAILABLE == YES)
		(building-type-count barracks > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-pikeman c: 1)
		(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
		(up-modify-goal g-important-techs-gold-needed g:+ g-gold-cost)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(goal g-primary-unit spearman)
		(goal g-age-status TO-CASTLE)
		(up-compare-const PIKEMAN-AVAILABLE == YES)
		(building-type-count barracks > 0)
		=>
		(up-store-tech-name c: ri-pikeman)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		)

		(defrule
		(or
			(up-compare-goal g-game-focus != BOOM)
			(or
				(up-compare-goal g-eco-tech-progress >= PRIORITY-CASTLE-COMPLETE)
				(goal g-town-under-attack YES)))
		(up-compare-goal g-desired-num-spearman > 0)
		(up-research-status c: ri-pikeman == research-available)
		(building-type-count barracks > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-pikeman c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(or
			(up-compare-goal g-game-focus != BOOM)
			(or
				(up-compare-goal g-eco-tech-progress >= PRIORITY-CASTLE-COMPLETE)
				(goal g-town-under-attack YES)))
		(up-compare-goal g-desired-num-spearman > 0)
		(up-research-status c: ri-pikeman == research-available)
		(building-type-count barracks > 0)
		=>
		(up-store-tech-name c: ri-pikeman)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		)

	;-----------------------------------------
	;	Halberdier - Priority Imperial Tech
	;-----------------------------------------

		(defrule
		(goal g-primary-unit spearman)
		(goal g-age-status TO-IMPERIAL)
		(up-compare-const HALBERDIER-AVAILABLE == YES)
		(building-type-count barracks > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-halberdier c: 1)
		(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
		(up-modify-goal g-important-techs-gold-needed g:+ g-gold-cost)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(goal g-primary-unit spearman)
		(goal g-age-status TO-IMPERIAL)
		(up-compare-const HALBERDIER-AVAILABLE == YES)
		(building-type-count barracks > 0)
		=>
		(up-store-tech-name c: ri-halberdier)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		)

		(defrule
		(or
			(goal g-primary-unit spearman)
			(and
				(goal g-support-unit spearman)
				(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
		(up-research-status c: ri-halberdier == research-available)
		(building-type-count barracks > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-halberdier c: 1)
		(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
		(up-modify-goal g-important-techs-gold-needed g:+ g-gold-cost)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(or
			(goal g-primary-unit spearman)
			(and
				(goal g-support-unit spearman)
				(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
		(up-research-status c: ri-halberdier == research-available)
		(building-type-count barracks > 0)
		=>
		(up-store-tech-name c: ri-halberdier)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		)

	;----------------------------------------
	;	Man-at-Arms - Priority Feudal Tech
	;----------------------------------------

		(defrule
		(goal g-primary-unit militiaman)
		(goal g-age-status TO-FEUDAL)
		(building-type-count barracks > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-man-at-arms c: 1)
		(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
		(up-modify-goal g-important-techs-gold-needed g:+ g-gold-cost)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(goal g-primary-unit militiaman)
		(goal g-age-status TO-FEUDAL)
		(building-type-count barracks > 0)
		=>
		(up-store-tech-name c: ri-man-at-arms)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		)

		(defrule
		(or
			(goal g-primary-unit militiaman)
			(goal g-support-unit militiaman))
		(up-compare-goal g-age-status != SAVE-FOR-CASTLE)
		(up-research-status c: ri-man-at-arms == research-available)
		(building-type-count barracks > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-man-at-arms c: 1)
		(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
		(up-modify-goal g-important-techs-gold-needed g:+ g-gold-cost)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(or
			(goal g-primary-unit militiaman)
			(goal g-support-unit militiaman))
		(up-compare-goal g-age-status != SAVE-FOR-CASTLE)
		(up-research-status c: ri-man-at-arms == research-available)
		(building-type-count barracks > 0)
		=>
		(up-store-tech-name c: ri-man-at-arms)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		)

	;-------------------------------------------
	;	Long Swordsman - Required Castle Tech
	;-------------------------------------------

		(defrule
		(goal g-primary-unit militiaman)
		(goal g-age-status TO-CASTLE)
		(building-type-count barracks > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-long-swordsman c: 1)
		(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
		(up-modify-goal g-important-techs-gold-needed g:+ g-gold-cost)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(goal g-primary-unit militiaman)
		(goal g-age-status TO-CASTLE)
		(building-type-count barracks > 0)
		=>
		(up-store-tech-name c: ri-long-swordsman)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		)

		(defrule
		(or
			(up-compare-goal g-game-focus != BOOM)
			(or
				(up-compare-goal g-eco-tech-progress >= PRIORITY-CASTLE-COMPLETE)
				(goal g-town-under-attack YES)))
		(or
			(goal g-primary-unit militiaman)
			(goal g-support-unit militiaman))
		(up-research-status c: ri-long-swordsman == research-available)
		(building-type-count barracks > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-long-swordsman c: 1)
		(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
		(up-modify-goal g-important-techs-gold-needed g:+ g-gold-cost)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(or
			(up-compare-goal g-game-focus != BOOM)
			(or
				(up-compare-goal g-eco-tech-progress >= PRIORITY-CASTLE-COMPLETE)
				(goal g-town-under-attack YES)))
		(or
			(goal g-primary-unit militiaman)
			(goal g-support-unit militiaman))
		(up-research-status c: ri-long-swordsman == research-available)
		(building-type-count barracks > 0)
		=>
		(up-store-tech-name c: ri-long-swordsman)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		)

	#load-if-defined ROMANS-CIV

		;---------------------------------------------------
		;	Two-Handed Swordsman - Required Imperial Tech
		;---------------------------------------------------

			(defrule
			(goal g-primary-unit militiaman)
			(goal g-age-status TO-IMPERIAL)
			(up-compare-const TWO-HANDED-SWORDSMAN-AVAILABLE == YES)
			(building-type-count barracks > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-two-handed-swordsman c: 1)
			(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
			(up-modify-goal g-important-techs-gold-needed g:+ g-gold-cost)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)

			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(goal g-primary-unit militiaman)
			(goal g-age-status TO-IMPERIAL)
			(up-compare-const TWO-HANDED-SWORDSMAN-AVAILABLE == YES)
			(building-type-count barracks > 0)
			=>
			(up-store-tech-name c: ri-two-handed-swordsman)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

			(defrule
			(or
				(goal g-primary-unit militiaman)
				(and
					(goal g-support-unit militiaman)
					(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
			(up-research-status c: ri-two-handed-swordsman == research-available)
			(building-type-count barracks > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-two-handed-swordsman c: 1)
			(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
			(up-modify-goal g-important-techs-gold-needed g:+ g-gold-cost)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)

			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(or
				(goal g-primary-unit militiaman)
				(and
					(goal g-support-unit militiaman)
					(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
			(up-research-status c: ri-two-handed-swordsman == research-available)
			(building-type-count barracks > 0)
			=>
			(up-store-tech-name c: ri-two-handed-swordsman)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

		;---------------------------------------
		;	Champion - Priority Imperial Tech
		;---------------------------------------

			(defrule
			(or
				(goal g-primary-unit militiaman)
				(and
					(goal g-support-unit militiaman)
					(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
			(up-research-status c: ri-champion == research-available)
			(building-type-count barracks > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-champion c: 1)
			(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
			(up-modify-goal g-important-techs-gold-needed g:+ g-gold-cost)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)

			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(or
				(goal g-primary-unit militiaman)
				(and
					(goal g-support-unit militiaman)
					(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
			(up-research-status c: ri-champion == research-available)
			(building-type-count barracks > 0)
			=>
			(up-store-tech-name c: ri-champion)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

	#else

		;---------------------------------------
		;	Legionary - Priority Imperial Tech
		;---------------------------------------

			(defrule
			(or
				(goal g-primary-unit militiaman)
				(and
					(goal g-support-unit militiaman)
					(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
			(up-research-status c: ri-legionary == research-available)
			(building-type-count barracks > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-legionary c: 1)
			(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
			(up-modify-goal g-important-techs-gold-needed g:+ g-gold-cost)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)

			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(or
				(goal g-primary-unit militiaman)
				(and
					(goal g-support-unit militiaman)
					(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
			(up-research-status c: ri-legionary == research-available)
			(building-type-count barracks > 0)
			=>
			(up-store-tech-name c: ri-legionary)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

	#end-if

	;---------------------------------------
	;	Scale Mail - Priority Castle Tech (>= 4 infantry)
	;---------------------------------------

		(defrule
		(current-age == feudal-age)
		(or
			(goal g-primary-unit-class infantry-class)
			(and
				(goal g-support-unit-class infantry-class)
				(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
		(unit-type-count infantry-class >= 4)
		(up-research-status c: ri-scale-mail == research-available)
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-scale-mail c: 1)
		(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(current-age == feudal-age)
		(or
			(goal g-primary-unit-class infantry-class)
			(and
				(goal g-support-unit-class infantry-class)
				(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
		(unit-type-count infantry-class >= 4)
		(up-research-status c: ri-scale-mail == research-available)
		(building-type-count blacksmith > 0)
		=>
		(up-store-tech-name c: ri-scale-mail)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		)

		(defrule
		(or
			(up-compare-goal g-game-focus != BOOM)
			(or
				(up-compare-goal g-eco-tech-progress >= PRIORITY-CASTLE-COMPLETE)
				(goal g-town-under-attack YES)))
		(current-age >= castle-age)
		(or
			(goal g-primary-unit-class infantry-class)
			(and
				(goal g-support-unit-class infantry-class)
				(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
		(unit-type-count infantry-class >= 4)
		(up-research-status c: ri-scale-mail == research-available)
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-scale-mail c: 1)
		(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(or
			(up-compare-goal g-game-focus != BOOM)
			(or
				(up-compare-goal g-eco-tech-progress >= PRIORITY-CASTLE-COMPLETE)
				(goal g-town-under-attack YES)))
		(current-age >= castle-age)
		(or
			(goal g-primary-unit-class infantry-class)
			(and
				(goal g-support-unit-class infantry-class)
				(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
		(unit-type-count infantry-class >= 4)
		(up-research-status c: ri-scale-mail == research-available)
		(building-type-count blacksmith > 0)
		=>
		(up-store-tech-name c: ri-scale-mail)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		)

	;----------------------------------------
	;	Chain Mail - Secondary Castle Tech (>= 9 infantry)
	;----------------------------------------

		(defrule
		(goal g-primary-unit-class infantry-class)
		(or
			(unit-type-count infantry-class >= 9)
			(or
				(unit-type-count infantry-class g:>= g-desired-num-infantry)
				(up-compare-goal g-age-status >= TO-IMPERIAL)))
		(or
			(goal g-town-under-attack NO)
			(up-compare-goal g-human-military-count g:>= g-min-military-pop))
		(up-research-status c: ri-chain-mail == research-available)
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-chain-mail c: 1)
		(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
		(up-modify-goal g-important-techs-gold-needed g:+ g-gold-cost)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-jump-rule 1)
		)
			(defrule
			(goal g-support-unit-class infantry-class)
			(or
				(unit-type-count infantry-class >= 9)
				(or
					(unit-type-count infantry-class g:>= g-desired-num-infantry)
					(up-compare-goal g-age-status >= TO-IMPERIAL)))
			(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
			(up-compare-goal g-age-status >= MID-CASTLE)
			(or
				(goal g-town-under-attack NO)
				(up-compare-goal g-human-military-count g:>= g-min-military-pop))
			(up-research-status c: ri-chain-mail == research-available)
			(building-type-count blacksmith > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-chain-mail c: 1)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(goal g-primary-unit-class infantry-class)
		(or
			(unit-type-count infantry-class >= 9)
			(or
				(unit-type-count infantry-class g:>= g-desired-num-infantry)
				(up-compare-goal g-age-status >= TO-IMPERIAL)))
		(or
			(goal g-town-under-attack NO)
			(up-compare-goal g-human-military-count g:>= g-min-military-pop))
		(up-research-status c: ri-chain-mail == research-available)
		(building-type-count blacksmith > 0)
		=>
		(up-store-tech-name c: ri-chain-mail)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		(up-jump-rule 1)
		)
			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(goal g-support-unit-class infantry-class)
			(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
			(or
				(unit-type-count infantry-class >= 9)
				(or
					(unit-type-count infantry-class g:>= g-desired-num-infantry)
					(up-compare-goal g-age-status >= TO-IMPERIAL)))
			(up-compare-goal g-age-status >= MID-CASTLE)
			(or
				(goal g-town-under-attack NO)
				(up-compare-goal g-human-military-count g:>= g-min-military-pop))
			(up-research-status c: ri-chain-mail == research-available)
			(building-type-count blacksmith > 0)
			=>
			(up-store-tech-name c: ri-chain-mail)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

	;-----------------------------------------
	;	Plate Mail - Priority Imperial Tech
	;-----------------------------------------

		(defrule
		(goal g-primary-unit-class infantry-class)
		(goal g-age-status TO-IMPERIAL)
		(up-compare-const PLATE-MAIL-ARMOR-AVAILABLE == YES)
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-plate-mail c: 1)
		(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
		(up-modify-goal g-important-techs-gold-needed g:+ g-gold-cost)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(goal g-primary-unit-class infantry-class)
		(goal g-age-status TO-IMPERIAL)
		(up-compare-const PLATE-MAIL-ARMOR-AVAILABLE == YES)
		(building-type-count blacksmith > 0)
		=>
		(up-store-tech-name c: ri-plate-mail)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		)

		(defrule
		(or
			(goal g-primary-unit-class infantry-class)
			(and
				(goal g-support-unit-class infantry-class)
				(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
		(up-research-status c: ri-plate-mail == research-available)
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-plate-mail c: 1)
		(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
		(up-modify-goal g-important-techs-gold-needed g:+ g-gold-cost)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(or
			(goal g-primary-unit-class infantry-class)
			(and
				(goal g-support-unit-class infantry-class)
				(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
		(up-research-status c: ri-plate-mail == research-available)
		(building-type-count blacksmith > 0)
		=>
		(up-store-tech-name c: ri-plate-mail)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		)

	;--------------------------------------
	;	Forging - Required Imperial Tech (>= 9 infantry or >= 12 cavalry)
	;--------------------------------------

		(defrule
		(current-age >= castle-age)
		(or
			(goal g-primary-unit-class infantry-class)
			(goal g-support-unit-class infantry-class))
		(or
			(unit-type-count infantry-class >= 9)
			(or
				(unit-type-count infantry-class g:>= g-desired-num-infantry)
				(up-compare-goal g-age-status >= TO-IMPERIAL)))
		(or
			(goal g-town-under-attack NO)
			(up-compare-goal g-human-military-count g:>= g-min-military-pop))
		(up-research-status c: ri-forging == research-available)
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-forging c: 1)
		(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-jump-rule 2)
		)
			(defrule
			(current-age >= castle-age)
			(or
				(goal g-primary-unit-class cavalry-class)
				(goal g-support-unit-class cavalry-class))
			(or
				(unit-type-count cavalry-class >= 12)
				(or
					(unit-type-count scout-cavalry-line >= 12)
					(unit-type-count steppe-lancer-line >= 8)))
			(or
				(goal g-town-under-attack NO)
				(up-compare-goal g-human-military-count g:>= g-min-military-pop))
			(up-research-status c: ri-forging == research-available)
			(building-type-count blacksmith > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-forging c: 1)
			(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-jump-rule 1)
			)
			(defrule
			(current-age >= castle-age)
			(or
				(goal g-primary-unit-class cavalry-class)
				(goal g-support-unit-class cavalry-class))
			(or
				(unit-type-count cavalry-class g:>= g-desired-num-cavalry)
				(or
					(unit-type-count scout-cavalry-line g:>= g-desired-num-cavalry)
					(up-compare-goal g-age-status >= TO-IMPERIAL)))
			(or
				(goal g-town-under-attack NO)
				(up-compare-goal g-human-military-count g:>= g-min-military-pop))
			(up-research-status c: ri-forging == research-available)
			(building-type-count blacksmith > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-forging c: 1)
			(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(current-age >= castle-age)
		(or
			(goal g-primary-unit-class infantry-class)
			(goal g-support-unit-class infantry-class))
		(or
			(unit-type-count infantry-class >= 9)
			(or
				(unit-type-count infantry-class g:>= g-desired-num-infantry)
				(up-compare-goal g-age-status >= TO-IMPERIAL)))
		(or
			(goal g-town-under-attack NO)
			(up-compare-goal g-human-military-count g:>= g-min-military-pop))
		(up-research-status c: ri-forging == research-available)
		(building-type-count blacksmith > 0)
		=>
		(up-store-tech-name c: ri-forging)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		(up-jump-rule 2)
		)
			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(current-age >= castle-age)
			(or
				(goal g-primary-unit-class cavalry-class)
				(goal g-support-unit-class cavalry-class))
			(or
				(unit-type-count cavalry-class >= 12)
				(or
					(unit-type-count scout-cavalry-line >= 12)
					(unit-type-count steppe-lancer-line >= 8)))
			(or
				(goal g-town-under-attack NO)
				(up-compare-goal g-human-military-count g:>= g-min-military-pop))
			(up-research-status c: ri-forging == research-available)
			(building-type-count blacksmith > 0)
			=>
			(up-store-tech-name c: ri-forging)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			(up-jump-rule 1)
			)
			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(current-age >= castle-age)
			(or
				(goal g-primary-unit-class cavalry-class)
				(goal g-support-unit-class cavalry-class))
			(or
				(unit-type-count cavalry-class g:>= g-desired-num-cavalry)
				(or
					(unit-type-count scout-cavalry-line g:>= g-desired-num-cavalry)
					(up-compare-goal g-age-status >= TO-IMPERIAL)))
			(or
				(goal g-town-under-attack NO)
				(up-compare-goal g-human-military-count g:>= g-min-military-pop))
			(up-research-status c: ri-forging == research-available)
			(building-type-count blacksmith > 0)
			=>
			(up-store-tech-name c: ri-forging)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

	;-------------------------------------------
	;	Iron Casting - Priority Imperial Tech (>= 15 infantry or cavalry)
	;-------------------------------------------

		(defrule
		(goal g-primary-unit-class infantry-class)
		(or
			(unit-type-count infantry-class >= 15)
			(or
				(unit-type-count infantry-class g:>= g-desired-num-infantry)
				(up-compare-goal g-age-status >= TO-IMPERIAL)))
		(or
			(goal g-town-under-attack NO)
			(up-compare-goal g-human-military-count g:>= g-min-military-pop))
		(up-research-status c: ri-iron-casting == research-available)
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-iron-casting c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-jump-rule 1)
		)
			(defrule
			(goal g-support-unit-class infantry-class)
			(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
			(or
				(unit-type-count infantry-class >= 15)
				(or
					(unit-type-count infantry-class g:>= g-desired-num-infantry)
					(up-compare-goal g-age-status >= TO-IMPERIAL)))
			(up-compare-goal g-age-status >= MID-CASTLE)
			(or
				(goal g-town-under-attack NO)
				(up-compare-goal g-human-military-count g:>= g-min-military-pop))
			(up-research-status c: ri-iron-casting == research-available)
			(building-type-count blacksmith > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-iron-casting c: 1)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(goal g-primary-unit-class infantry-class)
		(or
			(unit-type-count infantry-class >= 15)
			(or
				(unit-type-count infantry-class g:>= g-desired-num-infantry)
				(up-compare-goal g-age-status >= TO-IMPERIAL)))
		(or
			(goal g-town-under-attack NO)
			(up-compare-goal g-human-military-count g:>= g-min-military-pop))
		(up-research-status c: ri-iron-casting == research-available)
		(building-type-count blacksmith > 0)
		=>
		(up-store-tech-name c: ri-iron-casting)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		(up-jump-rule 1)
		)
			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(goal g-support-unit-class infantry-class)
			(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
			(or
				(unit-type-count infantry-class >= 15)
				(or
					(unit-type-count infantry-class g:>= g-desired-num-infantry)
					(up-compare-goal g-age-status >= TO-IMPERIAL)))
			(up-compare-goal g-age-status >= MID-CASTLE)
			(or
				(goal g-town-under-attack NO)
				(up-compare-goal g-human-military-count g:>= g-min-military-pop))
			(up-research-status c: ri-iron-casting == research-available)
			(building-type-count blacksmith > 0)
			=>
			(up-store-tech-name c: ri-iron-casting)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

		(defrule
		(goal g-primary-unit-class cavalry-class)
		(or
			(unit-type-count cavalry-class >= 15)
			(or
				(unit-type-count scout-cavalry-line >= 15)
				(or
					(unit-type-count steppe-lancer-line >= 12)
					(or
						(unit-type-count cavalry-class g:>= g-desired-num-cavalry)
						(up-compare-goal g-age-status >= TO-IMPERIAL)))))
		(or
			(goal g-town-under-attack NO)
			(up-compare-goal g-human-military-count g:>= g-min-military-pop))
		(up-research-status c: ri-iron-casting == research-available)
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-iron-casting c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-jump-rule 1)
		)
			(defrule
			(goal g-support-unit-class cavalry-class)
			(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
			(or
				(unit-type-count cavalry-class >= 15)
				(or
					(unit-type-count scout-cavalry-line >= 15)
					(or
						(unit-type-count steppe-lancer-line >= 12)
						(or
							(unit-type-count cavalry-class g:>= g-desired-num-cavalry)
							(up-compare-goal g-age-status >= TO-IMPERIAL)))))
			(or
				(goal g-town-under-attack NO)
				(up-compare-goal g-human-military-count g:>= g-min-military-pop))
			(up-research-status c: ri-iron-casting == research-available)
			(building-type-count blacksmith > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-iron-casting c: 1)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(goal g-primary-unit-class cavalry-class)
		(or
			(unit-type-count cavalry-class >= 15)
			(or
				(unit-type-count scout-cavalry-line >= 15)
				(or
					(unit-type-count steppe-lancer-line >= 12)
					(or
						(unit-type-count cavalry-class g:>= g-desired-num-cavalry)
						(up-compare-goal g-age-status >= TO-IMPERIAL)))))
		(or
			(goal g-town-under-attack NO)
			(up-compare-goal g-human-military-count g:>= g-min-military-pop))
		(up-research-status c: ri-iron-casting == research-available)
		(building-type-count blacksmith > 0)
		=>
		(up-store-tech-name c: ri-iron-casting)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		(up-jump-rule 1)
		)
			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(goal g-support-unit-class cavalry-class)
			(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
			(or
				(unit-type-count cavalry-class >= 15)
				(or
					(unit-type-count scout-cavalry-line >= 15)
					(or
						(unit-type-count steppe-lancer-line >= 12)
						(or
							(unit-type-count cavalry-class g:>= g-desired-num-cavalry)
							(up-compare-goal g-age-status >= TO-IMPERIAL)))))
			(or
				(goal g-town-under-attack NO)
				(up-compare-goal g-human-military-count g:>= g-min-military-pop))
			(up-research-status c: ri-iron-casting == research-available)
			(building-type-count blacksmith > 0)
			=>
			(up-store-tech-name c: ri-iron-casting)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

	;--------------------------------------------
	;	Blast Furnace - Secondary Imperial Tech (Priority for Throwing Axemen)
	;--------------------------------------------

		(defrule
		(goal g-primary-unit-class infantry-class)
		(or
			(up-research-status c: ri-plate-mail >= research-pending)
			(up-compare-const PLATE-MAIL-ARMOR-AVAILABLE == NO))
		(up-research-status c: ri-blast-furnace == research-available)
		(building-type-count blacksmith > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-blast-furnace c: 1)
		(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
		(up-modify-goal g-important-techs-gold-needed g:+ g-gold-cost)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-jump-rule 3)
		)
			(defrule
			(goal g-support-unit-class infantry-class)
			(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
			(or
				(up-research-status c: ri-plate-mail >= research-pending)
				(up-compare-const PLATE-MAIL-ARMOR-AVAILABLE == NO))
			(up-research-status c: ri-blast-furnace == research-available)
			(building-type-count blacksmith > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-blast-furnace c: 1)
			(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
			(up-modify-goal g-important-techs-gold-needed g:+ g-gold-cost)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			(up-jump-rule 2)
			)
			(defrule
			(goal g-primary-unit-class cavalry-class)
			(or
				(up-research-status c: ri-plate-barding >= research-pending)
				(up-compare-const PLATE-BARDING-ARMOR-AVAILABLE == NO))
			(up-research-status c: ri-blast-furnace == research-available)
			(building-type-count blacksmith > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-blast-furnace c: 1)
			(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
			(up-modify-goal g-important-techs-gold-needed g:+ g-gold-cost)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			(up-jump-rule 1)
			)
			(defrule
			(goal g-support-unit-class cavalry-class)
			(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
			(or
				(up-research-status c: ri-plate-barding >= research-pending)
				(up-compare-const PLATE-BARDING-ARMOR-AVAILABLE == NO))
			(up-research-status c: ri-blast-furnace == research-available)
			(building-type-count blacksmith > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-blast-furnace c: 1)
			(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
			(up-modify-goal g-important-techs-gold-needed g:+ g-gold-cost)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)
		
		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(or
			(goal g-primary-unit-class infantry-class)
			(goal g-support-unit-class infantry-class))
		(or
			(up-research-status c: ri-plate-mail >= research-pending)
			(up-compare-const PLATE-MAIL-ARMOR-AVAILABLE == NO))
		(up-research-status c: ri-blast-furnace == research-available)
		(building-type-count blacksmith > 0)
		=>
		(up-store-tech-name c: ri-blast-furnace)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		(up-jump-rule 1)
		)
			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(or
				(goal g-primary-unit-class cavalry-class)
				(goal g-support-unit-class cavalry-class))
			(or
				(up-research-status c: ri-plate-barding >= research-pending)
				(up-compare-const PLATE-BARDING-ARMOR-AVAILABLE == NO))
			(up-research-status c: ri-blast-furnace == research-available)
			(building-type-count blacksmith > 0)
			=>
			(up-store-tech-name c: ri-blast-furnace)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

	;--------------------------------------
	;	Supplies - Secondary Castle Tech
	;--------------------------------------

		#load-if-defined DE-AVAILABLE

			(defrule
			(or
				(goal g-primary-unit militiaman)
				(and
					(goal g-support-unit militiaman)
					(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
			(or
				(goal g-town-under-attack NO)
				(up-compare-goal g-human-military-count g:>= g-min-military-pop))
			(up-research-status c: ri-supplies == research-available)
			(building-type-count barracks > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-supplies c: 1)
			(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
			(up-modify-goal g-important-techs-gold-needed g:+ g-gold-cost)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)

			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(or
				(goal g-primary-unit militiaman)
				(and
					(goal g-support-unit militiaman)
					(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
			(or
				(goal g-town-under-attack NO)
				(up-compare-goal g-human-military-count g:>= g-min-military-pop))
			(up-research-status c: ri-supplies == research-available)
			(building-type-count barracks > 0)
			=>
			(up-store-tech-name c: ri-supplies)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

		#end-if

	;---------------------------------------
	;	Gambesons - Secondary Castle Tech
	;---------------------------------------

		#load-if-defined DE-AVAILABLE

			(defrule
			(or
				(goal g-primary-unit militiaman)
				(and
					(goal g-support-unit militiaman)
					(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
			(or
				(goal g-town-under-attack NO)
				(up-compare-goal g-human-military-count g:>= g-min-military-pop))
			(up-research-status c: ri-gambesons == research-available)
			(building-type-count barracks > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-gambesons c: 1)
			(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
			(up-modify-goal g-important-techs-gold-needed g:+ g-gold-cost)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)

			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(or
				(goal g-primary-unit militiaman)
				(and
					(goal g-support-unit militiaman)
					(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
			(or
				(goal g-town-under-attack NO)
				(up-compare-goal g-human-military-count g:>= g-min-military-pop))
			(up-research-status c: ri-gambesons == research-available)
			(building-type-count barracks > 0)
			=>
			(up-store-tech-name c: ri-gambesons)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

		#end-if

    ;----------------------------------------
    ;   Squires - Secondary Castle Tech (>= 8 infantry)
    ;----------------------------------------
		
		(defrule
		(unit-type-count infantry-class < 8)
		(unit-type-count infantry-class g:< g-desired-num-infantry)
		=>
		(up-jump-rule 4)
		)

			(defrule
			(current-age >= castle-age)
			(or
				(up-compare-goal g-game-focus != BOOM)
				(or
					(up-compare-goal g-eco-tech-progress >= PRIORITY-CASTLE-COMPLETE)
					(goal g-town-under-attack YES)))
			(goal g-primary-unit-class infantry-class)
			(or
				(goal g-town-under-attack NO)
				(up-compare-goal g-human-military-count g:>= g-min-military-pop))
			(up-research-status c: ri-squires == research-available)
			(building-type-count barracks > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-squires c: 1)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			)
			(defrule
			(current-age >= castle-age)
			(or
				(up-compare-goal g-game-focus != BOOM)
				(or
					(up-compare-goal g-eco-tech-progress >= PRIORITY-CASTLE-COMPLETE)
					(goal g-town-under-attack YES)))
			(goal g-support-unit-class infantry-class)
			(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
			(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
			(or
				(goal g-town-under-attack NO)
				(up-compare-goal g-human-military-count g:>= g-min-military-pop))
			(up-research-status c: ri-squires == research-available)
			(building-type-count barracks > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-squires c: 1)
			(up-modify-goal g-max-food-needed g:max g-food-cost)
			)

			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(current-age >= castle-age)
			(or
				(up-compare-goal g-game-focus != BOOM)
				(or
					(up-compare-goal g-eco-tech-progress >= PRIORITY-CASTLE-COMPLETE)
					(goal g-town-under-attack YES)))
			(goal g-primary-unit-class infantry-class)
			(or
				(goal g-town-under-attack NO)
				(up-compare-goal g-human-military-count g:>= g-min-military-pop))
			(up-research-status c: ri-squires == research-available)
			(building-type-count barracks > 0)
			=>
			(up-store-tech-name c: ri-squires)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)
			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(current-age >= castle-age)
			(or
				(up-compare-goal g-game-focus != BOOM)
				(or
					(up-compare-goal g-eco-tech-progress >= PRIORITY-CASTLE-COMPLETE)
					(goal g-town-under-attack YES)))
			(goal g-support-unit-class infantry-class)
			(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)
			(up-compare-goal g-age-status != SAVE-FOR-IMPERIAL)
			(or
				(goal g-town-under-attack NO)
				(up-compare-goal g-human-military-count g:>= g-min-military-pop))
			(up-research-status c: ri-squires == research-available)
			(building-type-count barracks > 0)
			=>
			(up-store-tech-name c: ri-squires)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)



;=========================<>=========================
;				     SIEGE TECHS
;=========================<>=========================

	;------------
	;	Onager
	;------------

		(defrule
		(up-compare-goal g-desired-num-mangonel > 2)
		(up-research-status c: ri-onager == research-available)
		(building-type-count siege-workshop > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-onager c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(up-compare-goal g-desired-num-mangonel > 2)
		(up-research-status c: ri-onager == research-available)
		(building-type-count siege-workshop > 0)
		=>
		(up-store-tech-name c: ri-onager)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		)

	;------------------
	;	Siege Onager
	;------------------

		(defrule
		(up-compare-goal g-desired-num-mangonel > 2)
		(up-research-status c: ri-siege-onager == research-available)
		(building-type-count siege-workshop > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-siege-onager c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(up-compare-goal g-desired-num-mangonel > 2)
		(up-research-status c: ri-siege-onager == research-available)
		(building-type-count siege-workshop > 0)
		=>
		(up-store-tech-name c: ri-siege-onager)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		)

	;--------------------
	;	Heavy Scorpion
	;--------------------

		(defrule
		(up-compare-goal g-desired-num-scorpion > 3)
		(up-research-status c: ri-heavy-scorpion == research-available)
		(building-type-count siege-workshop > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-heavy-scorpion c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(up-compare-goal g-desired-num-scorpion > 3)
		(up-research-status c: ri-heavy-scorpion == research-available)
		(building-type-count siege-workshop > 0)
		=>
		(up-store-tech-name c: ri-heavy-scorpion)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		)

	;----------------
	;	Capped Ram
	;----------------

		(defrule
		(up-compare-goal g-desired-num-ram-type > 1)
		(up-research-status c: ri-capped-ram == research-available)
		(building-type-count siege-workshop > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-capped-ram c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(up-compare-goal g-desired-num-ram-type > 1)
		(up-research-status c: ri-capped-ram == research-available)
		(building-type-count siege-workshop > 0)
		=>
		(up-store-tech-name c: ri-capped-ram)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		)

	;---------------
	;	Siege Ram
	;---------------

		(defrule
		(up-compare-goal g-desired-num-ram-type > 2)
		(up-research-status c: ri-siege-ram == research-available)
		(building-type-count siege-workshop > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-siege-ram c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(up-compare-goal g-desired-num-ram-type > 2)
		(up-research-status c: ri-siege-ram == research-available)
		(building-type-count siege-workshop > 0)
		=>
		(up-store-tech-name c: ri-siege-ram)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		)

	;---------------------
	;	Siege Engineers
	;---------------------

		(defrule
		(up-compare-goal g-desired-num-siege > 0)
		(up-research-status c: ri-siege-engineers == research-available)
		(building-type-count university > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-siege-engineers c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-wood-needed g:max g-wood-cost)
		)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(up-compare-goal g-desired-num-siege > 0)
		(up-research-status c: ri-siege-engineers == research-available)
		(building-type-count university > 0)
		=>
		(up-store-tech-name c: ri-siege-engineers)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		)

;=========================<>=========================
;				      MONK TECHS
;=========================<>=========================

	;------------
	;	Heresy
	;------------

		(defrule
		(up-compare-goal g-enemy-monks-count >= 12)
		(up-research-status c: ri-heresy == research-available)
		(building-type-count monastery > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-heresy c: 1)
		(up-modify-goal g-important-techs-gold-needed g:+ g-gold-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(up-compare-goal g-enemy-monks-count >= 12)
		(up-research-status c: ri-heresy == research-available)
		(building-type-count monastery > 0)
		=>
		(up-store-tech-name c: ri-heresy)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		)

		;Battle Elephants
		(defrule
		(goal g-primary-unit battle-elephant)
		(up-compare-goal g-enemy-monks-count >= 6)
		(up-research-status c: ri-heresy == research-available)
		(building-type-count monastery > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-heresy c: 1)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(goal g-primary-unit battle-elephant)
		(up-compare-goal g-enemy-monks-count >= 6)
		(up-research-status c: ri-heresy == research-available)
		(building-type-count monastery > 0)
		=>
		(up-store-tech-name c: ri-heresy)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		)

	;----------------
	;	Redemption
	;----------------

		(defrule
		(or
			(goal g-primary-unit monk)
			(and
				(goal g-support-unit monk)
				(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
		(up-compare-goal g-enemy-field-siege-count > 0)
		(up-research-status c: ri-redemption == research-available)
		(building-type-count monastery > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-redemption c: 1)
		(up-modify-goal g-important-techs-gold-needed g:+ g-gold-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(or
			(goal g-primary-unit monk)
			(and
				(goal g-support-unit monk)
				(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
		(up-compare-goal g-enemy-field-siege-count > 0)
		(up-research-status c: ri-redemption == research-available)
		(building-type-count monastery > 0)
		=>
		(up-store-tech-name c: ri-redemption)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		)

		(defrule
		(or
			(goal g-primary-unit monk)
			(and
				(goal g-support-unit monk)
				(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
		(or
			(up-research-status c: ri-sanctity >= research-pending)
			(up-compare-const SANCTITY-AVAILABLE == NO))
		(up-research-status c: ri-redemption == research-available)
		(building-type-count monastery > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-redemption c: 1)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(or
			(goal g-primary-unit monk)
			(and
				(goal g-support-unit monk)
				(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
		(or
			(up-research-status c: ri-sanctity >= research-pending)
			(up-compare-const SANCTITY-AVAILABLE == NO))
		(up-research-status c: ri-redemption == research-available)
		(building-type-count monastery > 0)
		=>
		(up-store-tech-name c: ri-redemption)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		)

	;--------------------
	;	Block Printing
	;--------------------

		(defrule
		(or
			(goal g-primary-unit monk)
			(and
				(goal g-support-unit monk)
				(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
		(up-research-status c: ri-block-printing == research-available)
		(building-type-count monastery > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-block-printing c: 1)
		(up-modify-goal g-important-techs-gold-needed g:+ g-gold-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(or
			(goal g-primary-unit monk)
			(and
				(goal g-support-unit monk)
				(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
		(up-research-status c: ri-block-printing == research-available)
		(building-type-count monastery > 0)
		=>
		(up-store-tech-name c: ri-block-printing)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		)

	;--------------
	;	Sanctity
	;--------------

		(defrule
		(goal g-primary-unit monk)
		(goal g-age-status TO-CASTLE)
		(goal g-current-strategy FC-DEMON)
		(up-compare-const SANCTITY-AVAILABLE == YES)
		(building-type-count monastery > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-sanctity c: 1)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(goal g-primary-unit monk)
		(goal g-age-status TO-CASTLE)
		(goal g-current-strategy FC-DEMON)
		(up-compare-const SANCTITY-AVAILABLE == YES)
		(building-type-count monastery > 0)
		=>
		(up-store-tech-name c: ri-sanctity)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		)

		(defrule
		(or
			(goal g-primary-unit monk)
			(and
				(goal g-support-unit monk)
				(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
		(or
			(up-research-status c: ri-block-printing >= research-pending)
			(or
				(current-age == castle-age)
				(up-compare-const BLOCK-PRINTING-AVAILABLE == NO)))
		(up-research-status c: ri-sanctity == research-available)
		(building-type-count monastery > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-sanctity c: 1)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(or
			(goal g-primary-unit monk)
			(and
				(goal g-support-unit monk)
				(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
		(or
			(up-research-status c: ri-block-printing >= research-pending)
			(or
				(current-age == castle-age)
				(up-compare-const BLOCK-PRINTING-AVAILABLE == NO)))
		(up-research-status c: ri-sanctity == research-available)
		(building-type-count monastery > 0)
		=>
		(up-store-tech-name c: ri-sanctity)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		)

	;------------
	;	Fervor
	;------------

		#load-if-defined UP-GAME-WK		;Fervor actually had no effect in the original game

			(defrule
			(or
				(goal g-primary-unit monk)
				(and
					(goal g-support-unit monk)
					(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
			(or
				(up-research-status c: ri-block-printing >= research-pending)
				(or
					(current-age == castle-age)
					(up-compare-const BLOCK-PRINTING-AVAILABLE == NO)))
			(up-research-status c: ri-fervor == research-available)
			(building-type-count monastery > 0)
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-research-cost c: ri-fervor c: 1)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)

			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(or
				(goal g-primary-unit monk)
				(and
					(goal g-support-unit monk)
					(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
			(or
				(up-research-status c: ri-block-printing >= research-pending)
				(or
					(current-age == castle-age)
					(up-compare-const BLOCK-PRINTING-AVAILABLE == NO)))
			(up-research-status c: ri-fervor == research-available)
			(building-type-count monastery > 0)
			=>
			(up-store-tech-name c: ri-fervor)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

		#end-if

	;---------------
	;	Theocracy
	;---------------

		(defrule
		(or
			(goal g-primary-unit monk)
			(and
				(goal g-support-unit monk)
				(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
		(or
			(up-research-status c: ri-block-printing >= research-pending)
			(up-compare-const BLOCK-PRINTING-AVAILABLE == NO))
		(up-research-status c: ri-theocracy == research-available)
		(building-type-count monastery > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-theocracy c: 1)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(or
			(goal g-primary-unit monk)
			(and
				(goal g-support-unit monk)
				(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
		(or
			(up-research-status c: ri-block-printing >= research-pending)
			(up-compare-const BLOCK-PRINTING-AVAILABLE == NO))
		(up-research-status c: ri-theocracy == research-available)
		(building-type-count monastery > 0)
		=>
		(up-store-tech-name c: ri-theocracy)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		)

	;------------------
	;	Illumination
	;------------------

		(defrule
		(or
			(goal g-primary-unit monk)
			(and
				(goal g-support-unit monk)
				(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
		(or
			(up-research-status c: ri-theocracy >= research-pending)
			(up-compare-const THEOCRACY-AVAILABLE == NO))
		(up-research-status c: ri-illumination == research-available)
		(building-type-count monastery > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-illumination c: 1)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(or
			(goal g-primary-unit monk)
			(and
				(goal g-support-unit monk)
				(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
		(or
			(up-research-status c: ri-theocracy >= research-pending)
			(up-compare-const THEOCRACY-AVAILABLE == NO))
		(up-research-status c: ri-illumination == research-available)
		(building-type-count monastery > 0)
		=>
		(up-store-tech-name c: ri-illumination)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		)

	;---------------
	;	Atonement
	;---------------

		(defrule
		(or
			(goal g-primary-unit monk)
			(and
				(goal g-support-unit monk)
				(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
		(up-compare-goal g-enemy-monks-count >= 5)
		(up-research-status c: ri-atonement == research-available)
		(building-type-count monastery > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-atonement c: 1)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(or
			(goal g-primary-unit monk)
			(and
				(goal g-support-unit monk)
				(up-compare-flag g-flag == SAVE-FOR-SUPPORT-UNIT-TECHS)))
		(up-compare-goal g-enemy-monks-count >= 5)
		(up-research-status c: ri-atonement == research-available)
		(building-type-count monastery > 0)
		=>
		(up-store-tech-name c: ri-atonement)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		)



;=========================<>=========================
;				     OTHER TECHS
;=========================<>=========================

	;--------------
	;	Caravan
	;--------------

		(defrule
		(or
			(up-compare-goal g-desired-num-trade-cart > 0)
			(up-compare-goal g-desired-num-trade-cog > 0))
		(up-research-status c: ri-caravan == research-available)
		(building-type-count market > 0)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-research-cost c: ri-caravan c: 1)
		(up-modify-goal g-important-techs-food-needed g:+ g-food-cost)
		(up-modify-goal g-important-techs-gold-needed g:+ g-gold-cost)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(or
			(up-compare-goal g-desired-num-trade-cart > 0)
			(up-compare-goal g-desired-num-trade-cog > 0))
		(up-research-status c: ri-caravan == research-available)
		(building-type-count market > 0)
		=>
		(up-store-tech-name c: ri-caravan)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		)

;=========================<>=========================
;			STORE TECH RES NEEDED AMOUNTS
;=========================<>=========================

	(defrule
	(true)
	=>
	(up-setup-cost-data 1 g-total-techs-food-needed)
	(up-add-cost-data g-max-food-needed c: 1)
	(up-modify-goal g-total-techs-food-needed g:max g-important-techs-food-needed)
	(up-modify-goal g-total-techs-wood-needed g:max g-important-techs-wood-needed)
	(up-modify-goal g-total-techs-gold-needed g:max g-important-techs-gold-needed)
	(up-modify-goal g-total-techs-stone-needed g:max g-important-techs-stone-needed)
	)

;=========================<>=========================
;		    NEEDED RESOURCES FOR BUILDINGS
;=========================<>=========================

	;-------------
	;	Wonders
	;-------------

		(defrule
		(up-object-type-count-total c: wonder g:< g-desired-num-wonder)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-object-cost c: wonder c: 1)
		(up-modify-goal g-max-wood-needed g:max g-wood-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-max-stone-needed g:max g-stone-cost)
		)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(up-object-type-count-total c: wonder g:< g-desired-num-wonder)
		=>
		(up-store-type-name c: wonder)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		)

	;------------------
	;	Town Centers
	;------------------

		(defrule
		(up-object-type-count-total c: town-center g:< g-desired-num-town-center)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-object-cost c: town-center-foundation c: 1)
		(up-modify-goal g-max-wood-needed g:max g-wood-cost)
		(up-modify-goal g-max-stone-needed g:max g-stone-cost)
		)
        #load-if-defined DE-AVAILABLE
        #load-if-defined BRITON-CIV ;until bug with TC wood cost is fixed for Britons
        (defrule
        (up-object-type-count-total c: town-center g:< g-desired-num-town-center)
        =>
		(up-modify-goal g-max-wood-needed c:max 275)
        )
        #end-if
        #end-if

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(up-object-type-count-total c: town-center g:< g-desired-num-town-center)
		=>
		(up-store-type-name c: town-center)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		)

	;-------------
	;	Castles
	;-------------

		(defrule
		(up-object-type-count-total c: castle g:< g-desired-num-castle)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-object-cost c: castle c: 1)
		(up-modify-goal g-max-stone-needed g:max g-stone-cost)
		)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(up-object-type-count-total c: castle g:< g-desired-num-castle)
		=>
		(up-store-type-name c: castle)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		)

	;---------------------
	;	Siege Workshops
	;---------------------

		(defrule
		(up-object-type-count-total c: siege-workshop g:< g-desired-num-siege-workshop)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-object-cost c: siege-workshop c: 1)
		(up-modify-goal g-max-wood-needed g:max g-wood-cost)
		)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(up-object-type-count-total c: siege-workshop g:< g-desired-num-siege-workshop)
		=>
		(up-store-type-name c: siege-workshop)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		)

	;----------------
	;	University
	;----------------

		(defrule
		(up-object-type-count-total c: university g:< g-desired-num-university)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-object-cost c: university c: 1)
		(up-modify-goal g-max-wood-needed g:max g-wood-cost)
		)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(up-object-type-count-total c: university g:< g-desired-num-university)
		=>
		(up-store-type-name c: university)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		)

	;--------------
	;	Barracks
	;--------------

		(defrule
		(up-object-type-count-total c: barracks g:< g-desired-num-barracks)
		(goal g-primary-unit-class infantry-class)
		(or
			(up-compare-goal g-primary-unit != my-unique-unit)
			(research-completed ri-anarchy))
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-object-cost c: barracks c: 1)
		(up-modify-goal g-max-wood-needed g:max g-wood-cost)
		)
		(defrule
		(up-object-type-count-total c: barracks g:< g-desired-num-barracks)
		(goal g-support-unit-class infantry-class)
		(or
			(up-compare-goal g-support-unit != my-unique-unit)
			(research-completed ri-anarchy))
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-object-cost c: barracks c: 1)
		(up-modify-goal g-max-wood-needed g:max g-wood-cost)
		)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(up-object-type-count-total c: barracks g:< g-desired-num-barracks)
		(goal g-primary-unit-class infantry-class)
		(or
			(up-compare-goal g-primary-unit != my-unique-unit)
			(research-completed ri-anarchy))
		=>
		(up-store-type-name c: barracks)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		(up-jump-rule 1)
		)
			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(up-object-type-count-total c: barracks g:< g-desired-num-barracks)
			(goal g-support-unit-class infantry-class)
			(or
				(up-compare-goal g-support-unit != my-unique-unit)
				(research-completed ri-anarchy))
			=>
			(up-store-type-name c: barracks)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

	;-------------------
	;	Archery Range
	;-------------------

		(defrule
		(up-object-type-count-total c: archery-range g:< g-desired-num-archery-range)
		(or
			(goal g-primary-unit-class archery-class)
			(or
				(goal g-primary-unit-class cavalry-archer-class)
				(goal g-primary-unit hand-cannoneer)))
		(up-compare-goal g-age-status != TO-FEUDAL)
		(up-compare-goal g-primary-unit != my-unique-unit)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-object-cost c: archery-range c: 1)
		(up-modify-goal g-max-wood-needed g:max g-wood-cost)
		)
		(defrule
		(up-object-type-count-total c: archery-range g:< g-desired-num-archery-range)
		(or
			(goal g-primary-unit-class archery-class)
			(or
				(goal g-primary-unit-class cavalry-archer-class)
				(goal g-primary-unit hand-cannoneer)))
		(goal g-age-status TO-FEUDAL)
		(up-compare-goal g-primary-unit != my-unique-unit)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-object-cost c: archery-range c: 1)
		(up-modify-goal g-max-wood-needed g:+ g-wood-cost)
		)
		(defrule
		(up-object-type-count-total c: archery-range g:< g-desired-num-archery-range)
		(or
			(goal g-support-unit-class archery-class)
			(or
				(goal g-support-unit-class cavalry-archer-class)
				(goal g-support-unit hand-cannoneer)))
		(up-compare-goal g-primary-unit != my-unique-unit)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-object-cost c: archery-range c: 1)
		(up-modify-goal g-max-wood-needed g:max g-wood-cost)
		)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(up-object-type-count-total c: archery-range g:< g-desired-num-archery-range)
		(or
			(goal g-primary-unit-class archery-class)
			(or
				(goal g-primary-unit-class cavalry-archer-class)
				(goal g-primary-unit hand-cannoneer)))
		(up-compare-goal g-primary-unit != my-unique-unit)
		=>
		(up-store-type-name c: archery-range)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		(up-jump-rule 1)
		)
			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(up-object-type-count-total c: archery-range g:< g-desired-num-archery-range)
			(or
				(goal g-support-unit-class archery-class)
				(or
					(goal g-support-unit-class cavalry-archer-class)
					(goal g-support-unit hand-cannoneer)))
			(up-compare-goal g-support-unit != my-unique-unit)
			=>
			(up-store-type-name c: archery-range)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

	;------------
	;	Stable
	;------------

		(defrule
		(up-object-type-count-total c: stable g:< g-desired-num-stable)
		(goal g-primary-unit-class cavalry-class)
		(or
			(up-compare-goal g-primary-unit != my-unique-unit)
			(research-completed ri-marauders))
		(up-compare-goal g-age-status != TO-FEUDAL)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-object-cost c: stable c: 1)
		(up-modify-goal g-max-wood-needed g:max g-wood-cost)
		)
		(defrule
		(up-object-type-count-total c: stable g:< g-desired-num-stable)
		(goal g-primary-unit-class cavalry-class)
		(or
			(up-compare-goal g-primary-unit != my-unique-unit)
			(research-completed ri-marauders))
		(goal g-age-status TO-FEUDAL)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-object-cost c: stable c: 1)
		(up-modify-goal g-max-wood-needed g:+ g-wood-cost)
		)
		(defrule
		(up-object-type-count-total c: stable g:< g-desired-num-stable)
		(goal g-support-unit-class cavalry-class)
		(or
			(up-compare-goal g-primary-unit != my-unique-unit)
			(research-completed ri-marauders))
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-object-cost c: stable c: 1)
		(up-modify-goal g-max-wood-needed g:max g-wood-cost)
		)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(up-object-type-count-total c: stable g:< g-desired-num-stable)
		(goal g-primary-unit-class cavalry-class)
		(or
			(up-compare-goal g-primary-unit != my-unique-unit)
			(research-completed ri-marauders))
		=>
		(up-store-type-name c: stable)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		(up-jump-rule 1)
		)
			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(up-object-type-count-total c: stable g:< g-desired-num-stable)
			(goal g-support-unit-class cavalry-class)
			(or
				(up-compare-goal g-primary-unit != my-unique-unit)
				(research-completed ri-marauders))
			=>
			(up-store-type-name c: stable)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

	;---------------
	;	Monastery
	;---------------

		(defrule
		(up-object-type-count-total c: monastery g:< g-desired-num-monastery)
		(or
			(up-compare-goal g-desired-num-monks > 0)
			(goal g-age-status SAVE-FOR-IMPERIAL))
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-object-cost c: monastery c: 1)
		(up-modify-goal g-max-wood-needed g:max g-wood-cost)
		)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(up-object-type-count-total c: monastery g:< g-desired-num-monastery)
		(or
			(up-compare-goal g-desired-num-monks > 0)
			(goal g-age-status SAVE-FOR-IMPERIAL))
		=>
		(up-store-type-name c: monastery)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		)

	;------------
	;	Market
	;------------

		(defrule
		(up-object-type-count-total c: market g:< g-desired-num-market)
		(or
			(and
				(up-object-type-count-total c: town-center g:>= g-desired-num-town-center)
				(up-object-type-count-total c: siege-workshop g:>= g-desired-num-siege-workshop))
			(wood-amount >= 275))
		(up-compare-goal g-age-status != TO-FEUDAL)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-object-cost c: market c: 1)
		(up-modify-goal g-max-wood-needed g:max g-wood-cost)
		)
		(defrule
		(up-object-type-count-total c: market g:< g-desired-num-market)
		(or
			(and
				(up-object-type-count-total c: town-center g:>= g-desired-num-town-center)
				(up-object-type-count-total c: siege-workshop g:>= g-desired-num-siege-workshop))
			(wood-amount >= 275))
		(goal g-age-status TO-FEUDAL)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-object-cost c: market c: 1)
		(up-modify-goal g-max-wood-needed g:+ g-wood-cost)
		)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(up-object-type-count-total c: market g:< g-desired-num-market)
		(or
			(and
				(up-object-type-count-total c: town-center g:>= g-desired-num-town-center)
				(up-object-type-count-total c: siege-workshop g:>= g-desired-num-siege-workshop))
			(wood-amount >= 275))
		=>
		(up-store-type-name c: market)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		)

	;----------
	;	Mill
	;----------

		(defrule
		(up-object-type-count-total c: mill g:< g-desired-num-mill)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-object-cost c: mill c: 1)
		(up-modify-goal g-max-wood-needed g:max g-wood-cost)
		)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(up-object-type-count-total c: mill g:< g-desired-num-mill)
		=>
		(up-store-type-name c: mill)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		)

	;-----------------
	;	Mining Camp
	;-----------------

		(defrule
		(up-object-type-count-total c: mining-camp g:< g-desired-num-mining-camp)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-object-cost c: mining-camp c: 1)
		(up-modify-goal g-max-wood-needed g:max g-wood-cost)
		)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(up-object-type-count-total c: mining-camp g:< g-desired-num-mining-camp)
		=>
		(up-store-type-name c: mining-camp)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		)

	;-----------------
	;	Lumber Camp
	;-----------------

		(defrule
		(up-object-type-count-total c: lumber-camp g:< g-desired-num-lumber-camp)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-object-cost c: lumber-camp c: 1)
		(up-modify-goal g-max-wood-needed g:max g-wood-cost)
		)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(up-object-type-count-total c: lumber-camp g:< g-desired-num-lumber-camp)
		=>
		(up-store-type-name c: lumber-camp)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		)

	;----------
	;	Dock
	;----------

		(defrule
		(up-object-type-count-total c: dock g:< g-desired-num-dock)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-object-cost c: dock c: 1)
		(up-modify-goal g-max-wood-needed g:max g-wood-cost)
		)

		(defrule
		(up-object-type-count-total c: dock g:< g-desired-num-dock)
		(taunt-detected TAUNT-PLAYER 246)
		=>
		(up-store-type-name c: dock)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		)
		
	;----------------
	;	Blacksmith
	;----------------

		(defrule
		(up-object-type-count-total c: blacksmith g:< g-desired-num-blacksmith)
		(up-compare-goal g-age-status != TO-FEUDAL)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-object-cost c: blacksmith c: 1)
		(up-modify-goal g-max-wood-needed g:max g-wood-cost)
		)
		(defrule
		(up-object-type-count-total c: blacksmith g:< g-desired-num-blacksmith)
		(goal g-age-status TO-FEUDAL)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-object-cost c: blacksmith c: 1)
		(up-modify-goal g-max-wood-needed g:+ g-wood-cost)
		)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(up-object-type-count-total c: blacksmith g:< g-desired-num-blacksmith)
		=>
		(up-store-type-name c: blacksmith)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		)
		
	;------------------------
	;	Watch Tower/Donjon
	;------------------------

		(defrule
		(up-compare-goal g-tower-line g:< g-desired-num-tower)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-object-cost c: my-tower-type c: 1)
		(up-modify-goal g-max-wood-needed g:max g-wood-cost)
		(up-modify-goal g-max-stone-needed g:max g-stone-cost)
		)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(up-compare-goal g-tower-line g:< g-desired-num-tower)
		=>
		(up-store-type-name c: my-tower-type)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		)
		
	;-------------------
	;	Bombard Tower
	;-------------------

		(defrule
		(up-object-type-count c: bombard-tower g:< g-desired-num-bombard-tower)
		(building-available bombard-tower)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-object-cost c: bombard-tower c: 1)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-max-stone-needed g:max g-stone-cost)
		)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(up-object-type-count c: bombard-tower g:< g-desired-num-bombard-tower)
		(building-available bombard-tower)
		=>
		(up-store-type-name c: bombard-tower)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		)
		
	;---------------------
	;	Unique Building
	;---------------------

		(defrule
		(up-object-type-count-total c: my-unique-building g:< g-desired-num-unique-building)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-object-cost c: my-unique-building c: 1)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-goal g-max-stone-needed g:max g-stone-cost)
		)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(up-object-type-count-total c: my-unique-building g:< g-desired-num-unique-building)
		=>
		(up-store-type-name c: my-unique-building)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		)

;=========================<>=========================
;			  NEEDED RESOURCES FOR UNITS
;=========================<>=========================

	;-------------------------
	;	Constant train unit
	;-------------------------

		(defrule
		(up-compare-goal g-constant-train-unit > 0)
		=>
		(up-get-indirect-goal g: g-desired-num-constant-train-unit-goal g-desired-num-constant-train-unit)
		)

		(defrule
		(up-compare-goal g-constant-train-unit > 0)
		(up-object-type-count-total g: g-constant-train-unit g:< g-desired-num-constant-train-unit)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-object-cost g: g-constant-train-unit c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-goal g-max-wood-needed g:max g-wood-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(up-compare-goal g-constant-train-unit > 0)
		(up-object-type-count-total g: g-constant-train-unit g:< g-desired-num-constant-train-unit)
		=>
		(up-store-type-name g: g-constant-train-unit)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		)

	;--------------------
	;	Battering Rams
	;--------------------

		(defrule
		(up-object-type-count-total c: battering-ram-line g:< g-desired-num-ram-type)
		(up-compare-goal g-human-military-count g:>= g-min-military-pop)
		(or
			(unit-type-count-total battering-ram-line < 1)
			(and
				(military-population >= 15)
				(unit-type-count-total battering-ram-line < 3)))
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-object-cost c: battering-ram c: 1)
		(up-modify-goal g-max-wood-needed g:max g-wood-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(up-object-type-count-total c: battering-ram-line g:< g-desired-num-ram-type)
		(up-compare-goal g-human-military-count g:>= g-min-military-pop)
		(or
			(unit-type-count-total battering-ram-line < 1)
			(and
				(military-population >= 15)
				(unit-type-count-total battering-ram-line < 3)))
		=>
		(up-store-type-name c: battering-ram)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		)

	;---------------
	;	Mangonels
	;---------------

		(defrule
		(up-compare-goal g-mangonel-line g:< g-desired-num-mangonel)
		(or
			(up-compare-goal g-mangonel-line < 1)
			(and
				(military-population >= 15)
				(up-compare-goal g-mangonel-line < 2)))
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-object-cost c: mangonel c: 1)
		(up-modify-goal g-max-wood-needed g:max g-wood-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(up-compare-goal g-mangonel-line g:< g-desired-num-mangonel)
		(or
			(up-compare-goal g-mangonel-line < 1)
			(and
				(military-population >= 15)
				(up-compare-goal g-mangonel-line < 2)))
		=>
		(up-store-type-name c: mangonel)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		)

	;---------------
	;	Trebuchet
	;---------------	

		#load-if-not-defined DE-AVAILABLE

			(defrule
			(up-object-type-count-total c: trebuchet-set g:< g-desired-num-trebuchet)
			(up-compare-goal g-human-military-count g:>= g-min-military-pop)
			(or
				(unit-type-count-total trebuchet-set < 1)
				(and
					(military-population >= 15)
					(unit-type-count-total trebuchet-set < 2)))
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-object-cost c: trebuchet c: 1)
			(up-modify-goal g-max-wood-needed g:max g-wood-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)

			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(up-object-type-count-total c: trebuchet-set g:< g-desired-num-trebuchet)
			(up-compare-goal g-human-military-count g:>= g-min-military-pop)
			(or
				(unit-type-count-total trebuchet-set < 1)
				(and
					(military-population >= 15)
					(unit-type-count-total trebuchet-set < 2)))
			=>
			(up-store-type-name c: trebuchet)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)
		
		#else

			(defrule
			; (up-object-type-count-total c: trebuchet-set g:< g-desired-num-trebuchet)	;bugged in DE
			(up-object-type-count c: trebuchet-set g:< g-desired-num-trebuchet)
			(up-compare-goal g-human-military-count g:>= g-min-military-pop)
			(or
				(unit-type-count trebuchet-set < 1)
				(and
					(military-population >= 15)
					(unit-type-count trebuchet-set < 2)))
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-object-cost c: trebuchet c: 1)
			(up-modify-goal g-max-wood-needed g:max g-wood-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)

			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			; (up-object-type-count-total c: trebuchet-set g:< g-desired-num-trebuchet)	;bugged in DE
			(up-object-type-count c: trebuchet-set g:< g-desired-num-trebuchet)
			(up-compare-goal g-human-military-count g:>= g-min-military-pop)
			(or
				(unit-type-count trebuchet-set < 1)
				(and
					(military-population >= 15)
					(unit-type-count trebuchet-set < 2)))
			=>
			(up-store-type-name c: trebuchet)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

		#end-if

	;---------------------
	;	Bombard Cannons
	;---------------------

		#load-if-defined DE-AVAILABLE

			(defrule
			(up-object-type-count-total c: bombard-cannon-line g:< g-desired-num-bombard-cannon)
			(up-compare-goal g-human-military-count g:>= g-min-military-pop)
			(or
				(unit-type-count-total bombard-cannon-line < 1)
				(and
					(military-population >= 15)
					(unit-type-count-total bombard-cannon-line < 2)))
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-object-cost c: bombard-cannon c: 1)
			(up-modify-goal g-max-wood-needed g:max g-wood-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)

			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(up-object-type-count-total c: bombard-cannon-line g:< g-desired-num-bombard-cannon)
			(up-compare-goal g-human-military-count g:>= g-min-military-pop)
			(or
				(unit-type-count-total bombard-cannon-line < 1)
				(and
					(military-population >= 15)
					(unit-type-count-total bombard-cannon-line < 2)))
			=>
			(up-store-type-name c: bombard-cannon)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

		#else

			(defrule
			(up-object-type-count-total c: bombard-cannon g:< g-desired-num-bombard-cannon)
			(up-compare-goal g-human-military-count g:>= g-min-military-pop)
			(or
				(unit-type-count-total bombard-cannon < 1)
				(and
					(military-population >= 15)
					(unit-type-count-total bombard-cannon < 2)))
			=>
			(up-setup-cost-data 1 g-food-cost)
			(up-add-object-cost c: bombard-cannon c: 1)
			(up-modify-goal g-max-wood-needed g:max g-wood-cost)
			(up-modify-goal g-max-gold-needed g:max g-gold-cost)
			)

			(defrule
			(taunt-detected TAUNT-PLAYER 246)
			(up-object-type-count-total c: bombard-cannon g:< g-desired-num-bombard-cannon)
			(up-compare-goal g-human-military-count g:>= g-min-military-pop)
			(or
				(unit-type-count-total bombard-cannon < 1)
				(and
					(military-population >= 15)
					(unit-type-count-total bombard-cannon < 2)))
			=>
			(up-store-type-name c: bombard-cannon)
			(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
			)

		#end-if

	;---------------
	;	Villagers
	;---------------

		(defrule
		(up-object-type-count-total c: villager g:< g-desired-num-villager)
		(goal g-villager-training TRAIN-WITH-ESCROW)
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-object-cost c: villager c: 1)
		(up-modify-goal g-max-food-needed g:max g-food-cost)
		(up-modify-escrow food g:= g-max-food-needed)
		)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(up-object-type-count-total c: villager g:< g-desired-num-villager)
		(goal g-villager-training TRAIN-WITH-ESCROW)
		=>
		(up-store-type-name c: villager)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		)

	;-----------------
	;	Trade Carts
	;-----------------

		(defrule
		(up-object-type-count-total c: trade-cart g:< g-desired-num-trade-cart)
		(up-compare-goal g-human-military-count g:>= g-min-military-pop)
		(nor
			(goal g-game-focus DEFENSIVE)
			(goal g-game-focus AGGRESSIVE))
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-object-cost c: trade-cart c: 1)
		(up-modify-goal g-max-wood-needed g:max g-wood-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-escrow wood g:= g-max-wood-needed)
		(up-modify-escrow gold g:= g-max-gold-needed)
		)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(up-object-type-count-total c: trade-cart g:< g-desired-num-trade-cart)
		(up-compare-goal g-human-military-count g:>= g-min-military-pop)
		(nor
			(goal g-game-focus DEFENSIVE)
			(goal g-game-focus AGGRESSIVE))
		=>
		(up-store-type-name c: trade-cart)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		)

	;----------------
	;	Trade Cogs
	;----------------

		(defrule
		(up-object-type-count-total c: trade-cog g:< g-desired-num-trade-cog)
		(up-compare-goal g-human-military-count g:>= g-min-military-pop)
		(nor
			(goal g-game-focus DEFENSIVE)
			(goal g-game-focus AGGRESSIVE))
		=>
		(up-setup-cost-data 1 g-food-cost)
		(up-add-object-cost c: trade-cog c: 1)
		(up-modify-goal g-max-wood-needed g:max g-wood-cost)
		(up-modify-goal g-max-gold-needed g:max g-gold-cost)
		(up-modify-escrow wood g:= g-max-wood-needed)
		(up-modify-escrow gold g:= g-max-gold-needed)
		)

		(defrule
		(taunt-detected TAUNT-PLAYER 246)
		(up-object-type-count-total c: trade-cog g:< g-desired-num-trade-cog)
		(up-compare-goal g-human-military-count g:>= g-min-military-pop)
		(nor
			(goal g-game-focus DEFENSIVE)
			(goal g-game-focus AGGRESSIVE))
		=>
		(up-store-type-name c: trade-cog)
		(up-chat-data-to-player THIS-ANY-TAUNT-PLAYER TAUNT-246-SAVING c: 7031232)
		)

