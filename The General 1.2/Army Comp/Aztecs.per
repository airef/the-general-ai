;----------------------
;   Swordsmen Strats
;----------------------

    ;-------------
    ;   Defense
    ;-------------

        (defrule
        (goal g-game-focus DEFENSIVE)
        (up-compare-goal g-desired-num-military > 0)
        (current-age >= castle-age)
        (goal g-primary-unit militiaman)
        (military-population g:< g-min-military-pop)
        (or
            (up-compare-goal g-enemy-foot-archers-count > 5)
            (or
                (up-compare-goal g-enemy-cavalry-archers-count > 5)
                (up-compare-goal g-enemy-hand-cannoneer-slinger-count > 3)))
        =>
        (up-modify-goal g-desired-num-skirmisher c:max 6)
        )

        (defrule
        (goal g-game-focus DEFENSIVE)
        (up-compare-goal g-desired-num-military > 0)
        (current-age >= castle-age)
        (goal g-primary-unit militiaman)
        (military-population g:< g-min-military-pop)
        (or
            (up-compare-goal g-enemy-heavy-cavalry-count > 4)
            (or
                (up-compare-goal g-enemy-camel-count > 6)
                (up-compare-goal g-enemy-elephants-count > 2)))
        (or
            (goal g-primary-enemy-threat g-enemy-heavy-cavalry-count)
            (or
                (goal g-primary-enemy-threat g-enemy-camel-count)
                (goal g-primary-enemy-threat g-enemy-elephants-count)))
        =>
        (up-modify-goal g-desired-num-spearman c:max 6)
        )

        (defrule
        (goal g-game-focus DEFENSIVE)
        (up-compare-goal g-desired-num-military > 0)
        (current-age >= castle-age)
        (goal g-primary-unit militiaman)
        (military-population g:< g-min-military-pop)
        (or
            (up-compare-goal g-enemy-elephants-count > 2)
            (or
                (up-compare-goal g-enemy-heavy-cavalry-count > 3)
                (up-compare-goal g-enemy-camel-count > 3)))
        (or
            (goal g-primary-enemy-threat g-enemy-heavy-cavalry-count)
            (or
                (goal g-primary-enemy-threat g-enemy-camel-count)
                (goal g-primary-enemy-threat g-enemy-elephants-count)))
        =>
        (up-modify-goal g-desired-num-monk c:max 2)
        )

    ;---------------
    ;   Imp Flank
    ;---------------

        ;---------------
        ;   Early Imp
        ;---------------

            ;Select support unit
            (defrule
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy EARLYI-CHAMPFLOOD)
            (goal g-support-unit 0)
            (goal g-position FLANK)
            (or
                (up-compare-goal g-enemy-foot-archers-count > 6)
                (or
                    (up-compare-goal g-enemy-cavalry-archers-count > 5)
                    (up-compare-goal g-enemy-hand-cannoneer-slinger-count > 3)))
            =>
            (set-goal g-support-unit skirmisher)
            )

            (defrule
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy EARLYI-CHAMPFLOOD)
            (goal g-support-unit 0)
            (goal g-position FLANK)
            (up-compare-goal g-archer-tech-progress >= PRIORITY-CASTLE-COMPLETE)
            (or
                (up-compare-goal g-enemy-special-unique-unit-count > 6)
                (and
                    (up-compare-goal g-enemy-special-unique-unit-count > 3)
                    (military-population < 12)))
            (or
                (up-compare-flag g-enemy-special-unique-unit-flag == CATAPHRACT)
                (up-compare-flag g-enemy-special-unique-unit-flag == JAGUAR-WARRIOR))
            =>
            (set-goal g-support-unit archer)
            )

            (defrule
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy EARLYI-CHAMPFLOOD)
            (goal g-support-unit 0)
            (goal g-position FLANK)
            (up-compare-goal g-unique-unit-tech-progress >= PRIORITY-CASTLE-COMPLETE)
            (or
                (up-compare-goal g-enemy-special-unique-unit-count > 6)
                (and
                    (up-compare-goal g-enemy-special-unique-unit-count > 3)
                    (military-population < 12)))
            (or
                (up-compare-flag g-enemy-special-unique-unit-flag == HUSKARL)
                (up-compare-flag g-enemy-special-unique-unit-flag == TEUTONIC-KNIGHT))
            =>
            (set-goal g-support-unit my-unique-unit)
            )

            (defrule
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy EARLYI-CHAMPFLOOD)
            (goal g-support-unit 0)
            (goal g-position FLANK)
            (up-compare-goal g-spearman-tech-progress >= PRIORITY-CASTLE-COMPLETE)
            (or
                (up-compare-goal g-enemy-light-cavalry-count > 12)
                (or
                    (up-compare-goal g-enemy-heavy-cavalry-count > 8)
                    (or
                        (up-compare-goal g-enemy-elephants-count > 5)
                        (and
                            (up-compare-goal g-enemy-special-unique-unit-count > 8)
                            (up-compare-flag g-enemy-special-unique-unit-flag == LEITIS)))))
            =>
            (set-goal g-support-unit spearman)
            )
            (defrule
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy EARLYI-CHAMPFLOOD)
            (goal g-support-unit 0)
            (goal g-position FLANK)
            (up-compare-goal g-spearman-tech-progress >= PRIORITY-CASTLE-COMPLETE)
            (military-population < 12)
            (or
                (up-compare-goal g-enemy-light-cavalry-count > 8)
                (or
                    (up-compare-goal g-enemy-heavy-cavalry-count > 5)
                    (or
                        (up-compare-goal g-enemy-elephants-count > 3)
                        (and
                            (up-compare-goal g-enemy-special-unique-unit-count > 5)
                            (up-compare-flag g-enemy-special-unique-unit-flag == LEITIS)))))
            =>
            (set-goal g-support-unit spearman)
            )

            (defrule
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy EARLYI-CHAMPFLOOD)
            (goal g-support-unit 0)
            (goal g-position FLANK)
            =>
            (set-goal g-support-unit archer)
            )

            (defrule
            (goal g-position FLANK)
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy EARLYI-CHAMPFLOOD)
            (goal g-support-unit spearman)
            =>
            (up-modify-goal g-desired-num-militia g:= g-desired-num-military)
            (up-modify-goal g-desired-num-militia c:%* 75)
            (up-modify-goal g-desired-num-spearman g:= g-desired-num-military)
            (up-modify-goal g-desired-num-spearman c:%* 25)
            )

            (defrule
            (goal g-position FLANK)
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy EARLYI-CHAMPFLOOD)
            (goal g-support-unit archer)
            =>
            (up-modify-goal g-desired-num-militia g:= g-desired-num-military)
            (up-modify-goal g-desired-num-militia c:%* 70)
            (up-modify-goal g-desired-num-archer g:= g-desired-num-military)
            (up-modify-goal g-desired-num-archer c:%* 30)
            )

            (defrule
            (goal g-position FLANK)
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy EARLYI-CHAMPFLOOD)
            (goal g-support-unit skirmisher)
            =>
            (up-modify-goal g-desired-num-militia g:= g-desired-num-military)
            (up-modify-goal g-desired-num-militia c:%* 60)
            (up-modify-goal g-desired-num-skirmisher g:= g-desired-num-military)
            (up-modify-goal g-desired-num-skirmisher c:%* 40)
            )

            (defrule
            (goal g-position FLANK)
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy EARLYI-CHAMPFLOOD)
            (goal g-support-unit my-unique-unit)
            =>
            (up-modify-goal g-desired-num-militia g:= g-desired-num-military)
            (up-modify-goal g-desired-num-militia c:%* 70)
            (up-modify-goal g-desired-num-unique-unit g:= g-desired-num-military)
            (up-modify-goal g-desired-num-unique-unit c:%* 30)
            )

        ;-------------
        ;   Mid Imp
        ;-------------

            ;Select support unit
            (defrule
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy MIDI-CHAMPIONS)
            (goal g-support-unit 0)
            (goal g-position FLANK)
            (or
                (up-compare-goal g-enemy-foot-archers-count > 12)
                (or
                    (up-compare-goal g-enemy-cavalry-archers-count > 12)
                    (up-compare-goal g-enemy-hand-cannoneer-slinger-count > 8)))
            =>
            (set-goal g-support-unit skirmisher)
            )
            (defrule
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy MIDI-CHAMPIONS)
            (goal g-support-unit 0)
            (goal g-position FLANK)
            (or
                (up-compare-goal g-enemy-special-unique-unit-count > 12)
                (and
                    (up-compare-goal g-enemy-special-unique-unit-count > 8)
                    (military-population < 12)))
            (or
                (up-compare-flag g-enemy-special-unique-unit-flag == GENOESE-CROSSBOWMAN)
                (up-compare-flag g-enemy-special-unique-unit-flag == MAMELUKE))
            =>
            (set-goal g-support-unit skirmisher)
            )

            (defrule
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy MIDI-CHAMPIONS)
            (goal g-support-unit 0)
            (goal g-position FLANK)
            (up-compare-goal g-archer-tech-progress >= PRIORITY-CASTLE-COMPLETE)
            (or
                (up-compare-goal g-enemy-special-unique-unit-count > 12)
                (and
                    (up-compare-goal g-enemy-special-unique-unit-count > 8)
                    (military-population < 12)))
            (or
                (up-compare-flag g-enemy-special-unique-unit-flag == CATAPHRACT)
                (up-compare-flag g-enemy-special-unique-unit-flag == JAGUAR-WARRIOR))
            =>
            (set-goal g-support-unit archer)
            )

            (defrule
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy MIDI-CHAMPIONS)
            (goal g-support-unit 0)
            (goal g-position FLANK)
            (up-compare-goal g-unique-unit-tech-progress >= PRIORITY-CASTLE-COMPLETE)
            (or
                (up-compare-goal g-enemy-special-unique-unit-count > 8)
                (and
                    (up-compare-goal g-enemy-special-unique-unit-count > 5)
                    (military-population < 12)))
            (or
                (up-compare-flag g-enemy-special-unique-unit-flag == HUSKARL)
                (up-compare-flag g-enemy-special-unique-unit-flag == TEUTONIC-KNIGHT))
            =>
            (set-goal g-support-unit my-unique-unit)
            )

            (defrule
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy MIDI-CHAMPIONS)
            (goal g-support-unit 0)
            (goal g-position FLANK)
            (or
                (up-compare-goal g-enemy-heavy-cavalry-count > 8)
                (or
                    (up-compare-goal g-enemy-elephants-count > 5)
                    (and
                        (up-compare-goal g-enemy-special-unique-unit-count > 8)
                        (up-compare-flag g-enemy-special-unique-unit-flag == LEITIS))))
            =>
            (set-goal g-support-unit spearman)
            )
            (defrule
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy MIDI-CHAMPIONS)
            (goal g-support-unit 0)
            (goal g-position FLANK)
            (military-population < 12)
            (or
                (up-compare-goal g-enemy-heavy-cavalry-count > 5)
                (or
                    (up-compare-goal g-enemy-elephants-count > 3)
                    (and
                        (up-compare-goal g-enemy-special-unique-unit-count > 5)
                        (up-compare-flag g-enemy-special-unique-unit-flag == LEITIS))))
            =>
            (set-goal g-support-unit spearman)
            )

            (defrule
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy MIDI-CHAMPIONS)
            (goal g-support-unit 0)
            (goal g-position FLANK)
            =>
            (set-goal g-support-unit archer)
            )

            ;Modify unit counts
            (defrule
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy MIDI-CHAMPIONS)
            (goal g-support-unit spearman)
            (goal g-position FLANK)
            =>
            (up-modify-goal g-desired-num-militia g:= g-desired-num-military)
            (up-modify-goal g-desired-num-militia c:%* 65)
            (up-modify-goal g-desired-num-spearman g:= g-desired-num-military)
            (up-modify-goal g-desired-num-spearman c:%* 35)
            )
            
            (defrule
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy MIDI-CHAMPIONS)
            (goal g-support-unit archer)
            (goal g-position FLANK)
            =>
            (up-modify-goal g-desired-num-militia g:= g-desired-num-military)
            (up-modify-goal g-desired-num-militia c:%* 65)
            (up-modify-goal g-desired-num-archer g:= g-desired-num-military)
            (up-modify-goal g-desired-num-archer c:%* 35)
            )

            (defrule
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy MIDI-CHAMPIONS)
            (goal g-support-unit skirmisher)
            (goal g-position FLANK)
            =>
            (up-modify-goal g-desired-num-militia g:= g-desired-num-military)
            (up-modify-goal g-desired-num-militia c:%* 60)
            (up-modify-goal g-desired-num-skirmisher g:= g-desired-num-military)
            (up-modify-goal g-desired-num-skirmisher c:%* 40)
            )
            (defrule
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy MIDI-CHAMPIONS)
            (goal g-support-unit skirmisher)
            (goal g-position FLANK)
            (or
                (up-compare-goal g-enemy-special-unique-unit-count > 8)
                (and
                    (up-compare-goal g-enemy-special-unique-unit-count > 5)
                    (military-population < 12)))
            (or
                (up-compare-flag g-enemy-special-unique-unit-flag == GENOESE-CROSSBOWMAN)
                (up-compare-flag g-enemy-special-unique-unit-flag == MAMELUKE))
            =>
            (up-modify-goal g-desired-num-militia g:= g-desired-num-military)
            (up-modify-goal g-desired-num-militia c:%* 70)
            (up-modify-goal g-desired-num-skirmisher g:= g-desired-num-military)
            (up-modify-goal g-desired-num-skirmisher c:%* 30)
            )

            (defrule
            (goal g-position FLANK)
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy MIDI-CHAMPIONS)
            (goal g-support-unit my-unique-unit)
            =>
            (up-modify-goal g-desired-num-militia g:= g-desired-num-military)
            (up-modify-goal g-desired-num-militia c:%* 70)
            (up-modify-goal g-desired-num-unique-unit g:= g-desired-num-military)
            (up-modify-goal g-desired-num-unique-unit c:%* 30)
            )

    ;----------------
    ;   Imp Pocket
    ;----------------

        ;Select support unit
        (defrule
        (up-compare-goal g-desired-num-military > 0)
        (or
            (goal g-current-strategy EARLYI-CHAMPFLOOD)
            (goal g-current-strategy MIDI-CHAMPIONS))
        (goal g-support-unit 0)
        (goal g-position POCKET)
        (or
            (up-compare-goal g-enemy-foot-archers-count > 12)
            (or
                (up-compare-goal g-enemy-cavalry-archers-count > 10)
                (up-compare-goal g-enemy-hand-cannoneer-slinger-count > 5)))
        =>
        (set-goal g-support-unit skirmisher)
        )

        (defrule
        (up-compare-goal g-desired-num-military > 0)
        (or
            (goal g-current-strategy EARLYI-CHAMPFLOOD)
            (goal g-current-strategy MIDI-CHAMPIONS))
        (goal g-support-unit 0)
        (goal g-position POCKET)
        (up-compare-goal g-archer-tech-progress >= PRIORITY-CASTLE-COMPLETE)
        (or
            (up-compare-goal g-enemy-special-unique-unit-count > 12)
            (and
                (up-compare-goal g-enemy-special-unique-unit-count > 8)
                (military-population < 12)))
        (or
            (up-compare-flag g-enemy-special-unique-unit-flag == CATAPHRACT)
            (up-compare-flag g-enemy-special-unique-unit-flag == JAGUAR-WARRIOR))
        =>
        (set-goal g-support-unit archer)
        )

        (defrule
        (up-compare-goal g-desired-num-military > 0)
        (or
            (goal g-current-strategy EARLYI-CHAMPFLOOD)
            (goal g-current-strategy MIDI-CHAMPIONS))
        (goal g-support-unit 0)
        (goal g-position POCKET)
        (up-compare-goal g-unique-unit-tech-progress >= PRIORITY-CASTLE-COMPLETE)
        (or
            (up-compare-goal g-enemy-special-unique-unit-count > 12)
            (and
                (up-compare-goal g-enemy-special-unique-unit-count > 8)
                (military-population < 12)))
        (or
            (up-compare-flag g-enemy-special-unique-unit-flag == HUSKARL)
            (up-compare-flag g-enemy-special-unique-unit-flag == TEUTONIC-KNIGHT))
        =>
        (set-goal g-support-unit my-unique-unit)
        )

        (defrule
        (up-compare-goal g-desired-num-military > 0)
        (or
            (goal g-current-strategy EARLYI-CHAMPFLOOD)
            (goal g-current-strategy MIDI-CHAMPIONS))
        (goal g-support-unit 0)
        (goal g-position POCKET)
        (up-compare-goal g-spearman-tech-progress >= PRIORITY-CASTLE-COMPLETE)
        (or
            (up-compare-goal g-enemy-heavy-cavalry-count > 16)
            (or
                (up-compare-goal g-enemy-elephants-count > 10)
                (and
                    (up-compare-goal g-enemy-special-unique-unit-count > 16)
                    (up-compare-flag g-enemy-special-unique-unit-flag == LEITIS))))
        =>
        (set-goal g-support-unit spearman)
        )
        (defrule
        (up-compare-goal g-desired-num-military > 0)
        (or
            (goal g-current-strategy EARLYI-CHAMPFLOOD)
            (goal g-current-strategy MIDI-CHAMPIONS))
        (goal g-support-unit 0)
        (goal g-position POCKET)
        (up-compare-goal g-spearman-tech-progress >= PRIORITY-CASTLE-COMPLETE)
        (military-population < 12)
        (or
            (up-compare-goal g-enemy-heavy-cavalry-count > 10)
            (or
                (up-compare-goal g-enemy-elephants-count > 6)
                (and
                    (up-compare-goal g-enemy-special-unique-unit-count > 10)
                    (up-compare-flag g-enemy-special-unique-unit-flag == LEITIS))))
        =>
        (set-goal g-support-unit spearman)
        )

        (defrule
        (up-compare-goal g-desired-num-military > 0)
        (goal g-current-strategy MIDI-CHAMPIONS)
        (goal g-support-unit 0)
        (goal g-position POCKET)
        =>
        (set-goal g-support-unit archer)
        )

        (defrule
        (goal g-position POCKET)
        (up-compare-goal g-desired-num-military > 0)
        (or
            (goal g-current-strategy EARLYI-CHAMPFLOOD)
            (goal g-current-strategy MIDI-CHAMPIONS))
        (goal g-support-unit spearman)
        =>
        (up-modify-goal g-desired-num-militia g:= g-desired-num-military)
        (up-modify-goal g-desired-num-militia c:%* 75)
        (up-modify-goal g-desired-num-spearman g:= g-desired-num-military)
        (up-modify-goal g-desired-num-spearman c:%* 25)
        )

        (defrule
        (goal g-position POCKET)
        (up-compare-goal g-desired-num-military > 0)
        (or
            (goal g-current-strategy EARLYI-CHAMPFLOOD)
            (goal g-current-strategy MIDI-CHAMPIONS))
        (goal g-support-unit archer)
        =>
        (up-modify-goal g-desired-num-militia g:= g-desired-num-military)
        (up-modify-goal g-desired-num-militia c:%* 70)
        (up-modify-goal g-desired-num-archer g:= g-desired-num-military)
        (up-modify-goal g-desired-num-archer c:%* 30)
        )

        (defrule
        (goal g-position POCKET)
        (up-compare-goal g-desired-num-military > 0)
        (or
            (goal g-current-strategy EARLYI-CHAMPFLOOD)
            (goal g-current-strategy MIDI-CHAMPIONS))
        (goal g-support-unit skirmisher)
        =>
        (up-modify-goal g-desired-num-militia g:= g-desired-num-military)
        (up-modify-goal g-desired-num-militia c:%* 70)
        (up-modify-goal g-desired-num-skirmisher g:= g-desired-num-military)
        (up-modify-goal g-desired-num-skirmisher c:%* 30)
        )

        (defrule
        (goal g-position POCKET)
        (up-compare-goal g-desired-num-military > 0)
        (or
            (goal g-current-strategy EARLYI-CHAMPFLOOD)
            (goal g-current-strategy MIDI-CHAMPIONS))
        (goal g-support-unit my-unique-unit)
        =>
        (up-modify-goal g-desired-num-militia g:= g-desired-num-military)
        (up-modify-goal g-desired-num-militia c:%* 75)
        (up-modify-goal g-desired-num-unique-unit g:= g-desired-num-military)
        (up-modify-goal g-desired-num-unique-unit c:%* 25)
        )

    ;--------------
    ;   Late Imp
    ;--------------

        (defrule
        (up-compare-goal g-desired-num-military > 0)
        (goal g-current-strategy LATEI-CHAMPIONS)
        =>
        (up-modify-goal g-desired-num-militia g:= g-desired-num-military)
        (up-modify-goal g-desired-num-militia c:%* 65)
        (set-goal g-support-unit skirmisher)
        (up-modify-goal g-desired-num-skirmisher g:= g-desired-num-military)
        (up-modify-goal g-desired-num-skirmisher c:%* 35)
        )

;---------------------
;   Spearmen Strats
;---------------------

    (defrule
    (up-compare-goal g-desired-num-military > 0)
    (goal g-current-strategy LATEI-TRASHALBS)
    =>
    (up-modify-goal g-desired-num-spearman g:= g-desired-num-military)
    (up-modify-goal g-desired-num-spearman c:%* 65)
    (set-goal g-support-unit skirmisher)
    (up-modify-goal g-desired-num-skirmisher g:= g-desired-num-military)
    (up-modify-goal g-desired-num-skirmisher c:%* 35)
    )

;--------------------------
;   Eagle Warrior Strats
;--------------------------

    ;-------------
    ;   Defense
    ;-------------

        (defrule
        (goal g-game-focus DEFENSIVE)
        (up-compare-goal g-desired-num-military > 0)
        (current-age >= castle-age)
        (goal g-primary-unit eagle-warrior)
        (military-population g:< g-min-military-pop)
        (up-compare-goal g-enemy-swordsmen-count > 5)
        (goal g-primary-enemy-threat g-enemy-swordsmen-count)
        =>
        (up-modify-goal g-desired-num-archer c:max 6)
        )

        (defrule
        (goal g-game-focus DEFENSIVE)
        (up-compare-goal g-desired-num-military > 0)
        (current-age >= castle-age)
        (goal g-primary-unit eagle-warrior)
        (military-population g:< g-min-military-pop)
        (or
            (up-compare-goal g-enemy-heavy-cavalry-count > 4)
            (or
                (up-compare-goal g-enemy-camel-count > 6)
                (up-compare-goal g-enemy-elephants-count > 2)))
        (or
            (goal g-primary-enemy-threat g-enemy-heavy-cavalry-count)
            (or
                (goal g-primary-enemy-threat g-enemy-camel-count)
                (goal g-primary-enemy-threat g-enemy-elephants-count)))
        =>
        (up-modify-goal g-desired-num-spearman c:max 6)
        )

        (defrule
        (goal g-game-focus DEFENSIVE)
        (up-compare-goal g-desired-num-military > 0)
        (current-age >= castle-age)
        (goal g-primary-unit eagle-warrior)
        (military-population g:< g-min-military-pop)
        (up-compare-goal g-enemy-hand-cannoneer-slinger-count > 5)
        =>
        (up-modify-goal g-desired-num-skirmisher c:max 6)
        )

        (defrule
        (goal g-game-focus DEFENSIVE)
        (up-compare-goal g-desired-num-military > 0)
        (current-age >= castle-age)
        (goal g-primary-unit eagle-warrior)
        (military-population g:< g-min-military-pop)
        (up-compare-goal g-enemy-eagle-warrior-count > 6)
        (goal g-primary-enemy-threat g-enemy-eagle-warrior-count)
        =>
        (up-modify-goal g-desired-num-militia c:max 6)
        )

        (defrule
        (goal g-game-focus DEFENSIVE)
        (up-compare-goal g-desired-num-military > 0)
        (current-age >= castle-age)
        (goal g-primary-unit eagle-warrior)
        (military-population g:< g-min-military-pop)
        (or
            (up-compare-goal g-enemy-elephants-count > 2)
            (or
                (up-compare-goal g-enemy-heavy-cavalry-count > 3)
                (up-compare-goal g-enemy-camel-count > 3)))
        (or
            (goal g-primary-enemy-threat g-enemy-heavy-cavalry-count)
            (or
                (goal g-primary-enemy-threat g-enemy-camel-count)
                (goal g-primary-enemy-threat g-enemy-elephants-count)))
        =>
        (up-modify-goal g-desired-num-monk c:max 2)
        )

    ;----------------
    ;   Mid Castle
    ;----------------

        ;Select support unit
        (defrule
        (up-compare-goal g-desired-num-military > 0)
        (goal g-current-strategy MIDC-EAGLES)
        (goal g-support-unit 0)
        (goal g-position FLANK)
        (or
            (up-compare-goal g-enemy-special-unique-unit-count > 6)
            (and
                (up-compare-goal g-enemy-special-unique-unit-count > 3)
                (military-population < 12)))
        (or
            (up-compare-flag g-enemy-special-unique-unit-flag == CATAPHRACT)
            (or
                (up-compare-flag g-enemy-special-unique-unit-flag == TEUTONIC-KNIGHT)
                (up-compare-flag g-enemy-special-unique-unit-flag == JAGUAR-WARRIOR)))
        =>
        (set-goal g-support-unit archer)
        )

        (defrule
        (up-compare-goal g-desired-num-military > 0)
        (goal g-current-strategy MIDC-EAGLES)
        (or
            (goal g-support-unit 0)
            (or
                (goal g-support-unit archer)
                (and
                    (goal g-support-unit spearman)
                    (up-compare-goal g-enemy-heavy-cavalry-count < 3))))
        (goal g-position FLANK)
        (or
            (up-compare-goal g-enemy-foot-archers-count > 12)
            (or
                (up-compare-goal g-enemy-cavalry-archers-count > 10)
                (up-compare-goal g-enemy-hand-cannoneer-slinger-count > 6)))
        =>
        (set-goal g-support-unit skirmisher)
        )
        (defrule
        (up-compare-goal g-desired-num-military > 0)
        (goal g-current-strategy MIDC-EAGLES)
        (or
            (goal g-support-unit 0)
            (goal g-support-unit archer))
        (goal g-position FLANK)
        (military-population < 12)
        (or
            (up-compare-goal g-enemy-foot-archers-count > 9)
            (or
                (up-compare-goal g-enemy-cavalry-archers-count > 7)
                (up-compare-goal g-enemy-hand-cannoneer-slinger-count > 3)))
        =>
        (set-goal g-support-unit skirmisher)
        )
        (defrule
        (up-compare-goal g-desired-num-military > 0)
        (goal g-current-strategy MIDC-EAGLES)
        (goal g-support-unit 0)
        (goal g-position FLANK)
        (or
            (up-compare-goal g-enemy-special-unique-unit-count > 8)
            (and
                (up-compare-goal g-enemy-special-unique-unit-count > 5)
                (military-population < 12)))
        (or
            (up-compare-flag g-enemy-special-unique-unit-flag == CAMEL-ARCHER)
            (up-compare-flag g-enemy-special-unique-unit-flag == MAMELUKE))
        =>
        (set-goal g-support-unit skirmisher)
        )
        
        (defrule
        (up-compare-goal g-desired-num-military > 0)
        (goal g-current-strategy MIDC-EAGLES)
        (or
            (goal g-support-unit 0)
            (goal g-support-unit skirmisher))
        (goal g-position FLANK)
        (building-type-count castle == 0)
        (up-compare-goal g-enemy-swordsmen-count > 6)
        =>
        (set-goal g-support-unit militiaman)
        )

        (defrule
        (up-compare-goal g-desired-num-military > 0)
        (goal g-current-strategy MIDC-EAGLES)
        (or
            (goal g-support-unit 0)
            (goal g-support-unit skirmisher))
        (goal g-position FLANK)
        (or
            (up-compare-goal g-enemy-light-cavalry-count > 5)
            (or
                (up-compare-goal g-enemy-heavy-cavalry-count > 4)
                (or
                    (up-compare-goal g-enemy-elephants-count > 2)
                    (and
                        (up-compare-goal g-enemy-special-unique-unit-count > 4)
                        (up-compare-flag g-enemy-special-unique-unit-flag == LEITIS)))))
        =>
        (set-goal g-support-unit spearman)
        )
        
        (defrule
        (up-compare-goal g-desired-num-military > 0)
        (goal g-current-strategy MIDC-EAGLES)
        (or
            (goal g-support-unit 0)
            (goal g-support-unit archer))
        (goal g-position FLANK)
        (building-type-count castle > 0)
        (or
            (up-compare-goal g-enemy-swordsmen-count > 6)
            (or
                (up-compare-goal g-enemy-eagle-warrior-count > 6)
                (up-compare-goal g-enemy-condottiero-count > 6)))
        =>
        (set-goal g-support-unit my-unique-unit)
        )
        (defrule
        (up-compare-goal g-desired-num-military > 0)
        (goal g-current-strategy MIDC-EAGLES)
        (or
            (goal g-support-unit 0)
            (goal g-support-unit archer))
        (goal g-position FLANK)
        (building-type-count castle > 0)
        (or
            (up-compare-goal g-enemy-special-unique-unit-count > 6)
            (and
                (up-compare-goal g-enemy-special-unique-unit-count > 3)
                (military-population < 12)))
        (or
            (up-compare-flag g-enemy-special-unique-unit-flag == TEUTONIC-KNIGHT)
            (up-compare-flag g-enemy-special-unique-unit-flag == HUSKARL))
        =>
        (set-goal g-support-unit my-unique-unit)
        )

        (defrule
        (up-compare-goal g-desired-num-military > 0)
        (goal g-current-strategy MIDC-EAGLES)
        (or
            (goal g-support-unit 0)
            (goal g-support-unit skirmisher))
        (goal g-position FLANK)
        (up-compare-goal g-enemy-eagle-warrior-count > 8)
        =>
        (set-goal g-support-unit militiaman)
        )
        (defrule
        (up-compare-goal g-desired-num-military > 0)
        (goal g-current-strategy MIDC-EAGLES)
        (or
            (goal g-support-unit 0)
            (goal g-support-unit skirmisher))
        (goal g-position FLANK)
        (or
            (up-compare-goal g-enemy-special-unique-unit-count > 6)
            (and
                (up-compare-goal g-enemy-special-unique-unit-count > 3)
                (military-population < 12)))
        (or
            (up-compare-flag g-enemy-special-unique-unit-flag == SAMURAI)
            (up-compare-flag g-enemy-special-unique-unit-flag == HUSKARL))
        =>
        (set-goal g-support-unit militiaman)
        )

        ;Modify unit counts
        (defrule
        (up-compare-goal g-desired-num-military > 0)
        (goal g-current-strategy MIDC-EAGLES)
        (goal g-support-unit militiaman)
        (goal g-position FLANK)
        =>
        (up-modify-goal g-desired-num-eagle-warrior g:= g-desired-num-military)
        (up-modify-goal g-desired-num-eagle-warrior c:%* 65)
        (up-modify-goal g-desired-num-militia g:= g-desired-num-military)
        (up-modify-goal g-desired-num-militia c:%* 35)
        )

        (defrule
        (up-compare-goal g-desired-num-military > 0)
        (goal g-current-strategy MIDC-EAGLES)
        (goal g-support-unit spearman)
        (goal g-position FLANK)
        =>
        (up-modify-goal g-desired-num-eagle-warrior g:= g-desired-num-military)
        (up-modify-goal g-desired-num-eagle-warrior c:%* 65)
        (up-modify-goal g-desired-num-spearman g:= g-desired-num-military)
        (up-modify-goal g-desired-num-spearman c:%* 35)
        )

        (defrule
        (up-compare-goal g-desired-num-military > 0)
        (goal g-current-strategy MIDC-EAGLES)
        (goal g-support-unit archer)
        (goal g-position FLANK)
        =>
        (up-modify-goal g-desired-num-eagle-warrior g:= g-desired-num-military)
        (up-modify-goal g-desired-num-eagle-warrior c:%* 65)
        (up-modify-goal g-desired-num-archer g:= g-desired-num-military)
        (up-modify-goal g-desired-num-archer c:%* 35)
        )
        (defrule
        (up-compare-goal g-desired-num-military > 0)
        (goal g-current-strategy MIDC-EAGLES)
        (goal g-support-unit archer)
        (goal g-position FLANK)
        (up-compare-goal g-enemy-special-unique-unit-count > 6)
        (or
            (up-compare-flag g-enemy-special-unique-unit-flag == CATAPHRACT)
            (or
                (up-compare-flag g-enemy-special-unique-unit-flag == TEUTONIC-KNIGHT)
                (up-compare-flag g-enemy-special-unique-unit-flag == JAGUAR-WARRIOR)))
        =>
        (up-modify-goal g-desired-num-eagle-warrior g:= g-desired-num-military)
        (up-modify-goal g-desired-num-eagle-warrior c:%* 40)
        (up-modify-goal g-desired-num-archer g:= g-desired-num-military)
        (up-modify-goal g-desired-num-archer c:%* 60)
        )
        (defrule
        (up-compare-goal g-desired-num-military > 0)
        (goal g-current-strategy MIDC-EAGLES)
        (goal g-support-unit archer)
        (goal g-position FLANK)
        (up-compare-goal g-enemy-special-unique-unit-count > 3)
        (military-population < 12)
        (or
            (up-compare-flag g-enemy-special-unique-unit-flag == CATAPHRACT)
            (or
                (up-compare-flag g-enemy-special-unique-unit-flag == TEUTONIC-KNIGHT)
                (up-compare-flag g-enemy-special-unique-unit-flag == JAGUAR-WARRIOR)))
        =>
        (up-modify-goal g-desired-num-eagle-warrior g:= g-desired-num-military)
        (up-modify-goal g-desired-num-eagle-warrior c:%* 40)
        (up-modify-goal g-desired-num-archer g:= g-desired-num-military)
        (up-modify-goal g-desired-num-archer c:%* 60)
        )
        
        (defrule
        (up-compare-goal g-desired-num-military > 0)
        (goal g-current-strategy MIDC-EAGLES)
        (goal g-support-unit skirmisher)
        (goal g-position FLANK)
        =>
        (up-modify-goal g-desired-num-eagle-warrior g:= g-desired-num-military)
        (up-modify-goal g-desired-num-eagle-warrior c:%* 65)
        (up-modify-goal g-desired-num-skirmisher g:= g-desired-num-military)
        (up-modify-goal g-desired-num-skirmisher c:%* 35)
        )

        (defrule
        (up-compare-goal g-desired-num-military > 0)
        (goal g-current-strategy MIDC-EAGLES)
        (goal g-support-unit my-unique-unit)
        (goal g-position FLANK)
        =>
        (up-modify-goal g-desired-num-eagle-warrior g:= g-desired-num-military)
        (up-modify-goal g-desired-num-eagle-warrior c:%* 65)
        (up-modify-goal g-desired-num-unique-unit g:= g-desired-num-military)
        (up-modify-goal g-desired-num-unique-unit c:%* 35)
        )

    ;---------------
    ;   Imp Flank
    ;---------------

        ;---------------
        ;   Early Imp
        ;---------------

            ;Select support unit
            (defrule
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy EARLYI-EL-DORADO)
            (goal g-support-unit 0)
            (goal g-position FLANK)
            (up-compare-goal g-spearman-tech-progress >= PRIORITY-CASTLE-COMPLETE)
            (or
                (up-compare-goal g-enemy-light-cavalry-count > 12)
                (or
                    (up-compare-goal g-enemy-heavy-cavalry-count > 8)
                    (or
                        (up-compare-goal g-enemy-elephants-count > 5)
                        (and
                            (up-compare-goal g-enemy-special-unique-unit-count > 8)
                            (up-compare-flag g-enemy-special-unique-unit-flag == LEITIS)))))
            =>
            (set-goal g-support-unit spearman)
            )
            (defrule
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy EARLYI-EL-DORADO)
            (goal g-support-unit 0)
            (goal g-position FLANK)
            (up-compare-goal g-spearman-tech-progress >= PRIORITY-CASTLE-COMPLETE)
            (military-population < 12)
            (or
                (up-compare-goal g-enemy-light-cavalry-count > 8)
                (or
                    (up-compare-goal g-enemy-heavy-cavalry-count > 5)
                    (or
                        (up-compare-goal g-enemy-elephants-count > 3)
                        (and
                            (up-compare-goal g-enemy-special-unique-unit-count > 5)
                            (up-compare-flag g-enemy-special-unique-unit-flag == LEITIS)))))
            =>
            (set-goal g-support-unit spearman)
            )

            (defrule
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy EARLYI-EL-DORADO)
            (goal g-support-unit 0)
            (goal g-position FLANK)
            (up-compare-goal g-unique-unit-tech-progress >= PRIORITY-CASTLE-COMPLETE)
            (building-type-count castle > 0)
            (or
                (up-compare-goal g-enemy-swordsmen-count > 6)
                (or
                    (up-compare-goal g-enemy-eagle-warrior-count > 6)
                    (up-compare-goal g-enemy-condottiero-count > 6)))
            =>
            (set-goal g-support-unit my-unique-unit)
            )
            (defrule
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy EARLYI-EL-DORADO)
            (goal g-support-unit 0)
            (goal g-position FLANK)
            (up-compare-goal g-unique-unit-tech-progress >= PRIORITY-CASTLE-COMPLETE)
            (building-type-count castle > 0)
            (or
                (up-compare-goal g-enemy-special-unique-unit-count > 6)
                (and
                    (up-compare-goal g-enemy-special-unique-unit-count > 3)
                    (military-population < 12)))
            (or
                (up-compare-flag g-enemy-special-unique-unit-flag == TEUTONIC-KNIGHT)
                (up-compare-flag g-enemy-special-unique-unit-flag == HUSKARL))
            =>
            (set-goal g-support-unit my-unique-unit)
            )

            (defrule
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy EARLYI-EL-DORADO)
            (goal g-support-unit 0)
            (goal g-position FLANK)
            (up-compare-goal g-militia-tech-progress >= PRIORITY-CASTLE-COMPLETE)
            (up-compare-goal g-enemy-eagle-warrior-count > 6)
            =>
            (set-goal g-support-unit militiaman)
            )
            (defrule
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy EARLYI-EL-DORADO)
            (goal g-support-unit 0)
            (goal g-position FLANK)
            (up-compare-goal g-militia-tech-progress >= PRIORITY-CASTLE-COMPLETE)
            (or
                (up-compare-goal g-enemy-special-unique-unit-count > 6)
                (and
                    (up-compare-goal g-enemy-special-unique-unit-count > 3)
                    (military-population < 12)))
            (or
                (up-compare-flag g-enemy-special-unique-unit-flag == HUSKARL)
                (up-compare-flag g-enemy-special-unique-unit-flag == SAMURAI))
            =>
            (set-goal g-support-unit militiaman)
            )

            (defrule
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy EARLYI-EL-DORADO)
            (goal g-support-unit 0)
            (goal g-position FLANK)
            (up-compare-goal g-archer-tech-progress >= PRIORITY-CASTLE-COMPLETE)
            (up-compare-goal g-enemy-swordsmen-count > 6)
            =>
            (set-goal g-support-unit archer)
            )
            (defrule
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy EARLYI-EL-DORADO)
            (goal g-support-unit 0)
            (goal g-position FLANK)
            (up-compare-goal g-archer-tech-progress >= PRIORITY-CASTLE-COMPLETE)
            (or
                (up-compare-goal g-enemy-special-unique-unit-count > 6)
                (and
                    (up-compare-goal g-enemy-special-unique-unit-count > 3)
                    (military-population < 12)))
            (or
                (up-compare-flag g-enemy-special-unique-unit-flag == CATAPHRACT)
                (or
                    (up-compare-flag g-enemy-special-unique-unit-flag == TEUTONIC-KNIGHT)
                    (up-compare-flag g-enemy-special-unique-unit-flag == JAGUAR-WARRIOR)))
            =>
            (set-goal g-support-unit archer)
            )
            
            ;Modify unit counts
            (defrule
            (goal g-position FLANK)
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy EARLYI-EL-DORADO)
            (goal g-support-unit militiaman)
            =>
            (up-modify-goal g-desired-num-eagle-warrior g:= g-desired-num-military)
            (up-modify-goal g-desired-num-eagle-warrior c:%* 65)
            (up-modify-goal g-desired-num-militia g:= g-desired-num-military)
            (up-modify-goal g-desired-num-militia c:%* 35)
            )

            (defrule
            (goal g-position FLANK)
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy EARLYI-EL-DORADO)
            (goal g-support-unit spearman)
            =>
            (up-modify-goal g-desired-num-eagle-warrior g:= g-desired-num-military)
            (up-modify-goal g-desired-num-eagle-warrior c:%* 75)
            (up-modify-goal g-desired-num-spearman g:= g-desired-num-military)
            (up-modify-goal g-desired-num-spearman c:%* 25)
            )

            (defrule
            (goal g-position FLANK)
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy EARLYI-EL-DORADO)
            (goal g-support-unit archer)
            =>
            (up-modify-goal g-desired-num-eagle-warrior g:= g-desired-num-military)
            (up-modify-goal g-desired-num-eagle-warrior c:%* 75)
            (up-modify-goal g-desired-num-archer g:= g-desired-num-military)
            (up-modify-goal g-desired-num-archer c:%* 25)
            )

            (defrule
            (goal g-position FLANK)
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy EARLYI-EL-DORADO)
            (goal g-support-unit my-unique-unit)
            =>
            (up-modify-goal g-desired-num-eagle-warrior g:= g-desired-num-military)
            (up-modify-goal g-desired-num-eagle-warrior c:%* 65)
            (up-modify-goal g-desired-num-unique-unit g:= g-desired-num-military)
            (up-modify-goal g-desired-num-unique-unit c:%* 35)
            )

        ;-------------
        ;   Mid Imp
        ;-------------

            ;Select support unit
            (defrule
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy MIDI-EAGLES)
            (goal g-support-unit 0)
            (goal g-position FLANK)
            (or
                (up-compare-goal g-enemy-heavy-cavalry-count > 8)
                (or
                    (up-compare-goal g-enemy-elephants-count > 5)
                    (and
                        (up-compare-goal g-enemy-special-unique-unit-count > 8)
                        (up-compare-flag g-enemy-special-unique-unit-flag == LEITIS))))
            =>
            (set-goal g-support-unit spearman)
            )
            (defrule
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy MIDI-EAGLES)
            (goal g-support-unit 0)
            (goal g-position FLANK)
            (military-population < 12)
            (or
                (up-compare-goal g-enemy-heavy-cavalry-count > 5)
                (or
                    (up-compare-goal g-enemy-elephants-count > 3)
                    (and
                        (up-compare-goal g-enemy-special-unique-unit-count > 5)
                        (up-compare-flag g-enemy-special-unique-unit-flag == LEITIS))))
            =>
            (set-goal g-support-unit spearman)
            )

            (defrule
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy MIDI-EAGLES)
            (goal g-support-unit 0)
            (goal g-position FLANK)
            (building-type-count castle > 0)
            (or
                (up-compare-goal g-enemy-swordsmen-count > 6)
                (or
                    (up-compare-goal g-enemy-eagle-warrior-count > 6)
                    (up-compare-goal g-enemy-condottiero-count > 6)))
            =>
            (set-goal g-support-unit my-unique-unit)
            )
            (defrule
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy MIDI-EAGLES)
            (goal g-support-unit 0)
            (goal g-position FLANK)
            (building-type-count castle > 0)
            (or
                (up-compare-goal g-enemy-special-unique-unit-count > 6)
                (and
                    (up-compare-goal g-enemy-special-unique-unit-count > 3)
                    (military-population < 12)))
            (or
                (up-compare-flag g-enemy-special-unique-unit-flag == TEUTONIC-KNIGHT)
                (up-compare-flag g-enemy-special-unique-unit-flag == HUSKARL))
            =>
            (set-goal g-support-unit my-unique-unit)
            )

            (defrule
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy MIDI-EAGLES)
            (goal g-support-unit 0)
            (goal g-position FLANK)
            (or
                (up-compare-goal g-enemy-foot-archers-count > 15)
                (and
                    (military-population < 20)
                    (up-compare-goal g-enemy-foot-archers-count > 8)))
            =>
            (set-goal g-support-unit skirmisher)
            )
            (defrule
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy MIDI-EAGLES)
            (goal g-support-unit 0)
            (goal g-position FLANK)
            (or
                (up-compare-goal g-enemy-cavalry-archers-count > 15)
                (and
                    (military-population < 20)
                    (up-compare-goal g-enemy-cavalry-archers-count > 8)))
            =>
            (set-goal g-support-unit skirmisher)
            )
            (defrule
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy MIDI-EAGLES)
            (goal g-support-unit 0)
            (goal g-position FLANK)
            (or
                (up-compare-goal g-enemy-special-unique-unit-count > 8)
                (and
                    (up-compare-goal g-enemy-special-unique-unit-count > 5)
                    (military-population < 12)))
            (or
                (up-compare-flag g-enemy-special-unique-unit-flag == GENOESE-CROSSBOWMAN)
                (up-compare-flag g-enemy-special-unique-unit-flag == MAMELUKE))
            =>
            (set-goal g-support-unit skirmisher)
            )

            (defrule
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy MIDI-EAGLES)
            (goal g-support-unit 0)
            (goal g-position FLANK)
            (building-type-count castle == 0)
            (up-compare-goal g-enemy-eagle-warrior-count > 8)
            =>
            (set-goal g-support-unit militiaman)
            )
            (defrule
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy MIDI-EAGLES)
            (goal g-support-unit 0)
            (goal g-position FLANK)
            (or
                (up-compare-goal g-enemy-special-unique-unit-count > 6)
                (and
                    (up-compare-goal g-enemy-special-unique-unit-count > 3)
                    (military-population < 12)))
            (or
                (up-compare-flag g-enemy-special-unique-unit-flag == HUSKARL)
                (up-compare-flag g-enemy-special-unique-unit-flag == SAMURAI))
            =>
            (set-goal g-support-unit militiaman)
            )

            (defrule
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy MIDI-EAGLES)
            (goal g-support-unit 0)
            (goal g-position FLANK)
            =>
            (set-goal g-support-unit archer)
            )

            ;Modify unit counts
            (defrule
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy MIDI-EAGLES)
            (goal g-support-unit militiaman)
            (goal g-position FLANK)
            =>
            (up-modify-goal g-desired-num-eagle-warrior g:= g-desired-num-military)
            (up-modify-goal g-desired-num-eagle-warrior c:%* 65)
            (up-modify-goal g-desired-num-militia g:= g-desired-num-military)
            (up-modify-goal g-desired-num-militia c:%* 35)
            )

            (defrule
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy MIDI-EAGLES)
            (goal g-support-unit spearman)
            (goal g-position FLANK)
            =>
            (up-modify-goal g-desired-num-eagle-warrior g:= g-desired-num-military)
            (up-modify-goal g-desired-num-eagle-warrior c:%* 65)
            (up-modify-goal g-desired-num-spearman g:= g-desired-num-military)
            (up-modify-goal g-desired-num-spearman c:%* 35)
            )
            
            (defrule
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy MIDI-EAGLES)
            (goal g-support-unit archer)
            (goal g-position FLANK)
            =>
            (up-modify-goal g-desired-num-eagle-warrior g:= g-desired-num-military)
            (up-modify-goal g-desired-num-eagle-warrior c:%* 65)
            (up-modify-goal g-desired-num-archer g:= g-desired-num-military)
            (up-modify-goal g-desired-num-archer c:%* 35)
            )

            (defrule
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy MIDI-EAGLES)
            (goal g-support-unit skirmisher)
            (goal g-position FLANK)
            =>
            (up-modify-goal g-desired-num-eagle-warrior g:= g-desired-num-military)
            (up-modify-goal g-desired-num-eagle-warrior c:%* 65)
            (up-modify-goal g-desired-num-skirmisher g:= g-desired-num-military)
            (up-modify-goal g-desired-num-skirmisher c:%* 35)
            )
            (defrule
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy MIDI-EAGLES)
            (goal g-support-unit skirmisher)
            (goal g-position FLANK)
            (or
                (up-compare-goal g-enemy-special-unique-unit-count > 8)
                (and
                    (up-compare-goal g-enemy-special-unique-unit-count > 5)
                    (military-population < 12)))
            (or
                (up-compare-flag g-enemy-special-unique-unit-flag == GENOESE-CROSSBOWMAN)
                (up-compare-flag g-enemy-special-unique-unit-flag == MAMELUKE))
            =>
            (up-modify-goal g-desired-num-eagle-warrior g:= g-desired-num-military)
            (up-modify-goal g-desired-num-eagle-warrior c:%* 70)
            (up-modify-goal g-desired-num-skirmisher g:= g-desired-num-military)
            (up-modify-goal g-desired-num-skirmisher c:%* 30)
            )

            (defrule
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy MIDI-EAGLES)
            (goal g-support-unit my-unique-unit)
            (goal g-position FLANK)
            =>
            (up-modify-goal g-desired-num-eagle-warrior g:= g-desired-num-military)
            (up-modify-goal g-desired-num-eagle-warrior c:%* 50)
            (up-modify-goal g-desired-num-unique-unit g:= g-desired-num-military)
            (up-modify-goal g-desired-num-unique-unit c:%* 50)
            )

    ;----------------
    ;   Imp Pocket
    ;----------------

        ;Select support unit
        (defrule
        (up-compare-goal g-desired-num-military > 0)
        (or
            (goal g-current-strategy EARLYI-EL-DORADO)
            (goal g-current-strategy MIDI-EAGLES))
        (goal g-support-unit 0)
        (goal g-position POCKET)
        (or
            (up-compare-goal g-enemy-heavy-cavalry-count > 12)
            (or
                (up-compare-goal g-enemy-elephants-count > 8)
                (and
                    (up-compare-goal g-enemy-special-unique-unit-count > 12)
                    (up-compare-flag g-enemy-special-unique-unit-flag == LEITIS))))
        =>
        (set-goal g-support-unit spearman)
        )
        (defrule
        (up-compare-goal g-desired-num-military > 0)
        (or
            (goal g-current-strategy EARLYI-EL-DORADO)
            (goal g-current-strategy MIDI-EAGLES))
        (goal g-support-unit 0)
        (goal g-position POCKET)
        (military-population < 12)
        (or
            (up-compare-goal g-enemy-heavy-cavalry-count > 8)
            (or
                (up-compare-goal g-enemy-elephants-count > 5)
                (and
                    (up-compare-goal g-enemy-special-unique-unit-count > 8)
                    (up-compare-flag g-enemy-special-unique-unit-flag == LEITIS))))
        =>
        (set-goal g-support-unit spearman)
        )

        (defrule
        (up-compare-goal g-desired-num-military > 0)
        (or
            (goal g-current-strategy EARLYI-EL-DORADO)
            (goal g-current-strategy MIDI-EAGLES))
        (goal g-support-unit 0)
        (goal g-position POCKET)
        (building-type-count castle > 0)
        (or
            (up-compare-goal g-enemy-swordsmen-count > 9)
            (or
                (up-compare-goal g-enemy-eagle-warrior-count > 9)
                (up-compare-goal g-enemy-condottiero-count > 9)))
        =>
        (set-goal g-support-unit my-unique-unit)
        )
        (defrule
        (up-compare-goal g-desired-num-military > 0)
        (or
            (goal g-current-strategy EARLYI-EL-DORADO)
            (goal g-current-strategy MIDI-EAGLES))
        (goal g-support-unit 0)
        (goal g-position POCKET)
        (building-type-count castle > 0)
        (or
            (up-compare-goal g-enemy-special-unique-unit-count > 9)
            (and
                (up-compare-goal g-enemy-special-unique-unit-count > 5)
                (military-population < 12)))
        (or
            (up-compare-flag g-enemy-special-unique-unit-flag == TEUTONIC-KNIGHT)
            (up-compare-flag g-enemy-special-unique-unit-flag == HUSKARL))
        =>
        (set-goal g-support-unit my-unique-unit)
        )

        (defrule
        (up-compare-goal g-desired-num-military > 0)
        (or
            (goal g-current-strategy EARLYI-EL-DORADO)
            (goal g-current-strategy MIDI-EAGLES))
        (goal g-support-unit 0)
        (goal g-position POCKET)
        (or
            (up-compare-goal g-enemy-foot-archers-count > 15)
            (and
                (military-population < 20)
                (up-compare-goal g-enemy-foot-archers-count > 10)))
        =>
        (set-goal g-support-unit skirmisher)
        )
        (defrule
        (up-compare-goal g-desired-num-military > 0)
        (or
            (goal g-current-strategy EARLYI-EL-DORADO)
            (goal g-current-strategy MIDI-EAGLES))
        (goal g-support-unit 0)
        (goal g-position POCKET)
        (or
            (up-compare-goal g-enemy-cavalry-archers-count > 15)
            (and
                (military-population < 20)
                (up-compare-goal g-enemy-cavalry-archers-count > 10)))
        =>
        (set-goal g-support-unit skirmisher)
        )

        (defrule
        (up-compare-goal g-desired-num-military > 0)
        (or
            (goal g-current-strategy EARLYI-EL-DORADO)
            (goal g-current-strategy MIDI-EAGLES))
        (goal g-support-unit 0)
        (goal g-position POCKET)
        (building-type-count castle == 0)
        (up-compare-goal g-enemy-eagle-warrior-count > 12)
        =>
        (set-goal g-support-unit militiaman)
        )
        (defrule
        (up-compare-goal g-desired-num-military > 0)
        (or
            (goal g-current-strategy EARLYI-EL-DORADO)
            (goal g-current-strategy MIDI-EAGLES))
        (goal g-support-unit 0)
        (goal g-position POCKET)
        (or
            (up-compare-goal g-enemy-special-unique-unit-count > 9)
            (and
                (up-compare-goal g-enemy-special-unique-unit-count > 5)
                (military-population < 12)))
        (or
            (up-compare-flag g-enemy-special-unique-unit-flag == SAMURAI)
            (up-compare-flag g-enemy-special-unique-unit-flag == HUSKARL))
        =>
        (set-goal g-support-unit militiaman)
        )

        (defrule
        (up-compare-goal g-desired-num-military > 0)
        (goal g-current-strategy MIDI-EAGLES)
        (goal g-support-unit 0)
        (goal g-position POCKET)
        =>
        (set-goal g-support-unit archer)
        )

        ;Modify unit counts
        (defrule
        (up-compare-goal g-desired-num-military > 0)
        (or
            (goal g-current-strategy EARLYI-EL-DORADO)
            (goal g-current-strategy MIDI-EAGLES))
        (goal g-support-unit militiaman)
        (goal g-position POCKET)
        =>
        (up-modify-goal g-desired-num-eagle-warrior g:= g-desired-num-military)
        (up-modify-goal g-desired-num-eagle-warrior c:%* 65)
        (up-modify-goal g-desired-num-militia g:= g-desired-num-military)
        (up-modify-goal g-desired-num-militia c:%* 35)
        )

        (defrule
        (up-compare-goal g-desired-num-military > 0)
        (or
            (goal g-current-strategy EARLYI-EL-DORADO)
            (goal g-current-strategy MIDI-EAGLES))
        (goal g-support-unit spearman)
        (goal g-position POCKET)
        =>
        (up-modify-goal g-desired-num-eagle-warrior g:= g-desired-num-military)
        (up-modify-goal g-desired-num-eagle-warrior c:%* 65)
        (up-modify-goal g-desired-num-spearman g:= g-desired-num-military)
        (up-modify-goal g-desired-num-spearman c:%* 35)
        )
        
        (defrule
        (up-compare-goal g-desired-num-military > 0)
        (or
            (goal g-current-strategy EARLYI-EL-DORADO)
            (goal g-current-strategy MIDI-EAGLES))
        (goal g-support-unit archer)
        (goal g-position POCKET)
        =>
        (up-modify-goal g-desired-num-eagle-warrior g:= g-desired-num-military)
        (up-modify-goal g-desired-num-eagle-warrior c:%* 65)
        (up-modify-goal g-desired-num-archer g:= g-desired-num-military)
        (up-modify-goal g-desired-num-archer c:%* 35)
        )

        (defrule
        (up-compare-goal g-desired-num-military > 0)
        (or
            (goal g-current-strategy EARLYI-EL-DORADO)
            (goal g-current-strategy MIDI-EAGLES))
        (goal g-support-unit skirmisher)
        (goal g-position POCKET)
        =>
        (up-modify-goal g-desired-num-eagle-warrior g:= g-desired-num-military)
        (up-modify-goal g-desired-num-eagle-warrior c:%* 70)
        (up-modify-goal g-desired-num-skirmisher g:= g-desired-num-military)
        (up-modify-goal g-desired-num-skirmisher c:%* 30)
        )

        (defrule
        (up-compare-goal g-desired-num-military > 0)
        (or
            (goal g-current-strategy EARLYI-EL-DORADO)
            (goal g-current-strategy MIDI-EAGLES))
        (goal g-support-unit my-unique-unit)
        (goal g-position POCKET)
        =>
        (up-modify-goal g-desired-num-eagle-warrior g:= g-desired-num-military)
        (up-modify-goal g-desired-num-eagle-warrior c:%* 65)
        (up-modify-goal g-desired-num-unique-unit g:= g-desired-num-military)
        (up-modify-goal g-desired-num-unique-unit c:%* 35)
        )

;-------------------
;   Archer Strats
;-------------------

    ;-------------
    ;   Defense
    ;-------------

        (defrule
        (goal g-game-focus DEFENSIVE)
        (up-compare-goal g-desired-num-military > 0)
        (current-age >= castle-age)
        (goal g-primary-unit archer)
        (military-population g:< g-min-military-pop)
        (or
            (up-compare-goal g-enemy-eagle-warrior-count > 6)
            (and
                (up-compare-goal g-enemy-special-unique-unit-count > 5)
                (up-compare-flag g-enemy-special-unique-unit-flag == HUSKARL)))
        (or
            (goal g-primary-enemy-threat g-enemy-eagle-warrior-count)
            (and
                (goal g-primary-enemy-threat g-enemy-special-unique-unit-count)
                (up-compare-flag g-enemy-special-unique-unit-flag == HUSKARL)))
        =>
        (up-modify-goal g-desired-num-militia c:max 6)
        )

        (defrule
        (goal g-game-focus DEFENSIVE)
        (up-compare-goal g-desired-num-military > 0)
        (current-age >= castle-age)
        (goal g-primary-unit archer)
        (military-population g:< g-min-military-pop)
        (or
            (and
                (up-compare-goal g-enemy-skirmishers-count > 5)
                (goal g-primary-enemy-threat g-enemy-skirmishers-count))
            (up-compare-goal g-enemy-field-siege-count > 2))
        (goal g-primary-enemy-threat g-enemy-skirmishers-count)
        =>
        (up-modify-goal g-desired-num-eagle-warrior c:max 6)
        )

        (defrule
        (goal g-game-focus DEFENSIVE)
        (up-compare-goal g-desired-num-military > 0)
        (current-age >= castle-age)
        (goal g-primary-unit archer)
        (military-population g:< g-min-military-pop)
        (or
            (up-compare-goal g-enemy-heavy-cavalry-count > 4)
            (or
                (up-compare-goal g-enemy-light-cavalry-count > 6)
                (up-compare-goal g-enemy-elephants-count > 2)))
        (or
            (goal g-primary-enemy-threat g-enemy-heavy-cavalry-count)
            (or
                (goal g-primary-enemy-threat g-enemy-light-cavalry-count)
                (goal g-primary-enemy-threat g-enemy-elephants-count)))
        =>
        (up-modify-goal g-desired-num-spearman c:max 6)
        )

        (defrule
        (goal g-game-focus DEFENSIVE)
        (up-compare-goal g-desired-num-military > 0)
        (current-age >= castle-age)
        (goal g-primary-unit archer)
        (military-population g:< g-min-military-pop)
        (up-compare-goal g-enemy-hand-cannoneer-slinger-count > 5)
        =>
        (up-modify-goal g-desired-num-skirmisher c:max 6)
        )

        (defrule
        (goal g-game-focus DEFENSIVE)
        (up-compare-goal g-desired-num-military > 0)
        (current-age >= castle-age)
        (goal g-primary-unit archer)
        (military-population g:< g-min-military-pop)
        (or
            (up-compare-goal g-enemy-elephants-count > 2)
            (or
                (up-compare-goal g-enemy-heavy-cavalry-count > 3)
                (up-compare-goal g-enemy-camel-count > 3)))
        (or
            (goal g-primary-enemy-threat g-enemy-heavy-cavalry-count)
            (or
                (goal g-primary-enemy-threat g-enemy-camel-count)
                (goal g-primary-enemy-threat g-enemy-elephants-count)))
        =>
        (up-modify-goal g-desired-num-monk c:max 2)
        )

    ;---------------
    ;   Imp Flank
    ;---------------

        ;---------------
        ;   Early Imp
        ;---------------

            ;Select support unit
            (defrule
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy EARLYI-ARBINGER)
            (goal g-support-unit 0)
            (goal g-position FLANK)
            (or
                (up-compare-goal g-enemy-skirmishers-count > 5)
                (up-compare-goal g-enemy-field-siege-count > 3))
            =>
            (set-goal g-support-unit eagle-warrior)
            )

            (defrule
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy EARLYI-ARBINGER)
            (goal g-support-unit 0)
            (goal g-position FLANK)
            (up-compare-goal g-spearman-tech-progress >= PRIORITY-CASTLE-COMPLETE)
            (or
                (up-compare-goal g-enemy-light-cavalry-count > 8)
                (or
                    (up-compare-goal g-enemy-heavy-cavalry-count > 5)
                    (or
                        (up-compare-goal g-enemy-elephants-count > 3)
                        (and
                            (up-compare-goal g-enemy-special-unique-unit-count > 5)
                            (up-compare-flag g-enemy-special-unique-unit-flag == LEITIS)))))
            =>
            (set-goal g-support-unit spearman)
            )
            (defrule
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy EARLYI-ARBINGER)
            (goal g-support-unit 0)
            (goal g-position FLANK)
            (up-compare-goal g-spearman-tech-progress >= PRIORITY-CASTLE-COMPLETE)
            (military-population < 12)
            (or
                (up-compare-goal g-enemy-light-cavalry-count > 5)
                (or
                    (up-compare-goal g-enemy-heavy-cavalry-count > 3)
                    (or
                        (up-compare-goal g-enemy-elephants-count > 2)
                        (and
                            (up-compare-goal g-enemy-special-unique-unit-count > 3)
                            (up-compare-flag g-enemy-special-unique-unit-flag == LEITIS)))))
            =>
            (set-goal g-support-unit spearman)
            )

            (defrule
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy EARLYI-ARBINGER)
            (goal g-support-unit 0)
            (goal g-position FLANK)
            (up-compare-goal g-enemy-eagle-warrior-count > 6)
            (or
                (building-type-count castle == 0)
                (up-compare-goal g-unique-unit-tech-progress < PRIORITY-CASTLE-COMPLETE))
            =>
            (set-goal g-support-unit militiaman)
            )

            (defrule
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy EARLYI-ARBINGER)
            (goal g-support-unit 0)
            (goal g-position FLANK)
            (up-compare-goal g-unique-unit-tech-progress >= PRIORITY-CASTLE-COMPLETE)
            (up-compare-goal g-enemy-eagle-warrior-count > 6)
            (building-type-count castle > 0)
            =>
            (set-goal g-support-unit my-unique-unit)
            )
            (defrule
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy EARLYI-ARBINGER)
            (goal g-support-unit 0)
            (goal g-position FLANK)
            (up-compare-goal g-unique-unit-tech-progress >= PRIORITY-CASTLE-COMPLETE)
            (or
                (up-compare-goal g-enemy-special-unique-unit-count > 4)
                (and
                    (up-compare-goal g-enemy-special-unique-unit-count > 2)
                    (military-population < 12)))
            (up-compare-flag g-enemy-special-unique-unit-flag == HUSKARL)
            =>
            (set-goal g-support-unit my-unique-unit)
            )

            (defrule
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy EARLYI-ARBINGER)
            (goal g-support-unit 0)
            (goal g-position FLANK)
            (or
                (up-compare-goal g-enemy-foot-archers-count > 6)
                (or
                    (up-compare-goal g-enemy-cavalry-archers-count > 5)
                    (up-compare-goal g-enemy-hand-cannoneer-slinger-count > 6)))
            =>
            (set-goal g-support-unit skirmisher)
            )

            (defrule
            (goal g-position FLANK)
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy EARLYI-ARBINGER)
            (goal g-support-unit militiaman)
            =>
            (up-modify-goal g-desired-num-archer g:= g-desired-num-military)
            (up-modify-goal g-desired-num-archer c:%* 75)
            (up-modify-goal g-desired-num-militia g:= g-desired-num-military)
            (up-modify-goal g-desired-num-militia c:%* 25)
            )

            (defrule
            (goal g-position FLANK)
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy EARLYI-ARBINGER)
            (goal g-support-unit spearman)
            =>
            (up-modify-goal g-desired-num-archer g:= g-desired-num-military)
            (up-modify-goal g-desired-num-archer c:%* 70)
            (up-modify-goal g-desired-num-spearman g:= g-desired-num-military)
            (up-modify-goal g-desired-num-spearman c:%* 30)
            )

            (defrule
            (goal g-position FLANK)
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy EARLYI-ARBINGER)
            (goal g-support-unit eagle-warrior)
            =>
            (up-modify-goal g-desired-num-archer g:= g-desired-num-military)
            (up-modify-goal g-desired-num-archer c:%* 75)
            (up-modify-goal g-desired-num-eagle-warrior g:= g-desired-num-military)
            (up-modify-goal g-desired-num-eagle-warrior c:%* 25)
            )

            (defrule
            (goal g-position FLANK)
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy EARLYI-ARBINGER)
            (goal g-support-unit skirmisher)
            =>
            (up-modify-goal g-desired-num-archer g:= g-desired-num-military)
            (up-modify-goal g-desired-num-archer c:%* 70)
            (up-modify-goal g-desired-num-skirmisher g:= g-desired-num-military)
            (up-modify-goal g-desired-num-skirmisher c:%* 30)
            )

            (defrule
            (goal g-position FLANK)
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy EARLYI-ARBINGER)
            (goal g-support-unit my-unique-unit)
            =>
            (up-modify-goal g-desired-num-archer g:= g-desired-num-military)
            (up-modify-goal g-desired-num-archer c:%* 75)
            (up-modify-goal g-desired-num-unique-unit g:= g-desired-num-military)
            (up-modify-goal g-desired-num-unique-unit c:%* 25)
            )

        ;-------------
        ;   Mid Imp
        ;-------------
        
            ;Select support unit
            (defrule
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy MIDI-ARBS)
            (goal g-support-unit 0)
            (goal g-position FLANK)
            (or
                (up-compare-goal g-enemy-skirmishers-count > 8)
                (up-compare-goal g-enemy-field-siege-count > 4))
            =>
            (set-goal g-support-unit eagle-warrior)
            )

            (defrule
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy MIDI-ARBS)
            (goal g-support-unit 0)
            (goal g-position FLANK)
            (up-compare-goal g-spearman-tech-progress >= PRIORITY-CASTLE-COMPLETE)
            (or
                (up-compare-goal g-enemy-light-cavalry-count > 12)
                (or
                    (up-compare-goal g-enemy-heavy-cavalry-count > 8)
                    (or
                        (up-compare-goal g-enemy-elephants-count > 5)
                        (and
                            (up-compare-goal g-enemy-special-unique-unit-count > 8)
                            (up-compare-flag g-enemy-special-unique-unit-flag == LEITIS)))))
            =>
            (set-goal g-support-unit spearman)
            )
            (defrule
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy MIDI-ARBS)
            (goal g-support-unit 0)
            (goal g-position FLANK)
            (up-compare-goal g-spearman-tech-progress >= PRIORITY-CASTLE-COMPLETE)
            (military-population < 12)
            (or
                (up-compare-goal g-enemy-light-cavalry-count > 8)
                (or
                    (up-compare-goal g-enemy-heavy-cavalry-count > 5)
                    (or
                        (up-compare-goal g-enemy-elephants-count > 3)
                        (and
                            (up-compare-goal g-enemy-special-unique-unit-count > 5)
                            (up-compare-flag g-enemy-special-unique-unit-flag == LEITIS)))))
            =>
            (set-goal g-support-unit spearman)
            )

            (defrule
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy MIDI-ARBS)
            (goal g-support-unit 0)
            (goal g-position FLANK)
            (up-compare-goal g-enemy-eagle-warrior-count > 10)
            (or
                (building-type-count castle == 0)
                (up-compare-goal g-unique-unit-tech-progress < PRIORITY-CASTLE-COMPLETE))
            =>
            (set-goal g-support-unit militiaman)
            )

            (defrule
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy MIDI-ARBS)
            (goal g-support-unit 0)
            (goal g-position FLANK)
            (up-compare-goal g-unique-unit-tech-progress >= PRIORITY-CASTLE-COMPLETE)
            (or
                (up-compare-goal g-enemy-swordsmen-count > 15)
                (or
                    (and
                        (up-compare-goal g-enemy-eagle-warrior-count > 10)
                        (building-type-count castle > 0))
                    (up-compare-goal g-enemy-condottiero-count > 15)))
            =>
            (set-goal g-support-unit my-unique-unit)
            )
            (defrule
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy MIDI-ARBS)
            (goal g-support-unit 0)
            (goal g-position FLANK)
            (up-compare-goal g-unique-unit-tech-progress >= PRIORITY-CASTLE-COMPLETE)
            (or
                (up-compare-goal g-enemy-special-unique-unit-count > 6)
                (and
                    (up-compare-goal g-enemy-special-unique-unit-count > 3)
                    (military-population < 12)))
            (up-compare-flag g-enemy-special-unique-unit-flag == HUSKARL)
            =>
            (set-goal g-support-unit my-unique-unit)
            )

            (defrule
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy MIDI-ARBS)
            (goal g-support-unit 0)
            (goal g-position FLANK)
            (or
                (up-compare-goal g-enemy-foot-archers-count > 9)
                (or
                    (up-compare-goal g-enemy-cavalry-archers-count > 8)
                    (up-compare-goal g-enemy-hand-cannoneer-slinger-count > 9)))
            =>
            (set-goal g-support-unit skirmisher)
            )

            (defrule
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy MIDI-ARBS)
            (goal g-support-unit 0)
            (goal g-position FLANK)
            (or
                (players-civ target-player aztec)
                (or
                    (players-civ target-player incan)
                    (players-civ target-player mayan)))
            =>
            (set-goal g-support-unit militiaman)
            (up-jump-rule 1)
            )
                (defrule
                (up-compare-goal g-desired-num-military > 0)
                (goal g-current-strategy MIDI-ARBS)
                (goal g-support-unit 0)
                (goal g-position FLANK)
                =>
                (set-goal g-support-unit spearman)
                )

            (defrule
            (goal g-position FLANK)
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy MIDI-ARBS)
            (goal g-support-unit militiaman)
            =>
            (up-modify-goal g-desired-num-archer g:= g-desired-num-military)
            (up-modify-goal g-desired-num-archer c:%* 75)
            (up-modify-goal g-desired-num-militia g:= g-desired-num-military)
            (up-modify-goal g-desired-num-militia c:%* 25)
            )

            (defrule
            (goal g-position FLANK)
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy MIDI-ARBS)
            (goal g-support-unit spearman)
            =>
            (up-modify-goal g-desired-num-archer g:= g-desired-num-military)
            (up-modify-goal g-desired-num-archer c:%* 70)
            (up-modify-goal g-desired-num-spearman g:= g-desired-num-military)
            (up-modify-goal g-desired-num-spearman c:%* 30)
            )

            (defrule
            (goal g-position FLANK)
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy MIDI-ARBS)
            (goal g-support-unit eagle-warrior)
            =>
            (up-modify-goal g-desired-num-archer g:= g-desired-num-military)
            (up-modify-goal g-desired-num-archer c:%* 75)
            (up-modify-goal g-desired-num-eagle-warrior g:= g-desired-num-military)
            (up-modify-goal g-desired-num-eagle-warrior c:%* 25)
            )

            (defrule
            (goal g-position FLANK)
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy MIDI-ARBS)
            (goal g-support-unit skirmisher)
            =>
            (up-modify-goal g-desired-num-archer g:= g-desired-num-military)
            (up-modify-goal g-desired-num-archer c:%* 70)
            (up-modify-goal g-desired-num-skirmisher g:= g-desired-num-military)
            (up-modify-goal g-desired-num-skirmisher c:%* 30)
            )

            (defrule
            (goal g-position FLANK)
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy MIDI-ARBS)
            (goal g-support-unit my-unique-unit)
            =>
            (up-modify-goal g-desired-num-archer g:= g-desired-num-military)
            (up-modify-goal g-desired-num-archer c:%* 75)
            (up-modify-goal g-desired-num-unique-unit g:= g-desired-num-military)
            (up-modify-goal g-desired-num-unique-unit c:%* 25)
            )

    ;----------------
    ;   Imp Pocket
    ;----------------
        
        ;Select support unit
        (defrule
        (up-compare-goal g-desired-num-military > 0)
        (or
            (goal g-current-strategy EARLYI-ARBINGER)
            (goal g-current-strategy MIDI-ARBS))
        (goal g-support-unit 0)
        (goal g-position POCKET)
        (or
            (up-compare-goal g-enemy-skirmishers-count > 12)
            (up-compare-goal g-enemy-field-siege-count > 5))
        =>
        (set-goal g-support-unit eagle-warrior)
        )

        (defrule
        (up-compare-goal g-desired-num-military > 0)
        (or
            (goal g-current-strategy EARLYI-ARBINGER)
            (goal g-current-strategy MIDI-ARBS))
        (goal g-support-unit 0)
        (goal g-position POCKET)
        (up-compare-goal g-spearman-tech-progress >= PRIORITY-CASTLE-COMPLETE)
        (or
            (up-compare-goal g-enemy-light-cavalry-count > 12)
            (or
                (up-compare-goal g-enemy-heavy-cavalry-count > 8)
                (up-compare-goal g-enemy-elephants-count > 5)))
        =>
        (set-goal g-support-unit spearman)
        )
        (defrule
        (up-compare-goal g-desired-num-military > 0)
        (or
            (goal g-current-strategy EARLYI-ARBINGER)
            (goal g-current-strategy MIDI-ARBS))
        (goal g-support-unit 0)
        (goal g-position POCKET)
        (up-compare-goal g-spearman-tech-progress >= PRIORITY-CASTLE-COMPLETE)
        (military-population < 12)
        (or
            (up-compare-goal g-enemy-light-cavalry-count > 8)
            (or
                (up-compare-goal g-enemy-heavy-cavalry-count > 5)
                (up-compare-goal g-enemy-elephants-count > 3)))
        =>
        (set-goal g-support-unit spearman)
        )
        (defrule
        (up-compare-goal g-desired-num-military > 0)
        (or
            (goal g-current-strategy EARLYI-ARBINGER)
            (goal g-current-strategy MIDI-ARBS))
        (goal g-support-unit 0)
        (goal g-position POCKET)
        (up-compare-goal g-spearman-tech-progress >= PRIORITY-CASTLE-COMPLETE)
        (or
            (up-compare-goal g-enemy-special-unique-unit-count > 8)
            (and
                (up-compare-goal g-enemy-special-unique-unit-count > 5)
                (military-population < 12)))
        (up-compare-flag g-enemy-special-unique-unit-flag == LEITIS)
        =>
        (set-goal g-support-unit spearman)
        )

        (defrule
        (up-compare-goal g-desired-num-military > 0)
        (or
            (goal g-current-strategy EARLYI-ARBINGER)
            (goal g-current-strategy MIDI-ARBS))
        (goal g-support-unit 0)
        (goal g-position POCKET)
        (up-compare-goal g-enemy-eagle-warrior-count > 10)
        (or
            (building-type-count castle == 0)
            (up-compare-goal g-unique-unit-tech-progress < PRIORITY-CASTLE-COMPLETE))
        =>
        (set-goal g-support-unit militiaman)
        )

        (defrule
        (up-compare-goal g-desired-num-military > 0)
        (or
            (goal g-current-strategy EARLYI-ARBINGER)
            (goal g-current-strategy MIDI-ARBS))
        (goal g-support-unit 0)
        (goal g-position POCKET)
        (up-compare-goal g-unique-unit-tech-progress >= PRIORITY-CASTLE-COMPLETE)
        (or
            (up-compare-goal g-enemy-swordsmen-count > 15)
            (or
                (and
                    (up-compare-goal g-enemy-eagle-warrior-count > 10)
                    (building-type-count castle > 0))
                (up-compare-goal g-enemy-condottiero-count > 15)))
        =>
        (set-goal g-support-unit my-unique-unit)
        )
        (defrule
        (up-compare-goal g-desired-num-military > 0)
        (or
            (goal g-current-strategy EARLYI-ARBINGER)
            (goal g-current-strategy MIDI-ARBS))
        (goal g-support-unit 0)
        (goal g-position POCKET)
        (up-compare-goal g-unique-unit-tech-progress >= PRIORITY-CASTLE-COMPLETE)
        (or
            (up-compare-goal g-enemy-special-unique-unit-count > 6)
            (and
                (up-compare-goal g-enemy-special-unique-unit-count > 3)
                (military-population < 12)))
        (up-compare-flag g-enemy-special-unique-unit-flag == HUSKARL)
        =>
        (set-goal g-support-unit my-unique-unit)
        )

        (defrule
        (up-compare-goal g-desired-num-military > 0)
        (or
            (goal g-current-strategy EARLYI-ARBINGER)
            (goal g-current-strategy MIDI-ARBS))
        (goal g-support-unit 0)
        (goal g-position POCKET)
        (or
            (up-compare-goal g-enemy-foot-archers-count > 12)
            (or
                (up-compare-goal g-enemy-cavalry-archers-count > 12)
                (up-compare-goal g-enemy-hand-cannoneer-slinger-count > 12)))
        =>
        (set-goal g-support-unit skirmisher)
        )

        (defrule
        (up-compare-goal g-desired-num-military > 0)
        (or
            (goal g-current-strategy EARLYI-ARBINGER)
            (goal g-current-strategy MIDI-ARBS))
        (goal g-support-unit 0)
        (goal g-position POCKET)
        (or
            (players-civ target-player aztec)
            (or
                (players-civ target-player incan)
                (players-civ target-player mayan)))
        =>
        (set-goal g-support-unit militiaman)
        (up-jump-rule 1)
        )
            (defrule
            (up-compare-goal g-desired-num-military > 0)
            (or
                (goal g-current-strategy EARLYI-ARBINGER)
                (goal g-current-strategy MIDI-ARBS))
            (goal g-support-unit 0)
            (goal g-position POCKET)
            =>
            (set-goal g-support-unit spearman)
            )

        (defrule
        (goal g-position POCKET)
        (up-compare-goal g-desired-num-military > 0)
        (or
            (goal g-current-strategy EARLYI-ARBINGER)
            (goal g-current-strategy MIDI-ARBS))
        (goal g-support-unit militiaman)
        =>
        (up-modify-goal g-desired-num-archer g:= g-desired-num-military)
        (up-modify-goal g-desired-num-archer c:%* 75)
        (up-modify-goal g-desired-num-militia g:= g-desired-num-military)
        (up-modify-goal g-desired-num-militia c:%* 25)
        )

        (defrule
        (goal g-position POCKET)
        (up-compare-goal g-desired-num-military > 0)
        (or
            (goal g-current-strategy EARLYI-ARBINGER)
            (goal g-current-strategy MIDI-ARBS))
        (goal g-support-unit spearman)
        =>
        (up-modify-goal g-desired-num-archer g:= g-desired-num-military)
        (up-modify-goal g-desired-num-archer c:%* 70)
        (up-modify-goal g-desired-num-spearman g:= g-desired-num-military)
        (up-modify-goal g-desired-num-spearman c:%* 30)
        )

        (defrule
        (goal g-position POCKET)
        (up-compare-goal g-desired-num-military > 0)
        (or
            (goal g-current-strategy EARLYI-ARBINGER)
            (goal g-current-strategy MIDI-ARBS))
        (goal g-support-unit eagle-warrior)
        =>
        (up-modify-goal g-desired-num-archer g:= g-desired-num-military)
        (up-modify-goal g-desired-num-archer c:%* 75)
        (up-modify-goal g-desired-num-eagle-warrior g:= g-desired-num-military)
        (up-modify-goal g-desired-num-eagle-warrior c:%* 25)
        )

        (defrule
        (goal g-position POCKET)
        (up-compare-goal g-desired-num-military > 0)
        (or
            (goal g-current-strategy EARLYI-ARBINGER)
            (goal g-current-strategy MIDI-ARBS))
        (goal g-support-unit skirmisher)
        =>
        (up-modify-goal g-desired-num-archer g:= g-desired-num-military)
        (up-modify-goal g-desired-num-archer c:%* 70)
        (up-modify-goal g-desired-num-skirmisher g:= g-desired-num-military)
        (up-modify-goal g-desired-num-skirmisher c:%* 30)
        )

        (defrule
        (goal g-position POCKET)
        (up-compare-goal g-desired-num-military > 0)
        (or
            (goal g-current-strategy EARLYI-ARBINGER)
            (goal g-current-strategy MIDI-ARBS))
        (goal g-support-unit my-unique-unit)
        =>
        (up-modify-goal g-desired-num-archer g:= g-desired-num-military)
        (up-modify-goal g-desired-num-archer c:%* 75)
        (up-modify-goal g-desired-num-unique-unit g:= g-desired-num-military)
        (up-modify-goal g-desired-num-unique-unit c:%* 25)
        )

;-----------------------
;   Skirmisher Strats
;-----------------------

    (defrule
    (up-compare-goal g-desired-num-military > 0)
    (goal g-current-strategy LATEI-TRASHKIRMS)
    =>
    (up-modify-goal g-desired-num-skirmisher g:= g-desired-num-military)
    (up-modify-goal g-desired-num-skirmisher c:%* 65)
    (set-goal g-support-unit spearman)
    (up-modify-goal g-desired-num-spearman g:= g-desired-num-military)
    (up-modify-goal g-desired-num-spearman c:%* 35)
    )

;------------------------
;   Unique Unit Strats
;------------------------

    ;-------------
    ;   Defense
    ;-------------

        (defrule
        (goal g-game-focus DEFENSIVE)
        (up-compare-goal g-desired-num-military > 0)
        (current-age >= castle-age)
        (goal g-primary-unit my-unique-unit)
        (military-population g:< g-min-military-pop)
        (or
            (up-compare-goal g-enemy-foot-archers-count > 5)
            (or
                (up-compare-goal g-enemy-cavalry-archers-count > 5)
                (up-compare-goal g-enemy-hand-cannoneer-slinger-count > 3)))
        =>
        (up-modify-goal g-desired-num-skirmisher c:max 6)
        )

        (defrule
        (goal g-game-focus DEFENSIVE)
        (up-compare-goal g-desired-num-military > 0)
        (current-age >= castle-age)
        (goal g-primary-unit my-unique-unit)
        (military-population g:< g-min-military-pop)
        (or
            (up-compare-goal g-enemy-heavy-cavalry-count > 4)
            (or
                (up-compare-goal g-enemy-camel-count > 6)
                (up-compare-goal g-enemy-elephants-count > 2)))
        (or
            (goal g-primary-enemy-threat g-enemy-heavy-cavalry-count)
            (or
                (goal g-primary-enemy-threat g-enemy-camel-count)
                (goal g-primary-enemy-threat g-enemy-elephants-count)))
        =>
        (up-modify-goal g-desired-num-spearman c:max 6)
        )

        (defrule
        (goal g-game-focus DEFENSIVE)
        (up-compare-goal g-desired-num-military > 0)
        (current-age >= castle-age)
        (goal g-primary-unit my-unique-unit)
        (military-population g:< g-min-military-pop)
        (or
            (up-compare-goal g-enemy-elephants-count > 2)
            (or
                (up-compare-goal g-enemy-heavy-cavalry-count > 3)
                (up-compare-goal g-enemy-camel-count > 3)))
        (or
            (goal g-primary-enemy-threat g-enemy-heavy-cavalry-count)
            (or
                (goal g-primary-enemy-threat g-enemy-camel-count)
                (goal g-primary-enemy-threat g-enemy-elephants-count)))
        =>
        (up-modify-goal g-desired-num-monk c:max 2)
        )

    ;---------------
    ;   Imp Flank
    ;---------------

        ;---------------
        ;   Early Imp
        ;---------------

            ;Select support unit
            (defrule
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy EARLYI-UNIQUE)
            (goal g-support-unit 0)
            (goal g-position FLANK)
            (or
                (up-compare-goal g-enemy-foot-archers-count > 6)
                (or
                    (up-compare-goal g-enemy-cavalry-archers-count > 5)
                    (up-compare-goal g-enemy-hand-cannoneer-slinger-count > 3)))
            =>
            (set-goal g-support-unit skirmisher)
            )

            (defrule
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy EARLYI-UNIQUE)
            (goal g-support-unit 0)
            (goal g-position FLANK)
            (up-compare-goal g-archer-tech-progress >= PRIORITY-CASTLE-COMPLETE)
            (or
                (up-compare-goal g-enemy-special-unique-unit-count > 6)
                (and
                    (up-compare-goal g-enemy-special-unique-unit-count > 3)
                    (military-population < 12)))
            (or
                (up-compare-flag g-enemy-special-unique-unit-flag == CATAPHRACT)
                (or
                    (up-compare-flag g-enemy-special-unique-unit-flag == TEUTONIC-KNIGHT)
                    (up-compare-flag g-enemy-special-unique-unit-flag == JAGUAR-WARRIOR)))
            =>
            (set-goal g-support-unit archer)
            )

            (defrule
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy EARLYI-UNIQUE)
            (goal g-support-unit 0)
            (goal g-position FLANK)
            (up-compare-goal g-spearman-tech-progress >= PRIORITY-CASTLE-COMPLETE)
            (or
                (up-compare-goal g-enemy-light-cavalry-count > 12)
                (or
                    (up-compare-goal g-enemy-heavy-cavalry-count > 8)
                    (or
                        (up-compare-goal g-enemy-elephants-count > 5)
                        (and
                            (up-compare-goal g-enemy-special-unique-unit-count > 8)
                            (up-compare-flag g-enemy-special-unique-unit-flag == LEITIS)))))
            =>
            (set-goal g-support-unit spearman)
            )
            (defrule
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy EARLYI-UNIQUE)
            (goal g-support-unit 0)
            (goal g-position FLANK)
            (up-compare-goal g-spearman-tech-progress >= PRIORITY-CASTLE-COMPLETE)
            (military-population < 12)
            (or
                (up-compare-goal g-enemy-light-cavalry-count > 8)
                (or
                    (up-compare-goal g-enemy-heavy-cavalry-count > 5)
                    (or
                        (up-compare-goal g-enemy-elephants-count > 3)
                        (and
                            (up-compare-goal g-enemy-special-unique-unit-count > 5)
                            (up-compare-flag g-enemy-special-unique-unit-flag == LEITIS)))))
            =>
            (set-goal g-support-unit spearman)
            )

            (defrule
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy EARLYI-UNIQUE)
            (goal g-support-unit 0)
            (goal g-position FLANK)
            =>
            (set-goal g-support-unit archer)
            )

            (defrule
            (goal g-position FLANK)
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy EARLYI-UNIQUE)
            (goal g-support-unit spearman)
            =>
            (up-modify-goal g-desired-num-unique-unit g:= g-desired-num-military)
            (up-modify-goal g-desired-num-unique-unit c:%* 75)
            (up-modify-goal g-desired-num-spearman g:= g-desired-num-military)
            (up-modify-goal g-desired-num-spearman c:%* 25)
            )

            (defrule
            (goal g-position FLANK)
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy EARLYI-UNIQUE)
            (goal g-support-unit archer)
            =>
            (up-modify-goal g-desired-num-unique-unit g:= g-desired-num-military)
            (up-modify-goal g-desired-num-unique-unit c:%* 70)
            (up-modify-goal g-desired-num-archer g:= g-desired-num-military)
            (up-modify-goal g-desired-num-archer c:%* 30)
            )

            (defrule
            (goal g-position FLANK)
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy EARLYI-UNIQUE)
            (goal g-support-unit skirmisher)
            =>
            (up-modify-goal g-desired-num-unique-unit g:= g-desired-num-military)
            (up-modify-goal g-desired-num-unique-unit c:%* 60)
            (up-modify-goal g-desired-num-skirmisher g:= g-desired-num-military)
            (up-modify-goal g-desired-num-skirmisher c:%* 40)
            )

        ;-------------
        ;   Mid Imp
        ;-------------

            ;Select support unit
            (defrule
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy MIDI-UNIQUE)
            (goal g-support-unit 0)
            (goal g-position FLANK)
            (or
                (up-compare-goal g-enemy-foot-archers-count > 8)
                (or
                    (up-compare-goal g-enemy-cavalry-archers-count > 8)
                    (up-compare-goal g-enemy-hand-cannoneer-slinger-count > 5)))
            =>
            (set-goal g-support-unit skirmisher)
            )
            (defrule
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy MIDI-UNIQUE)
            (goal g-support-unit 0)
            (goal g-position FLANK)
            (or
                (up-compare-goal g-enemy-special-unique-unit-count > 8)
                (and
                    (up-compare-goal g-enemy-special-unique-unit-count > 5)
                    (military-population < 12)))
            (or
                (up-compare-flag g-enemy-special-unique-unit-flag == GENOESE-CROSSBOWMAN)
                (up-compare-flag g-enemy-special-unique-unit-flag == MAMELUKE))
            =>
            (set-goal g-support-unit skirmisher)
            )

            (defrule
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy MIDI-UNIQUE)
            (goal g-support-unit 0)
            (goal g-position FLANK)
            (up-compare-goal g-archer-tech-progress >= PRIORITY-CASTLE-COMPLETE)
            (or
                (up-compare-goal g-enemy-special-unique-unit-count > 8)
                (and
                    (up-compare-goal g-enemy-special-unique-unit-count > 5)
                    (military-population < 12)))
            (or
                (up-compare-flag g-enemy-special-unique-unit-flag == CATAPHRACT)
                (or
                    (up-compare-flag g-enemy-special-unique-unit-flag == TEUTONIC-KNIGHT)
                    (up-compare-flag g-enemy-special-unique-unit-flag == JAGUAR-WARRIOR)))
            =>
            (set-goal g-support-unit archer)
            )

            (defrule
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy MIDI-UNIQUE)
            (goal g-support-unit 0)
            (goal g-position FLANK)
            (or
                (up-compare-goal g-enemy-heavy-cavalry-count > 8)
                (or
                    (up-compare-goal g-enemy-elephants-count > 5)
                    (and
                        (up-compare-goal g-enemy-special-unique-unit-count > 8)
                        (up-compare-flag g-enemy-special-unique-unit-flag == LEITIS))))
            =>
            (set-goal g-support-unit spearman)
            )
            (defrule
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy MIDI-UNIQUE)
            (goal g-support-unit 0)
            (goal g-position FLANK)
            (military-population < 12)
            (or
                (up-compare-goal g-enemy-heavy-cavalry-count > 5)
                (or
                    (up-compare-goal g-enemy-elephants-count > 3)
                    (and
                        (up-compare-goal g-enemy-special-unique-unit-count > 5)
                        (up-compare-flag g-enemy-special-unique-unit-flag == LEITIS))))
            =>
            (set-goal g-support-unit spearman)
            )

            (defrule
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy MIDI-UNIQUE)
            (goal g-support-unit 0)
            (goal g-position FLANK)
            =>
            (set-goal g-support-unit skirmisher)
            )

            ;Modify unit counts
            (defrule
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy MIDI-UNIQUE)
            (goal g-support-unit spearman)
            (goal g-position FLANK)
            =>
            (up-modify-goal g-desired-num-unique-unit g:= g-desired-num-military)
            (up-modify-goal g-desired-num-unique-unit c:%* 65)
            (up-modify-goal g-desired-num-spearman g:= g-desired-num-military)
            (up-modify-goal g-desired-num-spearman c:%* 35)
            )
            
            (defrule
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy MIDI-UNIQUE)
            (goal g-support-unit archer)
            (goal g-position FLANK)
            =>
            (up-modify-goal g-desired-num-unique-unit g:= g-desired-num-military)
            (up-modify-goal g-desired-num-unique-unit c:%* 65)
            (up-modify-goal g-desired-num-archer g:= g-desired-num-military)
            (up-modify-goal g-desired-num-archer c:%* 35)
            )

            (defrule
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy MIDI-UNIQUE)
            (goal g-support-unit skirmisher)
            (goal g-position FLANK)
            =>
            (up-modify-goal g-desired-num-unique-unit g:= g-desired-num-military)
            (up-modify-goal g-desired-num-unique-unit c:%* 60)
            (up-modify-goal g-desired-num-skirmisher g:= g-desired-num-military)
            (up-modify-goal g-desired-num-skirmisher c:%* 40)
            )
            (defrule
            (up-compare-goal g-desired-num-military > 0)
            (goal g-current-strategy MIDI-UNIQUE)
            (goal g-support-unit skirmisher)
            (goal g-position FLANK)
            (or
                (up-compare-goal g-enemy-special-unique-unit-count > 8)
                (and
                    (up-compare-goal g-enemy-special-unique-unit-count > 5)
                    (military-population < 12)))
            (or
                (up-compare-flag g-enemy-special-unique-unit-flag == GENOESE-CROSSBOWMAN)
                (up-compare-flag g-enemy-special-unique-unit-flag == MAMELUKE))
            =>
            (up-modify-goal g-desired-num-unique-unit g:= g-desired-num-military)
            (up-modify-goal g-desired-num-unique-unit c:%* 70)
            (up-modify-goal g-desired-num-skirmisher g:= g-desired-num-military)
            (up-modify-goal g-desired-num-skirmisher c:%* 30)
            )

    ;----------------
    ;   Imp Pocket
    ;----------------

        ;Select support unit
        (defrule
        (up-compare-goal g-desired-num-military > 0)
        (or
            (goal g-current-strategy EARLYI-UNIQUE)
            (goal g-current-strategy MIDI-UNIQUE))
        (goal g-support-unit 0)
        (goal g-position POCKET)
        (or
            (up-compare-goal g-enemy-foot-archers-count > 12)
            (or
                (up-compare-goal g-enemy-cavalry-archers-count > 12)
                (up-compare-goal g-enemy-hand-cannoneer-slinger-count > 8)))
        =>
        (set-goal g-support-unit skirmisher)
        )
        (defrule
        (up-compare-goal g-desired-num-military > 0)
        (or
            (goal g-current-strategy EARLYI-UNIQUE)
            (goal g-current-strategy MIDI-UNIQUE))
        (goal g-support-unit 0)
        (goal g-position POCKET)
        (or
            (up-compare-goal g-enemy-special-unique-unit-count > 12)
            (and
                (up-compare-goal g-enemy-special-unique-unit-count > 8)
                (military-population < 12)))
        (or
            (up-compare-flag g-enemy-special-unique-unit-flag == GENOESE-CROSSBOWMAN)
            (up-compare-flag g-enemy-special-unique-unit-flag == MAMELUKE))
        =>
        (set-goal g-support-unit skirmisher)
        )

        (defrule
        (up-compare-goal g-desired-num-military > 0)
        (or
            (goal g-current-strategy EARLYI-UNIQUE)
            (goal g-current-strategy MIDI-UNIQUE))
        (goal g-support-unit 0)
        (goal g-position POCKET)
        (up-compare-goal g-archer-tech-progress >= PRIORITY-CASTLE-COMPLETE)
        (up-compare-goal g-enemy-special-unique-unit-count > 12)
        (or
            (up-compare-flag g-enemy-special-unique-unit-flag == CATAPHRACT)
            (or
                (up-compare-flag g-enemy-special-unique-unit-flag == TEUTONIC-KNIGHT)
                (up-compare-flag g-enemy-special-unique-unit-flag == JAGUAR-WARRIOR)))
        =>
        (set-goal g-support-unit archer)
        )
        (defrule
        (up-compare-goal g-desired-num-military > 0)
        (or
            (goal g-current-strategy EARLYI-UNIQUE)
            (goal g-current-strategy MIDI-UNIQUE))
        (goal g-support-unit 0)
        (goal g-position POCKET)
        (up-compare-goal g-archer-tech-progress >= PRIORITY-CASTLE-COMPLETE)
        (up-compare-goal g-enemy-special-unique-unit-count > 8)
        (military-population < 12)
        (or
            (up-compare-flag g-enemy-special-unique-unit-flag == CATAPHRACT)
            (or
                (up-compare-flag g-enemy-special-unique-unit-flag == TEUTONIC-KNIGHT)
                (up-compare-flag g-enemy-special-unique-unit-flag == JAGUAR-WARRIOR)))
        =>
        (set-goal g-support-unit archer)
        )

        (defrule
        (up-compare-goal g-desired-num-military > 0)
        (or
            (goal g-current-strategy EARLYI-UNIQUE)
            (goal g-current-strategy MIDI-UNIQUE))
        (goal g-support-unit 0)
        (goal g-position POCKET)
        (or
            (up-compare-goal g-enemy-heavy-cavalry-count > 12)
            (or
                (up-compare-goal g-enemy-elephants-count > 8)
                (and
                    (up-compare-goal g-enemy-special-unique-unit-count > 12)
                    (up-compare-flag g-enemy-special-unique-unit-flag == LEITIS))))
        =>
        (set-goal g-support-unit spearman)
        )
        (defrule
        (up-compare-goal g-desired-num-military > 0)
        (or
            (goal g-current-strategy EARLYI-UNIQUE)
            (goal g-current-strategy MIDI-UNIQUE))
        (goal g-support-unit 0)
        (goal g-position POCKET)
        (military-population < 12)
        (or
            (up-compare-goal g-enemy-heavy-cavalry-count > 12)
            (or
                (up-compare-goal g-enemy-elephants-count > 8)
                (and
                    (up-compare-goal g-enemy-special-unique-unit-count > 8)
                    (up-compare-flag g-enemy-special-unique-unit-flag == LEITIS))))
        =>
        (set-goal g-support-unit spearman)
        )

        (defrule
        (up-compare-goal g-desired-num-military > 0)
        (goal g-current-strategy MIDI-UNIQUE)
        (goal g-support-unit 0)
        (goal g-position POCKET)
        =>
        (set-goal g-support-unit skirmisher)
        )

        ;Modify unit counts
        (defrule
        (up-compare-goal g-desired-num-military > 0)
        (or
            (goal g-current-strategy EARLYI-UNIQUE)
            (goal g-current-strategy MIDI-UNIQUE))
        (goal g-support-unit spearman)
        (goal g-position POCKET)
        =>
        (up-modify-goal g-desired-num-unique-unit g:= g-desired-num-military)
        (up-modify-goal g-desired-num-unique-unit c:%* 65)
        (up-modify-goal g-desired-num-spearman g:= g-desired-num-military)
        (up-modify-goal g-desired-num-spearman c:%* 35)
        )
        
        (defrule
        (up-compare-goal g-desired-num-military > 0)
        (or
            (goal g-current-strategy EARLYI-UNIQUE)
            (goal g-current-strategy MIDI-UNIQUE))
        (goal g-support-unit archer)
        (goal g-position POCKET)
        =>
        (up-modify-goal g-desired-num-unique-unit g:= g-desired-num-military)
        (up-modify-goal g-desired-num-unique-unit c:%* 65)
        (up-modify-goal g-desired-num-archer g:= g-desired-num-military)
        (up-modify-goal g-desired-num-archer c:%* 35)
        )

        (defrule
        (up-compare-goal g-desired-num-military > 0)
        (or
            (goal g-current-strategy EARLYI-UNIQUE)
            (goal g-current-strategy MIDI-UNIQUE))
        (goal g-support-unit skirmisher)
        (goal g-position POCKET)
        =>
        (up-modify-goal g-desired-num-unique-unit g:= g-desired-num-military)
        (up-modify-goal g-desired-num-unique-unit c:%* 60)
        (up-modify-goal g-desired-num-skirmisher g:= g-desired-num-military)
        (up-modify-goal g-desired-num-skirmisher c:%* 40)
        )
        (defrule
        (up-compare-goal g-desired-num-military > 0)
        (or
            (goal g-current-strategy EARLYI-UNIQUE)
            (goal g-current-strategy MIDI-UNIQUE))
        (goal g-support-unit skirmisher)
        (goal g-position POCKET)
        (up-compare-goal g-enemy-special-unique-unit-count > 12)
        (or
            (up-compare-flag g-enemy-special-unique-unit-flag == GENOESE-CROSSBOWMAN)
            (up-compare-flag g-enemy-special-unique-unit-flag == MAMELUKE))
        =>
        (up-modify-goal g-desired-num-unique-unit g:= g-desired-num-military)
        (up-modify-goal g-desired-num-unique-unit c:%* 70)
        (up-modify-goal g-desired-num-skirmisher g:= g-desired-num-military)
        (up-modify-goal g-desired-num-skirmisher c:%* 30)
        )
        (defrule
        (up-compare-goal g-desired-num-military > 0)
        (or
            (goal g-current-strategy EARLYI-UNIQUE)
            (goal g-current-strategy MIDI-UNIQUE))
        (goal g-support-unit skirmisher)
        (goal g-position POCKET)
        (up-compare-goal g-enemy-special-unique-unit-count > 8)
        (military-population < 12)
        (or
            (up-compare-flag g-enemy-special-unique-unit-flag == GENOESE-CROSSBOWMAN)
            (up-compare-flag g-enemy-special-unique-unit-flag == MAMELUKE))
        =>
        (up-modify-goal g-desired-num-unique-unit g:= g-desired-num-military)
        (up-modify-goal g-desired-num-unique-unit c:%* 70)
        (up-modify-goal g-desired-num-skirmisher g:= g-desired-num-military)
        (up-modify-goal g-desired-num-skirmisher c:%* 30)
        )

    ;--------------
    ;   Late Imp
    ;--------------

        (defrule
        (up-compare-goal g-desired-num-military > 0)
        (goal g-current-strategy LATEI-UNIQUE)
        =>
        (up-modify-goal g-desired-num-unique-unit g:= g-desired-num-military)
        (up-modify-goal g-desired-num-unique-unit c:%* 65)
        (set-goal g-support-unit skirmisher)
        (up-modify-goal g-desired-num-skirmisher g:= g-desired-num-military)
        (up-modify-goal g-desired-num-skirmisher c:%* 35)
        )